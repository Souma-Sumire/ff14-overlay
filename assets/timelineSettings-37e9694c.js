import{d as ye,n as j,J as Ie,o as E,e as G,a as n,w as i,u as o,a0 as W,x as v,y as Q,t as _,s as _e,v as ge,F as X,L as te,ah as $,ai as me,B as ke,aj as Ne,C as et,N as Be,ak as Ae,ae as Oe,af as Ue,ad as we,a1 as De,al as be,c as P,ac as je,Y as tt,p as ze,am as Je,an as nt,G as Pe,H as qe,A as it,Z as Ve,b as ot,X as lt,$ as pe,ao as ae,U as D,T as ee,ap as $e,aq as st,ar as at,a3 as rt,a2 as ct,D as dt,ag as ut,as as mt,a4 as pt,a5 as ft}from"./vendor-67b87c3f.js";import{u as he,_ as Me,p as _t}from"./TimelineShow-79aa036d.js";import{U as Z}from"./util-831b56e7.js";import{g as gt}from"./actionChinese-f29d4188.js";import{g as yt,h as wt}from"./xivapi-a5c0f7f0.js";import{_ as ve}from"./_plugin-vue_export-helper-c27b6911.js";import{a as bt,c as ht}from"./overlay_plugin_api-409cb9ea.js";import{z as fe}from"./zoneInfo-9e4e9a78.js";import{r as vt}from"./index-f39c79ff.js";import{u as Tt,c as Ee}from"./useWebSocket-fd029fe2.js";import"./actWS-e2500b62.js";const c=new Map;c.set(26155,{type:"cast",window:[999,999]});c.set(28027,{type:"cast",window:[999,999]});c.set(26340,{type:"cast",window:[999,999]});c.set(25533,{type:"begincast",window:[60,60]});c.set(26376,{type:"cast",window:[999,999]});c.set(26814,{type:"begincast",window:[999,999]});c.set(25313,{type:"begincast",window:[200,200]});c.set(27526,{type:"begincast",window:[999,999]});c.set(26215,{type:"cast",window:[500,30]});c.set(29050,{type:"begincast",window:[200,30]});c.set(29156,{type:"cast",window:[20,20]});c.set(27973,{type:"cast",window:[20,20]});c.set(27937,{type:"begincast",window:[20,20]});c.set(28059,{type:"begincast",window:[20,20]});c.set(28060,{type:"begincast",window:[20,20]});c.set(28061,{type:"begincast",window:[20,20]});c.set(27956,{type:"begincast",window:[20,20]});c.set(27957,{type:"begincast",window:[20,20]});c.set(27952,{type:"begincast",window:[30,30]});c.set(27969,{type:"begincast",window:[20,20]});c.set(27971,{type:"begincast",window:[20,20]});c.set(27939,{type:"begincast",window:[20,20]});c.set(27966,{type:"begincast",window:[20,20]});c.set(25316,{type:"begincast",window:[999,999]});c.set(25544,{type:"begincast",window:[10,10]});c.set(26379,{type:"begincast",window:[10,10]});c.set(31552,{type:"begincast",window:[30,30]});c.set(31573,{type:"begincast",window:[30,30]});c.set(31573,{type:"begincast",window:[30,30]});c.set(31617,{type:"begincast",window:[8,8]});c.set(31624,{type:"begincast",window:[30,30]});c.set(31649,{type:"begincast",window:[30,30]});c.set(18864,{type:"cast",window:[10,2.5],once:!0});c.set(18480,{type:"cast",window:[200,60],once:!0});c.set(18516,{type:"cast",window:[250,65],once:!0});c.set(18522,{type:"begincast",window:[500,500],once:!0});c.set(18552,{type:"begincast",window:[67,67],once:!0});c.set(18553,{type:"cast",window:[67,67],once:!0});c.set(19083,{type:"cast",window:[900,0],once:!0});function Ft(S){const A=new Map;S.filter(f=>f.type==="begincast").map(f=>A.set(f.actionId,(A.get(f.actionId)??0)+1));for(const f of S){A.get(f.actionId)===1&&f.type==="begincast"&&(f.window=[12,12]);const s=c.get(f.actionId);(s==null?void 0:s.type)===f.type&&(f.window=s==null?void 0:s.window),f.syncOnce=!!(s!=null&&s.once)}return S}const xt={class:"fflogs-query-result-friendlies"},Ct=["src","onerror"],St=ye({__name:"FflogsImport",props:{filters:{}},emits:["newTimeline","showFFlogsToggle","clearCurrentlyTimeline","updateFilters"],setup(S,{emit:A}){const f=S,s=A,h=new RegExp("(?<=^|\\/)(?<code>\\w{16,})\\/?#fight=(?<fight>\\d+|last)"),q={begincast:"14",cast:"1[56]"},x=j("查询"),k=j(""),N=j(!1),e=Ie({});R();const I=he();function M(V){var y;$.fire({text:"正在解析数据 (步骤1/3)",showConfirmButton:!1,allowOutsideClick:!1,allowEscapeKey:!1}),R(),x.value="正在请求";const d=V.match(h);I.settings.api?d?d?(e.code=((y=d.groups)==null?void 0:y.code)??"",me.get(`https://cn.fflogs.com/v1/report/fights/${e.code}?api_key=${I.settings.api}`).then(m=>{var b,T;e.bossIDs=m.data.enemies.filter(a=>a.type==="Boss").map(a=>a.id),e.fightIndex=(((b=d==null?void 0:d.groups)==null?void 0:b.fight)==="last"?m.data.fights.length:Number.parseInt(((T=d==null?void 0:d.groups)==null?void 0:T.fight)??"0"))-1;const u=m.data.fights[e.fightIndex];e.zoneID=u.zoneID,e.start=u.start_time,e.end=u.end_time,e.friendlies=m.data.friendlies.filter(a=>a.icon!=="LimitBreak"&&a.fights.find(L=>L.id===e.fightIndex+1)),x.value="查询",e.abilityFilterEvents.length=0,e.abilityFilterCandidate.length=0,$.fire("在列表中选择一名玩家")}).catch(m=>{$.fire({icon:"error",title:"Oops...(步骤1)",text:m}),x.value="查询"})):($.fire({icon:"error",title:"url链接格式错误",footer:`验证规则：${h.toString().replaceAll(/\?<\w+>/g,"")}`}),x.value="查询"):($.fire({icon:"error",title:"FF logs 战斗记录链接 未填写",footer:"例如：aaAAAAaAAAaAaa11#fight=18"}),x.value="查询"):($.fire({icon:"error",title:"FF logs API Key 未填写",footer:'<a href="https://cn.fflogs.com/profile">点击这里，在最下方起名，然后获得你的V1 Client Key</a>'}),x.value="查询")}async function z(V){e.player=V,await O().then(()=>{e.abilityFilterCandidate=e.abilityFilterEvents.reduce((d,y)=>(y.sourceIsFriendly&&!d.find(m=>m.actionId===y.actionId)&&d.push(y),d),[])}).catch(d=>{$.fire({icon:"error",title:"Oops...(步骤2)",text:d})})}async function O(){$.fire({text:"正在解析数据，请耐心等待。(步骤2/3)",showConfirmButton:!1,allowOutsideClick:!1,allowEscapeKey:!1});const V=[];e.abilityFilterEvents.length=0;async function d(b){var T;await me.get(`https://cn.fflogs.com/v1/report/events/casts/${e.code}?start=${b}&end=${e.end}&hostility=0&sourceid=${(T=e.player)==null?void 0:T.id}&api_key=${I.settings.api}`).then(async a=>{V.push(...a.data.events),a.data.nextPageTimestamp&&a.data.nextPageTimestamp>0&&a.data.nextPageTimestamp<e.end&&await d(a.data.nextPageTimestamp)}).catch(a=>{$.fire({icon:"error",title:"Oops...(步骤3.1)",text:a})})}async function y(b,T){T>=0&&await me.get(`https://cn.fflogs.com/v1/report/events/casts/${e.code}?start=${b}&end=${e.end}&hostility=1&sourceid=${e.bossIDs[T]}&api_key=${I.settings.api}`).then(async a=>{V.push(...a.data.events),a.data.nextPageTimestamp&&a.data.nextPageTimestamp>0&&a.data.nextPageTimestamp<e.end&&await y(a.data.nextPageTimestamp,T),T<e.bossIDs.length-1&&await y(b,T+1)}).catch(a=>{$.fire({icon:"error",title:"Oops...(步骤3.2)",text:a})})}const m=await d(e.start),u=await y(e.start,0);await Promise.all([m,u]).then(()=>{var b,T;for(const a of V)a.type==="begincast"&&a.sourceIsFriendly||e.abilityFilterEvents.push({time:Number(((a.timestamp-e.start)/1e3).toFixed(1)),type:a.type,actionName:gt(a.ability.guid)??a.ability.name,actionId:a.ability.guid,sourceIsFriendly:a.sourceIsFriendly,url:((b=a==null?void 0:a.ability)==null?void 0:b.abilityIcon.replace("-","/").replace(".png",""))??"000000/000405",window:void 0});(T=e.player)!=null&&T.icon&&f.filters[e.player.icon]&&(e.abilityFilterSelected=f.filters[e.player.icon]),$.fire("请在技能过滤器中选择需要的技能")})}function Y(){var V,d,y,m;$.fire({text:"正在解析数据 (步骤3/3)",showConfirmButton:!1,allowOutsideClick:!1,allowEscapeKey:!1}),(V=e.player)!=null&&V.icon&&s("updateFilters",(d=e.player)==null?void 0:d.icon,JSON.parse(JSON.stringify(e.abilityFilterSelected))),e.abilityFilterEvents=e.abilityFilterEvents.filter(u=>u.sourceIsFriendly&&e.abilityFilterSelected.includes(u.actionId)||!u.sourceIsFriendly).sort((u,b)=>u.time-b.time),e.abilityFilterEvents=Ft(e.abilityFilterEvents),e.abilityFilterEventsAfterFilterRawTimeline=e.abilityFilterEvents.map(u=>u.sourceIsFriendly?`${u.time} "<${u.actionName}>~"${N.value?` tts "${u.actionName}"`:""}`:/^(?:攻击|attack|攻撃)$|^unknown/i.test(u.actionName)||u.type==="cast"&&u.window===void 0?`# ${u.time} "${u.actionName}"`:`${u.time} "${u.actionName}" sync /^.{14} \\w+ ${q[u.type]}:4.{7}:[^:]+:${u.actionId.toString(16).toUpperCase()}:/${u.window?` window ${u.window.join(",")}`:""}`).join(`
`),s("newTimeline",`导入${(y=e.player)==null?void 0:y.name}`,{zoneId:e.zoneID.toString(),jobs:[((m=e.player)==null?void 0:m.icon)??"NONE"]},e.abilityFilterEventsAfterFilterRawTimeline,`${e.code}#fight=${e.fightIndex+1}`),R(),s("showFFlogsToggle"),$.fire({position:"top-end",icon:"success",title:"已生成新时间轴",showConfirmButton:!1,timer:1500})}function R(){e.code="",e.fightIndex=0,e.start=0,e.end=0,e.friendlies=[],e.abilityFilterEvents=[],e.abilityFilterCandidate=[],e.abilityFilterSelected=[],e.abilityFilterEventsAfterFilterRawTimeline="",e.player=void 0,e.zoneID=0,e.bossIDs=[]}return(V,d)=>{const y=ke,m=Ne,u=et,b=Be,T=Ae,a=Oe,L=Ue,ne=we,ie=je,ce=De,oe=be;return E(),G(X,null,[n(T,{inline:!0,class:"fflogs-query"},{default:i(()=>[n(m,{label:"FF logs 战斗",style:{width:"450px"}},{default:i(()=>[n(y,{modelValue:o(k),"onUpdate:modelValue":d[0]||(d[0]=w=>W(k)?k.value=w:null),placeholder:"reports/AAAaAaAAaa1aA1aA#fight=3",autocomplete:"on"},null,8,["modelValue"])]),_:1}),n(m,{label:"FF logs V1 Key",style:{width:"450px"}},{default:i(()=>[n(y,{modelValue:o(I).settings.api,"onUpdate:modelValue":d[1]||(d[1]=w=>o(I).settings.api=w)},null,8,["modelValue"])]),_:1}),n(m,{label:"添加TTS",style:{width:"100px"}},{default:i(()=>[n(u,{modelValue:o(N),"onUpdate:modelValue":d[2]||(d[2]=w=>W(N)?N.value=w:null)},null,8,["modelValue"])]),_:1}),n(m,null,{default:i(()=>[n(b,{disabled:o(x)==="正在请求",type:"primary",onClick:d[3]||(d[3]=w=>M(o(k)))},{default:i(()=>[v(Q(o(x)),1)]),_:1},8,["disabled"])]),_:1})]),_:1}),_("div",xt,[n(ne,null,{default:i(()=>[_e(n(L,{data:o(e).friendlies.filter(w=>w.icon!=="NPC"),stripe:"",border:"",class:"fflogs-query-result-friendlies-list"},{default:i(()=>[n(a,{prop:"name",label:"玩家名称","min-width":"60px"}),n(a,{prop:"server",label:"服务器","min-width":"60px"}),n(a,{label:"职业","min-width":"60px"},{default:i(({row:w})=>[v(Q(o(Z).nameToFullName(o(Z).jobEnumToJob(o(Z).iconToJobEnum(w.icon))).cn),1)]),_:1}),n(a,{label:"选定","min-width":"20px"},{default:i(w=>[n(b,{type:"primary",size:"small",onClick:Te=>z(w.row)},{default:i(()=>[v(" 选择 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),[[ge,o(e).abilityFilterEvents.length===0]])]),_:1}),_e(n(ne,{class:"fflogs-query-result-friendlies-ability-filter-select"},{default:i(()=>[n(oe,{span:20},{default:i(()=>[n(ce,{modelValue:o(e).abilityFilterSelected,"onUpdate:modelValue":d[4]||(d[4]=w=>o(e).abilityFilterSelected=w),multiple:"",placeholder:"技能过滤器","fit-input-width":!0},{default:i(()=>[(E(!0),G(X,null,te(o(e).abilityFilterCandidate,w=>(E(),P(ie,{key:w.actionId,class:"ability-filter-li",value:w.actionId,label:w.actionName},{default:i(()=>[_("img",{src:o(yt)(`/i/${w.url}.png`),class:"ability-filter-li-icon",title:"",onerror:o(wt)},null,8,Ct),v(Q(w.actionName),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),n(oe,{span:4},{default:i(()=>[n(b,{type:"success",onClick:d[5]||(d[5]=w=>Y())},{default:i(()=>[v(" 选择好了 ")]),_:1})]),_:1})]),_:1},512),[[ge,o(e).abilityFilterEvents.length>0]])])],64)}}});const Vt=ve(St,[["__scopeId","data-v-98e77142"]]),re=S=>(Pe("data-v-52d0d6b5"),S=S(),qe(),S),$t=re(()=>_("h3",{style:{margin:"0",padding:"10px","background-color":"#f5f7fa",cursor:"move"}}," 设置 ",-1)),Et=re(()=>_("h3",{class:"form-section-title"}," 参数 ",-1)),It=re(()=>_("h3",{class:"form-section-title"}," 样式 ",-1)),kt=re(()=>_("h3",{class:"form-section-title"}," 测试用例 ",-1)),Nt=ye({__name:"SettingsDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup(S,{emit:A}){const f=S,s=A,h=he();tt(()=>{h.saveTimelineSettings()});const q=ze({get:()=>f.modelValue,set:N=>s("update:modelValue",N)}),x=j(-15),k=j([{time:-15,action:"<圣光幕帘>~",show:!0},{time:-2,action:"<圣灵>~",show:!0},{time:0,action:"战斗开始！",show:!0},{time:3,action:"<挑衅>~",show:!0},{time:5,action:"<神圣领域>~",show:!0}]);return(N,e)=>{const I=it,M=Ne,z=be,O=we,Y=Je,R=Me,V=Ae,d=nt;return E(),P(d,{modelValue:o(q),"onUpdate:modelValue":e[1]||(e[1]=y=>W(q)?q.value=y:null),modal:!0,overflow:"","close-on-click-modal":!1,"custom-class":"timeline-dialog",width:"600px","append-to-body":!0,draggable:!0},{header:i(()=>[$t]),default:i(()=>[n(V,{"label-position":"right","label-width":"120px",class:"timeline-form"},{default:i(()=>[Et,n(O,{gutter:20},{default:i(()=>[(E(!0),G(X,null,te(o(h).configValues,(y,m,u)=>(E(),P(z,{key:u,span:12},{default:i(()=>[n(M,{label:o(h).configTranslate[m]},{default:i(()=>[n(I,{modelValue:o(h).configValues[m],"onUpdate:modelValue":b=>o(h).configValues[m]=b,min:0,step:.1,class:"custom-input"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])]),_:2},1024))),128))]),_:1}),It,n(O,{gutter:20},{default:i(()=>[(E(!0),G(X,null,te(o(h).showStyle,(y,m,u)=>(E(),P(z,{key:u,span:12},{default:i(()=>[n(M,{label:o(h).showStyleTranslate[m]},{default:i(()=>[n(I,{modelValue:o(h).showStyle[m],"onUpdate:modelValue":b=>o(h).showStyle[m]=b,min:0,step:.01,class:"custom-input"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])]),_:2},1024))),128))]),_:1}),kt,n(O,{gutter:20},{default:i(()=>[n(Y,{modelValue:o(x),"onUpdate:modelValue":e[0]||(e[0]=y=>W(x)?x.value=y:null),min:-15,max:5,step:.1,"show-input":""},null,8,["modelValue"]),n(R,{config:o(h).configValues,lines:o(k),runtime:o(x),"show-style":o(h).showStyle},null,8,["config","lines","runtime","show-style"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}});const Bt=ve(Nt,[["__scopeId","data-v-52d0d6b5"]]),B=S=>(Pe("data-v-81a5cb01"),S=S(),qe(),S),At=B(()=>_("br",null,null,-1)),Ot=B(()=>_("br",null,null,-1)),Ut={class:"slider-demo-block"},Dt=B(()=>_("span",null,"模拟时间：",-1)),jt={class:"timeline-info-config"},zt=B(()=>_("span",null,"显示名称：",-1)),Jt={class:"timeline-info-config"},Pt=B(()=>_("span",null,"限定地图：",-1)),qt={class:"timeline-info-config"},Mt=B(()=>_("span",null,"限定职业：",-1)),Rt={class:"timeline-info-config"},Lt=B(()=>_("span",null,"战斗来源：",-1)),Kt={class:"timeline-info-config"},Ht=B(()=>_("span",null,"创建时间：",-1)),Qt={style:{flex:"1"}},Zt={style:{"max-height":"353px"}},Gt={class:"timeline-timeline-view"},Wt=B(()=>_("br",null,null,-1)),Xt=B(()=>_("br",null,null,-1)),Yt=ye({__name:"timelineSettings",setup(S){const{wsConnected:A}=Tt(),f=j(0),s=he(),h=Ve(s,"allTimelines"),q=Ve(s,"filters"),x=[{id:"0",name:"任意"}],k=j(!1),N=j(!1),e=Ie({timeline:{name:"空",condition:{zoneId:"0",jobs:["NONE"]},timeline:"空",codeFight:"空",create:"空"}}),I=j([]);let M=null,z=!1;m();async function O(){I.value=[{time:0,action:"正在加载...",show:!0,windowBefore:0,windowAfter:0,alertAlready:!0}],I.value=await _t(e.timeline.timeline)}const Y=[...Z.getBattleJobs3(),"NONE"];R();function R(){var r,t,g;for(const C in fe)if(Object.prototype.hasOwnProperty.call(fe,C)){const p=fe[C];switch(p.contentType){case 4:case 5:case 28:x.push({id:C,name:((r=p.name)==null?void 0:r.cn)??((t=p.name)==null?void 0:t.ja)??((g=p.name)==null?void 0:g.ja)??C})}}a(),s.sortTimelines()}function V(r,t={}){ht({call:"broadcast",source:"soumaTimelineSettings",msg:{type:r,data:t}})}function d(){k.value=!k.value,m()}function y(){const r="https://docs.qq.com/sheet/DTWxKT3lFbmpDV3Fm?tab=5ovrc8";window.open(r,"_blank")}function m(){f.value=-30,e.timeline={name:"空",condition:{zoneId:"0",jobs:["NONE"]},timeline:"空",codeFight:"空",create:"空"}}function u(){e.timeline=s.allTimelines[s.newTimeline()],O()}function b(r){window.scrollTo({top:0,behavior:"smooth"}),e.timeline=r,O()}function T(r){$.fire({title:`确定要删除${r.name}吗？`,text:"这将无法撤回！",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"确认删除",cancelButtonText:"取消"}).then(t=>{t.isConfirmed&&(m(),h.value.splice(h.value.findIndex(g=>g===r),1))})}function a(){s.loadTimelineSettings()}function L(r){const t=JSON.stringify(r),g=JSON.parse(t);for(const J of g)J.timeline=J.timeline.replace(/^#.*\n/gm,"");const C=JSON.stringify(g),p=ae.compressToBase64(t),F=ae.compressToBase64(C),U=p.length,K=F.length;if(U===K){Ee(p).then(()=>{D({message:"数据复制成功，已写入剪切板。",type:"success",duration:2e3})}).catch(()=>{D({message:"复制失败，请手动复制！",type:"error",duration:3e3})});return}const de=((U-K)/U*100).toFixed(2);ee.confirm(`
     1. 完整版本（包含注释）<br>
     &nbsp;&nbsp;&nbsp;- 大小：${U} 字节<br>
     &nbsp;&nbsp;&nbsp;- 包含所有时间轴信息和注释<br><br>
     2. 优化版本（不含注释）<br>
     &nbsp;&nbsp;&nbsp;- 大小：${K} 字节<br>
     &nbsp;&nbsp;&nbsp;- 节省 ${de}% 的空间<br>
     &nbsp;&nbsp;&nbsp;- 仅包含必要的时间轴数据`,"请选择导出版本：",{confirmButtonText:"导出优化版本",cancelButtonText:"导出完整版本",distinguishCancelAndClose:!0,closeOnClickModal:!1,closeOnPressEscape:!1,dangerouslyUseHTMLString:!0,showClose:!0,type:"info",callback:J=>{(J==="cancel"||J==="confirm")&&Ee(J==="confirm"?F:p).then(()=>{D({message:"压缩数据复制成功，已写入剪切板。",type:"success",duration:2e3})}).catch(()=>{D({message:"复制失败，请手动复制！",type:"error",duration:3e3})})}})}function ne(){ee.prompt("请输入导出的字符串","导入时间轴",{confirmButtonText:"解析",cancelButtonText:"取消",inputType:"textarea",inputValidator:r=>{if(!r)return"请输入导出的字符串";let t;try{t=JSON.parse(r)}catch{try{const g=ae.decompressFromBase64(r);t=JSON.parse(g)}catch{return"无法解析输入的数据，请确保输入正确的JSON或压缩后的字符串。"}}return Array.isArray(t)?t.length===0?"导入的数据不包含任何时间轴。":!0:"导入的数据格式不正确。"},inputErrorMessage:"无效的输入"}).then(({value:r})=>{let t;try{t=JSON.parse(r)}catch{const p=ae.decompressFromBase64(r);t=JSON.parse(p)}const g=t.length,C=t.map(p=>`「${p.name}」`).join(", ");ee({title:"确认",message:`导入 ${g} 个时间轴：
${C}
？`,showCancelButton:!0,showConfirmButton:!0,confirmButtonText:"覆盖",cancelButtonText:"追加",distinguishCancelAndClose:!0,type:"warning",callback:p=>{p==="confirm"?ee.confirm("覆盖操作将删除所有现有的时间轴。确定要继续吗？","二次确认",{confirmButtonText:"确定覆盖",cancelButtonText:"取消",type:"warning"}).then(()=>{ie(t,!0)}).catch(()=>{}):p==="cancel"&&ie(t,!1)}})}).catch(()=>{})}function ie(r,t){t&&(s.allTimelines.length=0),s.allTimelines.push(...r),s.sortTimelines();for(const F of s.allTimelines)F.condition.jobs===void 0&&(F.condition.jobs=[F.condition.job]);if(m(),t){D({type:"success",message:"覆盖成功！",duration:2e3});return}const g=[],C=new Set;for(const F of s.allTimelines){const U=JSON.stringify({name:F.name,condition:F.condition,timeline:F.timeline,codeFight:F.codeFight,create:F.create});C.has(U)||(C.add(U),g.push(F))}const p=s.allTimelines.length-g.length;s.allTimelines=g,D({message:`追加成功！共导入 ${r.length} 个时间轴，但其中 ${p} 个重复，已自动移除。`,type:"success",duration:3e3})}const ce=ze(()=>`${(f.value<0?"-":"")+(Array(2).join("0")+(Math.floor(f.value/60)+(f.value<0?1:0))).slice(-2)}:${(Array(2).join("0")+Math.floor(f.value%60)).slice(-2)}`);function oe(){e.timeline.timeline=e.timeline.timeline.replaceAll(new RegExp("(?<=^|#\\s*)(?<time>[:：\\d.]+)","gm"),(r,t)=>/^\d+:\d+(?:\.\d{1,2})?$/.test(r.toString())?$e.duration(`00:${r.toString()}`).as("seconds").toString():$e.utc(Number.parseFloat(r.toString())*1e3).format("mm:ss.S"))}function w(){const r=vt.resolve({path:"/timelineHelp"}).href;window.open(r,"_blank")}function Te(r){s.configValues=r.configValues,s.showStyle=r.showStyle}const Re=r=>{if(r.source==="soumaTimeline"&&r.msg.type==="post"){z=!1,M.close();const t=r.msg.data;if(s.allTimelines.length===0&&t.allTimelines.length>s.allTimelines.length){for(const g of t.allTimelines)g.condition.jobs===void 0&&(g.condition.jobs=[g.condition.job]),Reflect.deleteProperty(g.condition,"job");s.allTimelines=t.allTimelines,s.configValues=t.configValues,s.showStyle=t.showStyle,D.closeAll(),D({message:"数据获取成功",type:"success",duration:3e3})}}};function Fe(){z=!0,M=st.service({lock:!0,text:"正在请求数据，请确保ACT与时间轴悬浮窗已开启...，若 3 秒内仍未获取到数据，请检查ACT状态，且确认 timeline 悬浮窗已开启。",background:"rgba(0, 0, 0, 0.7)"}),V("get"),setTimeout(()=>{z&&(D.info("重新尝试获取数据..."),Fe())},5e3)}function Le(){ee.confirm("你确定要将当前数据发送至 ACT 悬浮窗吗？悬浮窗中的内容将会被覆盖！","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{V("post",s.$state)})}function Ke(r){var g;const t=((g=Z.nameToFullName(r))==null?void 0:g.cn)??"job";return t==="冒险者"?"全部职业":t}return ot(()=>{bt("BroadcastMessage",Re);const r=lt(A,t=>{t&&(Fe(),r())})}),(r,t)=>{const g=at,C=we,p=Be,F=rt,U=ct,K=be,de=dt,J=Bt,xe=Vt,He=Je,le=ke,Ce=je,Se=De,Qe=Me,ue=ut,se=Oe,Ze=Ue,Ge=mt,We=pt,Xe=ft;return E(),P(Xe,{class:"container"},{default:i(()=>[n(de,null,{default:i(()=>[n(C,{"m-b-5":""},{default:i(()=>[n(g,{title:"为防止用户数据意外丢失，在编辑完成后，你需要手动点击右侧绿色「应用」按钮，才会使得改动应用到悬浮窗中。",type:"info",closable:!1})]),_:1}),n(C,{align:"middle"},{default:i(()=>[n(K,{span:20},{default:i(()=>[n(U,{wrap:""},{default:i(()=>[n(F,null,{default:i(()=>[n(p,{type:"primary",onClick:t[0]||(t[0]=l=>d())},{default:i(()=>[v(" 从 FFlogs 生成 ")]),_:1}),n(p,{type:"primary",onClick:t[1]||(t[1]=l=>y())},{default:i(()=>[v(" 从 在线文档 获取 ")]),_:1}),n(p,{type:"primary",onClick:t[2]||(t[2]=l=>u())},{default:i(()=>[v(" 手动编写 ")]),_:1})]),_:1}),n(F,null,{default:i(()=>[n(p,{onClick:t[3]||(t[3]=l=>ne())},{default:i(()=>[v(" 导入字符串 ")]),_:1}),n(p,{class:"export",onClick:t[4]||(t[4]=l=>L(o(h)))},{default:i(()=>[v(" 导出全部 ")]),_:1})]),_:1}),n(F,null,{default:i(()=>[n(p,{onClick:t[5]||(t[5]=l=>w())},{default:i(()=>[v(" 时间轴语法 ")]),_:1})]),_:1}),n(F,null,{default:i(()=>[n(p,{type:"success",onClick:t[6]||(t[6]=l=>Le())},{default:i(()=>[v(" 应用 ")]),_:1})]),_:1})]),_:1})]),_:1}),n(K,{span:4,style:{"text-align":"right"}},{default:i(()=>[n(p,{color:"#626aef",style:{color:"white"},onClick:t[7]||(t[7]=l=>N.value=!0)},{default:i(()=>[v(" 设置 ")]),_:1})]),_:1})]),_:1})]),_:1}),n(J,{modelValue:o(N),"onUpdate:modelValue":t[8]||(t[8]=l=>W(N)?N.value=l:null),onSave:Te},null,8,["modelValue"]),n(We,null,{default:i(()=>[At,o(k)?(E(),P(xe,{key:0,filters:o(q),onClearCurrentlyTimeline:m,onShowFFlogsToggle:t[9]||(t[9]=()=>k.value=!o(k)),onNewTimeline:o(s).newTimeline,onUpdateFilters:o(s).updateFilters},null,8,["filters","onNewTimeline","onUpdateFilters"])):pe("",!0),Ot,_e(n(ue,null,{default:i(()=>[_("div",Ut,[Dt,n(He,{modelValue:o(f),"onUpdate:modelValue":t[10]||(t[10]=l=>W(f)?f.value=l:null),min:-30,max:1500,step:.1,"show-input":""},null,8,["modelValue"]),_("div",null,Q(o(ce)),1)]),n(C,{class:"timeline-info"},{default:i(()=>[_("div",null,[_("p",jt,[zt,n(le,{modelValue:o(e).timeline.name,"onUpdate:modelValue":t[11]||(t[11]=l=>o(e).timeline.name=l),class:"timeline-info-name"},null,8,["modelValue"])]),_("p",Jt,[Pt,n(Se,{modelValue:o(e).timeline.condition.zoneId,"onUpdate:modelValue":t[12]||(t[12]=l=>o(e).timeline.condition.zoneId=l),filterable:""},{default:i(()=>[(E(),G(X,null,te(x,l=>n(Ce,{key:l.id,label:l.name,value:l.id},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_("p",qt,[Mt,n(Se,{modelValue:o(e).timeline.condition.jobs,"onUpdate:modelValue":t[13]||(t[13]=l=>o(e).timeline.condition.jobs=l),multiple:"",required:"",placeholder:"职业","collapse-tags":"","collapse-tags-tooltip":""},{default:i(()=>[(E(),G(X,null,te(Y,l=>n(Ce,{key:l,label:Ke(l),value:l},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_("p",Rt,[Lt,n(le,{modelValue:o(e).timeline.codeFight,"onUpdate:modelValue":t[14]||(t[14]=l=>o(e).timeline.codeFight=l),disabled:""},null,8,["modelValue"])]),_("p",Kt,[Ht,n(le,{modelValue:o(e).timeline.create,"onUpdate:modelValue":t[15]||(t[15]=l=>o(e).timeline.create=l),disabled:""},null,8,["modelValue"])]),n(C,{"m-b-10px":""},{default:i(()=>[n(p,{span:12,class:"export",onClick:t[16]||(t[16]=l=>L([o(e).timeline]))},{default:i(()=>[v(" 单独导出 ")]),_:1}),n(p,{type:"primary",span:12,onClick:t[17]||(t[17]=l=>oe())},{default:i(()=>[v(" 切换时间 ")]),_:1})]),_:1}),n(C,null,{default:i(()=>[n(p,{span:24,onClick:t[18]||(t[18]=l=>m())},{default:i(()=>[v(" 隐藏编辑界面 ")]),_:1})]),_:1})]),_("div",Qt,[n(le,{modelValue:o(e).timeline.timeline,"onUpdate:modelValue":t[19]||(t[19]=l=>o(e).timeline.timeline=l),class:"timeline-timeline-raw",type:"textarea",rows:12,wrap:"off",placeholder:"请键入时间轴文本",style:{"max-width":"569px"},onChange:t[20]||(t[20]=l=>O())},null,8,["modelValue"])]),_("div",Zt,[_("div",Gt,[n(Qe,{config:o(s).configValues,lines:o(I),runtime:o(f),"show-style":o(s).showStyle},null,8,["config","lines","runtime","show-style"])])])]),_:1}),Wt]),_:1},512),[[ge,o(e).timeline.create!=="空"]]),Xt,o(h).length>0?(E(),P(ue,{key:1},{default:i(()=>[n(Ze,{data:o(h),style:{width:"100%"},stripe:""},{default:i(()=>[n(se,{prop:"name",label:"名称"}),n(se,{prop:"conditon",label:"地图",sortable:""},{default:i(l=>{var H;return[v(Q((H=x.find(Ye=>Ye.id===l.row.condition.zoneId))==null?void 0:H.name),1)]}),_:1}),n(se,{prop:"conditon",label:"职业"},{default:i(l=>[v(Q(l.row.condition.jobs.map(H=>o(Z).nameToFullName(H).cn).join("、")),1)]),_:1}),n(se,{fixed:"right",label:"操作",width:"150"},{default:i(l=>[n(p,{type:"primary",size:"small",onClick:H=>b(l.row)},{default:i(()=>[v(" 编辑 ")]),_:2},1032,["onClick"]),n(p,{type:"danger",size:"small",onClick:H=>T(l.row)},{default:i(()=>[v(" 删除 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})):pe("",!0),o(h).length===0?(E(),P(ue,{key:2},{default:i(()=>[n(Ge,{description:"点击上方新建或导入一个时间轴吧~"})]),_:1})):pe("",!0)]),_:1})]),_:1})}}});const mn=ve(Yt,[["__scopeId","data-v-81a5cb01"]]);export{mn as default};
