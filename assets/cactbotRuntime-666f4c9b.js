import{d as z,A as k,C as T,o as f,b as _,J as A,K as L,a as w,w as R,u as o,h as U,R as ae,t as E,H as $,aG as oe,B as re,_ as ne,F as se,r as D,a3 as le,g as y,aH as ie,S as H,i as ue,p as ce,l as pe,c as de}from"./vendor-bfd3a191.js";import{U as s,j as me}from"./util-ef9ccf87.js";import{_ as q}from"./index-4163f07d.js";import{a as M,c as fe}from"./overlay_plugin_api-409cb9ea.js";const ye={flex:"~ col"},_e=z({__name:"dragJob",props:{party:{}},emits:["updateSortArr"],setup(h,{emit:b}){const m=k(),v=k(!0),P=b,V=h,I=()=>{P("updateSortArr",Object.values(p.value).flat().map(r=>r.id))},a=[{role:"tank",color:"blue"},{role:"healer",color:"green"},{role:"dps",color:"red"},{role:"crafter",color:"yellow"},{role:"gatherer",color:"purple"},{role:"none",color:"gray"}],N=r=>V.party.find(i=>i.job===r),j=s.getBattleJobs3(),x=(()=>{const r={},i={tank:s.isTankJob,healer:s.isHealerJob,dps:s.isDpsJob,crafter:s.isCraftingJob,gatherer:s.isGatheringJob};for(const n of a.map(u=>u.role))r[n]=(n==="none"?[]:j.filter(u=>i[n](u))).map(u=>s.jobToJobEnum(u)).sort((u,d)=>s.enumSortMethod(u,d));return r})(),J=Object.values(x).flat().map(r=>({name:s.nameToFullName(s.jobEnumToJob(r)).simple1,id:r})),p=T("cactbotRuntime-jobList",(()=>{const r={};for(const i of a.map(n=>n.role))r[i]=J.filter(n=>x[i].includes(n.id)).sort((n,u)=>x[i].indexOf(n.id)-x[i].indexOf(u.id));return r})());return(r,i)=>(f(),_("div",ye,[(f(),_(A,null,L(a,(n,u)=>w(o(oe),{key:u,ref_for:!0,ref_key:"el",ref:m,disabled:!v.value,modelValue:o(p)[n.role],"onUpdate:modelValue":d=>o(p)[n.role]=d,animation:"150",ghostClass:"ghost",class:"flex flex-row gap-0.25 p-0 m-t-0.25 m-b-0.25 rounded",onUpdate:I,filter:".no-draggable",forceFallback:!0},{default:R(()=>[(f(!0),_(A,null,L(o(p)[n.role],d=>U((f(),_("div",{key:d.id,class:ae(`${N(d.id)?`draggable bg-${n.color} cursor-move`:"no-draggable bg-gray-700/50 opacity-33"} rounded p-l-0.6 p-r-0.6 p-t-0 p-b-0.3 m-0 color-white`)},E(d.name),3)),[[$,V.party.find(S=>S.job===36)?!0:d.id!==36]])),128))]),_:2},1032,["disabled","modelValue","onUpdate:modelValue"])),64))]))}});const be=q(_e,[["__scopeId","data-v-a90d6e1a"]]),B=h=>(ce("data-v-647100eb"),h=h(),pe(),h),ve=B(()=>y("span",null,"用法",-1)),ge=B(()=>y("p",null,"使悬浮窗的位置分配对应游戏内的实际位置（D1D2等）",-1)),he=B(()=>y("ul",null,[y("li",null,"临时：下拉选择框修改。"),y("li",null,"长期：用鼠标拖动职能顺序。")],-1)),je={class:"players"},xe={class:"name"},Je={key:0,style:{position:"fixed",bottom:"0"}},Se=z({__name:"cactbotRuntime",setup(h){const b=(e,t)=>Array(t).fill(e).map((c,C)=>c+(+C+1)),m={tank:["MT","ST",...b("T",6)],healer:[...b("H",8)],dps:[...b("D",8)],crafter:[...b("C",8)],gatherer:[...b("G",8)],none:[...b("N",8)]},v=k(!1),P=T("cactbotRuntime-sortArr",me),V=[{id:"10000001",name:"虚构战士",job:21,inParty:!0},{id:"10000002",name:"虚构骑士",job:19,inParty:!0},{id:"10000003",name:"虚构占星",job:33,inParty:!0},{id:"10000004",name:"虚构学者",job:28,inParty:!0},{id:"10000005",name:"虚构忍者",job:30,inParty:!0},{id:"10000006",name:"虚构武士",job:34,inParty:!0},{id:"10000008",name:"虚构诗人",job:23,inParty:!0},{id:"10000007",name:"虚构召唤",job:27,inParty:!0}],a=T("cactbotRuntime-data",{party:[]}),N=T("cactbotRuntime-showTips",k(!0)),j=re({tank:0,healer:0,dps:0,crafter:0,gatherer:0,none:0});function x(){for(const e in j)Object.prototype.hasOwnProperty.call(j,e)&&(j[e]=a.value.party.reduce((t,c)=>i(c.job)===e?t+1:t,0))}const F=e=>{const t=i(e);return m[t].filter((c,C)=>C<j[t])},J=location.href.includes("localhost"),p=k(!1),r=k(J?"虚构SMN":""),i=e=>{const t=Number(e);return[1,3,19,21,32,37].includes(t)?"tank":[6,24,28,33,40].includes(t)?"healer":[2,4,5,7,20,22,23,25,26,27,29,30,31,34,35,36,38,39].includes(t)?"dps":s.isCraftingJob(s.jobEnumToJob(e))?"crafter":s.isGatheringJob(s.jobEnumToJob(e))?"gatherer":"none"},n=()=>{a.value.party.sort((e,t)=>P.value.indexOf(e.job)-P.value.indexOf(t.job));for(const e of a.value.party)e.rp=void 0,e.rp=d(e)},u=e=>{a.value.party[e].specify=!0;const t=a.value.party.find(c=>c.rp===a.value.party[e].rp&&c.id!==a.value.party[e].id);t&&(t.rp=d(t),t.specify=!0),S()},d=e=>m[i(e.job)].find(t=>!a.value.party.find(c=>c.rp===t))??"unknown",S=()=>{const e=[...m.tank,...m.healer,...m.dps,...m.crafter,...m.gatherer,...m.none];a.value.party.sort((t,c)=>e.indexOf(t.rp??"")-e.indexOf(c.rp??"")),fe({call:"broadcast",source:"soumaRuntimeJS",msg:{party:a.value.party}})},K=()=>{p.value=!0},Q=()=>{p.value=!1},W=e=>{P.value=e,G()},X=e=>s.nameToFullName(s.jobEnumToJob(e)).simple1,Y=e=>e,G=()=>{n(),x(),S()};return ne(()=>a.value.party,()=>{G()},{immediate:!0}),se(()=>{S(),M("PartyChanged",e=>{N.value&&(v.value=!0),!(J&&e.party.length===0)&&(a.value.party=e.party.filter(t=>t.inParty).map(t=>({...t,rp:"",specify:!1})))}),M("ChangePrimaryPlayer",e=>{J||(r.value=e.charName)}),M("BroadcastMessage",e=>{e.source==="soumaUserJS"&&typeof e.msg=="object"&&e.msg!==null&&Reflect.get(e.msg,"text")==="requestData"&&S()}),startOverlayEvents()}),(e,t)=>{const c=D("vxe-modal"),C=D("vxe-option"),Z=D("vxe-select"),ee=be;return f(),_("div",{onMouseenter:K,onMouseleave:Q},[w(c,{modelValue:o(v),"onUpdate:modelValue":t[0]||(t[0]=l=>le(v)?v.value=l:null),size:"small",position:{left:10,top:10},width:"90vw",onClose:t[1]||(t[1]=l=>{v.value=!1,N.value=!1})},{title:R(()=>[ve]),default:R(()=>[ge,he]),_:1},8,["modelValue"]),y("main",{style:H({width:o(p)?15.5+ +(o(a).party.find(l=>l.job===36)?1:0)+"em":"4em"})},[y("div",je,[w(ie,{name:"animate__animated animate__bounce","enter-active-class":"animate__fadeInLeft","leave-active-class":"animate__fadeOutLeft"},{default:R(()=>[(f(!0),_(A,null,L(o(a).party,(l,O)=>U((f(),_("section",{key:l.id,flex:"~ nowrap",style:H({opacity:o(p)?1:.5}),class:"player"},[w(Z,{modelValue:l.rp,"onUpdate:modelValue":g=>l.rp=g,size:"mini",onChange:g=>u(O),"class-name":"select"},{default:R(()=>[(f(!0),_(A,null,L(F(l.job),(g,te)=>(f(),de(C,{key:te,value:g,label:g},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),y("span",xe,E(X(l.job))+" "+E(o(p)?Y(l.name):""),1)],4)),[[$,o(a).party.length>1&&(o(p)||l.name===o(r))]])),128))]),_:1})]),U(w(ee,{onUpdateSortArr:W,party:o(a).party,"m-b-1":"","p-1":""},null,8,["party"]),[[$,o(p)]])],4),o(J)?(f(),_("div",Je,[y("button",{onClick:t[2]||(t[2]=l=>{o(a).party=o(a).party.filter(O=>O.name===o(r))})}," 测试单人 "),y("button",{onClick:t[3]||(t[3]=l=>{{const O={party:V};o(a).party=O.party.map(g=>({...g,rp:"",specify:!1}))}})}," 测试组队 ")])):ue("",!0)],32)}}});const we=q(Se,[["__scopeId","data-v-647100eb"]]);export{we as default};
