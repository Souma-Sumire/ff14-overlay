import{d as ue,n as B,J as Ce,o as $,e as z,a as t,w as o,u as l,a1 as J,x as v,y as j,t as _,s as re,v as ce,F as L,L as Q,ai as F,aj as ie,B as Ve,ak as xe,C as Ge,N as Se,al as $e,af as Ie,ag as Ee,ae as me,a2 as ke,am as pe,c as A,ad as Be,Z as Ae,p as de,an as Ne,ao as Ze,G as De,H as Ue,A as Xe,b as Oe,Y as Pe,T as be,_ as ve,ap as et,a0 as se,W as tt,aq as Fe,ar as nt,a4 as lt,a3 as ot,D as it,ah as st,as as at,a5 as rt,a6 as ct,U as Te}from"./vendor-9294eafe.js";import{u as fe,_ as Re,p as dt}from"./TimelineShow-55a76eff.js";import{U as M}from"./util-831b56e7.js";import{g as ut}from"./actionChinese-f29d4188.js";import{g as mt,h as pt}from"./xivapi-a5c0f7f0.js";import{_ as _e}from"./_plugin-vue_export-helper-c27b6911.js";import{c as qe,a as ft}from"./overlay_plugin_api-409cb9ea.js";import{z as ae}from"./zoneInfo-9e4e9a78.js";import{r as _t}from"./index-63bc9f38.js";import{A as wt}from"./actWS-e2500b62.js";const r=new Map;r.set(26155,{type:"cast",window:[999,999]});r.set(28027,{type:"cast",window:[999,999]});r.set(26340,{type:"cast",window:[999,999]});r.set(25533,{type:"begincast",window:[60,60]});r.set(26376,{type:"cast",window:[999,999]});r.set(26814,{type:"begincast",window:[999,999]});r.set(25313,{type:"begincast",window:[200,200]});r.set(27526,{type:"begincast",window:[999,999]});r.set(26215,{type:"cast",window:[500,30]});r.set(29050,{type:"begincast",window:[200,30]});r.set(29156,{type:"cast",window:[20,20]});r.set(27973,{type:"cast",window:[20,20]});r.set(27937,{type:"begincast",window:[20,20]});r.set(28059,{type:"begincast",window:[20,20]});r.set(28060,{type:"begincast",window:[20,20]});r.set(28061,{type:"begincast",window:[20,20]});r.set(27956,{type:"begincast",window:[20,20]});r.set(27957,{type:"begincast",window:[20,20]});r.set(27952,{type:"begincast",window:[30,30]});r.set(27969,{type:"begincast",window:[20,20]});r.set(27971,{type:"begincast",window:[20,20]});r.set(27939,{type:"begincast",window:[20,20]});r.set(27966,{type:"begincast",window:[20,20]});r.set(25316,{type:"begincast",window:[999,999]});r.set(25544,{type:"begincast",window:[10,10]});r.set(26379,{type:"begincast",window:[10,10]});r.set(31552,{type:"begincast",window:[30,30]});r.set(31573,{type:"begincast",window:[30,30]});r.set(31573,{type:"begincast",window:[30,30]});r.set(31617,{type:"begincast",window:[8,8]});r.set(31624,{type:"begincast",window:[30,30]});r.set(31649,{type:"begincast",window:[30,30]});r.set(18864,{type:"cast",window:[10,2.5],once:!0});r.set(18480,{type:"cast",window:[200,60],once:!0});r.set(18516,{type:"cast",window:[250,65],once:!0});r.set(18522,{type:"begincast",window:[500,500],once:!0});r.set(18552,{type:"begincast",window:[67,67],once:!0});r.set(18553,{type:"cast",window:[67,67],once:!0});r.set(19083,{type:"cast",window:[900,0],once:!0});function gt(b){const C=new Map;b.filter(m=>m.type==="begincast").map(m=>C.set(m.actionId,(C.get(m.actionId)??0)+1));for(const m of b){C.get(m.actionId)===1&&m.type==="begincast"&&(m.window=[12,12]);const i=r.get(m.actionId);(i==null?void 0:i.type)===m.type&&(m.window=i==null?void 0:i.window),m.syncOnce=!!(i!=null&&i.once)}return b}const yt={class:"fflogs-query-result-friendlies"},ht=["src","onerror"],bt=ue({__name:"FflogsImport",props:{filters:{}},emits:["newTimeline","showFFlogsToggle","clearCurrentlyTimeline","updateFilters"],setup(b,{emit:C}){const m=b,i=C,w=new RegExp("(?<=^|\\/)(?<code>\\w{16,})\\/?#fight=(?<fight>\\d+|last)"),k={begincast:"14",cast:"1[56]"},g=B("查询"),x=B(""),I=B(!1),e=Ce({});U();const E=fe();function P(S){var p;F.fire({text:"正在解析数据 (步骤1/3)",showConfirmButton:!1}),U(),g.value="正在请求";const c=S.match(w);E.settings.api?c?c?(e.code=((p=c.groups)==null?void 0:p.code)??"",ie.get(`https://cn.fflogs.com/v1/report/fights/${e.code}?api_key=${E.settings.api}`).then(f=>{var h,T;e.bossIDs=f.data.enemies.filter(s=>s.type==="Boss").map(s=>s.id),e.fightIndex=(((h=c==null?void 0:c.groups)==null?void 0:h.fight)==="last"?f.data.fights.length:Number.parseInt(((T=c==null?void 0:c.groups)==null?void 0:T.fight)??"0"))-1;const u=f.data.fights[e.fightIndex];e.zoneID=u.zoneID,e.start=u.start_time,e.end=u.end_time,e.friendlies=f.data.friendlies.filter(s=>s.icon!=="LimitBreak"&&s.fights.find(H=>H.id===e.fightIndex+1)),g.value="查询",e.abilityFilterEvents.length=0,e.abilityFilterCandidate.length=0,F.fire("在列表中选择一名玩家")}).catch(f=>{F.fire({icon:"error",title:"Oops...(步骤1)",text:f}),g.value="查询"})):(F.fire({icon:"error",title:"url链接格式错误",footer:`验证规则：${w.toString().replaceAll(/\?<\w+>/g,"")}`}),g.value="查询"):(F.fire({icon:"error",title:"FF logs 战斗记录链接 未填写",footer:"例如：aaAAAAaAAAaAaa11#fight=18"}),g.value="查询"):(F.fire({icon:"error",title:"FF logs API Key 未填写",footer:'<a href="https://cn.fflogs.com/profile">点击这里，在最下方起名，然后获得你的V1 Client Key</a>'}),g.value="查询")}async function D(S){e.player=S,await R().then(()=>{e.abilityFilterCandidate=e.abilityFilterEvents.reduce((c,p)=>(p.sourceIsFriendly&&!c.find(f=>f.actionId===p.actionId)&&c.push(p),c),[])}).catch(c=>{F.fire({icon:"error",title:"Oops...(步骤2)",text:c})})}async function R(){F.fire({text:"正在解析数据，请耐心等待。(步骤2/3)",showConfirmButton:!1});const S=[];e.abilityFilterEvents.length=0;async function c(h){var T;await ie.get(`https://cn.fflogs.com/v1/report/events/casts/${e.code}?start=${h}&end=${e.end}&hostility=0&sourceid=${(T=e.player)==null?void 0:T.id}&api_key=${E.settings.api}`).then(async s=>{S.push(...s.data.events),s.data.nextPageTimestamp&&s.data.nextPageTimestamp>0&&s.data.nextPageTimestamp<e.end&&await c(s.data.nextPageTimestamp)}).catch(s=>{F.fire({icon:"error",title:"Oops...(步骤3.1)",text:s})})}async function p(h,T){T>=0&&await ie.get(`https://cn.fflogs.com/v1/report/events/casts/${e.code}?start=${h}&end=${e.end}&hostility=1&sourceid=${e.bossIDs[T]}&api_key=${E.settings.api}`).then(async s=>{S.push(...s.data.events),s.data.nextPageTimestamp&&s.data.nextPageTimestamp>0&&s.data.nextPageTimestamp<e.end&&await p(s.data.nextPageTimestamp,T),T<e.bossIDs.length-1&&await p(h,T+1)}).catch(s=>{F.fire({icon:"error",title:"Oops...(步骤3.2)",text:s})})}const f=await c(e.start),u=await p(e.start,0);await Promise.all([f,u]).then(()=>{var h,T;for(const s of S)s.type==="begincast"&&s.sourceIsFriendly||e.abilityFilterEvents.push({time:Number(((s.timestamp-e.start)/1e3).toFixed(1)),type:s.type,actionName:ut(s.ability.guid)??s.ability.name,actionId:s.ability.guid,sourceIsFriendly:s.sourceIsFriendly,url:((h=s==null?void 0:s.ability)==null?void 0:h.abilityIcon.replace("-","/").replace(".png",""))??"000000/000405",window:void 0});(T=e.player)!=null&&T.icon&&m.filters[e.player.icon]&&(e.abilityFilterSelected=m.filters[e.player.icon]),F.fire("请在技能过滤器中选择需要的技能")})}function W(){var S,c,p,f;F.fire({text:"正在解析数据 (步骤3/3)",showConfirmButton:!1}),(S=e.player)!=null&&S.icon&&i("updateFilters",(c=e.player)==null?void 0:c.icon,JSON.parse(JSON.stringify(e.abilityFilterSelected))),e.abilityFilterEvents=e.abilityFilterEvents.filter(u=>u.sourceIsFriendly&&e.abilityFilterSelected.includes(u.actionId)||!u.sourceIsFriendly).sort((u,h)=>u.time-h.time),e.abilityFilterEvents=gt(e.abilityFilterEvents),e.abilityFilterEventsAfterFilterRawTimeline=e.abilityFilterEvents.map(u=>u.sourceIsFriendly?`${u.time} "<${u.actionName}>~"${I.value?` tts "${u.actionName}"`:""}`:/^(?:攻击|attack|攻撃)$|^unknown/i.test(u.actionName)||u.type==="cast"&&u.window===void 0?`# ${u.time} "${u.actionName}"`:`${u.time} "${u.actionName}" sync /^.{14} \\w+ ${k[u.type]}:4.{7}:[^:]+:${u.actionId.toString(16).toUpperCase()}:/${u.window?` window ${u.window.join(",")}`:""}`).join(`
`),i("newTimeline",`导入${(p=e.player)==null?void 0:p.name}`,{zoneId:e.zoneID.toString(),job:((f=e.player)==null?void 0:f.icon)??"NONE"},e.abilityFilterEventsAfterFilterRawTimeline,`${e.code}#fight=${e.fightIndex+1}`),U(),i("showFFlogsToggle"),F.fire({position:"top-end",icon:"success",title:"已生成新时间轴",showConfirmButton:!1,timer:1500})}function U(){e.code="",e.fightIndex=0,e.start=0,e.end=0,e.friendlies=[],e.abilityFilterEvents=[],e.abilityFilterCandidate=[],e.abilityFilterSelected=[],e.abilityFilterEventsAfterFilterRawTimeline="",e.player=void 0,e.zoneID=0,e.bossIDs=[]}return(S,c)=>{const p=Ve,f=xe,u=Ge,h=Se,T=$e,s=Ie,H=Ee,K=me,te=Be,ne=ke,Y=pe;return $(),z(L,null,[t(T,{inline:!0,class:"fflogs-query"},{default:o(()=>[t(f,{label:"FF logs 战斗",style:{width:"450px"}},{default:o(()=>[t(p,{modelValue:l(x),"onUpdate:modelValue":c[0]||(c[0]=y=>J(x)?x.value=y:null),placeholder:"reports/AAAaAaAAaa1aA1aA#fight=3",autocomplete:"on"},null,8,["modelValue"])]),_:1}),t(f,{label:"FF logs V1 Key",style:{width:"450px"}},{default:o(()=>[t(p,{modelValue:l(E).settings.api,"onUpdate:modelValue":c[1]||(c[1]=y=>l(E).settings.api=y)},null,8,["modelValue"])]),_:1}),t(f,{label:"添加TTS",style:{width:"100px"}},{default:o(()=>[t(u,{modelValue:l(I),"onUpdate:modelValue":c[2]||(c[2]=y=>J(I)?I.value=y:null)},null,8,["modelValue"])]),_:1}),t(f,null,{default:o(()=>[t(h,{disabled:l(g)==="正在请求",type:"primary",onClick:c[3]||(c[3]=y=>P(l(x)))},{default:o(()=>[v(j(l(g)),1)]),_:1},8,["disabled"])]),_:1})]),_:1}),_("div",yt,[t(K,null,{default:o(()=>[re(t(H,{data:l(e).friendlies.filter(y=>y.icon!=="NPC"),stripe:"",border:"",class:"fflogs-query-result-friendlies-list"},{default:o(()=>[t(s,{prop:"name",label:"玩家名称","min-width":"60px"}),t(s,{prop:"server",label:"服务器","min-width":"60px"}),t(s,{label:"职业","min-width":"60px"},{default:o(({row:y})=>[v(j(l(M).nameToFullName(l(M).jobEnumToJob(l(M).iconToJobEnum(y.icon))).cn),1)]),_:1}),t(s,{label:"选定","min-width":"20px"},{default:o(y=>[t(h,{type:"primary",size:"small",onClick:we=>D(y.row)},{default:o(()=>[v(" 选择 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),[[ce,l(e).abilityFilterEvents.length===0]])]),_:1}),re(t(K,{class:"fflogs-query-result-friendlies-ability-filter-select"},{default:o(()=>[t(Y,{span:20},{default:o(()=>[t(ne,{modelValue:l(e).abilityFilterSelected,"onUpdate:modelValue":c[4]||(c[4]=y=>l(e).abilityFilterSelected=y),multiple:"",placeholder:"技能过滤器","fit-input-width":!0},{default:o(()=>[($(!0),z(L,null,Q(l(e).abilityFilterCandidate,y=>($(),A(te,{key:y.actionId,class:"ability-filter-li",value:y.actionId,label:y.actionName},{default:o(()=>[_("img",{src:l(mt)(`/i/${y.url}.png`),class:"ability-filter-li-icon",title:"",onerror:l(pt)},null,8,ht),v(j(y.actionName),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(Y,{span:4},{default:o(()=>[t(h,{type:"success",onClick:c[5]||(c[5]=y=>W())},{default:o(()=>[v(" 选择好了 ")]),_:1})]),_:1})]),_:1},512),[[ce,l(e).abilityFilterEvents.length>0]])])],64)}}});const vt=_e(bt,[["__scopeId","data-v-b3c10a40"]]),ee=b=>(De("data-v-52d0d6b5"),b=b(),Ue(),b),Ft=ee(()=>_("h3",{style:{margin:"0",padding:"10px","background-color":"#f5f7fa",cursor:"move"}}," 设置 ",-1)),Tt=ee(()=>_("h3",{class:"form-section-title"}," 参数 ",-1)),Ct=ee(()=>_("h3",{class:"form-section-title"}," 样式 ",-1)),Vt=ee(()=>_("h3",{class:"form-section-title"}," 测试用例 ",-1)),xt=ue({__name:"SettingsDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup(b,{emit:C}){const m=b,i=C,w=fe();Ae(()=>{w.saveTimelineSettings()});const k=de({get:()=>m.modelValue,set:I=>i("update:modelValue",I)}),g=B(-15),x=B([{time:-15,action:"<圣光幕帘>~",show:!0},{time:-2,action:"<圣灵>~",show:!0},{time:0,action:"战斗开始！",show:!0},{time:3,action:"<挑衅>~",show:!0},{time:5,action:"<神圣领域>~",show:!0}]);return(I,e)=>{const E=Xe,P=xe,D=pe,R=me,W=Ne,U=Re,S=$e,c=Ze;return $(),A(c,{modelValue:l(k),"onUpdate:modelValue":e[1]||(e[1]=p=>J(k)?k.value=p:null),modal:!0,overflow:"","close-on-click-modal":!1,"custom-class":"timeline-dialog",width:"600px","append-to-body":!0,draggable:!0},{header:o(()=>[Ft]),default:o(()=>[t(S,{"label-position":"right","label-width":"120px",class:"timeline-form"},{default:o(()=>[Tt,t(R,{gutter:20},{default:o(()=>[($(!0),z(L,null,Q(l(w).configValues,(p,f,u)=>($(),A(D,{key:u,span:12},{default:o(()=>[t(P,{label:l(w).configTranslate[f]},{default:o(()=>[t(E,{modelValue:l(w).configValues[f],"onUpdate:modelValue":h=>l(w).configValues[f]=h,min:0,step:.1,class:"custom-input"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])]),_:2},1024))),128))]),_:1}),Ct,t(R,{gutter:20},{default:o(()=>[($(!0),z(L,null,Q(l(w).showStyle,(p,f,u)=>($(),A(D,{key:u,span:12},{default:o(()=>[t(P,{label:l(w).showStyleTranslate[f]},{default:o(()=>[t(E,{modelValue:l(w).showStyle[f],"onUpdate:modelValue":h=>l(w).showStyle[f]=h,min:0,step:.01,class:"custom-input"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])]),_:2},1024))),128))]),_:1}),Vt,t(R,{gutter:20},{default:o(()=>[t(W,{modelValue:l(g),"onUpdate:modelValue":e[0]||(e[0]=p=>J(g)?g.value=p:null),min:-15,max:5,step:.1,"show-input":""},null,8,["modelValue"]),t(U,{config:l(w).configValues,lines:l(x),runtime:l(g),"show-style":l(w).showStyle},null,8,["config","lines","runtime","show-style"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}});const St=_e(xt,[["__scopeId","data-v-52d0d6b5"]]);function $t(){const b=window.location.href,[C,m=""]=b.split("#"),[i,w=""]=m.split("?"),k=new URLSearchParams(w);let g="";k.forEach((I,e)=>{e!=="OVERLAY_WS"&&(g+=`${e}=${encodeURIComponent(I)}&`)}),g+="OVERLAY_WS=ws://127.0.0.1:10501/ws";let x=C;i&&(x+=`#${i}`,g&&(x+=`?${g}`)),window.location.href=x,location.reload()}function It(b={allowClose:!1}){const C=B(void 0),m=B(!1);function i(){Promise.race([qe({call:"cactbotRequestState"}),new Promise((k,g)=>{setTimeout(()=>{g(new Error("Timeout"))},1e3)})]).then(()=>{C.value=!0}).catch(()=>{C.value=!1})}function w(){m.value||be.alert(`请按照下图设置<img src='${wt}' style='width:100%'>`,b.allowClose?"未连接到 ACT":"未连接到 ACT，无法使用",{dangerouslyUseHTMLString:!0,closeOnClickModal:!1,showClose:!1,closeOnPressEscape:!1,closeOnHashChange:!1,showCancelButton:b.allowClose,showConfirmButton:!1,cancelButtonText:"我偏要看看",buttonSize:"small"}).catch(()=>{m.value=!0})}return Oe(()=>{Pe(C,k=>{k?be.close():w()}),window.location.href.includes("OVERLAY_WS")||$t(),i(),setInterval(()=>{i()},3e3)}),{wsConnected:C}}const N=b=>(De("data-v-04fe47ae"),b=b(),Ue(),b),Et=N(()=>_("br",null,null,-1)),kt={class:"slider-demo-block"},Bt=N(()=>_("span",null,"模拟时间：",-1)),At={class:"timeline-info-config"},Nt=N(()=>_("span",null,"显示名称：",-1)),Dt={class:"timeline-info-config"},Ut=N(()=>_("span",null,"限定地图：",-1)),Ot={class:"timeline-info-config"},Pt=N(()=>_("span",null,"限定职业：",-1)),Rt={class:"timeline-info-config"},qt=N(()=>_("span",null,"战斗来源：",-1)),jt={class:"timeline-info-config"},Mt=N(()=>_("span",null,"创建时间：",-1)),zt={style:{flex:"1"}},Jt={style:{"max-height":"353px"}},Lt={class:"timeline-timeline-view"},Wt=N(()=>_("br",null,null,-1)),Ht=N(()=>_("br",null,null,-1)),Qt=ue({__name:"timelineSettings",setup(b){const{wsConnected:C}=It(),m=B(0),i=fe(),w=ve(i,"allTimelines"),k=ve(i,"filters"),g=[{id:"0",name:"任意"}],x=B(!1),I=B(!1),e=Ce({timeline:{name:"空",condition:{zoneId:"0",job:"NONE"},timeline:"空",codeFight:"空",create:"空"}}),E=B([]);let P=null;p();async function D(){E.value=[{time:0,action:"正在加载...",show:!0,windowBefore:0,windowAfter:0,alertAlready:!0}],E.value=await dt(e.timeline.timeline)}const R=et(de(()=>M.getBattleJobs2()),500,{maxWait:5e3});W();function W(){var d,n,V;for(const O in ae)if(Object.prototype.hasOwnProperty.call(ae,O)){const q=ae[O];switch(q.contentType){case 4:case 5:case 28:g.push({id:O,name:((d=q.name)==null?void 0:d.cn)??((n=q.name)==null?void 0:n.ja)??((V=q.name)==null?void 0:V.ja)??O})}}T(),i.sortTimelines()}function U(d,n={}){qe({call:"broadcast",source:"soumaTimelineSettings",msg:{type:d,data:n}})}function S(){x.value=!x.value,p()}function c(){const d="https://docs.qq.com/sheet/DTWxKT3lFbmpDV3Fm?tab=5ovrc8";window.open(d,"_blank")}function p(){m.value=-30,e.timeline={name:"空",condition:{zoneId:"0",job:"NONE"},timeline:"空",codeFight:"空",create:"空"}}function f(){e.timeline=i.allTimelines[i.newTimeline()],D()}function u(d){window.scrollTo({top:0,behavior:"smooth"}),e.timeline=d,D()}function h(d){F.fire({title:`确定要删除${d.name}吗？`,text:"这将无法撤回！",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"确认删除",cancelButtonText:"取消"}).then(n=>{n.isConfirmed&&(p(),w.value.splice(w.value.findIndex(V=>V===d),1))})}function T(){i.loadTimelineSettings()}function s(d){const n=new tt(".export",{text:()=>JSON.stringify(d)});n.on("success",()=>{F.fire({position:"top-end",icon:"success",title:"复制成功，已写入剪切板。",showConfirmButton:!1,timer:1500}),n.destroy()}),n.on("error",()=>{F.fire("复制失败，请手动复制！",JSON.stringify([d])),n.destroy()})}function H(){F.fire({title:"输入导出的字符串",input:"text",returnInputValueOnDeny:!0,showDenyButton:!0,denyButtonText:"覆盖",showConfirmButton:!0,confirmButtonText:"追加",showCancelButton:!0,cancelButtonText:"放弃"}).then(d=>{if(d.isConfirmed||d.isDenied)try{d.isDenied?F.fire({title:"这将丢失目前拥有的所有数据，你确定要覆盖吗？",showConfirmButton:!1,showDenyButton:!0,denyButtonText:"确定覆盖",showCancelButton:!0,cancelButtonText:"取消"}).then(n=>{n.isDenied&&(i.allTimelines.length=0,i.allTimelines.push(...JSON.parse(d.value)),i.sortTimelines())}):(i.allTimelines.push(...JSON.parse(d.value)),i.sortTimelines())}catch(n){F.fire({icon:"error",title:"Oops...",text:n})}})}const K=de(()=>`${(m.value<0?"-":"")+(Array(2).join("0")+(Math.floor(m.value/60)+(m.value<0?1:0))).slice(-2)}:${(Array(2).join("0")+Math.floor(m.value%60)).slice(-2)}`);function te(){e.timeline.timeline=e.timeline.timeline.replaceAll(new RegExp("(?<=^|#\\s*)(?<time>[:：\\d.]+)","gm"),(d,n)=>/^\d+:\d+(?:\.\d{1,2})?$/.test(d.toString())?Fe.duration(`00:${d.toString()}`).as("seconds").toString():Fe.utc(Number.parseFloat(d.toString())*1e3).format("mm:ss.S"))}function ne(){const d=_t.resolve({path:"/timelineHelp"}).href;window.open(d,"_blank")}function Y(d){i.configValues=d.configValues,i.showStyle=d.showStyle}const y=d=>{if(d.source==="soumaTimeline"&&d.msg.type==="post"){P.close();const n=d.msg.data;i.allTimelines.length===0&&n.allTimelines.length>i.allTimelines.length&&(i.allTimelines=n.allTimelines,i.configValues=n.configValues,i.showStyle=n.showStyle,Te.closeAll(),Te({message:"数据获取成功",type:"success",duration:3e3}))}};function we(){P=nt.service({lock:!0,text:"正在请求数据，请确保ACT与时间轴悬浮窗已开启...，若1秒内仍未获取到数据，请检查ACT状态，随后刷新页面重试。",background:"rgba(0, 0, 0, 0.7)"}),U("get")}return Oe(()=>{ft("BroadcastMessage",y);const d=Pe(C,n=>{n&&(we(),d())});Ae(()=>{C.value&&U("post",i.$state)})}),(d,n)=>{const V=Se,O=lt,q=ot,ge=pe,G=me,je=it,Me=St,ze=vt,Je=Ne,Z=Ve,ye=Be,he=ke,Le=Re,le=st,X=Ie,We=Ee,He=at,Qe=rt,Ke=ct;return $(),A(Ke,{class:"container"},{default:o(()=>[t(je,null,{default:o(()=>[t(G,{gutter:10,align:"middle",justify:"space-between"},{default:o(()=>[t(ge,{span:20},{default:o(()=>[t(q,{wrap:""},{default:o(()=>[t(O,null,{default:o(()=>[t(V,{type:"primary",onClick:n[0]||(n[0]=a=>S())},{default:o(()=>[v(" 从 FFlogs 生成 ")]),_:1}),t(V,{type:"primary",onClick:n[1]||(n[1]=a=>c())},{default:o(()=>[v(" 从 在线文档 获取 ")]),_:1}),t(V,{type:"primary",onClick:n[2]||(n[2]=a=>f())},{default:o(()=>[v(" 手动编写 ")]),_:1})]),_:1}),t(O,null,{default:o(()=>[t(V,{onClick:n[3]||(n[3]=a=>H())},{default:o(()=>[v(" 导入字符串 ")]),_:1}),t(V,{class:"export",onClick:n[4]||(n[4]=a=>s(l(w)))},{default:o(()=>[v(" 导出全部 ")]),_:1})]),_:1}),t(O,null,{default:o(()=>[t(V,{onClick:n[5]||(n[5]=a=>ne())},{default:o(()=>[v(" 时间轴语法 ")]),_:1})]),_:1})]),_:1})]),_:1}),t(ge,{span:4,style:{"text-align":"right"}},{default:o(()=>[t(V,{color:"#626aef",style:{color:"white"},onClick:n[6]||(n[6]=a=>I.value=!0)},{default:o(()=>[v(" 设置 ")]),_:1})]),_:1})]),_:1})]),_:1}),t(Me,{modelValue:l(I),"onUpdate:modelValue":n[7]||(n[7]=a=>J(I)?I.value=a:null),onSave:Y},null,8,["modelValue"]),t(Qe,null,{default:o(()=>[l(x)?($(),A(ze,{key:0,filters:l(k),onClearCurrentlyTimeline:p,onShowFFlogsToggle:n[8]||(n[8]=()=>x.value=!l(x)),onNewTimeline:l(i).newTimeline,onUpdateFilters:l(i).updateFilters},null,8,["filters","onNewTimeline","onUpdateFilters"])):se("",!0),Et,re(t(le,null,{default:o(()=>[_("div",kt,[Bt,t(Je,{modelValue:l(m),"onUpdate:modelValue":n[9]||(n[9]=a=>J(m)?m.value=a:null),min:-30,max:1500,step:.1,"show-input":""},null,8,["modelValue"]),_("div",null,j(l(K)),1)]),t(G,{class:"timeline-info"},{default:o(()=>[_("div",null,[_("p",At,[Nt,t(Z,{modelValue:l(e).timeline.name,"onUpdate:modelValue":n[10]||(n[10]=a=>l(e).timeline.name=a),class:"timeline-info-name"},null,8,["modelValue"])]),_("p",Dt,[Ut,t(he,{modelValue:l(e).timeline.condition.zoneId,"onUpdate:modelValue":n[11]||(n[11]=a=>l(e).timeline.condition.zoneId=a),filterable:""},{default:o(()=>[($(),z(L,null,Q(g,a=>t(ye,{key:a.id,label:a.name,value:a.id},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_("p",Ot,[Pt,t(he,{modelValue:l(e).timeline.condition.job,"onUpdate:modelValue":n[12]||(n[12]=a=>l(e).timeline.condition.job=a),required:"",placeholder:"职业"},{default:o(()=>[($(!0),z(L,null,Q(l(R),a=>($(),A(ye,{key:a,label:l(M).nameToFullName(a).cn,value:a},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_("p",Rt,[qt,t(Z,{modelValue:l(e).timeline.codeFight,"onUpdate:modelValue":n[13]||(n[13]=a=>l(e).timeline.codeFight=a),disabled:""},null,8,["modelValue"])]),_("p",jt,[Mt,t(Z,{modelValue:l(e).timeline.create,"onUpdate:modelValue":n[14]||(n[14]=a=>l(e).timeline.create=a),disabled:""},null,8,["modelValue"])]),t(G,{"m-b-10px":""},{default:o(()=>[t(V,{span:12,class:"export",onClick:n[15]||(n[15]=a=>s([l(e).timeline]))},{default:o(()=>[v(" 单独导出 ")]),_:1}),t(V,{type:"primary",span:12,onClick:n[16]||(n[16]=a=>te())},{default:o(()=>[v(" 切换时间 ")]),_:1})]),_:1}),t(G,null,{default:o(()=>[t(V,{span:12,type:"danger",onClick:n[17]||(n[17]=a=>h(l(e).timeline))},{default:o(()=>[v(" 删除 ")]),_:1}),t(V,{span:12,onClick:n[18]||(n[18]=a=>p())},{default:o(()=>[v(" 隐藏编辑界面 ")]),_:1})]),_:1})]),_("div",zt,[t(Z,{modelValue:l(e).timeline.timeline,"onUpdate:modelValue":n[19]||(n[19]=a=>l(e).timeline.timeline=a),class:"timeline-timeline-raw",type:"textarea",rows:12,wrap:"off",placeholder:"请键入时间轴文本",style:{"max-width":"569px"},onChange:n[20]||(n[20]=a=>D())},null,8,["modelValue"])]),_("div",Jt,[_("div",Lt,[t(Le,{config:l(i).configValues,lines:l(E),runtime:l(m),"show-style":l(i).showStyle},null,8,["config","lines","runtime","show-style"])])])]),_:1}),Wt]),_:1},512),[[ce,l(e).timeline.create!=="空"]]),Ht,l(w).length>0?($(),A(le,{key:1},{default:o(()=>[t(We,{data:l(w),style:{width:"100%"},stripe:""},{default:o(()=>[t(X,{prop:"name",label:"名称"}),t(X,{prop:"conditon",label:"地图",sortable:""},{default:o(a=>{var oe;return[v(j((oe=g.find(Ye=>Ye.id===a.row.condition.zoneId))==null?void 0:oe.name),1)]}),_:1}),t(X,{prop:"conditon",label:"职业"},{default:o(a=>[v(j(l(M).nameToFullName(a.row.condition.job).cn),1)]),_:1}),t(X,{fixed:"right",label:"操作",width:"100"},{default:o(a=>[t(V,{type:"primary",size:"small",onClick:oe=>u(a.row)},{default:o(()=>[v(" 编辑 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})):se("",!0),l(w).length===0?($(),A(le,{key:2},{default:o(()=>[t(He,{description:"点击上方新建或导入一个时间轴吧~"})]),_:1})):se("",!0)]),_:1})]),_:1})}}});const sn=_e(Qt,[["__scopeId","data-v-04fe47ae"]]);export{sn as default};
