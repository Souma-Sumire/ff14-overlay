import{d as be,p as U,K as Ce,o as $,e as Z,a as e,w as l,u as n,c as D,a0 as K,y as T,A as W,$ as oe,x as g,F as G,M as se,U as z,ah as ye,n as O,ai as Ge,aj as Xe,C as Ie,ak as Ee,O as ke,al as Ye,D as et,am as Be,ag as Ne,ae as Ae,af as ze,a1 as Ue,ac as De,Y as tt,q as je,ad as Oe,an as Pe,ao as Le,H as Me,I as Re,B as nt,ap as lt,Z as Se,b as ot,X as it,t as st,v as at,aq as de,ar as $e,as as rt,a3 as ct,a2 as dt,at as ut,G as mt,au as pt,a4 as ft,a5 as _t}from"./vendor-6ba522cf.js";import{u as he,_ as qe,p as gt}from"./TimelineShow-fad28b0f.js";import{U as ie}from"./util-831b56e7.js";import{g as yt}from"./actionChinese-f29d4188.js";import{g as wt,h as bt}from"./xivapi-a5c0f7f0.js";import{_ as ve}from"./_plugin-vue_export-helper-c27b6911.js";import{a as ht,c as vt}from"./overlay_plugin_api-409cb9ea.js";import{z as we}from"./zoneInfo-9e4e9a78.js";import{r as Tt}from"./index-8a6a9acb.js";import{u as Ft,c as xe}from"./useWebSocket-3477449c.js";import"./actWS-e2500b62.js";const a=new Map;a.set(26155,{type:"cast",window:[999,999]});a.set(28027,{type:"cast",window:[999,999]});a.set(26340,{type:"cast",window:[999,999]});a.set(25533,{type:"begincast",window:[60,60]});a.set(26376,{type:"cast",window:[999,999]});a.set(26814,{type:"begincast",window:[999,999]});a.set(25313,{type:"begincast",window:[200,200]});a.set(27526,{type:"begincast",window:[999,999]});a.set(26215,{type:"cast",window:[500,30]});a.set(29050,{type:"begincast",window:[200,30]});a.set(29156,{type:"cast",window:[20,20]});a.set(27973,{type:"cast",window:[20,20]});a.set(27937,{type:"begincast",window:[20,20]});a.set(28059,{type:"begincast",window:[20,20]});a.set(28060,{type:"begincast",window:[20,20]});a.set(28061,{type:"begincast",window:[20,20]});a.set(27956,{type:"begincast",window:[20,20]});a.set(27957,{type:"begincast",window:[20,20]});a.set(27952,{type:"begincast",window:[30,30]});a.set(27969,{type:"begincast",window:[20,20]});a.set(27971,{type:"begincast",window:[20,20]});a.set(27939,{type:"begincast",window:[20,20]});a.set(27966,{type:"begincast",window:[20,20]});a.set(25316,{type:"begincast",window:[999,999]});a.set(25544,{type:"begincast",window:[10,10]});a.set(26379,{type:"begincast",window:[10,10]});a.set(31552,{type:"begincast",window:[30,30]});a.set(31573,{type:"begincast",window:[30,30]});a.set(31573,{type:"begincast",window:[30,30]});a.set(31617,{type:"begincast",window:[8,8]});a.set(31624,{type:"begincast",window:[30,30]});a.set(31649,{type:"begincast",window:[30,30]});a.set(18864,{type:"cast",window:[10,2.5],once:!0});a.set(18480,{type:"cast",window:[200,60],once:!0});a.set(18516,{type:"cast",window:[250,65],once:!0});a.set(18522,{type:"begincast",window:[500,500],once:!0});a.set(18552,{type:"begincast",window:[67,67],once:!0});a.set(18553,{type:"cast",window:[67,67],once:!0});a.set(19083,{type:"cast",window:[900,0],once:!0});function Vt(x){const P=new Map;x.filter(y=>y.type==="begincast").map(y=>P.set(y.actionId,(P.get(y.actionId)??0)+1));for(const y of x){P.get(y.actionId)===1&&y.type==="begincast"&&(y.window=[12,12]);const s=a.get(y.actionId);(s==null?void 0:s.type)===y.type&&(y.window=s==null?void 0:s.window),y.syncOnce=!!(s!=null&&s.once)}return x}const St={class:"query-results"},$t={class:"ability-filter-container"},xt=["src","alt","onerror"],Ct=be({__name:"FflogsImport",props:{filters:{}},emits:["newTimeline","showFFlogsToggle","clearCurrentlyTimeline","updateFilters"],setup(x,{emit:P}){const y=x,s=P,F=new RegExp("(?<=^|\\/)(?<code>\\w{16,})\\/?#fight=(?<fight>\\d+|last)"),J={begincast:"14",cast:"1[56]"},C=U("查询"),B=U(""),A=U(!1),d=U(!1),E=U(0),t=Ce({});H();const N=he();async function L(v){var b,k,m;d.value=!0,H(),C.value="正在查询...";const c=v.match(F);if(!N.settings.api){z.alert("请在FF Logs个人设置页面获取V1 API Key","FF logs API Key 未填写",{confirmButtonText:"确定",type:"error",dangerouslyUseHTMLString:!0,message:'<a href="https://cn.fflogs.com/profile">点击这里，在最下方填写 V1 客户名称并点击确认后，获取你的 V1 客户端密钥</a>'}),C.value="查询",d.value=!1;return}if(!c){z.alert("请正确填写FF Logs链接","FF Logs链接格式错误",{confirmButtonText:"确定",type:"error"}),C.value="查询",d.value=!1;return}t.code=((b=c.groups)==null?void 0:b.code)??"";try{const p=await ye.get(`https://cn.fflogs.com/v1/report/fights/${t.code}?api_key=${N.settings.api}`);t.bossIDs=p.data.enemies.filter(w=>w.type==="Boss").map(w=>w.id),t.fightIndex=(((k=c==null?void 0:c.groups)==null?void 0:k.fight)==="last"?p.data.fights.length:Number.parseInt(((m=c==null?void 0:c.groups)==null?void 0:m.fight)??"0"))-1;const V=p.data.fights[t.fightIndex];t.zoneID=V.zoneID,t.start=V.start_time,t.end=V.end_time,t.friendlies=p.data.friendlies.filter(w=>w.icon!=="LimitBreak"&&w.fights.find(ee=>ee.id===t.fightIndex+1)),C.value="查询",t.abilityFilterEvents.length=0,t.abilityFilterCandidate.length=0,d.value=!1,E.value=1}catch(p){z.alert(`请检查您的FF Logs链接是否正确,并确保您有权限访问该报告。错误详情: ${p}`,"无法获取战斗数据",{confirmButtonText:"确定",type:"error",dangerouslyUseHTMLString:!0}),C.value="查询",d.value=!1}}async function X(v){d.value=!0,E.value=2,t.player=v;try{await Q(),t.abilityFilterCandidate=t.abilityFilterEvents.reduce((c,b)=>(b.sourceIsFriendly&&!c.find(k=>k.actionId===b.actionId)&&c.push(b),c),[]),d.value=!1}catch(c){z.alert(`请稍后重试。如果问题持续存在,请检查您的网络连接。错误详情: ${c}`,"获取玩家技能数据失败",{confirmButtonText:"确定",type:"error"}),d.value=!1}}async function Q(){var k,m;const v=[];t.abilityFilterEvents.length=0;async function c(p){var V;try{const w=await ye.get(`https://cn.fflogs.com/v1/report/events/casts/${t.code}?start=${p}&end=${t.end}&hostility=0&sourceid=${(V=t.player)==null?void 0:V.id}&api_key=${N.settings.api}`);v.push(...w.data.events),w.data.nextPageTimestamp&&w.data.nextPageTimestamp>0&&w.data.nextPageTimestamp<t.end&&await c(w.data.nextPageTimestamp)}catch(w){z.alert(`请稍后重试。如果问题持续存在,请检查您的网络连接。错误详情: ${w}`,"获取友方技能数据失败",{confirmButtonText:"确定",type:"error"})}}async function b(p,V){if(V>=0)try{const w=await ye.get(`https://cn.fflogs.com/v1/report/events/casts/${t.code}?start=${p}&end=${t.end}&hostility=1&sourceid=${t.bossIDs[V]}&api_key=${N.settings.api}`);v.push(...w.data.events),w.data.nextPageTimestamp&&w.data.nextPageTimestamp>0&&w.data.nextPageTimestamp<t.end&&await b(w.data.nextPageTimestamp,V),V<t.bossIDs.length-1&&await b(p,V+1)}catch(w){z.alert(`请稍后重试。如果问题持续存在,请检查您的网络连接。错误详情: ${w}`,"获取敌方技能数据失败",{confirmButtonText:"确定",type:"error"})}}await Promise.all([c(t.start),b(t.start,0)]);for(const p of v)p.type==="begincast"&&p.sourceIsFriendly||t.abilityFilterEvents.push({time:Number(((p.timestamp-t.start)/1e3).toFixed(1)),type:p.type,actionName:yt(p.ability.guid)??p.ability.name,actionId:p.ability.guid,sourceIsFriendly:p.sourceIsFriendly,url:((k=p==null?void 0:p.ability)==null?void 0:k.abilityIcon.replace("-","/").replace(".png",""))??"000000/000405",window:void 0});(m=t.player)!=null&&m.icon&&y.filters[t.player.icon]&&(t.abilityFilterSelected=y.filters[t.player.icon])}function Y(){var v,c,b,k;d.value=!0,E.value=3,(v=t.player)!=null&&v.icon&&s("updateFilters",(c=t.player)==null?void 0:c.icon,JSON.parse(JSON.stringify(t.abilityFilterSelected))),t.abilityFilterEvents=t.abilityFilterEvents.filter(m=>m.sourceIsFriendly&&t.abilityFilterSelected.includes(m.actionId)||!m.sourceIsFriendly).sort((m,p)=>m.time-p.time),t.abilityFilterEvents=Vt(t.abilityFilterEvents),t.abilityFilterEventsAfterFilterRawTimeline=t.abilityFilterEvents.map(m=>m.sourceIsFriendly?`${m.time} "<${m.actionName}>~"${A.value?` tts "${m.actionName}"`:""}`:/^(?:攻击|attack|攻撃)$|^unknown/i.test(m.actionName)||m.type==="cast"&&m.window===void 0?`# ${m.time} "${m.actionName}"`:`${m.time} "${m.actionName}" sync /^.{14} \\w+ ${J[m.type]}:4.{7}:[^:]+:${m.actionId.toString(16).toUpperCase()}:/${m.window?` window ${m.window.join(",")}`:""}`).join(`
`),s("newTimeline",`导入${(b=t.player)==null?void 0:b.name}`,{zoneId:t.zoneID.toString(),jobs:[((k=t.player)==null?void 0:k.icon)??"NONE"]},t.abilityFilterEventsAfterFilterRawTimeline,`${t.code}#fight=${t.fightIndex+1}`),H(),s("showFFlogsToggle"),O({message:"已生成新时间轴",type:"success",duration:1500}),d.value=!1}function H(){t.code="",t.fightIndex=0,t.start=0,t.end=0,t.friendlies=[],t.abilityFilterEvents=[],t.abilityFilterCandidate=[],t.abilityFilterSelected=[],t.abilityFilterEventsAfterFilterRawTimeline="",t.player=void 0,t.zoneID=0,t.bossIDs=[]}function I(){window.open("https://cn.fflogs.com/profile","_blank")}return(v,c)=>{const b=Ge,k=Xe,m=Ie,p=Ee,V=ke,w=Ye,ee=et,me=Be,te=Ne,ne=Ae,le=ze,pe=De,fe=Ue;return $(),Z(G,null,[e(k,{active:n(E),class:"steps-guide","align-center":""},{default:l(()=>[e(b,{title:"输入链接"}),e(b,{title:"选择玩家"}),e(b,{title:"过滤技能"}),e(b,{title:"生成时间轴"})]),_:1},8,["active"]),n(E)===0?($(),D(te,{key:0,class:"input-section"},{default:l(()=>[e(me,{"label-width":"150px",class:"fflogs-form"},{default:l(()=>[e(p,{label:"FF logs 战斗链接"},{default:l(()=>[e(m,{modelValue:n(B),"onUpdate:modelValue":c[0]||(c[0]=o=>K(B)?B.value=o:null),placeholder:"AAAaAaAAaa1aA1aA#fight=3",autocomplete:"on"},null,8,["modelValue"])]),_:1}),e(p,{label:"FF logs V1 Key"},{default:l(()=>[e(m,{modelValue:n(N).settings.api,"onUpdate:modelValue":c[1]||(c[1]=o=>n(N).settings.api=o),placeholder:"在FF Logs个人设置页面获取V1 API Key"},{append:l(()=>[e(w,{content:"点击前往FF Logs个人设置页面，在最下方填写V1客户名称并点击确认后，获取你的V1客户端密钥",placement:"top",effect:"light"},{default:l(()=>[e(V,{type:"primary",link:"",onClick:I},{default:l(()=>[T(" 如何获取 ")]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(p,{label:"使用 TTS"},{default:l(()=>[e(ee,{modelValue:n(A),"onUpdate:modelValue":c[2]||(c[2]=o=>K(A)?A.value=o:null)},null,8,["modelValue"])]),_:1}),e(p,null,{default:l(()=>[e(V,{disabled:n(C)==="正在查询...",type:"primary",onClick:c[3]||(c[3]=o=>L(n(B)))},{default:l(()=>[T(W(n(C)),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})):oe("",!0),g("div",St,[n(E)===1&&n(t).friendlies.length>0&&n(t).abilityFilterEvents.length===0?($(),D(te,{key:0,class:"player-selection"},{default:l(()=>[e(le,{data:n(t).friendlies.filter(o=>!["NPC"].includes(o.icon)),stripe:"",border:"",class:"friendlies-table"},{default:l(()=>[e(ne,{prop:"name",label:"玩家名称"}),e(ne,{label:"职业"},{default:l(({row:o})=>[T(W(n(ie).nameToFullName(n(ie).jobEnumToJob(n(ie).iconToJobEnum(o.icon))).cn),1)]),_:1}),e(ne,{label:"选定",width:"100",align:"center"},{default:l(o=>[e(V,{type:"primary",size:"small",onClick:i=>X(o.row)},{default:l(()=>[T(" 选择 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})):oe("",!0),n(E)===2?($(),D(te,{key:1,class:"ability-filter"},{default:l(()=>[g("div",$t,[e(fe,{modelValue:n(t).abilityFilterSelected,"onUpdate:modelValue":c[4]||(c[4]=o=>n(t).abilityFilterSelected=o),multiple:"",placeholder:"选择需要导入的技能","fit-input-width":!0,class:"ability-filter-select"},{default:l(()=>[($(!0),Z(G,null,se(n(t).abilityFilterCandidate,o=>($(),D(pe,{key:o.actionId,value:o.actionId,label:o.actionName,class:"ability-filter-option"},{default:l(()=>[g("img",{src:n(wt)(`/i/${o.url}.png`),class:"ability-filter-icon",alt:o.actionName,onerror:n(bt)},null,8,xt),g("span",null,W(o.actionName),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue"]),e(V,{type:"success",class:"filter-confirm-btn",onClick:Y},{default:l(()=>[T(" 生成时间轴 ")]),_:1})])]),_:1})):oe("",!0)])],64)}}});const It=ve(Ct,[["__scopeId","data-v-5f5a5352"]]),ue=x=>(Me("data-v-52d0d6b5"),x=x(),Re(),x),Et=ue(()=>g("h3",{style:{margin:"0",padding:"10px","background-color":"#f5f7fa",cursor:"move"}}," 设置 ",-1)),kt=ue(()=>g("h3",{class:"form-section-title"}," 参数 ",-1)),Bt=ue(()=>g("h3",{class:"form-section-title"}," 样式 ",-1)),Nt=ue(()=>g("h3",{class:"form-section-title"}," 测试用例 ",-1)),At=be({__name:"SettingsDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup(x,{emit:P}){const y=x,s=P,F=he();tt(()=>{F.saveTimelineSettings()});const J=je({get:()=>y.modelValue,set:A=>s("update:modelValue",A)}),C=U(-15),B=U([{time:-15,action:"<圣光幕帘>~",show:!0},{time:-2,action:"<圣灵>~",show:!0},{time:0,action:"战斗开始！",show:!0},{time:3,action:"<挑衅>~",show:!0},{time:5,action:"<神圣领域>~",show:!0}]);return(A,d)=>{const E=nt,t=Ee,N=lt,L=Oe,X=Pe,Q=qe,Y=Be,H=Le;return $(),D(H,{modelValue:n(J),"onUpdate:modelValue":d[1]||(d[1]=I=>K(J)?J.value=I:null),modal:!0,overflow:"","close-on-click-modal":!1,"custom-class":"timeline-dialog",width:"600px","append-to-body":!0,draggable:!0},{header:l(()=>[Et]),default:l(()=>[e(Y,{"label-position":"right","label-width":"120px",class:"timeline-form"},{default:l(()=>[kt,e(L,{gutter:20},{default:l(()=>[($(!0),Z(G,null,se(n(F).configValues,(I,v,c)=>($(),D(N,{key:c,span:12},{default:l(()=>[e(t,{label:n(F).configTranslate[v]},{default:l(()=>[e(E,{modelValue:n(F).configValues[v],"onUpdate:modelValue":b=>n(F).configValues[v]=b,min:0,step:.1,class:"custom-input"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])]),_:2},1024))),128))]),_:1}),Bt,e(L,{gutter:20},{default:l(()=>[($(!0),Z(G,null,se(n(F).showStyle,(I,v,c)=>($(),D(N,{key:c,span:12},{default:l(()=>[e(t,{label:n(F).showStyleTranslate[v]},{default:l(()=>[e(E,{modelValue:n(F).showStyle[v],"onUpdate:modelValue":b=>n(F).showStyle[v]=b,min:0,step:.01,class:"custom-input"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])]),_:2},1024))),128))]),_:1}),Nt,e(L,{gutter:20},{default:l(()=>[e(X,{modelValue:n(C),"onUpdate:modelValue":d[0]||(d[0]=I=>K(C)?C.value=I:null),min:-15,max:5,step:.1,"show-input":""},null,8,["modelValue"]),e(Q,{config:n(F).configValues,lines:n(B),runtime:n(C),"show-style":n(F).showStyle},null,8,["config","lines","runtime","show-style"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}});const zt=ve(At,[["__scopeId","data-v-52d0d6b5"]]),q=x=>(Me("data-v-d9b5d951"),x=x(),Re(),x),Ut={class:"alerts-container"},Dt={class:"slider-demo-block"},jt=q(()=>g("span",null,"模拟时间：",-1)),Ot={class:"timeline-info-config"},Pt=q(()=>g("span",null,"显示名称：",-1)),Lt={class:"timeline-info-config"},Mt=q(()=>g("span",null,"限定地图：",-1)),Rt={class:"timeline-info-config"},qt=q(()=>g("span",null,"限定职业：",-1)),Jt={class:"timeline-info-config"},Ht=q(()=>g("span",null,"战斗来源：",-1)),Kt={class:"timeline-info-config"},Qt=q(()=>g("span",null,"创建时间：",-1)),Wt={style:{flex:"1"}},Zt={style:{"max-height":"353px"}},Gt={class:"timeline-timeline-view"},Xt=q(()=>g("br",null,null,-1)),Yt=q(()=>g("br",null,null,-1)),en=be({__name:"timelineSettings",setup(x){const{wsConnected:P}=Ft({allowClose:!0,addWsParam:!0}),y=U(0),s=he(),F=Se(s,"allTimelines"),J=Se(s,"filters"),C=[{id:"0",name:"任意"}],B=U(!1),A=U(!1),d=Ce({timeline:{name:"空",condition:{zoneId:"0",jobs:["NONE"]},timeline:"空",codeFight:"空",create:"空"}}),E=U([]);let t=null,N=!1;I();async function L(){E.value=[{time:0,action:"正在加载...",show:!0,windowBefore:0,windowAfter:0,alertAlready:!0}],E.value=await gt(d.timeline.timeline)}X();function X(){var o,i,f;for(const u in we)if(Object.prototype.hasOwnProperty.call(we,u)){const h=we[u];switch(h.contentType){case 4:case 5:case 28:C.push({id:u,name:((o=h.name)==null?void 0:o.cn)??((i=h.name)==null?void 0:i.ja)??((f=h.name)==null?void 0:f.ja)??u})}}k(),s.sortTimelines()}function Q(o,i={}){vt({call:"broadcast",source:"soumaTimelineSettings",msg:{type:o,data:i}})}function Y(){B.value=!0,I()}function H(){const o="https://docs.qq.com/sheet/DTWxKT3lFbmpDV3Fm?tab=5ovrc8";window.open(o,"_blank")}function I(){y.value=-30,d.timeline={name:"空",condition:{zoneId:"0",jobs:["NONE"]},timeline:"空",codeFight:"空",create:"空"}}function v(){d.timeline=s.allTimelines[s.newTimeline()],L()}function c(o){window.scrollTo({top:0,behavior:"smooth"}),d.timeline=o,L()}function b(o){z.confirm(`确定要删除「${o.name}」吗？`,"删除时间轴",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning"}).then(()=>{I(),F.value.splice(F.value.findIndex(i=>i===o),1)})}function k(){s.loadTimelineSettings()}function m(o){const i=JSON.stringify(o),f=JSON.parse(i);for(const R of f)R.timeline=R.timeline.replace(/^#.*\n/gm,"");const u=JSON.stringify(f),h=de.compressToBase64(i),_=de.compressToBase64(u),S=h.length,M=_.length;if(S===M){xe(h).then(()=>{O({message:"数据复制成功，已写入剪切板。",type:"success",duration:2e3})}).catch(()=>{O({message:"复制失败，请手动复制！",type:"error",duration:3e3})});return}const _e=((S-M)/S*100).toFixed(2);z.confirm(`
     1. 完整版本（包含注释）<br>
     &nbsp;&nbsp;&nbsp;- 大小：${S} 字节<br>
     &nbsp;&nbsp;&nbsp;- 包含所有时间轴信息和注释<br><br>
     2. 优化版本（不含注释）<br>
     &nbsp;&nbsp;&nbsp;- 大小：${M} 字节<br>
     &nbsp;&nbsp;&nbsp;- 节省 ${_e}% 的空间<br>
     &nbsp;&nbsp;&nbsp;- 仅包含必要的时间轴数据`,"请选择导出版本：",{confirmButtonText:"导出优化版本",cancelButtonText:"导出完整版本",distinguishCancelAndClose:!0,closeOnClickModal:!1,closeOnPressEscape:!1,dangerouslyUseHTMLString:!0,showClose:!0,type:"info",callback:R=>{(R==="cancel"||R==="confirm")&&xe(R==="confirm"?_:h).then(()=>{O({message:"压缩数据复制成功，已写入剪切板。",type:"success",duration:2e3})}).catch(()=>{O({message:"复制失败，请手动复制！",type:"error",duration:3e3})})}})}function p(){z.prompt("请输入导出的字符串（支持多行导入）","导入时间轴",{confirmButtonText:"解析",cancelButtonText:"取消",inputType:"textarea",inputValidator:o=>{if(!o)return"请输入导出的字符串";const i=o.split(`
`).filter(u=>u.trim()!=="");let f=[];for(const u of i){let h;try{h=JSON.parse(u)}catch{try{const _=de.decompressFromBase64(u);h=JSON.parse(_)}catch{return`无法解析输入的数据：${u}，请确保每行都是正确的JSON或压缩后的字符串。`}}if(!Array.isArray(h))return`导入的数据格式不正确：${u}`;f=f.concat(h)}return f.length===0?"导入的数据不包含任何时间轴。":!0},inputErrorMessage:"无效的输入"}).then(({value:o})=>{const i=o.split(`
`).filter(_=>_.trim()!=="");let f=[];for(const _ of i){let S;try{S=JSON.parse(_)}catch{const M=de.decompressFromBase64(_);S=JSON.parse(M)}f=f.concat(S)}const u=f.length,h=f.map(_=>`「${_.name}」`).join(", ");z({title:"确认",message:`导入 ${u} 个时间轴：
${h}
？`,showCancelButton:!0,showConfirmButton:!0,confirmButtonText:"追加",cancelButtonText:"覆盖",distinguishCancelAndClose:!0,type:"warning",callback:_=>{_==="cancel"?z.prompt('覆盖操作将删除所有现有的时间轴。请输入"我确认"以继续。',"二次确认",{confirmButtonText:"确定覆盖",cancelButtonText:"取消",inputPattern:/^我确认$/,inputErrorMessage:'请输入"我确认"以确认覆盖操作',type:"warning"}).then(({value:S})=>{S==="我确认"&&V(f,!0)}).catch(()=>{}):_==="confirm"&&V(f,!1)}})}).catch(()=>{})}function V(o,i){i&&(s.allTimelines.length=0),s.allTimelines.push(...o),s.sortTimelines();for(const _ of s.allTimelines)_.condition.jobs===void 0&&(_.condition.jobs=[_.condition.job]);if(I(),i){O({type:"success",message:"覆盖成功！",duration:2e3});return}const f=[],u=new Set;for(const _ of s.allTimelines){const S=JSON.stringify({name:_.name,condition:_.condition,timeline:_.timeline,codeFight:_.codeFight,create:_.create});u.has(S)||(u.add(S),f.push(_))}const h=s.allTimelines.length-f.length;s.allTimelines=f,O({message:`追加成功！共导入 ${o.length} 个时间轴${h>0?`，但其中 ${h} 个重复，已自动移除。`:""}`,type:"success",duration:3e3})}const w=je(()=>`${(y.value<0?"-":"")+(Array(2).join("0")+(Math.floor(y.value/60)+(y.value<0?1:0))).slice(-2)}:${(Array(2).join("0")+Math.floor(y.value%60)).slice(-2)}`);function ee(){d.timeline.timeline=d.timeline.timeline.replaceAll(new RegExp("(?<=^|#\\s*)(?<time>[:：\\d.]+)","gm"),(o,i)=>/^\d+:\d+(?:\.\d{1,2})?$/.test(o.toString())?$e.duration(`00:${o.toString()}`).as("seconds").toString():$e.utc(Number.parseFloat(o.toString())*1e3).format("mm:ss.S"))}function me(){const o=Tt.resolve({path:"/timelineHelp"}).href;window.open(o,"_blank")}function te(o){s.configValues=o.configValues,s.showStyle=o.showStyle}const ne=o=>{if(o.source==="soumaTimeline"&&o.msg.type==="post"){N=!1,t.close();const i=o.msg.data;if(s.allTimelines.length===0&&i.allTimelines.length>s.allTimelines.length){for(const f of i.allTimelines)f.condition.jobs===void 0&&(f.condition.jobs=[f.condition.job]),f.condition.jobs.sort((u,h)=>s.jobList.indexOf(u)-s.jobList.indexOf(h)),Reflect.deleteProperty(f.condition,"job");s.allTimelines=i.allTimelines,s.configValues=i.configValues,s.showStyle=i.showStyle,O.closeAll(),O({message:"数据获取成功",type:"success",duration:3e3})}}};function le(){N=!0,t=rt.service({lock:!0,text:"正在请求数据，请确保 ACT 与悬浮窗已开启...，若 3 秒内仍未获取到数据，请检查 ACT 状态，且确认 timeline 悬浮窗已开启，或刷新页面重连。",background:"rgba(0, 0, 0, 0.7)"}),Q("get"),setTimeout(()=>{N&&(O.info("重新尝试获取数据..."),le())},5e3)}function pe(){z.confirm("你确定要将当前数据发送至 ACT 悬浮窗吗？悬浮窗中的内容将会被覆盖！","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{Q("post",s.$state)})}function fe(){s.allTimelines.length=0,I(),le()}return ot(()=>{ht("BroadcastMessage",ne);const o=it(P,i=>{i&&(le(),o())})}),(o,i)=>{const f=zt,u=ke,h=ct,_=dt,S=Oe,M=ut,_e=mt,R=It,Te=Le,Je=Pe,ae=Ie,Fe=De,Ve=Ue,He=qe,ge=Ne,re=Ae,Ke=ze,Qe=pt,We=ft,Ze=_t;return $(),D(Ze,{class:"container"},{default:l(()=>[e(f,{modelValue:n(A),"onUpdate:modelValue":i[0]||(i[0]=r=>K(A)?A.value=r:null),onSave:te},null,8,["modelValue"]),e(_e,{class:"flex-header"},{default:l(()=>[e(S,{justify:"space-between",align:"middle","m-b-2":""},{default:l(()=>[e(_,{wrap:"",size:10},{default:l(()=>[e(h,null,{default:l(()=>[e(u,{type:"primary",size:"small",onClick:Y},{default:l(()=>[T(" 从 FFlogs 生成 ")]),_:1}),e(u,{type:"primary",size:"small",onClick:H},{default:l(()=>[T(" 从 在线文档 获取 ")]),_:1}),e(u,{type:"primary",size:"small",onClick:v},{default:l(()=>[T(" 手动编写 ")]),_:1})]),_:1}),e(h,null,{default:l(()=>[e(u,{size:"small",onClick:p},{default:l(()=>[T(" 导入字符串 ")]),_:1}),e(u,{size:"small",class:"export",onClick:i[1]||(i[1]=r=>m(n(F)))},{default:l(()=>[T(" 导出全部 ")]),_:1})]),_:1}),e(u,{size:"small",onClick:me},{default:l(()=>[T(" 时间轴语法 ")]),_:1}),e(u,{type:"success",size:"small",onClick:pe},{default:l(()=>[T(" 应用 ")]),_:1})]),_:1}),e(_,null,{default:l(()=>[e(u,{color:"#a0d911",style:{color:"white"},size:"small",onClick:fe},{default:l(()=>[T(" 恢复至之前的时间轴 ")]),_:1}),e(u,{color:"#626aef",style:{color:"white"},size:"small",onClick:i[2]||(i[2]=r=>A.value=!0)},{default:l(()=>[T(" 设置 ")]),_:1})]),_:1})]),_:1}),g("div",Ut,[e(M,{title:"编辑完成后,需手动点击「应用」按钮","show-icon":"",type:"info",closable:!1,class:"alert-item"}),e(M,{title:"当你误操作但尚未点击「应用」时，可点击「恢复至之前的时间轴」，则会恢复到当前 ACT 悬浮窗中保存的数据","show-icon":"",type:"warning",closable:!1,class:"alert-item"})])]),_:1}),e(We,null,{default:l(()=>[e(Te,{modelValue:n(B),"onUpdate:modelValue":i[4]||(i[4]=r=>K(B)?B.value=r:null),title:"从 FFlogs 生成时间轴",width:"80%","before-close":()=>B.value=!1},{default:l(()=>[e(R,{filters:n(J),onClearCurrentlyTimeline:I,onShowFFlogsToggle:i[3]||(i[3]=()=>B.value=!1),onNewTimeline:n(s).newTimeline,onUpdateFilters:n(s).updateFilters},null,8,["filters","onNewTimeline","onUpdateFilters"])]),_:1},8,["modelValue","before-close"]),st(e(ge,null,{default:l(()=>[g("div",Dt,[jt,e(Je,{modelValue:n(y),"onUpdate:modelValue":i[5]||(i[5]=r=>K(y)?y.value=r:null),min:-30,max:1500,step:.1,"show-input":""},null,8,["modelValue"]),g("div",null,W(n(w)),1)]),e(S,{class:"timeline-info"},{default:l(()=>[g("div",null,[g("p",Ot,[Pt,e(ae,{modelValue:n(d).timeline.name,"onUpdate:modelValue":i[6]||(i[6]=r=>n(d).timeline.name=r),class:"timeline-info-name"},null,8,["modelValue"])]),g("p",Lt,[Mt,e(Ve,{modelValue:n(d).timeline.condition.zoneId,"onUpdate:modelValue":i[7]||(i[7]=r=>n(d).timeline.condition.zoneId=r),filterable:""},{default:l(()=>[($(),Z(G,null,se(C,r=>e(Fe,{key:r.id,label:r.name,value:r.id},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),g("p",Rt,[qt,e(Ve,{modelValue:n(d).timeline.condition.jobs,"onUpdate:modelValue":i[8]||(i[8]=r=>n(d).timeline.condition.jobs=r),multiple:"",required:"",placeholder:"职业","collapse-tags":"","collapse-tags-tooltip":""},{default:l(()=>[($(!0),Z(G,null,se(n(s).jobList,r=>{var j;return $(),D(Fe,{key:r,label:(((j=n(ie).nameToFullName(r))==null?void 0:j.cn)??r).replace("冒险者","全部职业"),value:r},null,8,["label","value"])}),128))]),_:1},8,["modelValue"])]),g("p",Jt,[Ht,e(ae,{modelValue:n(d).timeline.codeFight,"onUpdate:modelValue":i[9]||(i[9]=r=>n(d).timeline.codeFight=r),disabled:""},null,8,["modelValue"])]),g("p",Kt,[Qt,e(ae,{modelValue:n(d).timeline.create,"onUpdate:modelValue":i[10]||(i[10]=r=>n(d).timeline.create=r),disabled:""},null,8,["modelValue"])]),e(S,{"m-b-10px":""},{default:l(()=>[e(u,{span:12,class:"export",onClick:i[11]||(i[11]=r=>m([n(d).timeline]))},{default:l(()=>[T(" 单独导出 ")]),_:1}),e(u,{type:"primary",span:12,onClick:i[12]||(i[12]=r=>ee())},{default:l(()=>[T(" 切换时间 ")]),_:1})]),_:1}),e(S,null,{default:l(()=>[e(u,{span:24,onClick:i[13]||(i[13]=r=>I())},{default:l(()=>[T(" 隐藏编辑界面 ")]),_:1})]),_:1})]),g("div",Wt,[e(ae,{modelValue:n(d).timeline.timeline,"onUpdate:modelValue":i[14]||(i[14]=r=>n(d).timeline.timeline=r),class:"timeline-timeline-raw",type:"textarea",rows:12,wrap:"off",placeholder:"请键入时间轴文本",style:{"max-width":"569px"},onChange:i[15]||(i[15]=r=>L())},null,8,["modelValue"])]),g("div",Zt,[g("div",Gt,[e(He,{config:n(s).configValues,lines:n(E),runtime:n(y),"show-style":n(s).showStyle},null,8,["config","lines","runtime","show-style"])])])]),_:1}),Xt]),_:1},512),[[at,n(d).timeline.create!=="空"]]),Yt,n(F).length>0?($(),D(ge,{key:0},{default:l(()=>[e(Ke,{data:n(F),style:{width:"100%"},stripe:""},{default:l(()=>[e(re,{prop:"name",label:"名称"}),e(re,{prop:"conditon",label:"地图",sortable:""},{default:l(r=>{var j;return[T(W((j=C.find(ce=>ce.id===r.row.condition.zoneId))==null?void 0:j.name),1)]}),_:1}),e(re,{prop:"conditon",label:"职业"},{default:l(r=>[T(W(r.row.condition.jobs.map(j=>{var ce;return((ce=n(ie).nameToFullName(j.toUpperCase()))==null?void 0:ce.cn)??j}).join("、").replace("冒险者","全部职业")),1)]),_:1}),e(re,{fixed:"right",label:"操作",width:"150"},{default:l(r=>[e(u,{type:"primary",size:"small",onClick:j=>c(r.row)},{default:l(()=>[T(" 编辑 ")]),_:2},1032,["onClick"]),e(u,{type:"danger",size:"small",onClick:j=>b(r.row)},{default:l(()=>[T(" 删除 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})):oe("",!0),n(F).length===0?($(),D(ge,{key:1},{default:l(()=>[e(Qe,{description:"点击上方新建或导入一个时间轴吧~"})]),_:1})):oe("",!0)]),_:1})]),_:1})}}});const pn=ve(en,[["__scopeId","data-v-d9b5d951"]]);export{pn as default};
