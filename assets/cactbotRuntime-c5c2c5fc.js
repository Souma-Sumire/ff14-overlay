import{d as G,A as S,C as V,o as _,b as v,J as w,K as A,a as k,w as P,u as l,R as H,t as U,aG as te,F as ae,r as D,I as oe,a3 as ne,g,aH as re,h as $,H as F,P as se,p as le,l as ue,c as ie}from"./vendor-bfd3a191.js";import{U as r,j as ce}from"./util-ef9ccf87.js";import{_ as z}from"./index-3b3981d4.js";import{c as de,a as E}from"./overlay_plugin_api-409cb9ea.js";const pe={flex:"~ col"},fe=G({__name:"dragJob",props:{party:{}},emits:["updateSortArr"],setup(j,{emit:b}){const d=S(),y=S(!0),C=b,N=j,M=()=>{C("updateSortArr",Object.values(u.value).flat().map(o=>o.id))},a=[{name:"tank",color:"blue"},{name:"healer",color:"green"},{name:"dps",color:"red"},{name:"crafter",color:"yellow"},{name:"gatherer",color:"purple"},{name:"none",color:"gray"}];function O(o){return N.party.find(i=>i.job===o)}const x=r.getBattleJobs3(),J=["tank","healer","dps","crafter","gatherer","none"],f=(()=>{const o={},i={tank:r.isTankJob,healer:r.isHealerJob,dps:r.isDpsJob,crafter:r.isCraftingJob,gatherer:r.isGatheringJob};for(const s of J)o[s]=(s==="none"?[]:x.filter(n=>i[s](n))).map(n=>r.jobToJobEnum(n)).sort((n,m)=>r.enumSortMethod(n,m));return o})(),T=Object.values(f).flat().map(o=>({name:r.nameToFullName(r.jobEnumToJob(o)).simple1,id:o})),u=V("cactbotRuntime-jobList",(()=>{const o={};for(const i of J)o[i]=T.filter(s=>f[i].includes(s.id)).sort((s,n)=>f[i].indexOf(s.id)-f[i].indexOf(n.id));return o})());return(o,i)=>(_(),v("div",pe,[(_(),v(w,null,A(a,(s,n)=>k(l(te),{key:n,ref_for:!0,ref_key:"el",ref:d,disabled:!y.value,modelValue:l(u)[s.name],"onUpdate:modelValue":m=>l(u)[s.name]=m,animation:"150",ghostClass:"ghost",class:"flex flex-row gap-0.25 p-0 m-t-0.25 m-b-0.25 rounded",onUpdate:M,filter:".no-draggable",forceFallback:!0},{default:P(()=>[(_(!0),v(w,null,A(l(u)[s.name],m=>(_(),v("div",{key:m.id,class:H(`${O(m.id)?`draggable bg-${s.color} cursor-move`:"no-draggable bg-gray-700/50"} rounded p-l-0.6 p-r-0.6 p-t-0 p-b-0.3 m-0 color-white`)},U(m.name),3))),128))]),_:2},1032,["disabled","modelValue","onUpdate:modelValue"])),64))]))}});const me=z(fe,[["__scopeId","data-v-9039b8ac"]]),I=j=>(le("data-v-d28f54f7"),j=j(),ue(),j),_e=I(()=>g("span",null,"用法",-1)),be=I(()=>g("p",null,"使悬浮窗的位置分配对应游戏内的实际位置（D1D2等）",-1)),ye=I(()=>g("ul",null,[g("li",null,"临时：下拉选择框修改。"),g("li",null,"长期：用鼠标拖动职能顺序。")],-1)),ve={class:"players"},ge={class:"name"},he=G({__name:"cactbotRuntime",setup(j){const b=(e,t)=>Array(t).fill(e).map((p,L)=>p+(+L+1)),d={tank:["MT","ST",...b("T",70)],healer:[...b("H",72)],dps:[...b("D",72)],crafter:[...b("C",72)],gatherer:[...b("G",72)],none:[...b("N",72)]},y=S(!1),C=V("cactbotRuntime-sortArr",ce),N=[{id:"10000001",name:"虚构战士",job:21,inParty:!0},{id:"10000002",name:"虚构骑士",job:19,inParty:!0},{id:"10000003",name:"虚构占星",job:33,inParty:!0},{id:"10000004",name:"虚构学者",job:28,inParty:!0},{id:"10000005",name:"虚构忍者",job:30,inParty:!0},{id:"10000006",name:"虚构武士",job:34,inParty:!0},{id:"10000007",name:"虚构黑魔",job:25,inParty:!0},{id:"10000008",name:"虚构舞者",job:38,inParty:!0}],a=V("cactbotRuntime-data",{party:[]}),O=V("cactbotRuntime-showTips",S(!0)),x={tank:0,healer:0,dps:0,crafter:0,gatherer:0,none:0};function J(){x.tank=a.value.party.reduce((e,t)=>u(t.job)==="tank"?e+1:e,0),x.healer=a.value.party.reduce((e,t)=>u(t.job)==="healer"?e+1:e,0),x.dps=a.value.party.reduce((e,t)=>u(t.job)==="dps"?e+1:e,0)}const f=location.href.includes("localhost"),h=S(!1),T=S(f?"虚构占星":"");if(f){const e={party:N};O.value&&(y.value=!0),a.value.party=e.party.map(t=>({...t,rp:"",specify:!1})),o(),J(),n()}function u(e){const t=Number(e);return[1,3,19,21,32,37].includes(t)?"tank":[6,24,28,33,40].includes(t)?"healer":[2,4,5,7,20,22,23,25,26,27,29,30,31,34,35,36,38,39].includes(t)?"dps":r.isCraftingJob(r.jobEnumToJob(e))?"crafter":r.isGatheringJob(r.jobEnumToJob(e))?"gatherer":"none"}function o(){a.value.party.sort((e,t)=>C.value.indexOf(e.job)-C.value.indexOf(t.job));for(const e of a.value.party)e.rp=void 0,e.rp=s(e)}function i(e){a.value.party[e].specify=!0;const t=a.value.party.find(p=>p.rp===a.value.party[e].rp&&p.id!==a.value.party[e].id);t&&(t.rp=s(t),t.specify=!0),n()}function s(e){return d[u(e.job)].find(t=>!a.value.party.find(p=>p.rp===t))??"unknown"}function n(){const e=[...d.tank,...d.healer,...d.dps,...d.crafter,...d.gatherer,...d.none];a.value.party.sort((t,p)=>e.indexOf(t.rp??"")-e.indexOf(p.rp??"")),de({call:"broadcast",source:"soumaRuntimeJS",msg:{party:a.value.party}})}function m(){h.value=!0}function K(){h.value=!1}function q(e){C.value=e,o(),J(),n()}const Q=e=>r.nameToFullName(r.jobEnumToJob(e)).simple1,W=e=>e;return ae(()=>{n(),E("PartyChanged",e=>{O.value&&(y.value=!0),!(f&&e.party.length===0)&&(a.value.party=e.party.filter(t=>t.inParty).map(t=>({...t,rp:"",specify:!1})),o(),J(),n())}),E("ChangePrimaryPlayer",e=>{f||(T.value=e.charName)}),E("BroadcastMessage",e=>{e.source==="soumaUserJS"&&typeof e.msg=="object"&&e.msg!==null&&Reflect.get(e.msg,"text")==="requestData"&&n()}),startOverlayEvents()}),(e,t)=>{const p=se,L=D("vxe-modal"),X=D("vxe-option"),Y=D("vxe-select"),Z=me;return _(),v("div",{onMouseenter:m,onMouseleave:K},[k(L,{modelValue:l(y),"onUpdate:modelValue":t[1]||(t[1]=c=>ne(y)?y.value=c:null),size:"small",position:{left:10,top:10},width:"90vw"},{title:P(()=>[_e]),default:P(()=>[be,ye,k(p,{type:"primary",onClick:t[0]||(t[0]=c=>{y.value=!1,O.value=!1})},{default:P(()=>[oe("不再提示")]),_:1})]),_:1},8,["modelValue"]),g("main",{class:H(l(h)?"mouseIn":"")},[g("div",ve,[k(re,{name:"animate__animated animate__bounce","enter-active-class":"animate__fadeInLeft","leave-active-class":"animate__fadeOutLeft"},{default:P(()=>[(_(!0),v(w,null,A(l(a).party,(c,ee)=>$((_(),v("section",{key:c.id,flex:"~ nowrap",class:"player"},[k(Y,{modelValue:c.rp,"onUpdate:modelValue":R=>c.rp=R,size:"mini",onChange:R=>i(ee),"class-name":"select"},{default:P(()=>[(_(!0),v(w,null,A(d[u(c.job)],(R,B)=>(_(),ie(X,{visible:B<x[u(c.job)],key:B,value:R,label:R},null,8,["visible","value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),g("span",ge,U(Q(c.job))+" "+U(l(h)?W(c.name):""),1)])),[[F,l(a).party.length>1&&(l(h)||c.name===l(T))]])),128))]),_:1})]),$(k(Z,{class:"dragJob",onUpdateSortArr:q,party:l(a).party,"m-b-1":"","p-1":""},null,8,["party"]),[[F,l(h)]])],2)],32)}}});const Pe=z(he,[["__scopeId","data-v-d28f54f7"]]);export{Pe as default};
