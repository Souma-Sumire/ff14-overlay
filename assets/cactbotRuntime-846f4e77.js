import{d as G,v as w,y as A,o as c,b as d,G as T,H as D,a as V,w as R,u as s,O as q,t as I,aD as Y,B as Z,r as N,g as ee,f as p,a0 as te,aE as ae,C as H,D as z,p as oe,j as ne,c as se}from"./vendor-6e892703.js";import{U as r,j as re}from"./util-f6d3a594.js";import{_ as Q}from"./index-5a8a9b32.js";import{c as le,a as U}from"./overlay_plugin_api-9faadcd6.js";const ue={flex:"~ col"},ie=G({__name:"dragJob",props:{party:{}},emits:["updateSortArr"],setup(g,{emit:J}){const _=w(),b=w(!0),S=J,L=g,$=()=>{S("updateSortArr",Object.values(k.value).flat().map(t=>t.id))},n=[{name:"tank",color:"blue"},{name:"healer",color:"green"},{name:"dps",color:"red"}];function C(t){return L.party.find(o=>o.job===t)}const m=r.getBattleJobs3(),O=m.filter(t=>r.isTankJob(t)).map(t=>r.jobToJobEnum(t)).sort((t,o)=>r.enumSortMethod(t,o)),j=m.filter(t=>r.isHealerJob(t)).map(t=>r.jobToJobEnum(t)).sort((t,o)=>r.enumSortMethod(t,o)),f=m.filter(t=>r.isDpsJob(t)).map(t=>r.jobToJobEnum(t)).sort((t,o)=>r.enumSortMethod(t,o)),l={tank:O,healer:j,dps:f,unknown:[]},v=Object.values(l).flat().map(t=>({name:r.nameToFullName(r.jobEnumToJob(t)).simple1,id:t})),k=A("cactbotRuntime-jobList",{tank:v.filter(t=>l.tank.includes(t.id)).sort((t,o)=>l.tank.indexOf(t.id)-l.tank.indexOf(o.id)),healer:v.filter(t=>l.healer.includes(t.id)).sort((t,o)=>l.healer.indexOf(t.id)-l.healer.indexOf(o.id)),dps:v.filter(t=>l.dps.includes(t.id)).sort((t,o)=>l.dps.indexOf(t.id)-l.dps.indexOf(o.id)),unknown:[]});return(t,o)=>(c(),d("div",ue,[(c(),d(T,null,D(n,(x,E)=>V(s(Y),{key:E,ref_for:!0,ref_key:"el",ref:_,disabled:!b.value,modelValue:s(k)[x.name],"onUpdate:modelValue":h=>s(k)[x.name]=h,animation:"150",ghostClass:"ghost",class:"flex flex-row gap-0.25 p-0 m-t-0.25 m-b-0.25 rounded",onUpdate:$,filter:".no-draggable",forceFallback:!0},{default:R(()=>[(c(!0),d(T,null,D(s(k)[x.name],h=>(c(),d("div",{key:h.id,class:q(`${C(h.id)?`draggable bg-${x.color} cursor-move`:"no-draggable bg-gray-700/50"} rounded p-l-0.6 p-r-0.6 p-t-0 p-b-0.3 m-0 color-white`)},I(h.name),3))),128))]),_:2},1032,["disabled","modelValue","onUpdate:modelValue"])),64))]))}});const ce=Q(ie,[["__scopeId","data-v-c9ddef79"]]),B=g=>(oe("data-v-9ea3cd42"),g=g(),ne(),g),de={key:0,style:{color:"white","text-shadow":"1px 1px 2px black"}},pe=B(()=>p("span",null,"用法",-1)),me=B(()=>p("p",null,"使悬浮窗的位置分配对应游戏内的实际位置（D1D2等）",-1)),fe=B(()=>p("ul",null,[p("li",null,"临时：下拉选择框修改。"),p("li",null,"长期：用鼠标拖动职能顺序。")],-1)),_e={class:"players"},be={class:"name"},ye=G({__name:"cactbotRuntime",setup(g){const J=(e,a)=>Array(a).fill(e).map((u,M)=>u+(+M+1)),_={tank:["MT","ST",...J("T",70)],healer:[...J("H",72)],dps:[...J("D",72)],unknown:["unknown"]},b=w(!1),S=A("cactbotRuntime-sortArr",re),L=[{id:"10000001",name:"虚构战士",job:21,inParty:!0},{id:"10000002",name:"虚构骑士",job:19,inParty:!0},{id:"10000003",name:"虚构占星",job:33,inParty:!0},{id:"10000004",name:"虚构学者",job:28,inParty:!0},{id:"10000005",name:"虚构忍者",job:30,inParty:!0},{id:"10000006",name:"虚构武士",job:34,inParty:!0},{id:"10000007",name:"虚构黑魔",job:25,inParty:!0},{id:"10000008",name:"虚构舞者",job:38,inParty:!0}],n=A("cactbotRuntime-data",{party:[]}),C=A("cactbotRuntime-showTips",w(!0)),m={tank:0,healer:0,dps:0,unknown:1};function O(){m.tank=n.value.party.reduce((e,a)=>y(a.job)==="tank"?e+1:e,0),m.healer=n.value.party.reduce((e,a)=>y(a.job)==="healer"?e+1:e,0),m.dps=n.value.party.reduce((e,a)=>y(a.job)==="dps"?e+1:e,0)}const j=location.href.includes("localhost"),f=w(!1),l=w(j?"虚构占星":"");if(j){const e={party:L};C.value&&(b.value=!0),n.value.party=e.party.map(a=>({...a,rp:"",specify:!1})),v(),O(),o()}function y(e){const a=Number(e);return[1,3,19,21,32,37].includes(a)?"tank":[6,24,28,33,40].includes(a)?"healer":[2,4,5,7,20,22,23,25,26,27,29,30,31,34,35,36,38,39].includes(a)?"dps":"unknown"}function v(){n.value.party.sort((e,a)=>S.value.indexOf(e.job)-S.value.indexOf(a.job));for(const e of n.value.party)e.rp=void 0,e.rp=t(e)}function k(e){n.value.party[e].specify=!0;const a=n.value.party.find(u=>u.rp===n.value.party[e].rp&&u.id!==n.value.party[e].id);a&&(a.rp=t(a),a.specify=!0),o()}function t(e){return _[y(e.job)].find(a=>!n.value.party.find(u=>u.rp===a))??"unknown"}function o(){const e=[..._.tank,..._.healer,..._.dps];n.value.party.sort((a,u)=>e.indexOf(a.rp??"")-e.indexOf(u.rp??"")),le({call:"broadcast",source:"soumaRuntimeJS",msg:{party:n.value.party}})}function x(){f.value=!0}function E(){f.value=!1}function h(e){S.value=e,v(),O(),o()}return Z(()=>{o(),U("PartyChanged",e=>{C.value&&(b.value=!0),!(j&&e.party.length===0)&&(n.value.party=e.party.filter(a=>a.inParty).map(a=>({...a,rp:"",specify:!1})),v(),O(),o())}),U("ChangePrimaryPlayer",e=>{j||(l.value=e.charName)}),U("BroadcastMessage",e=>{e.source==="soumaUserJS"&&typeof e.msg=="object"&&e.msg!==null&&Reflect.get(e.msg,"text")==="requestData"&&o()}),startOverlayEvents()}),(e,a)=>{const u=N("vxe-modal"),M=N("vxe-option"),K=N("vxe-select"),W=ce;return c(),d(T,null,[s(n).party.length===0?(c(),d("span",de,"等待小队...")):ee("",!0),p("div",{onMouseenter:x,onMouseleave:E},[V(u,{modelValue:s(b),"onUpdate:modelValue":a[0]||(a[0]=i=>te(b)?b.value=i:null),size:"small",position:{left:10,top:10},width:"90vw"},{title:R(()=>[pe]),default:R(()=>[me,fe]),_:1},8,["modelValue"]),p("main",{class:q(s(f)?"mouseIn":"")},[p("div",_e,[V(ae,{name:"animate__animated animate__bounce","enter-active-class":"animate__fadeInLeft","leave-active-class":"animate__fadeOutLeft"},{default:R(()=>[(c(!0),d(T,null,D(s(n).party,(i,X)=>H((c(),d("section",{key:i.id,flex:"~ nowrap",class:"player"},[V(K,{modelValue:i.rp,"onUpdate:modelValue":P=>i.rp=P,size:"mini",onChange:P=>k(X),"class-name":"select"},{default:R(()=>[(c(!0),d(T,null,D(_[y(i.job)],(P,F)=>(c(),se(M,{visible:F<m[y(i.job)],key:F,value:P,label:P},null,8,["visible","value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),p("span",be,I(s(r).nameToFullName(s(r).jobEnumToJob(i.job)).simple2)+" "+I(s(f)?i.name:""),1)])),[[z,s(f)||i.name===s(l)]])),128))]),_:1})]),H(V(W,{class:"dragJob",onUpdateSortArr:h,party:s(n).party,"m-b-1":"","p-1":""},null,8,["party"]),[[z,s(f)]])],2)],32)],64)}}});const ke=Q(ye,[["__scopeId","data-v-9ea3cd42"]]);export{ke as default};
