import{ax as j,q as B,Y as oe,b as Q,o as b,e as x,t as r,a as n,w as o,F as se,L as le,u as e,c as L,a1 as re,ad as ie,a2 as ce,G as de,H as ue,d as pe,n as I,ay as me,y as d,a0 as F,x as g,az as V,aA as fe,J as _e,ah as he,B as ge,ak as be,N as we,al as ve,aB as Ce,aC as ye,as as Se,ap as Ee,af as Ve,C as Te,ag as De}from"./vendor-9c3ca848.js";import{_ as J}from"./_plugin-vue_export-helper-c27b6911.js";import{C as m}from"./content_type-52b79aff.js";import{a as H,r as W,c as Re}from"./overlay_plugin_api-409cb9ea.js";import{N as Y,c as Pe,l as M}from"./netregexes-60f54b26.js";import{z as xe}from"./zoneInfo-a419d684.js";const Ne=T=>(de("data-v-66d37cfa"),T=T(),ue(),T),ke={class:"language-switcher"},Oe={class:"select-wrapper"},Ue=Ne(()=>r("svg",{class:"globe-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[r("circle",{cx:"12",cy:"12",r:"10"}),r("line",{x1:"2",y1:"12",x2:"22",y2:"12"}),r("path",{d:"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"})],-1)),Be={__name:"LanguageSwitcher",setup(T){const{locale:a,availableLocales:i}=j(),f={zhCn:"简体中文",en:"English",ja:"日本語"},w=B("user-locale",a.value);return oe(w,y=>{a.value=y}),Q(()=>{a.value=w.value}),(y,N)=>{const k=ie,O=ce;return b(),x("div",ke,[r("div",Oe,[Ue,n(O,{modelValue:e(w),"onUpdate:modelValue":N[0]||(N[0]=S=>re(w)?w.value=S:null),size:"small",class:"language-select"},{default:o(()=>[(b(!0),x(se,null,le(e(i),(S,E)=>(b(),L(k,{key:E,value:S,label:f[S]},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])])])}}},Le=J(Be,[["__scopeId","data-v-66d37cfa"]]),Ae={class:"obs-container"},Ie={class:"card-header"},Fe={class:"act-not-ready-content"},Ge={key:1},$e={class:"card-header"},ze={key:1},qe={class:"card-header"},Ze={class:"status-info"},He={class:"button-container"},We={class:"card-header"},Ye={class:"profile-info"},Me={class:"file-path-explanation"},je={class:"file-name-explanation"},Qe={class:"card-header"},Je=pe({__name:"obs2",setup(T){const{t:a}=j(),i=B("obs-user-config",{host:4455,password:"",path:"",fileName:""},localStorage,{writeDefaults:!0}),f=B("obs-user-content-setting",[]),w=B("obs-is-first-time",!0),y=I(!1),N=I(!1),k=I({});function O(){return new Promise(u=>{Re({call:"cactbotRequestState"}).then(()=>{y.value=!0,u()}),setTimeout(()=>{y.value||O()},3e3)})}const S={inCombat:Y.inCombat(),countdown:Y.countdown(),wipe:Pe.wipe},E=["Savage","Extreme","Ultimate","Dungeons","Raids","Trials","VCDungeonFinder","DeepDungeons","Guildhests","DisciplesOfTheLand","Eureka","GrandCompany","QuestBattles","TreasureHunt","Pvp","Default"],G={enter:!1,countdown:!0,combatStart:!1,combatEnd:!0,wipe:!0},$={enter:!1,countdown:!1,combatStart:!1,combatEnd:!1,wipe:!1};function K(){const u=["Savage","Extreme","Ultimate"];if(w.value)w.value=!1,f.value=[...u.map(t=>({type:t,...G})),...E.filter(t=>!u.includes(t)).map(t=>({type:t,...$}))];else{f.value=f.value.filter(l=>E.includes(l.type));const t=E.filter(l=>!f.value.some(p=>p.type===l)&&l!=="Default").map(l=>u.includes(l)?{type:l,...G}:{type:l,...$});f.value.push(...t)}f.value.sort((t,l)=>E.indexOf(t.type)-E.indexOf(l.type))}class X{constructor(){this.handleConnectionError=()=>{this.status.connecting=!1,this.status.connected=!1,this.status.recording=!1,this.status.outputActive=!1,this.status.outputPath="",V.modal.close(),V.modal.message({title:a("OBS Connection"),content:a("OBS Connection Error"),status:"warning",duration:2e3})},this.handleConnectionClosed=()=>{this.status.connecting=!1,this.status.connected=!1,this.status.recording=!1,this.status.outputActive=!1,this.status.outputPath="",V.modal.close(),V.modal.message({title:a("OBS Connection"),content:a("OBS Connection Closed"),status:"warning",duration:2e3})},this.ws=new fe,this.status=_e({connecting:!1,connected:!1,recording:!1,outputActive:!1,outputPath:""}),this.ws.on("ConnectionClosed",this.handleConnectionClosed),this.ws.on("ConnectionError",this.handleConnectionError),this.ws.on("RecordStateChanged",t=>{this.status.connected=!0,this.status.recording=t.outputState==="OBS_WEBSOCKET_OUTPUT_STARTED",this.status.outputActive=t.outputActive,this.status.outputPath=t.outputPath})}connect(){i.value.host&&i.value.password&&(this.status.connecting=!0,this.ws.connect(`ws://127.0.0.1:${i.value.host}`,i.value.password).then(()=>{this.ws.call("GetRecordStatus").then(t=>{this.status.recording=t.outputActive,this.status.outputActive=t.outputActive}),this.status.connected=!0,V.modal.close(),V.modal.message({title:a("OBS Connection"),content:a("OBS Connection Opened"),status:"success",duration:2e3})}).finally(()=>{this.status.connecting=!1,i.value.path||this.ws.call("GetRecordDirectory").then(t=>{t.recordDirectory&&(i.value.path=t.recordDirectory)}),i.value.fileName||(i.value.fileName="%CCYY-%MM-%DD %hh-%mm-%ss")}))}disconnect(){this.ws.disconnect()}async startRecord(){await this.setProfileParameter(),this.ws.call("StartRecord")}stopRecord(){this.ws.call("StopRecord")}splitRecord(){this.ws.call("StopRecord").finally(()=>{setTimeout(()=>{this.ws.call("StartRecord")},1e3)})}async setProfileParameter(){const t=i.value.path,l=i.value.fileName,p=[];return p.push({requestType:"SetProfileParameter",requestData:{parameterCategory:"AdvOut",parameterName:"RecFilePath",parameterValue:t}}),p.push({requestType:"SetProfileParameter",requestData:{parameterCategory:"Output",parameterName:"FilenameFormatting",parameterValue:l}}),i.value.path=t,i.value.fileName=l,this.ws.callBatch(p)}}const c=new X,z=u=>{const t=u.zoneID,l=xe[t];k.value=l},q=u=>{const t=u.rawLine;for(const l in S)if(S[l].exec(t)){const v=t.split("|");switch(l){case"inCombat":{const _=v[M.InCombat.fields.inACTCombat]==="1",R=v[M.InCombat.fields.inGameCombat]==="1";if(_&&R){U("combatStart");return}if(!_&&!R){U("combatEnd");return}break}case"countdown":{U("countdown");break}case"wipe":{U("wipe");break}}}};function ee(u){var t,l;switch(u.contentType){case m.UltimateRaids:return"Ultimate";case m.Pvp:return"Pvp";case m.Dungeons:return"Dungeons";case m.DeepDungeons:return"DeepDungeons";case m.VCDungeonFinder:return"VCDungeonFinder";case m.Trials:return(t=u.name.fr)!=null&&t.includes("(extrême)")?"Extreme":"Trials";case m.Raids:return(l=u.name.en)!=null&&l.includes("(Savage)")?"Savage":"Raids";case m.DisciplesOfTheLand:return"DisciplesOfTheLand";case m.Eureka:return"Eureka";case m.GrandCompany:return"GrandCompany";case m.QuestBattles:return"QuestBattles";case m.TreasureHunt:return"TreasureHunt";default:return"Default"}}function U(u){const t=c.status.recording,l=ee(k.value);if(f.value.find(p=>p.type===l&&p[u]))switch(u){case"enter":case"countdown":case"combatStart":t?c.splitRecord():c.startRecord();return;case"combatEnd":case"wipe":t&&c.stopRecord()}}return Q(async()=>{await O(),c.connect(),H("ChangeZone",z),H("LogLine",q),K()}),me(()=>{c.disconnect(),W("ChangeZone",z),W("LogLine",q)}),(u,t)=>{const l=Le,p=he,D=ge,v=be,_=we,R=ve,te=Ce,A=ye,Z=Se,ae=Ee,C=Ve,P=Te,ne=De;return b(),x("div",Ae,[r("header",null,[r("h1",null,d(e(a)("OBS Auto Record V2")),1),n(l)]),e(y)?F("",!0):(b(),L(p,{key:0,class:"act-not-ready-card"},{header:o(()=>[r("div",Ie,[r("span",null,d(e(a)("ACT Not Ready")),1)])]),default:o(()=>[r("div",Fe,[r("p",null,d(e(a)("overlayTutorial")),1)])]),_:1})),e(y)?(b(),x("main",Ge,[e(c).status.connected?(b(),x("div",ze,[n(A,{class:"instruction-alert",type:"info",description:e(a)("hideTutorial"),closable:!1,"show-icon":""},null,8,["description"]),e(N)?(b(),L(p,{key:0,class:"status-card"},{header:o(()=>[r("div",qe,[r("span",null,d(e(a)("Connection Status")),1),n(_,{type:"danger",size:"small",class:"disconnect-button",onClick:t[3]||(t[3]=s=>e(c).disconnect())},{default:o(()=>[g(d(e(a)("Disconnect")),1)]),_:1})])]),default:o(()=>[r("div",Ze,[n(ae,{direction:"vertical",column:1,border:""},{default:o(()=>[n(Z,{label:e(a)("Recording")},{default:o(()=>[g(d(e(c).status.recording?e(a)("Yes"):e(a)("No")),1)]),_:1},8,["label"]),n(Z,{label:e(a)("Output Path")},{default:o(()=>[g(d(e(c).status.outputPath||e(a)("None")),1)]),_:1},8,["label"])]),_:1})]),r("div",He,[n(_,{disabled:!e(c).status.connected||e(c).status.recording,type:"primary",onClick:t[4]||(t[4]=s=>e(c).startRecord())},{default:o(()=>[g(d(e(a)("Start Record")),1)]),_:1},8,["disabled"]),n(_,{disabled:!e(c).status.connected||!e(c).status.recording,type:"danger",onClick:t[5]||(t[5]=s=>e(c).stopRecord())},{default:o(()=>[g(d(e(a)("Stop Record")),1)]),_:1},8,["disabled"]),n(_,{disabled:!e(c).status.connected||!e(c).status.recording,type:"warning",onClick:t[6]||(t[6]=s=>e(c).splitRecord())},{default:o(()=>[g(d(e(a)("Split Record")),1)]),_:1},8,["disabled"]),n(_,{type:"primary",onClick:t[7]||(t[7]=s=>e(c).setProfileParameter())},{default:o(()=>[g(d(e(a)("Set Recording Name")),1)]),_:1})])]),_:1})):F("",!0),n(p,{class:"profile-card"},{header:o(()=>[r("div",We,[r("span",null,d(e(a)("Recording Profile")),1)])]),default:o(()=>[r("div",Ye,[n(R,{"label-position":"top",class:"content-form"},{default:o(()=>[n(v,{label:e(a)("Record Path")},{default:o(()=>[n(D,{modelValue:e(i).path,"onUpdate:modelValue":t[8]||(t[8]=s=>e(i).path=s),placeholder:e(a)("recordPathPlaceholder")},null,8,["modelValue","placeholder"]),r("div",Me,d(e(a)("filePathExplanation")),1)]),_:1},8,["label"]),n(v,{label:e(a)("Record File Name")},{default:o(()=>[n(D,{modelValue:e(i).fileName,"onUpdate:modelValue":t[9]||(t[9]=s=>e(i).fileName=s),placeholder:e(a)("recordFileNamePlaceholder")},null,8,["modelValue","placeholder"]),r("div",je,d(e(a)("fileNameExplanation")),1)]),_:1},8,["label"])]),_:1})])]),_:1}),n(p,{class:"table-card"},{header:o(()=>[r("div",Qe,[r("span",null,d(e(a)("User Content Settings")),1)])]),default:o(()=>[n(ne,{data:e(f),style:{width:"100%"},border:!0,stripe:""},{default:o(()=>[n(C,{prop:"type",label:e(a)("Type"),"min-width":"130",fixed:""},{default:o(s=>[r("span",null,d(e(a)(s.row.type)),1)]),_:1},8,["label"]),n(C,{label:e(a)("Start When"),align:"center"},{default:o(()=>[n(C,{prop:"enter",label:e(a)("Enter Zone"),align:"center","min-width":"95"},{default:o(s=>[n(P,{modelValue:s.row.enter,"onUpdate:modelValue":h=>s.row.enter=h},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),n(C,{prop:"countdown",label:e(a)("CountDown"),align:"center","min-width":"95"},{default:o(s=>[n(P,{modelValue:s.row.countdown,"onUpdate:modelValue":h=>s.row.countdown=h},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),n(C,{prop:"combatStart",label:e(a)("CombatStart"),align:"center","min-width":"95"},{default:o(s=>[n(P,{modelValue:s.row.combatStart,"onUpdate:modelValue":h=>s.row.combatStart=h},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"])]),_:1},8,["label"]),n(C,{label:e(a)("End When"),align:"center"},{default:o(()=>[n(C,{prop:"combatEnd",label:e(a)("CombatEnd"),align:"center","min-width":"95"},{default:o(s=>[n(P,{modelValue:s.row.combatEnd,"onUpdate:modelValue":h=>s.row.combatEnd=h},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),n(C,{prop:"wipe",label:e(a)("Wipe"),align:"center","min-width":"95"},{default:o(s=>[n(P,{modelValue:s.row.wipe,"onUpdate:modelValue":h=>s.row.wipe=h},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"])]),_:1},8,["label"])]),_:1},8,["data"])]),_:1})])):(b(),L(p,{key:0,class:"connection-card"},{header:o(()=>[r("div",$e,[r("span",null,d(e(a)("Connect to OBS")),1)])]),default:o(()=>[n(R,{"label-position":"top",class:"connection-form"},{default:o(()=>[n(v,{label:e(a)("Port")},{default:o(()=>[n(D,{modelValue:e(i).host,"onUpdate:modelValue":t[0]||(t[0]=s=>e(i).host=s),placeholder:e(a)("portPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),n(v,{label:e(a)("Password")},{default:o(()=>[n(D,{modelValue:e(i).password,"onUpdate:modelValue":t[1]||(t[1]=s=>e(i).password=s),placeholder:e(a)("passwordPlaceholder"),type:"password"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),n(v,null,{default:o(()=>[n(_,{type:"primary",class:"connect-button",loading:e(c).status.connecting,disabled:e(c).status.connecting||!e(i).host||!e(i).password,onClick:t[2]||(t[2]=s=>e(c).connect())},{default:o(()=>[g(d(e(c).status.connecting?e(a)("Connecting"):e(a)("Connect")),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1}),n(te,null,{default:o(()=>[g(d(e(a)("Instructions")),1)]),_:1}),n(A,{class:"instruction-alert",type:"info",description:e(a)("obsTutorial"),closable:!1,"show-icon":""},null,8,["description"]),n(A,{class:"instruction-alert",type:"info",description:e(a)("inputTutorial"),closable:!1,"show-icon":""},null,8,["description"])]),_:1}))])):F("",!0)])}}});const ot=J(Je,[["__scopeId","data-v-f5ef39af"]]);export{ot as default};
