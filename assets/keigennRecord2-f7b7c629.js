import{as as ft,R as yt,d as re,o as N,b as S,G as _e,H as Ve,f as y,t as T,u as c,O as ue,c as Be,w as V,a as x,ax as gt,P as Ke,g as Ce,A as Fe,v as R,y as W,B as ht,x as bt,Z as vt,r as se,C as Le,D as ze,a0 as kt,au as Ft,av as Me}from"./vendor-0a68389d.js";import{s as Ze,c as Je,a as wt}from"./status-2d1e5a26.js";import{h as fe}from"./xivapi-cae66b04.js";import{t as xe,a as _t,p as Ct,b as xt,d as Nt}from"./deepClone-74719da6.js";import{N as L,l as n}from"./netregexes-2830d8aa.js";import{U}from"./util-ef9ccf87.js";import{g as It}from"./actionChinese-71b7e526.js";import{a as we}from"./overlay_plugin_api-9faadcd6.js";import"./queryParams-cf2e4fb1.js";import"./index-6f760b32.js";const Ge=[{name:"铁壁",description:"减轻所受到的伤害",id:1191,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"盾阵",description:"受到攻击时必定发动格挡",id:1856,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"干预",description:"减轻所受到的伤害",id:1174,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"预警",description:"减轻所受到的伤害",id:74,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"武装",description:"减轻所受到的伤害",id:1176,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"神圣领域",description:"除特定攻击之外其他所有攻击均无效化",id:82,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"圣光幕帘",description:"抵消一定伤害",id:1362,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"圣盾阵",description:"受到攻击时必定发动格挡",id:2674,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"骑士的坚守",description:"减轻所受到的伤害",id:2675,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"壁垒",description:"受到攻击时必定发动格挡",id:77,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的直觉",description:"自身发动战技命中时可以恢复体力，同时减轻所受到的伤害",id:735,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的勇猛",description:"自身发动战技命中时可以恢复体力",id:1857,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的武猛",description:`附加此效果的战士受到原初的勇猛的恢复体力的效果时，会获得相当于其100%的恢复效果
另外受到攻击的伤害减少`,id:1858,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"战栗",description:`体力最大值提高
习得战栗效果提高后追加效果：自身所受的治疗效果提高`,id:87,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"复仇",description:"受到攻击的伤害减少并且受到物理攻击时会发动反击",id:89,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"摆脱",description:"抵消一定伤害",id:1457,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"死斗",description:"除特定攻击之外其他所有对自身发动的攻击均无法令体力减少到1以下",id:409,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的血气",description:"自身发动战技命中时可以恢复体力，同时减轻所受到的伤害",id:2678,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的血潮",description:"减轻所受到的伤害",id:2679,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的血烟",description:"抵消一定伤害",id:2680,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"至黑之夜",description:"抵消一定伤害",id:1178,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"弃明投暗",description:"减轻所受到的魔法伤害",id:746,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!0},{name:"暗影墙",description:"减轻所受到的伤害",id:747,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"暗黑布道",description:"减轻所受到的魔法伤害",id:1894,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!0},{name:"行尸走肉",description:`受到致命伤害时体力减为1，并附加死而不僵状态
但是对部分攻击无效`,id:810,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"死而不僵",description:"除特定攻击之外其他所有对自身发动的攻击均无法令体力减少到1以下",id:811,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"出死入生",description:"除特定攻击之外其他所有对自身发动的攻击均无法令体力减少到1以下",id:3255,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"献奉",description:"减轻所受到的伤害",id:2682,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"石之心",description:"减轻所受到的伤害",id:1840,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"残暴弹",description:"抵消一定伤害",id:1898,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"伪装",description:"招架发动率提高，减轻所受到的伤害",id:1832,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"星云",description:"减轻所受到的伤害",id:1834,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"光之心",description:"减轻所受到的魔法伤害",id:1839,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!0},{name:"超火流星",description:"除特定攻击之外其他所有攻击均无效化",id:1836,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"刚玉之心",description:"减轻所受到的伤害",id:2683,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"刚玉之清",description:"减轻所受到的伤害",id:2684,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"神祝祷",description:"抵消一定伤害",id:1218,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"节制",description:"减轻所受到的伤害",id:1873,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"水流幕",description:"减轻所受到的伤害",id:2708,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"鼓舞",description:"抵消一定伤害",id:297,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"激励",description:"抵消一定伤害",id:1918,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"炽天的幕帘",description:"抵消一定伤害",id:1917,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"野战治疗阵",description:"减轻所受到的伤害",id:299,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"异想的幻光",description:"发动治疗魔法的治疗量提高，且受到魔法攻击的伤害减少",id:317,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!0},{name:"炽天的幻光",description:"发动治疗魔法的治疗量提高，且受到魔法攻击的伤害减少",id:1875,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!0},{name:"生命回生法",description:"体力最大值提高，同时自身所受体力恢复效果提高",id:2710,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"怒涛之计",description:"减轻所受到的伤害",id:2711,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"命运之轮",description:"减轻所受到的伤害",id:849,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"天星交错",description:"抵消一定伤害",id:1889,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"擢升",description:"减轻所受到的伤害",id:2717,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"中间学派",description:"抵消一定伤害",id:1921,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"均衡诊断",description:"抵消一定伤害",id:2607,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"齐衡诊断",description:"抵消一定伤害",id:2608,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"均衡预后",description:"抵消一定伤害",id:2609,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"坚角清汁",description:"减轻所受到的伤害",id:2618,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"白牛清汁",description:"减轻所受到的伤害",id:2619,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"整体论",description:"减轻所受到的伤害",id:3003,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"整体盾",description:"抵消一定伤害",id:3365,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"输血",description:"抵消一定伤害",id:2612,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"泛输血",description:"抵消一定伤害",id:2613,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"心眼",description:"下次受到攻击时所受到的伤害减轻",id:1232,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"金刚极意",description:"减轻所受到的一部分伤害",id:1179,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"行吟",description:"减轻所受到的伤害",id:1934,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"策动",description:"减轻所受到的伤害",id:1951,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"防守之桑巴",description:"减轻所受到的伤害",id:1826,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"即兴表演结束",description:"抵消一定伤害",id:2697,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"残影",description:"抵消一定伤害",id:488,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"魔罩",description:"抵消一定伤害",id:168,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"守护之光",description:"抵消一定伤害",id:2702,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"守护纹",description:"抵消一定伤害",id:2597,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"抗死",description:"减轻所受到的魔法伤害，同时自身所受体力恢复效果提高",id:2707,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!0},{name:"雪仇",description:"攻击所造成的伤害降低",id:1193,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!1},{name:"牵制",description:"物理攻击和魔法攻击所造成的伤害降低",id:1195,type:"multiplier",performance:{physics:1,magic:.5,darkness:0},isFriendly:!1},{name:"昏乱",description:"物理攻击和魔法攻击所造成的伤害降低",id:1203,type:"multiplier",performance:{physics:.5,magic:1,darkness:0},isFriendly:!1},{name:"武装解除",description:"攻击所造成的伤害降低",id:860,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!1},{name:"减速",description:"战技与魔法的咏唱及复唱时间延长",id:9,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!1},{name:"体力增加",description:"体力最大值提高",id:2120,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"腐臭",description:"造成的伤害降低",id:1715,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!1},{name:"智力精神降低",description:"智力与精神有所降低",id:2115,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!1},{name:"龙之力",description:"受到的伤害降低",id:2500,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"超硬化",description:"无法自由活动，但受到攻击的伤害减少",id:1722,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"玄结界",description:"减轻所受到的伤害，受到一定伤害后将附加玄天武水壁状态",id:2496,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"仙人盾",description:"受到的伤害降低",id:2119,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"强力守护",description:"令自身所受到的伤害减少，同时会以攻击力降低为代价提高自身仇恨",id:1719,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"哥布防御",description:"抵消一定伤害",id:2114,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"铜墙铁盾",description:"减轻所受到的伤害",id:194,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"坚守要塞",description:"减轻所受到的伤害",id:195,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"终极堡垒",description:"减轻所受到的伤害",id:196,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初大地",description:"减轻所受到的伤害",id:863,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"暗黑之力",description:"减轻所受到的伤害",id:864,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"灵魂之青",description:"减轻所受到的伤害",id:1931,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0}],Ne=new Map;let We;function Ie(a){if(We!==a){const t=a==="Chinese"?Ge:Object.assign(Ge,{});Ne.clear();for(const i of t){const I=Ze[i.id][1];i.fullIcon=Je(I),Ne.set(i.id.toString(16).toUpperCase(),i)}We=a}}Ie("Chinese");function $t(a){return Ne.get(a)}const Et=a=>a===1?"useful":a===0?"unuseful":"half-useful",Tt=/(?:耐性|防御力)(?:大幅)?(?:降低|提升|低下|下降)|受伤(?:加重|减轻)|体力(?:增加|衰减|减少)|伤害屏障/,St=/(?:精神|力量|灵巧|智力){1,2}(?:大幅)?降低/,Ye=(a,t)=>Object.entries(Ze).reduce((i,[I,[k,b]])=>(a.test(k)&&i.set(I,{name:k,icon:b,isFriendly:t}),i),new Map),At=Ye(Tt,!0),Dt=Ye(St,!1),f=ft("hash"),$e=yt("keigennRecord2",{state:()=>({userOptions:{scale:E(f.scale,1),showHeader:E(f.showHeader,!0),showIcon:E(f.showIcon,!0),showName:E(f.showName,!1),abbrId:E(f.abbrId,!0),anonymous:E(f.anonymous,!0),replaceWithYou:E(f.replaceWithYou,!1),parseAA:E(f.parseAA,!0),parseDoT:E(f.parseDoT,!1),minimize:E(f.minimize,!1),actionCN:E(f.actionCN,!0),statusCN:E(f.statusCN,!0)},isDev:f.dev==="1"||f.dev===void 0&&!window.OverlayPluginApi&&!f.OVERLAY_WS&&!f.HOST_PORT}),getters:{icon4k(a){return a.userOptions.scale>=2||window.devicePixelRatio>=2?"_hr1":""}},actions:{recheckIsDev(){setTimeout(()=>{this.isDev=f.dev==="1"||f.dev===void 0&&!window.OverlayPluginApi&&!f.OVERLAY_WS&&!f.HOST_PORT},1e3)},formatterName(a){return a},initEnvironment(a){/^([A-Z])\S+ ([A-Z])\S+$/.test(a)?(this.userOptions.abbrId&&(this.formatterName=t=>t.replace(/^([A-Z])\S+ ([A-Z])\S+$/,"$1.$2.")),Ie("Global")):(this.userOptions.abbrId&&(this.formatterName=t=>t.substring(0,2)),Ie("Chinese"))}}});function E(a,t){return typeof t=="boolean"?a==="0"?!1:a==="1"?!0:t:typeof t=="number"?Number.isNaN(+a)?t:+a:t}const jt={key:0},Ht={key:1},Ot=["title","data-duration","data-sourcePov"],Pt=["src","alt"],Rt=re({__name:"StatusShow",props:{row:{type:Object,required:!0}},setup(a){const i=$e().icon4k,I=a;return(k,b)=>I.row.type==="dot"?(N(),S("div",jt,"（不支持）")):(N(),S("div",Ht,[(N(!0),S(_e,null,Ve(I.row.keigenns,(_,ye)=>(N(),S("span",{key:ye},[y("span",{class:"status",title:`${_.name}(${_.source})`,"data-duration":_.remainingDuration,"data-sourcePov":_.isPov},[y("img",{class:ue(`statusIcon ${c(Et)(_.performance[a.row.type])}`),src:`//cafemaker.wakingsands.com/i/${_.fullIcon}${c(i)}.png`,alt:_.effect,onError:b[0]||(b[0]=(...ne)=>c(fe)&&c(fe)(...ne)),loading:"lazy"},null,42,Pt)],8,Ot)]))),128)),y("span",null,T(a.row.effect==="damage done"?"":c(xe)(a.row.effect)),1)]))}}),Lt=y("br",null,null,-1),zt=y("br",null,null,-1),Mt=y("br",null,null,-1),Gt=y("br",null,null,-1),Wt=re({__name:"AmountDetails",props:{row:{type:Object,required:!0}},setup(a){const t=a;return(i,I)=>(N(),S("div",null,[y("span",null," 盾:"+T(Math.round(t.row.maxHp*+t.row.shield/100))+" ("+T(t.row.shield)+"%) ",1),Lt,y("span",null," HP:"+T(t.row.currentHp)+"/"+T(t.row.maxHp)+" ( "+T(Math.round(t.row.currentHp/t.row.maxHp*100))+"%) ",1),zt,y("span",null,"来源:"+T(t.row.source),1),Mt,y("span",null,"受到伤害:"+T(t.row.amount),1),Gt,y("span",null," 剩余HP:"+T(t.row.currentHp-t.row.amount)+" ( "+T(Math.round((t.row.currentHp-t.row.amount)/t.row.maxHp*100))+"%) ",1)]))}}),Ut=[409 .toString(16).toUpperCase(),810 .toString(16).toUpperCase(),811 .toString(16).toUpperCase(),1836 .toString(16).toUpperCase()],Vt=a=>a.currentHp-a.amount<0&&!a.keigenns.find(t=>Ut.includes(t.effectId)),Bt={class:"amount"},Kt=re({__name:"Amount",props:{row:{type:Object,required:!0}},setup(a){const t=a;return(i,I)=>{const k=Wt,b=gt;return N(),Be(b,{"append-to":".wrapper",effect:"dark",placement:"right-start",title:"",trigger:"hover",enterable:!1,"hide-after":0,"popper-class":"my-el-popover"},{reference:V(()=>[y("span",Bt,[y("span",{class:ue(t.row.type)},[y("span",{class:ue(`${c(Vt)(a.row)?"lethal":""}`)},T(a.row.amount.toLocaleString().padStart(3,"　")),3)],2)])]),default:V(()=>[x(k,{row:a.row},null,8,["row"])]),_:1})}}}),Zt={key:0,class:"target"},Jt=["src","data-job"],Yt=re({__name:"Target",props:{row:{type:Object,required:!0}},setup(a){const t=$e(),i=a;return(I,k)=>(N(),S("div",null,[c(t).userOptions.showIcon?(N(),S("span",Zt,[y("img",{class:"jobIcon",src:`//cafemaker.wakingsands.com/cj/companion/${i.row.jobIcon}.png`,alt:"","data-job":c(t).userOptions.showName?"":i.row.job,onError:k[0]||(k[0]=(...b)=>c(fe)&&c(fe)(...b)),loading:"lazy"},null,40,Jt),c(t).userOptions.showName?(N(),S("span",{key:0,class:ue(`job ${i.row.jobIcon} ${i.row.targetId===i.row.povId?"YOU":""}`),style:Ke(!c(t).userOptions.abbrId&&c(t).userOptions.showName?{overflow:"hidden",textOverflow:"ellipsis"}:{})},T(i.row.targetId===i.row.povId&&c(t).userOptions.replaceWithYou?"YOU":c(t).userOptions.anonymous?i.row.job:c(t).formatterName(i.row.target)),7)):Ce("",!0)])):Ce("",!0)]))}}),qt={key:0,class:"testLog"},Ue="souma-keigenn-record-2",ci=re({__name:"keigennRecord2",setup(a){const t=$e(),i=t.userOptions,I=t.isDev;I&&t.recheckIsDev();const k=Fe(()=>i.actionCN?"actionCN":"action"),b=R(i.minimize),_={line_height:28*i.scale,time:35*i.scale,action:65*i.scale,target:((i.showIcon?24:0)+(i.showName?i.anonymous||!i.anonymous&&i.abbrId?24:36:0)+7)*i.scale,amount:44*i.scale},ye={"--vxe-font-size-mini":`${12*i.scale}px`,"--vxe-table-row-line-height":`${30*i.scale}px`,"--vxe-table-row-height-mini":`${30*i.scale}px`,"--vxe-input-height-mini":`${20*i.scale}px`,"--vxe-select-option-height-mini":`${24*i.scale}px`},ne={runtime:99,localStorage:3},ge=R(!1),ae=R(),oe=W("keigenn-record-2-pov-name",""),z=W("keigenn-record-2-pov-id",""),he=W("keigenn-record-2-party-list",[]),B=W("keigenn-record-2-job-map",{}),ce=W("keigenn-record-2-party-event-party",[]),H=R(0),d=R([{zoneName:"",duration:"00:00",table:[],key:"init"}]),Ee={rsv:/^262\|(?<timestamp>[^|]*)\|[^|]*\|[^|]*\|_rsv_(?<id>\d*)[^|]*\|(?<real>[^|]*)\|/i,ability:L.ability(),statusEffectExplicit:L.statusEffectExplicit(),gainsEffect:L.gainsEffect(),losesEffect:L.losesEffect(),inCombat:/^260\|(?<timestamp>[^|]*)\|(?<inACTCombat>[^|]*)\|(?<inGameCombat>[^|]*)\|/i,changeZone:L.changeZone(),partyList:/^11\|(?<timestamp>[^|]*)\|(?<partyCount>\d*)\|(?<list>(?:\w{8}\|){0,})\w{16}/i,primaryPlayer:/^02\|(?<timestamp>[^|]*)\|(?<id>[^|]*)\|(?<name>[^|]*)/,addCombatant:L.addedCombatant(),removingCombatant:L.removingCombatant(),networkDoT:L.networkDoT()},$=R(0),Te=W("souma-keigenn-record-2-zone-name",""),Se=W("souma-keigenn-record-2-rsv-data",{}),be={},F={friendly:{},enemy:{}},qe=e=>{e.table.length=0,e.zoneName="",e.duration="00:00",e.key="init"},Xe=()=>{ge.value=!0,$.value=0,H.value=0,d.value.length=1,qe(d.value[0])},Qe=()=>{Oe(),ge.value=!1},Ae=e=>{var s,o,p,w,v,Z,J,Y,q,u;for(const de in Ee){const M=Ee[de].exec(e);if(M){const r=e.split("|");switch(de){case"statusEffectExplicit":(s=M.groups)!=null&&s.targetId.startsWith("1")&&(be[(o=M.groups)==null?void 0:o.targetId]=(p=M.groups)==null?void 0:p.currentShield);break;case"gainsEffect":{const l=r[n.GainsEffect.fields.effectId],m=r[n.GainsEffect.fields.effect],g=r[n.GainsEffect.fields.target],h=r[n.GainsEffect.fields.targetId],j=Number(r[n.GainsEffect.fields.count]);let C=$t(l);if(!C){const D=h.startsWith("1")&&At.get(Number.parseInt(l,16).toString())||h.startsWith("4")&&Dt.get(Number.parseInt(l,16).toString());if(!D)return;const te=Je(D.icon),ie=j>1?wt(te,j):te;C={type:"multiplier",performance:{physics:1,magic:1,darkness:1},id:Number.parseInt(l,16),fullIcon:ie,name:D.name,isFriendly:D.isFriendly}}const X=r[n.GainsEffect.fields.duration],A=r[n.GainsEffect.fields.source],P=r[n.GainsEffect.fields.sourceId],Q=new Date(r[n.GainsEffect.fields.timestamp]).getTime()+Number.parseFloat(X)*1e3,ee={name:C.name,count:j,effect:m,effectId:l,source:A,sourceId:P,target:g,targetId:h,expirationTimestamp:Q,performance:C.performance,fullIcon:C.fullIcon,isPov:z.value===P};h.startsWith("1")&&C.isFriendly?(F.friendly[h]==null&&(F.friendly[h]={}),F.friendly[h][l]=ee):h.startsWith("4")&&!C.isFriendly&&(F.enemy[h]==null&&(F.enemy[h]={}),F.enemy[g][l]=ee)}break;case"losesEffect":{const l=r[n.LosesEffect.fields.target],m=r[n.LosesEffect.fields.targetId],g=r[n.LosesEffect.fields.effectId];m.startsWith("1")?F.friendly[m]&&Reflect.deleteProperty(F.friendly[m],g):F.enemy[l]&&Reflect.deleteProperty(F.enemy[l],g)}break;case"addCombatant":if(r[n.AddedCombatant.fields.job]!=="00"){const l=r[n.AddedCombatant.fields.job],m=new Date(r[n.AddedCombatant.fields.timestamp]).getTime();B.value[r[n.AddedCombatant.fields.id]]={job:Number.parseInt(l,16),timestamp:m}}break;case"removingCombatant":Reflect.deleteProperty(B.value,r[n.RemovedCombatant.fields.id]);break;case"primaryPlayer":{z.value=r[n.ChangedPlayer.fields.id];const l=r[n.ChangedPlayer.fields.name];if(oe.value===l)return;oe.value=l,t.initEnvironment(r[n.ChangedPlayer.fields.name]);break}case"partyList":he.value=((v=(w=M.groups)==null?void 0:w.list)==null?void 0:v.split("|"))??[];break;case"changeZone":Te.value=r[n.ChangeZone.fields.name],He(new Date(r[n.ChangeZone.fields.timestamp]).getTime());break;case"inCombat":{const l=r[n.InCombat.fields.inACTCombat]==="1",m=r[n.InCombat.fields.inGameCombat]==="1",g=new Date(r[n.InCombat.fields.timestamp]).getTime();if(l||m){if($.value>0)return;d.value[0].table.length!==0&&(d.value[0]=Ft(d.value[0]),d.value.unshift({zoneName:"",duration:"00:00",table:[],key:r[n.InCombat.fields.timestamp]}),d.value.length>=ne.runtime&&d.value.splice(d.value.length-1,1)),$.value=g,d.value[0].zoneName=Te.value,H.value=0;return}if(!l&&!m){He(g);return}}break;case"rsv":{const l=Number((Z=M.groups)==null?void 0:Z.id),m=r[n.RSVData.fields.value];Se.value[Number(l)]=m}break;case"networkDoT":if(!i.parseDoT)return;{const l=r[n.NetworkDoT.fields.which],m=r[n.NetworkDoT.fields.id];if(l!=="DoT"||m.startsWith("4")||!(m===z.value||he.value.includes(m)||ce.value.find(ie=>ie.id===m)))return;const g=r[n.NetworkDoT.fields.name],h=r[n.NetworkDoT.fields.damage],j=Number.parseInt(h,16),C=new Date(r[n.Ability.fields.timestamp]??"???").getTime(),X=Number(r[n.NetworkDoT.fields.currentHp]),A=Number(r[n.NetworkDoT.fields.maxHp]),P=$.value===0?0:C-$.value,me=le(P),Q=De(m),ee=U.nameToFullName(U.jobEnumToJob(Q)).simple2,D=Q,te=U.jobEnumToIcon(D).toLocaleLowerCase();je({timestamp:C,time:me,id:void 0,action:l,actionCN:l,source:"",target:g,targetId:m,job:ee,jobIcon:te,jobEnum:D,amount:j,keigenns:[],currentHp:X,maxHp:A,effect:"damage done",type:"dot",shield:be[m],povId:z.value})}break;case"ability":if($.value===0)return;{const l=Ct(r);if(l.isAttack&&l.amount>=0){const m=r[n.Ability.fields.sourceId]??"???",g=r[n.Ability.fields.targetId]??"???";if(!(m.startsWith("4")&&g.startsWith("1"))||!(g===z.value||he.value.includes(g)||ce.value.find(G=>G.id===g)))return;const h=new Date(r[n.Ability.fields.timestamp]??"???").getTime(),j=r[n.Ability.fields.ability],C=j.match(/^_rsv_(?<id>\d+)_/),X=r[n.Ability.fields.id]??"???";let A=j;if(C){const G=Number((J=C.groups)==null?void 0:J.id);A=Se.value[G]??((q=(Y=j.match(/^_(?<id>rsv_\d+)_/))==null?void 0:Y.groups)==null?void 0:q.id)}else if(A=A.replace(/unknown_.*/,"攻击"),i.parseAA===!1&&/^攻击|攻撃|[Aa]ttack$/.test(A))return;const P=It(Number.parseInt(X,16)),me=P&&P!==""?P:A,Q=Number(r[n.Ability.fields.targetCurrentHp])??"???",ee=Number(r[n.Ability.fields.targetMaxHp])??"???",D=r[n.Ability.fields.source]??"???",te=r[n.Ability.fields.target]??"???",{effect:ie,type:ct}=xt(l.flags),lt=$.value===0?0:h-$.value,dt=le(lt),Pe=De(g),mt=U.nameToFullName(U.jobEnumToJob(Pe)).cn.substring(0,2),Re=Pe,pt=U.jobEnumToIcon(Re).toLocaleLowerCase(),ut=Nt(Object.values(F.friendly[g]??[]).concat(Object.values(F.enemy[D]??[])).filter(G=>{const pe=Math.max(0,(G.expirationTimestamp-h)/1e3);return G.remainingDuration=pe>=999?"":pe.toFixed(pe>.05&&pe<.95?1:0),Number(G.remainingDuration)>-3}));je({timestamp:h,time:dt,id:X,action:A,actionCN:me,source:D,target:te,targetId:g,job:mt,jobIcon:pt,jobEnum:Re,amount:l.amount,keigenns:ut,currentHp:Q,maxHp:ee,effect:ie,type:ct,shield:be[((u=M.groups)==null?void 0:u.targetId)??""],povId:z.value}),d.value[0].duration=le(new Date(r[n.Ability.fields.timestamp]).getTime()-$.value)}break}}}}},De=e=>{const s=B.value[e],o=ce.value.find(p=>p.id===e)??{job:0,timestamp:0};return[s,o].sort((p,w)=>w.timestamp-p.timestamp)[0].job},je=e=>{d.value[0].table.unshift(e)},He=e=>{$.value!==0&&(d.value[0].duration=le(e-$.value),$.value=0,F.friendly={},F.enemy={},Oe())},Oe=()=>{localStorage.setItem(Ue,JSON.stringify(d.value.slice(0,ne.localStorage)))},et=()=>{const e=localStorage.getItem(Ue);if(e)try{const s=JSON.parse(e);d.value.length=0,d.value.push(...s)}catch(s){console.error(s)}},le=e=>{const s=Math.max(Math.floor(e/6e4),0),o=Math.max(Math.floor((e-s*6e4)/1e3),0);return`${s<10?"0":""}${s}:${o<10?"0":""}${o}`},tt=Fe(()=>{const e=new Set(d.value[H.value].table.map(s=>i.actionCN?s.actionCN:s.action));return Array.from(e).map(s=>({label:s,value:s}))}),it=Fe(()=>{const e={},s=new Set(d.value[H.value].table.slice().sort((o,p)=>U.enumSortMethod(o.jobEnum,p.jobEnum)).map(o=>(e[o.target]=o.job,o.target)));return Array.from(s).map(o=>({label:`${e[o]}（${o}）`,value:o}))});t.initEnvironment(oe.value),ht(()=>{for(const e in B.value){const s=B.value[e];Date.now()-s.timestamp>1e3*60*60*24*1&&Reflect.deleteProperty(B.value,e)}et(),we("LogLine",e=>{Ae(e.rawLine)}),we("PartyChanged",e=>{ce.value=e.party.map(s=>({...s,timestamp:Date.now()}))}),we("ChangePrimaryPlayer",e=>{oe.value=e.charName,z.value=Number(e.charID).toString(16).toUpperCase()}),startOverlayEvents()});const st=e=>{const{action:s,actionCN:o,amount:p,job:w,keigenns:v,source:Z,target:J,time:Y,type:q}=e,u=e.effect==="damage done"?"":`,${xe(e.effect)}`,de=`${Y} [${w}]${J} HP:${e.currentHp}/${e.maxHp}(${Math.round(e.currentHp/e.maxHp*100)}%) + 护盾:${Math.round(e.maxHp*+e.shield/100)}(${e.shield}%) 受到${Z}“${s}${o!==s?`(${o})`:""}”的${p.toLocaleString()}点${xe(q)}伤害。剩余HP:${e.currentHp-e.amount}(${Math.round((e.currentHp-e.amount)/e.maxHp*100)}%)。减伤：${v.length===0&&u===""?"无":v.map(ke=>i.statusCN?ke.name:ke.effect).join(",")+u}。`;rt(de)},rt=e=>{navigator.clipboard.writeText(e).catch(()=>{const s=document.createElement("input");s.value=e,document.body.appendChild(s),s.select(),document.execCommand("copy"),document.body.removeChild(s)}),Me.modal.message({content:"已复制到剪贴板",status:"success"})},O=R({target:!1,action:!1}),K=R(),ve=bt({className:"my-menus",body:{options:[]}});vt(()=>{var e,s,o,p;(e=ve.body)!=null&&e.options&&ae.value&&(ve.body.options[0]=[{code:"copy",name:"复制详情",prefixIcon:"vxe-icon-copy",className:"my-copy-item"},{code:"clearFilterAction",name:"取消技能筛选",prefixIcon:"vxe-icon-funnel-clear",className:"my-clear-filter",visible:O.value.action,disabled:!1},{code:"filterSelectAction",name:(s=K.value)!=null&&s[k.value]?`只看 ${(o=K.value)==null?void 0:o[k.value]}`:"只看该技能",prefixIcon:"vxe-icon-info-circle",visible:!O.value.action,disabled:!1},{code:"clearFilterTarget",name:"取消玩家筛选",prefixIcon:"vxe-icon-funnel-clear",visible:O.value.target,disabled:!1},{code:"filterSelectTarget",name:(p=K.value)!=null&&p.target?`只看[${K.value.job}] ${K.value.target}`:"只看该玩家",prefixIcon:"vxe-icon-user-fill",visible:!O.value.target,disabled:!1}])});const nt=()=>{b.value=!b.value},at=({row:e})=>{const s=ae.value;s&&(s.setCurrentRow(e),K.value=e)},ot=({menu:e,row:s})=>{const o=ae.value;switch(e.code){case"copy":if(!s){Me.modal.message({content:"未选中有效数据行",status:"error"});return}st(s);break;case"clearFilterTarget":o&&(o.clearFilter(o.getColumnByField("target")),O.value.target=!1);break;case"clearFilterAction":o&&(o.clearFilter(o.getColumnByField(k.value)),O.value.action=!1);break;case"filterSelectTarget":if(o){const p=o.getColumnByField("target");if(p){const w=p.filters.find(v=>v.value===s.target);if(!w)return;w.checked=!0,o.updateData().then(()=>{o.scrollToRow(s),O.value.target=!0})}}break;case"filterSelectAction":if(o){const p=o.getColumnByField(k.value);if(p){const w=p.filters.find(v=>v.value===s[k.value]);if(!w)return;w.checked=!0,o.updateData().then(()=>{o.scrollToRow(s),O.value.action=!0})}}break}};return(e,s)=>{const o=se("vxe-option"),p=se("vxe-select"),w=se("vxe-button"),v=se("vxe-column"),Z=Yt,J=Kt,Y=Rt,q=se("vxe-table");return N(),S(_e,null,[y("div",{class:"wrapper",style:ye},[y("header",null,[Le(x(p,{modelValue:c(H),"onUpdate:modelValue":s[0]||(s[0]=u=>kt(H)?H.value=u:null),size:"mini",class:"select"},{default:V(()=>[(N(!0),S(_e,null,Ve(c(d).length,u=>(N(),Be(o,{key:`${c(d)[u-1].key}-${c(d)[u-1].duration}-${c(d)[u-1].zoneName}`,value:u-1,label:`${c(d)[u-1].duration} ${c(d)[u-1].zoneName}`},null,8,["value","label"]))),128))]),_:1},8,["modelValue"]),[[ze,!c(b)]]),x(w,{class:"minimize",icon:c(b)?"vxe-icon-fullscreen":"vxe-icon-minimize",onClick:nt,style:Ke({opacity:c(b)?.5:1})},null,8,["icon","style"])]),Le(y("main",null,[x(q,{ref_key:"xTable",ref:ae,size:"mini",class:"vxe-table","show-overflow":"tooltip",round:"",height:"100%","scroll-y":{enabled:!0},loading:c(ge),"show-header":c(i).showHeader,data:c(d)[c(H)].table,"row-config":{isHover:!0,height:_.line_height},"header-cell-style":{padding:"0px"},onCellMenu:at,"menu-config":c(ve),onMenuClick:ot},{default:V(()=>[x(v,{width:_.time,field:"time",title:"时间",align:"center"},null,8,["width"]),x(v,{width:_.action,field:c(i).actionCN?"actionCN":"action",title:"技能",filters:c(tt),"filter-multiple":!1,resizable:!1,align:"center"},null,8,["width","field","filters"]),x(v,{width:_.target,field:"target",title:c(i).showName?"目标":"目",filters:c(it),"filter-multiple":!1,resizable:!c(i).anonymous&&!c(i).abbrId,align:"left","header-align":"center"},{default:V(({row:u})=>[x(Z,{row:u},null,8,["row"])]),_:1},8,["width","title","filters","resizable"]),x(v,{width:_.amount,title:"伤害","header-align":"center"},{default:V(({row:u})=>[x(J,{row:u},null,8,["row"])]),_:1},8,["width"]),x(v,{title:"减伤",align:"left"},{default:V(({row:u})=>[x(Y,{row:u},null,8,["row"])]),_:1})]),_:1},8,["loading","show-header","data","row-config","menu-config"])],512),[[ze,!c(b)]])]),c(I)?(N(),S("div",qt,[x(_t,{onBeforeHandle:Xe,onAfterHandle:Qe,onHandleLine:Ae})])):Ce("",!0)],64)}}});export{ci as default};
