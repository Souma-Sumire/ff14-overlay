import{ax as j,q as B,Y as oe,b as Q,o as b,e as x,t as i,a as n,w as o,F as se,L as le,u as e,c as L,a1 as re,ad as ie,a2 as ce,G as ue,H as de,d as pe,n as I,ay as me,y as d,a0 as F,x as g,az as V,aA as fe,J as _e,ah as he,B as ge,ak as be,N as we,al as ve,aB as Ce,aC as ye,as as Se,ap as Ee,af as Ve,C as Te,ag as De}from"./vendor-9c3ca848.js";import{_ as J}from"./_plugin-vue_export-helper-c27b6911.js";import{C as m}from"./content_type-ecdd0c19.js";import{a as H,r as W,c as Re}from"./overlay_plugin_api-409cb9ea.js";import{N as Y,c as Pe,l as M}from"./netregexes-60f54b26.js";import{z as xe}from"./zoneInfo-9e4e9a78.js";const Ne=T=>(ue("data-v-66d37cfa"),T=T(),de(),T),ke={class:"language-switcher"},Oe={class:"select-wrapper"},Ue=Ne(()=>i("svg",{class:"globe-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[i("circle",{cx:"12",cy:"12",r:"10"}),i("line",{x1:"2",y1:"12",x2:"22",y2:"12"}),i("path",{d:"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"})],-1)),Be={__name:"LanguageSwitcher",setup(T){const{locale:t,availableLocales:c}=j(),f={zhCn:"简体中文",en:"English",ja:"日本語"},w=B("user-locale",t.value);return oe(w,y=>{t.value=y}),Q(()=>{t.value=w.value}),(y,N)=>{const k=ie,O=ce;return b(),x("div",ke,[i("div",Oe,[Ue,n(O,{modelValue:e(w),"onUpdate:modelValue":N[0]||(N[0]=S=>re(w)?w.value=S:null),size:"small",class:"language-select"},{default:o(()=>[(b(!0),x(se,null,le(e(c),(S,E)=>(b(),L(k,{key:E,value:S,label:f[S]},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])])])}}},Le=J(Be,[["__scopeId","data-v-66d37cfa"]]),Ae={class:"obs-container"},Ie={class:"card-header"},Fe={class:"act-not-ready-content"},Ge={key:1},$e={class:"card-header"},ze={key:1},qe={class:"card-header"},Ze={class:"status-info"},He={class:"button-container"},We={class:"card-header"},Ye={class:"profile-info"},Me={class:"file-path-explanation"},je={class:"file-name-explanation"},Qe={class:"card-header"},Je=pe({__name:"obs2",setup(T){const{t}=j(),c=B("obs-user-config",{host:4455,password:"",path:"",fileName:""},localStorage,{writeDefaults:!0}),f=B("obs-user-content-setting",[]),w=B("obs-is-first-time",!0),y=I(!1),N=I(!1),k=I({});function O(){return new Promise(u=>{Re({call:"cactbotRequestState"}).then(()=>{y.value=!0,u()}),setTimeout(()=>{y.value||O()},3e3)})}const S={inCombat:Y.inCombat(),countdown:Y.countdown(),wipe:Pe.wipe},E=["Savage","Extreme","Ultimate","Dungeons","Raids","Trials","VCDungeonFinder","DeepDungeons","Guildhests","DisciplesOfTheLand","Eureka","GrandCompany","QuestBattles","TreasureHunt","Pvp","Default"],G={enter:!1,countdown:!0,combatStart:!1,combatEnd:!0,wipe:!0},$={enter:!1,countdown:!1,combatStart:!1,combatEnd:!1,wipe:!1};function K(){const u=["Savage","Extreme","Ultimate"];if(w.value)w.value=!1,f.value=[...u.map(a=>({type:a,...G})),...E.filter(a=>!u.includes(a)).map(a=>({type:a,...$}))];else{f.value=f.value.filter(s=>E.includes(s.type));const a=E.filter(s=>!f.value.some(p=>p.type===s)&&s!=="Default").map(s=>u.includes(s)?{type:s,...G}:{type:s,...$});f.value.push(...a)}f.value.sort((a,s)=>E.indexOf(a.type)-E.indexOf(s.type))}class X{constructor(){this.handleConnectionError=()=>{this.status.connecting=!1,this.status.connected=!1,this.status.recording=!1,this.status.outputActive=!1,this.status.outputPath="",V.modal.close(),V.modal.message({title:t("OBS Connection"),content:t("OBS Connection Error"),status:"warning",duration:2e3})},this.handleConnectionClosed=()=>{this.status.connecting=!1,this.status.connected=!1,this.status.recording=!1,this.status.outputActive=!1,this.status.outputPath="",V.modal.close(),V.modal.message({title:t("OBS Connection"),content:t("OBS Connection Closed"),status:"warning",duration:2e3})},this.ws=new fe,this.status=_e({connecting:!1,connected:!1,recording:!1,outputActive:!1,outputPath:""}),this.ws.on("ConnectionClosed",this.handleConnectionClosed),this.ws.on("ConnectionError",this.handleConnectionError),this.ws.on("RecordStateChanged",a=>{this.status.connected=!0,this.status.recording=a.outputState==="OBS_WEBSOCKET_OUTPUT_STARTED",this.status.outputActive=a.outputActive,this.status.outputPath=a.outputPath})}connect(a){c.value.host&&c.value.password&&(this.status.connecting=!0,this.ws.connect(`ws://127.0.0.1:${c.value.host}`,c.value.password).then(()=>{this.ws.call("GetRecordStatus").then(s=>{this.status.recording=s.outputActive,this.status.outputActive=s.outputActive}),this.status.connected=!0,V.modal.close(),V.modal.message({title:t("OBS Connection"),content:t("OBS Connection Opened"),status:"success",duration:2e3}),a&&a()}).finally(()=>{this.status.connecting=!1,c.value.path||this.ws.call("GetRecordDirectory").then(s=>{s.recordDirectory&&(c.value.path=s.recordDirectory)}),c.value.fileName||(c.value.fileName="%CCYY-%MM-%DD %hh-%mm-%ss")}))}disconnect(){this.ws.disconnect()}async startRecord(){await this.setProfileParameter(),this.ws.call("StartRecord")}stopRecord(){this.ws.call("StopRecord")}splitRecord(){this.ws.call("StopRecord").finally(()=>{setTimeout(()=>{this.ws.call("StartRecord")},1e3)})}async setProfileParameter(){const a=c.value.path,s=c.value.fileName,p=[];return p.push({requestType:"SetProfileParameter",requestData:{parameterCategory:"AdvOut",parameterName:"RecFilePath",parameterValue:a}}),p.push({requestType:"SetProfileParameter",requestData:{parameterCategory:"Output",parameterName:"FilenameFormatting",parameterValue:s}}),c.value.path=a,c.value.fileName=s,this.ws.callBatch(p)}}const r=new X,z=u=>{const a=u.zoneID,s=xe[a];k.value=s},q=u=>{const a=u.rawLine;for(const s in S)if(S[s].exec(a)){const v=a.split("|");switch(s){case"inCombat":{const _=v[M.InCombat.fields.inACTCombat]==="1",R=v[M.InCombat.fields.inGameCombat]==="1";if(_&&R){U("combatStart");return}if(!_&&!R){U("combatEnd");return}break}case"countdown":{U("countdown");break}case"wipe":{U("wipe");break}}}};function ee(u){var a,s;switch(u.contentType){case m.UltimateRaids:return"Ultimate";case m.Pvp:return"Pvp";case m.Dungeons:return"Dungeons";case m.DeepDungeons:return"DeepDungeons";case m.VCDungeonFinder:return"VCDungeonFinder";case m.Trials:return(a=u.name.fr)!=null&&a.includes("(extrême)")?"Extreme":"Trials";case m.Raids:return(s=u.name.en)!=null&&s.includes("(Savage)")?"Savage":"Raids";case m.DisciplesOfTheLand:return"DisciplesOfTheLand";case m.Eureka:return"Eureka";case m.GrandCompany:return"GrandCompany";case m.QuestBattles:return"QuestBattles";case m.TreasureHunt:return"TreasureHunt";default:return"Default"}}function U(u){const a=ee(k.value);if(f.value.find(s=>s.type===a&&s[u]))switch(u){case"enter":case"countdown":case"combatStart":if(!r.status.connected){r.connect(()=>{r.startRecord()});return}if(r.status.recording===!1){r.startRecord();return}r.status.recording===!0&&u!=="combatStart"&&r.splitRecord();return;case"combatEnd":case"wipe":r.status.recording&&r.stopRecord()}}return Q(async()=>{await O(),r.connect(),H("ChangeZone",z),H("LogLine",q),K()}),me(()=>{r.disconnect(),W("ChangeZone",z),W("LogLine",q)}),(u,a)=>{const s=Le,p=he,D=ge,v=be,_=we,R=ve,te=Ce,A=ye,Z=Se,ae=Ee,C=Ve,P=Te,ne=De;return b(),x("div",Ae,[i("header",null,[i("h1",null,d(e(t)("OBS Auto Record V2")),1),n(s)]),e(y)?F("",!0):(b(),L(p,{key:0,class:"act-not-ready-card"},{header:o(()=>[i("div",Ie,[i("span",null,d(e(t)("ACT Not Ready")),1)])]),default:o(()=>[i("div",Fe,[i("p",null,d(e(t)("overlayTutorial")),1)])]),_:1})),e(y)?(b(),x("main",Ge,[e(r).status.connected?(b(),x("div",ze,[n(A,{class:"instruction-alert",type:"info",description:e(t)("hideTutorial"),closable:!1,"show-icon":""},null,8,["description"]),e(N)?(b(),L(p,{key:0,class:"status-card"},{header:o(()=>[i("div",qe,[i("span",null,d(e(t)("Connection Status")),1),n(_,{type:"danger",size:"small",class:"disconnect-button",onClick:a[3]||(a[3]=l=>e(r).disconnect())},{default:o(()=>[g(d(e(t)("Disconnect")),1)]),_:1})])]),default:o(()=>[i("div",Ze,[n(ae,{direction:"vertical",column:1,border:""},{default:o(()=>[n(Z,{label:e(t)("Recording")},{default:o(()=>[g(d(e(r).status.recording?e(t)("Yes"):e(t)("No")),1)]),_:1},8,["label"]),n(Z,{label:e(t)("Output Path")},{default:o(()=>[g(d(e(r).status.outputPath||e(t)("None")),1)]),_:1},8,["label"])]),_:1})]),i("div",He,[n(_,{disabled:!e(r).status.connected||e(r).status.recording,type:"primary",onClick:a[4]||(a[4]=l=>e(r).startRecord())},{default:o(()=>[g(d(e(t)("Start Record")),1)]),_:1},8,["disabled"]),n(_,{disabled:!e(r).status.connected||!e(r).status.recording,type:"danger",onClick:a[5]||(a[5]=l=>e(r).stopRecord())},{default:o(()=>[g(d(e(t)("Stop Record")),1)]),_:1},8,["disabled"]),n(_,{disabled:!e(r).status.connected||!e(r).status.recording,type:"warning",onClick:a[6]||(a[6]=l=>e(r).splitRecord())},{default:o(()=>[g(d(e(t)("Split Record")),1)]),_:1},8,["disabled"]),n(_,{type:"primary",onClick:a[7]||(a[7]=l=>e(r).setProfileParameter())},{default:o(()=>[g(d(e(t)("Set Recording Name")),1)]),_:1})])]),_:1})):F("",!0),n(p,{class:"profile-card"},{header:o(()=>[i("div",We,[i("span",null,d(e(t)("Recording Profile")),1)])]),default:o(()=>[i("div",Ye,[n(R,{"label-position":"top",class:"content-form"},{default:o(()=>[n(v,{label:e(t)("Record Path")},{default:o(()=>[n(D,{modelValue:e(c).path,"onUpdate:modelValue":a[8]||(a[8]=l=>e(c).path=l),placeholder:e(t)("recordPathPlaceholder")},null,8,["modelValue","placeholder"]),i("div",Me,d(e(t)("filePathExplanation")),1)]),_:1},8,["label"]),n(v,{label:e(t)("Record File Name")},{default:o(()=>[n(D,{modelValue:e(c).fileName,"onUpdate:modelValue":a[9]||(a[9]=l=>e(c).fileName=l),placeholder:e(t)("recordFileNamePlaceholder")},null,8,["modelValue","placeholder"]),i("div",je,d(e(t)("fileNameExplanation")),1)]),_:1},8,["label"])]),_:1})])]),_:1}),n(p,{class:"table-card"},{header:o(()=>[i("div",Qe,[i("span",null,d(e(t)("User Content Settings")),1)])]),default:o(()=>[n(ne,{data:e(f),style:{width:"100%"},border:!0,stripe:""},{default:o(()=>[n(C,{prop:"type",label:e(t)("Type"),"min-width":"130",fixed:""},{default:o(l=>[i("span",null,d(e(t)(l.row.type)),1)]),_:1},8,["label"]),n(C,{label:e(t)("Start When"),align:"center"},{default:o(()=>[n(C,{prop:"enter",label:e(t)("Enter Zone"),align:"center","min-width":"95"},{default:o(l=>[n(P,{modelValue:l.row.enter,"onUpdate:modelValue":h=>l.row.enter=h},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),n(C,{prop:"countdown",label:e(t)("CountDown"),align:"center","min-width":"95"},{default:o(l=>[n(P,{modelValue:l.row.countdown,"onUpdate:modelValue":h=>l.row.countdown=h},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),n(C,{prop:"combatStart",label:e(t)("CombatStart"),align:"center","min-width":"95"},{default:o(l=>[n(P,{modelValue:l.row.combatStart,"onUpdate:modelValue":h=>l.row.combatStart=h},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"])]),_:1},8,["label"]),n(C,{label:e(t)("End When"),align:"center"},{default:o(()=>[n(C,{prop:"combatEnd",label:e(t)("CombatEnd"),align:"center","min-width":"95"},{default:o(l=>[n(P,{modelValue:l.row.combatEnd,"onUpdate:modelValue":h=>l.row.combatEnd=h},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),n(C,{prop:"wipe",label:e(t)("Wipe"),align:"center","min-width":"95"},{default:o(l=>[n(P,{modelValue:l.row.wipe,"onUpdate:modelValue":h=>l.row.wipe=h},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"])]),_:1},8,["label"])]),_:1},8,["data"])]),_:1})])):(b(),L(p,{key:0,class:"connection-card"},{header:o(()=>[i("div",$e,[i("span",null,d(e(t)("Connect to OBS")),1)])]),default:o(()=>[n(R,{"label-position":"top",class:"connection-form"},{default:o(()=>[n(v,{label:e(t)("Port")},{default:o(()=>[n(D,{modelValue:e(c).host,"onUpdate:modelValue":a[0]||(a[0]=l=>e(c).host=l),placeholder:e(t)("portPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),n(v,{label:e(t)("Password")},{default:o(()=>[n(D,{modelValue:e(c).password,"onUpdate:modelValue":a[1]||(a[1]=l=>e(c).password=l),placeholder:e(t)("passwordPlaceholder"),type:"password"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),n(v,null,{default:o(()=>[n(_,{type:"primary",class:"connect-button",loading:e(r).status.connecting,disabled:e(r).status.connecting||!e(c).host||!e(c).password,onClick:a[2]||(a[2]=l=>e(r).connect())},{default:o(()=>[g(d(e(r).status.connecting?e(t)("Connecting"):e(t)("Connect")),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1}),n(te,null,{default:o(()=>[g(d(e(t)("Instructions")),1)]),_:1}),n(A,{class:"instruction-alert",type:"info",description:e(t)("obsTutorial"),closable:!1,"show-icon":""},null,8,["description"]),n(A,{class:"instruction-alert",type:"info",description:e(t)("inputTutorial"),closable:!1,"show-icon":""},null,8,["description"])]),_:1}))])):F("",!0)])}}});const ot=J(Je,[["__scopeId","data-v-f6016e90"]]);export{ot as default};
