import{c as h}from"./overlay_plugin_api-409cb9ea.js";import{A as w}from"./actWS-e2500b62.js";import{n as c,b as d,Y as m,T as u}from"./vendor-9294eafe.js";function v(){const t=window.location.href,[o,l=""]=t.split("#"),[a,n=""]=l.split("?"),r=new URLSearchParams(n);let e="";r.forEach((f,i)=>{i!=="OVERLAY_WS"&&(e+=`${i}=${encodeURIComponent(f)}&`)}),e+="OVERLAY_WS=ws://127.0.0.1:10501/ws";let s=o;a&&(s+=`#${a}`,e&&(s+=`?${e}`)),window.location.href=s,location.reload()}function S(t={allowClose:!1}){const o=c(void 0),l=c(!1),a=c(void 0);function n(){Promise.race([h({call:"cactbotRequestState"}),new Promise((e,s)=>{setTimeout(()=>{s(new Error("Timeout"))},1e3)})]).then(()=>{o.value=!0}).catch(()=>{o.value=!1})}function r(){l.value||u.alert(`请按照下图设置<img src='${w}' style='width:100%'>`,t.allowClose?"未连接到 ACT":"未连接到 ACT，无法使用",{dangerouslyUseHTMLString:!0,closeOnClickModal:!1,showClose:!1,closeOnPressEscape:!1,closeOnHashChange:!1,showCancelButton:t.allowClose,showConfirmButton:!1,cancelButtonText:"我偏要看看",buttonSize:"small"}).catch(()=>{l.value=!0})}return d(()=>{m(o,e=>{e?u.close():r()}),window.location.href.includes("OVERLAY_WS")?a.value="overlay":(a.value="websocket",v()),n(),setInterval(()=>{n()},3e3)}),{wsConnected:o,useType:a}}export{S as u};
