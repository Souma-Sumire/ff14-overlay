import{d as H,v as k,y as A,o as p,b as _,G as V,H as D,a as P,w as O,u as s,O as z,t as M,aD as Y,B as Z,r as N,g as ee,f as y,a0 as te,aE as ae,C as $,D as F,p as oe,j as ne,c as re}from"./vendor-0a68389d.js";import{U as l,j as se}from"./util-ef9ccf87.js";import{_ as G}from"./index-c427d36d.js";import{c as le,a as U}from"./overlay_plugin_api-9faadcd6.js";const ue={flex:"~ col"},ce=H({__name:"dragJob",props:{party:{}},emits:["updateSortArr"],setup(h,{emit:w}){const b=k(),v=k(!0),S=w,L=h,I=()=>{S("updateSortArr",Object.values(u.value).flat().map(o=>o.id))},a=[{name:"tank",color:"blue"},{name:"healer",color:"green"},{name:"dps",color:"red"},{name:"crafter",color:"yellow"},{name:"gatherer",color:"purple"},{name:"none",color:"gray"}];function C(o){return L.party.find(c=>c.job===o)}const j=l.getBattleJobs3(),x=["tank","healer","dps","crafter","gatherer","none"],m=(()=>{const o={},c={tank:l.isTankJob,healer:l.isHealerJob,dps:l.isDpsJob,crafter:l.isCraftingJob,gatherer:l.isGatheringJob};for(const r of x)o[r]=(r==="none"?[]:j.filter(n=>c[r](n))).map(n=>l.jobToJobEnum(n)).sort((n,f)=>l.enumSortMethod(n,f));return o})(),R=Object.values(m).flat().map(o=>({name:l.nameToFullName(l.jobEnumToJob(o)).simple1,id:o})),u=A("cactbotRuntime-jobList",(()=>{const o={};for(const c of x)o[c]=R.filter(r=>m[c].includes(r.id)).sort((r,n)=>m[c].indexOf(r.id)-m[c].indexOf(n.id));return o})());return(o,c)=>(p(),_("div",ue,[(p(),_(V,null,D(a,(r,n)=>P(s(Y),{key:n,ref_for:!0,ref_key:"el",ref:b,disabled:!v.value,modelValue:s(u)[r.name],"onUpdate:modelValue":f=>s(u)[r.name]=f,animation:"150",ghostClass:"ghost",class:"flex flex-row gap-0.25 p-0 m-t-0.25 m-b-0.25 rounded",onUpdate:I,filter:".no-draggable",forceFallback:!0},{default:O(()=>[(p(!0),_(V,null,D(s(u)[r.name],f=>(p(),_("div",{key:f.id,class:z(`${C(f.id)?`draggable bg-${r.color} cursor-move`:"no-draggable bg-gray-700/50"} rounded p-l-0.6 p-r-0.6 p-t-0 p-b-0.3 m-0 color-white`)},M(f.name),3))),128))]),_:2},1032,["disabled","modelValue","onUpdate:modelValue"])),64))]))}});const ie=G(ce,[["__scopeId","data-v-9039b8ac"]]),E=h=>(oe("data-v-9ea3cd42"),h=h(),ne(),h),de={key:0,style:{color:"white","text-shadow":"1px 1px 2px black"}},pe=E(()=>y("span",null,"用法",-1)),me=E(()=>y("p",null,"使悬浮窗的位置分配对应游戏内的实际位置（D1D2等）",-1)),fe=E(()=>y("ul",null,[y("li",null,"临时：下拉选择框修改。"),y("li",null,"长期：用鼠标拖动职能顺序。")],-1)),_e={class:"players"},ye={class:"name"},be=H({__name:"cactbotRuntime",setup(h){const w=(e,t)=>Array(t).fill(e).map((i,T)=>i+(+T+1)),b={tank:["MT","ST",...w("T",70)],healer:[...w("H",72)],dps:[...w("D",72)],unknown:["unknown"]},v=k(!1),S=A("cactbotRuntime-sortArr",se),L=[{id:"10000001",name:"虚构战士",job:21,inParty:!0},{id:"10000002",name:"虚构骑士",job:19,inParty:!0},{id:"10000003",name:"虚构占星",job:33,inParty:!0},{id:"10000004",name:"虚构学者",job:28,inParty:!0},{id:"10000005",name:"虚构忍者",job:30,inParty:!0},{id:"10000006",name:"虚构武士",job:34,inParty:!0},{id:"10000007",name:"虚构黑魔",job:25,inParty:!0},{id:"10000008",name:"虚构舞者",job:38,inParty:!0}],a=A("cactbotRuntime-data",{party:[]}),C=A("cactbotRuntime-showTips",k(!0)),j={tank:0,healer:0,dps:0,unknown:1};function x(){j.tank=a.value.party.reduce((e,t)=>u(t.job)==="tank"?e+1:e,0),j.healer=a.value.party.reduce((e,t)=>u(t.job)==="healer"?e+1:e,0),j.dps=a.value.party.reduce((e,t)=>u(t.job)==="dps"?e+1:e,0)}const m=location.href.includes("localhost"),g=k(!1),R=k(m?"虚构占星":"");if(m){const e={party:L};C.value&&(v.value=!0),a.value.party=e.party.map(t=>({...t,rp:"",specify:!1})),o(),x(),n()}function u(e){const t=Number(e);return[1,3,19,21,32,37].includes(t)?"tank":[6,24,28,33,40].includes(t)?"healer":[2,4,5,7,20,22,23,25,26,27,29,30,31,34,35,36,38,39].includes(t)?"dps":"unknown"}function o(){a.value.party.sort((e,t)=>S.value.indexOf(e.job)-S.value.indexOf(t.job));for(const e of a.value.party)e.rp=void 0,e.rp=r(e)}function c(e){a.value.party[e].specify=!0;const t=a.value.party.find(i=>i.rp===a.value.party[e].rp&&i.id!==a.value.party[e].id);t&&(t.rp=r(t),t.specify=!0),n()}function r(e){return b[u(e.job)].find(t=>!a.value.party.find(i=>i.rp===t))??"unknown"}function n(){const e=[...b.tank,...b.healer,...b.dps];a.value.party.sort((t,i)=>e.indexOf(t.rp??"")-e.indexOf(i.rp??"")),le({call:"broadcast",source:"soumaRuntimeJS",msg:{party:a.value.party}})}function f(){g.value=!0}function q(){g.value=!1}function K(e){S.value=e,o(),x(),n()}return Z(()=>{n(),U("PartyChanged",e=>{C.value&&(v.value=!0),!(m&&e.party.length===0)&&(a.value.party=e.party.filter(t=>t.inParty).map(t=>({...t,rp:"",specify:!1})),o(),x(),n())}),U("ChangePrimaryPlayer",e=>{m||(R.value=e.charName)}),U("BroadcastMessage",e=>{e.source==="soumaUserJS"&&typeof e.msg=="object"&&e.msg!==null&&Reflect.get(e.msg,"text")==="requestData"&&n()}),startOverlayEvents()}),(e,t)=>{const i=N("vxe-modal"),T=N("vxe-option"),Q=N("vxe-select"),W=ie;return p(),_(V,null,[s(a).party.length===0?(p(),_("span",de,"等待小队...")):ee("",!0),y("div",{onMouseenter:f,onMouseleave:q},[P(i,{modelValue:s(v),"onUpdate:modelValue":t[0]||(t[0]=d=>te(v)?v.value=d:null),size:"small",position:{left:10,top:10},width:"90vw"},{title:O(()=>[pe]),default:O(()=>[me,fe]),_:1},8,["modelValue"]),y("main",{class:z(s(g)?"mouseIn":"")},[y("div",_e,[P(ae,{name:"animate__animated animate__bounce","enter-active-class":"animate__fadeInLeft","leave-active-class":"animate__fadeOutLeft"},{default:O(()=>[(p(!0),_(V,null,D(s(a).party,(d,X)=>$((p(),_("section",{key:d.id,flex:"~ nowrap",class:"player"},[P(Q,{modelValue:d.rp,"onUpdate:modelValue":J=>d.rp=J,size:"mini",onChange:J=>c(X),"class-name":"select"},{default:O(()=>[(p(!0),_(V,null,D(b[u(d.job)],(J,B)=>(p(),re(T,{visible:B<j[u(d.job)],key:B,value:J,label:J},null,8,["visible","value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),y("span",ye,M(s(l).nameToFullName(s(l).jobEnumToJob(d.job)).simple2)+" "+M(s(g)?d.name:""),1)])),[[F,s(g)||d.name===s(R)]])),128))]),_:1})]),$(P(W,{class:"dragJob",onUpdateSortArr:K,party:s(a).party,"m-b-1":"","p-1":""},null,8,["party"]),[[F,s(g)]])],2)],32)],64)}}});const xe=G(be,[["__scopeId","data-v-9ea3cd42"]]);export{xe as default};
