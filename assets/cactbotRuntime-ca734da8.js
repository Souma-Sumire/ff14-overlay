import{d as $,A as x,C as R,o as m,b as f,J as D,K as V,a as w,w as C,u as l,R as U,t as E,aG as te,F as ae,r as L,i as oe,g as _,a3 as ne,aH as re,h as G,H,p as se,l as le,c as ue}from"./vendor-9c8efe32.js";import{U as n,j as ce}from"./util-ef9ccf87.js";import{_ as z}from"./index-701368e2.js";import{c as ie,a as M}from"./overlay_plugin_api-409cb9ea.js";const de={flex:"~ col"},pe=$({__name:"dragJob",props:{party:{}},emits:["updateSortArr"],setup(J,{emit:T}){const b=x(),i=x(!0),g=T,k=J,A=()=>{g("updateSortArr",Object.values(j.value).flat().map(a=>a.id))},F=[{name:"tank",color:"blue"},{name:"healer",color:"green"},{name:"dps",color:"red"},{name:"crafter",color:"yellow"},{name:"gatherer",color:"purple"},{name:"none",color:"gray"}];function o(a){return k.party.find(u=>u.job===a)}const O=n.getBattleJobs3(),h=["tank","healer","dps","crafter","gatherer","none"],y=(()=>{const a={},u={tank:n.isTankJob,healer:n.isHealerJob,dps:n.isDpsJob,crafter:n.isCraftingJob,gatherer:n.isGatheringJob};for(const r of h)a[r]=(r==="none"?[]:O.filter(c=>u[r](c))).map(c=>n.jobToJobEnum(c)).sort((c,s)=>n.enumSortMethod(c,s));return a})(),v=Object.values(y).flat().map(a=>({name:n.nameToFullName(n.jobEnumToJob(a)).simple1,id:a})),j=R("cactbotRuntime-jobList",(()=>{const a={};for(const u of h)a[u]=v.filter(r=>y[u].includes(r.id)).sort((r,c)=>y[u].indexOf(r.id)-y[u].indexOf(c.id));return a})());return(a,u)=>(m(),f("div",de,[(m(),f(D,null,V(F,(r,c)=>w(l(te),{key:c,ref_for:!0,ref_key:"el",ref:b,disabled:!i.value,modelValue:l(j)[r.name],"onUpdate:modelValue":s=>l(j)[r.name]=s,animation:"150",ghostClass:"ghost",class:"flex flex-row gap-0.25 p-0 m-t-0.25 m-b-0.25 rounded",onUpdate:A,filter:".no-draggable",forceFallback:!0},{default:C(()=>[(m(!0),f(D,null,V(l(j)[r.name],s=>(m(),f("div",{key:s.id,class:U(`${o(s.id)?`draggable bg-${r.color} cursor-move`:"no-draggable bg-gray-700/50"} rounded p-l-0.6 p-r-0.6 p-t-0 p-b-0.3 m-0 color-white`)},E(s.name),3))),128))]),_:2},1032,["disabled","modelValue","onUpdate:modelValue"])),64))]))}});const me=z(pe,[["__scopeId","data-v-9039b8ac"]]),I=J=>(se("data-v-341c9039"),J=J(),le(),J),fe={key:0,style:{color:"white","text-shadow":"1px 1px 2px black"}},_e=I(()=>_("span",null,"用法",-1)),be=I(()=>_("p",null,"使悬浮窗的位置分配对应游戏内的实际位置（D1D2等）",-1)),ye=I(()=>_("ul",null,[_("li",null,"临时：下拉选择框修改。"),_("li",null,"长期：用鼠标拖动职能顺序。")],-1)),ve={class:"players"},ge=$({__name:"cactbotRuntime",setup(J){const T=x(new Date().getMonth()===3&&new Date().getDate()===1),b=(e,t)=>Array(t).fill(e).map((d,N)=>d+(+N+1)),i={tank:["MT","ST",...b("T",70)],healer:[...b("H",72)],dps:[...b("D",72)],crafter:[...b("C",72)],gatherer:[...b("G",72)],none:[...b("N",72)]},g=x(!1),k=R("cactbotRuntime-sortArr",ce),A=[{id:"10000001",name:"虚构战士",job:21,inParty:!0},{id:"10000002",name:"虚构骑士",job:19,inParty:!0},{id:"10000003",name:"虚构占星",job:33,inParty:!0},{id:"10000004",name:"虚构学者",job:28,inParty:!0},{id:"10000005",name:"虚构忍者",job:30,inParty:!0},{id:"10000006",name:"虚构武士",job:34,inParty:!0},{id:"10000007",name:"虚构黑魔",job:25,inParty:!0},{id:"10000008",name:"虚构舞者",job:38,inParty:!0}],o=R("cactbotRuntime-data",{party:[]}),O=R("cactbotRuntime-showTips",x(!0)),h={tank:0,healer:0,dps:0,crafter:0,gatherer:0,none:0};function y(){h.tank=o.value.party.reduce((e,t)=>a(t.job)==="tank"?e+1:e,0),h.healer=o.value.party.reduce((e,t)=>a(t.job)==="healer"?e+1:e,0),h.dps=o.value.party.reduce((e,t)=>a(t.job)==="dps"?e+1:e,0)}const S=location.href.includes("localhost"),v=x(!1),j=x(S?"虚构占星":"");if(S){const e={party:A};O.value&&(g.value=!0),o.value.party=e.party.map(t=>({...t,rp:"",specify:!1})),u(),y(),s()}function a(e){const t=Number(e);return[1,3,19,21,32,37].includes(t)?"tank":[6,24,28,33,40].includes(t)?"healer":[2,4,5,7,20,22,23,25,26,27,29,30,31,34,35,36,38,39].includes(t)?"dps":n.isCraftingJob(n.jobEnumToJob(e))?"crafter":n.isGatheringJob(n.jobEnumToJob(e))?"gatherer":"none"}function u(){o.value.party.sort((e,t)=>k.value.indexOf(e.job)-k.value.indexOf(t.job));for(const e of o.value.party)e.rp=void 0,e.rp=c(e)}function r(e){o.value.party[e].specify=!0;const t=o.value.party.find(d=>d.rp===o.value.party[e].rp&&d.id!==o.value.party[e].id);t&&(t.rp=c(t),t.specify=!0),s()}function c(e){return i[a(e.job)].find(t=>!o.value.party.find(d=>d.rp===t))??"unknown"}function s(){const e=[...i.tank,...i.healer,...i.dps,...i.crafter,...i.gatherer,...i.none];o.value.party.sort((t,d)=>e.indexOf(t.rp??"")-e.indexOf(d.rp??"")),ie({call:"broadcast",source:"soumaRuntimeJS",msg:{party:o.value.party}})}function K(){v.value=!0}function q(){v.value=!1}function Q(e){k.value=e,u(),y(),s()}const W=e=>n.nameToFullName(n.jobEnumToJob(e)).simple1,X=e=>e;return ae(()=>{s(),M("PartyChanged",e=>{O.value&&(g.value=!0),!(S&&e.party.length===0)&&(o.value.party=e.party.filter(t=>t.inParty).map(t=>({...t,rp:"",specify:!1})),u(),y(),s())}),M("ChangePrimaryPlayer",e=>{S||(j.value=e.charName)}),M("BroadcastMessage",e=>{e.source==="soumaUserJS"&&typeof e.msg=="object"&&e.msg!==null&&Reflect.get(e.msg,"text")==="requestData"&&s()}),startOverlayEvents()}),(e,t)=>{const d=L("vxe-modal"),N=L("vxe-option"),Y=L("vxe-select"),Z=me;return m(),f(D,null,[l(o).party.length===0?(m(),f("span",fe,"等待小队...")):oe("",!0),_("div",{onMouseenter:K,onMouseleave:q},[w(d,{modelValue:l(g),"onUpdate:modelValue":t[0]||(t[0]=p=>ne(g)?g.value=p:null),size:"small",position:{left:10,top:10},width:"90vw"},{title:C(()=>[_e]),default:C(()=>[be,ye]),_:1},8,["modelValue"]),_("main",{class:U(l(v)?"mouseIn":"")},[_("div",ve,[w(re,{name:"animate__animated animate__bounce","enter-active-class":"animate__fadeInLeft","leave-active-class":"animate__fadeOutLeft"},{default:C(()=>[(m(!0),f(D,null,V(l(o).party,(p,ee)=>G((m(),f("section",{key:p.id,flex:"~ nowrap",class:"player"},[w(Y,{modelValue:p.rp,"onUpdate:modelValue":P=>p.rp=P,size:"mini",onChange:P=>r(ee),"class-name":"select"},{default:C(()=>[(m(!0),f(D,null,V(i[a(p.job)],(P,B)=>(m(),ue(N,{visible:B<h[a(p.job)],key:B,value:P,label:P},null,8,["visible","value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),_("span",{class:U(["name",l(T)?"aprilFoolSDay":""])},E(W(p.job))+" "+E(l(v)?X(p.name):""),3)])),[[H,l(v)||p.name===l(j)]])),128))]),_:1})]),G(w(Z,{class:"dragJob",onUpdateSortArr:Q,party:l(o).party,"m-b-1":"","p-1":""},null,8,["party"]),[[H,l(v)]])],2)],32)],64)}}});const ke=z(ge,[["__scopeId","data-v-341c9039"]]);export{ke as default};
