import{d as K,A as k,C as P,r as U,o as m,b as y,a as C,w as V,I as ae,J as I,K as $,u as o,h as M,R as oe,t as G,H as E,aG as ne,F as re,g as d,a3 as le,aH as se,S as q,i as ie,p as ue,l as ce,c as de}from"./vendor-11731512.js";import{U as l,j as pe}from"./util-ef9ccf87.js";import{_ as Q}from"./index-83851854.js";import{a as F,c as me}from"./overlay_plugin_api-409cb9ea.js";const fe={flex:"~ col",style:{position:"relative"}},ye=K({__name:"dragJob",props:{party:{}},emits:["updateSortArr"],setup(J,{emit:_}){const x=k(),w=k(!0),A=_,L=k(!1),a=J,N=()=>{A("updateSortArr",Object.values(v.value).flat().map(r=>r.id))},b=[{role:"tank",color:"blue"},{role:"healer",color:"green"},{role:"dps",color:"red"},{role:"crafter",color:"yellow"},{role:"gatherer",color:"purple"},{role:"none",color:"gray"}],p=r=>a.party.find(i=>i.job===r),B=l.getBattleJobs3(),S=(()=>{const r={},i={tank:l.isTankJob,healer:l.isHealerJob,dps:l.isDpsJob,crafter:l.isCraftingJob,gatherer:l.isGatheringJob};for(const u of b.map(n=>n.role))r[u]=(u==="none"?[]:B.filter(n=>i[u](n))).map(n=>l.jobToJobEnum(n)).sort((n,g)=>l.enumSortMethod(n,g));return r})(),f=Object.values(S).flat().map(r=>({name:l.nameToFullName(l.jobEnumToJob(r)).simple1,id:r})),v=P("cactbotRuntime-jobList",(()=>{const r={};for(const i of b.map(u=>u.role))r[i]=f.filter(u=>S[i].includes(u.id)).sort((u,n)=>S[i].indexOf(u.id)-S[i].indexOf(n.id));return r})());return(r,i)=>{const u=U("vxe-checkbox");return m(),y("div",fe,[C(u,{modelValue:L.value,"onUpdate:modelValue":i[0]||(i[0]=n=>L.value=n),size:"mini",style:{position:"absolute",top:"0.25rem",right:"0.25rem",color:"darkcyan"}},{default:V(()=>[ae("解除限制")]),_:1},8,["modelValue"]),(m(),y(I,null,$(b,(n,g)=>C(o(ne),{key:g,ref_for:!0,ref_key:"el",ref:x,disabled:!w.value,modelValue:o(v)[n.role],"onUpdate:modelValue":h=>o(v)[n.role]=h,animation:"150",ghostClass:"ghost",class:"flex flex-row gap-0.25 p-0 m-t-0.25 m-b-0.25 rounded",onUpdate:N,filter:".no-draggable",forceFallback:!0},{default:V(()=>[(m(!0),y(I,null,$(o(v)[n.role],h=>M((m(),y("div",{key:h.id,class:oe(`${L.value||p(h.id)?`draggable bg-${n.color} cursor-move`:"no-draggable bg-gray-700/50 opacity-33"} rounded p-l-0.6 p-r-0.6 p-t-0 p-b-0.3 m-0 color-white`)},G(h.name),3)),[[E,a.party.find(z=>z.job===36)?!0:h.id!==36]])),128))]),_:2},1032,["disabled","modelValue","onUpdate:modelValue"])),64))])}}});const _e=Q(ye,[["__scopeId","data-v-ad30bd11"]]),H=J=>(ue("data-v-851420b6"),J=J(),ce(),J),be={style:{color:"white","text-shadow":"1px 1px 2px black"}},ve=H(()=>d("span",null,"用法",-1)),ge=H(()=>d("p",null,"使悬浮窗的位置分配对应游戏内的实际位置（D1D2等）",-1)),he=H(()=>d("ul",null,[d("li",null,"临时：下拉选择框修改。"),d("li",null,"长期：用鼠标拖动职能顺序。")],-1)),xe={class:"players"},je={class:"name"},ke={key:0,style:{position:"fixed",bottom:"0"}},Je=K({__name:"cactbotRuntime",setup(J){const _=(e,t)=>Array(t).fill(e).map((c,R)=>c+(+R+1)),x=k(!1),w=P("cactbotRuntime-sortArr",pe),A=[{id:"10000001",name:"虚构战士",job:21,inParty:!0},{id:"10000002",name:"虚构骑士",job:19,inParty:!0},{id:"10000003",name:"虚构占星",job:33,inParty:!0},{id:"10000004",name:"虚构学者",job:28,inParty:!0},{id:"10000005",name:"虚构忍者",job:30,inParty:!0},{id:"10000006",name:"虚构武士",job:34,inParty:!0},{id:"10000008",name:"虚构诗人",job:23,inParty:!0},{id:"10000007",name:"虚构召唤",job:27,inParty:!0}],a=P("cactbotRuntime-data",{party:[]}),N=P("cactbotRuntime-showTips",k(!0)),b=P("cactbotRuntime-roleSelectLength",{tank:0,healer:0,dps:0,crafter:0,gatherer:0,none:0}),p=P("cactbotRuntime-roleAssignLocationNames",{tank:["MT","ST",..._("T",6)],healer:[..._("H",8)],dps:[..._("D",8)],crafter:[..._("C",8)],gatherer:[..._("G",8)],none:[..._("N",8)]});function B(){for(const e in b.value)Object.prototype.hasOwnProperty.call(b.value,e)&&(b.value[e]=a.value.party.reduce((t,c)=>r(c.job)===e?t+1:t,0))}const S=e=>{const t=r(e);return p.value[t].filter((c,R)=>R<b.value[t])},O=location.href.includes("localhost"),f=k(!1),v=k(O?A[2].name:""),r=e=>[1,3,19,21,32,37].includes(e)?"tank":[6,24,28,33,40].includes(e)?"healer":[2,4,5,7,20,22,23,25,26,27,29,30,31,34,35,36,38,39].includes(e)?"dps":l.isCraftingJob(l.jobEnumToJob(e))?"crafter":l.isGatheringJob(l.jobEnumToJob(e))?"gatherer":"none",i=()=>{a.value.party.sort((e,t)=>w.value.indexOf(e.job)-w.value.indexOf(t.job));for(const e of a.value.party)e.rp=void 0,e.rp=n(e)},u=e=>{a.value.party[e].specify=!0;const t=a.value.party.find(c=>c.rp===a.value.party[e].rp&&c.id!==a.value.party[e].id);t&&(t.rp=n(t),t.specify=!0),g()},n=e=>p.value[r(e.job)].find(t=>!a.value.party.find(c=>c.rp===t))??"unknown",g=()=>{const e=[...p.value.tank,...p.value.healer,...p.value.dps,...p.value.crafter,...p.value.gatherer,...p.value.none];a.value.party.sort((t,c)=>e.indexOf(t.rp??"")-e.indexOf(c.rp??"")),me({call:"broadcast",source:"soumaRuntimeJS",msg:{party:a.value.party}})},h=()=>{f.value=!0},z=()=>{f.value=!1},W=e=>{w.value=e,D()},X=e=>l.nameToFullName(l.jobEnumToJob(e)).simple1,Y=e=>e,D=()=>{i(),B(),g()};return re(()=>{g(),F("PartyChanged",e=>{N.value&&(x.value=!0),!(O&&e.party.length===0)&&(a.value.party=e.party.filter(t=>t.inParty).map(t=>({...t,rp:"",specify:!1})),D())}),F("ChangePrimaryPlayer",e=>{O||(v.value=e.charName)}),F("BroadcastMessage",e=>{e.source==="soumaUserJS"&&typeof e.msg=="object"&&e.msg!==null&&Reflect.get(e.msg,"text")==="requestData"&&g()})}),(e,t)=>{const c=U("vxe-modal"),R=U("vxe-option"),Z=U("vxe-select"),ee=_e;return m(),y("div",{onMouseenter:h,onMouseleave:z},[M(d("span",be,"...",512),[[E,o(a).party.length<=1]]),C(c,{modelValue:o(x),"onUpdate:modelValue":t[0]||(t[0]=s=>le(x)?x.value=s:null),size:"small",position:{left:10,top:10},width:"90vw",onClose:t[1]||(t[1]=s=>{x.value=!1,N.value=!1})},{title:V(()=>[ve]),default:V(()=>[ge,he]),_:1},8,["modelValue"]),d("main",{style:q({width:o(f)?15.5+ +(o(a).party.find(s=>s.job===36)?1:0)+"em":"4em"})},[d("div",xe,[C(se,{name:"animate__animated animate__bounce","enter-active-class":"animate__fadeInLeft","leave-active-class":"animate__fadeOutLeft"},{default:V(()=>[(m(!0),y(I,null,$(o(a).party,(s,T)=>M((m(),y("section",{key:s.id,flex:"~ nowrap",style:q({opacity:o(f)?1:.5}),class:"player"},[C(Z,{modelValue:s.rp,"onUpdate:modelValue":j=>s.rp=j,size:"mini",onChange:j=>u(T),"class-name":"select"},{default:V(()=>[(m(!0),y(I,null,$(S(s.job),(j,te)=>(m(),de(R,{key:te,value:j,label:j},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),d("span",je,G(X(s.job))+" "+G(o(f)?Y(s.name):""),1)],4)),[[E,o(a).party.length>1&&(o(f)||s.name===o(v))]])),128))]),_:1})]),M(C(ee,{onUpdateSortArr:W,party:o(a).party,"m-b-1":"","p-1":""},null,8,["party"]),[[E,o(f)]])],4),o(O)?(m(),y("div",ke,[d("button",{onClick:t[2]||(t[2]=s=>{o(a).party=o(a).party.filter(T=>T.name===o(v)),D()})}," 测试单人 "),d("button",{onClick:t[3]||(t[3]=s=>{{const T={party:A};o(a).party=T.party.map(j=>({...j,rp:"",specify:!1})),D()}})}," 测试组队 ")])):ie("",!0)],32)}}});const we=Q(Je,[["__scopeId","data-v-851420b6"]]);export{we as default};
