import{d as mi,at as pi,v as _,A as ce,y as L,B as ui,au as fi,x as yi,Z as gi,r as Z,o as ae,b as le,f as de,D as we,F as Ae,u,a as n,w as J,H as me,I as bi,a1 as hi,Q as vi,g as ki,av as Fi,ay as Ci,G as F,aw as $e,c as xi}from"./vendor-834361d8.js";import{a as Ii,p as Ni,b as Ei,d as Ti,t as pe}from"./deepClone-7a27aafb.js";import{N as S,l as a}from"./netregexes-da0a8b4c.js";import{U as P}from"./util-f6d3a594.js";import{s as je,c as Le,a as _i}from"./status-2cacdfd9.js";import{g as wi}from"./actionChinese-71b7e526.js";import"./index-8c167162.js";const Se=[{name:"铁壁",description:"减轻所受到的伤害",id:1191,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"盾阵",description:"受到攻击时必定发动格挡",id:1856,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"干预",description:"减轻所受到的伤害",id:1174,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"预警",description:"减轻所受到的伤害",id:74,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"武装",description:"减轻所受到的伤害",id:1176,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"神圣领域",description:"除特定攻击之外其他所有攻击均无效化",id:82,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"圣光幕帘",description:"抵消一定伤害",id:1362,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"圣盾阵",description:"受到攻击时必定发动格挡",id:2674,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"骑士的坚守",description:"减轻所受到的伤害",id:2675,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"壁垒",description:"受到攻击时必定发动格挡",id:77,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的直觉",description:"自身发动战技命中时可以恢复体力，同时减轻所受到的伤害",id:735,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的勇猛",description:"自身发动战技命中时可以恢复体力",id:1857,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的武猛",description:`附加此效果的战士受到原初的勇猛的恢复体力的效果时，会获得相当于其100%的恢复效果
另外受到攻击的伤害减少`,id:1858,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"战栗",description:`体力最大值提高
习得战栗效果提高后追加效果：自身所受的治疗效果提高`,id:87,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"复仇",description:"受到攻击的伤害减少并且受到物理攻击时会发动反击",id:89,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"摆脱",description:"抵消一定伤害",id:1457,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"死斗",description:"除特定攻击之外其他所有对自身发动的攻击均无法令体力减少到1以下",id:409,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的血气",description:"自身发动战技命中时可以恢复体力，同时减轻所受到的伤害",id:2678,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的血潮",description:"减轻所受到的伤害",id:2679,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的血烟",description:"抵消一定伤害",id:2680,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"至黑之夜",description:"抵消一定伤害",id:1178,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"弃明投暗",description:"减轻所受到的魔法伤害",id:746,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!0},{name:"暗影墙",description:"减轻所受到的伤害",id:747,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"暗黑布道",description:"减轻所受到的魔法伤害",id:1894,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!0},{name:"行尸走肉",description:`受到致命伤害时体力减为1，并附加死而不僵状态
但是对部分攻击无效`,id:810,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"死而不僵",description:"除特定攻击之外其他所有对自身发动的攻击均无法令体力减少到1以下",id:811,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"出死入生",description:"除特定攻击之外其他所有对自身发动的攻击均无法令体力减少到1以下",id:3255,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"献奉",description:"减轻所受到的伤害",id:2682,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"石之心",description:"减轻所受到的伤害",id:1840,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"残暴弹",description:"抵消一定伤害",id:1898,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"伪装",description:"招架发动率提高，减轻所受到的伤害",id:1832,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"星云",description:"减轻所受到的伤害",id:1834,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"光之心",description:"减轻所受到的魔法伤害",id:1839,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!0},{name:"超火流星",description:"除特定攻击之外其他所有攻击均无效化",id:1836,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"刚玉之心",description:"减轻所受到的伤害",id:2683,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"刚玉之清",description:"减轻所受到的伤害",id:2684,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"神祝祷",description:"抵消一定伤害",id:1218,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"节制",description:"减轻所受到的伤害",id:1873,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"水流幕",description:"减轻所受到的伤害",id:2708,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"鼓舞",description:"抵消一定伤害",id:297,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"激励",description:"抵消一定伤害",id:1918,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"炽天的幕帘",description:"抵消一定伤害",id:1917,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"野战治疗阵",description:"减轻所受到的伤害",id:299,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"异想的幻光",description:"发动治疗魔法的治疗量提高，且受到魔法攻击的伤害减少",id:317,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!0},{name:"炽天的幻光",description:"发动治疗魔法的治疗量提高，且受到魔法攻击的伤害减少",id:1875,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!0},{name:"生命回生法",description:"体力最大值提高，同时自身所受体力恢复效果提高",id:2710,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"怒涛之计",description:"减轻所受到的伤害",id:2711,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"命运之轮",description:"减轻所受到的伤害",id:849,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"天星交错",description:"抵消一定伤害",id:1889,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"擢升",description:"减轻所受到的伤害",id:2717,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"中间学派",description:"抵消一定伤害",id:1921,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"均衡诊断",description:"抵消一定伤害",id:2607,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"齐衡诊断",description:"抵消一定伤害",id:2608,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"均衡预后",description:"抵消一定伤害",id:2609,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"坚角清汁",description:"减轻所受到的伤害",id:2618,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"白牛清汁",description:"减轻所受到的伤害",id:2619,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"整体论",description:"减轻所受到的伤害",id:3003,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"整体盾",description:"抵消一定伤害",id:3365,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"输血",description:"抵消一定伤害",id:2612,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"泛输血",description:"抵消一定伤害",id:2613,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"心眼",description:"下次受到攻击时所受到的伤害减轻",id:1232,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"金刚极意",description:"减轻所受到的一部分伤害",id:1179,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"行吟",description:"减轻所受到的伤害",id:1934,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"策动",description:"减轻所受到的伤害",id:1951,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"防守之桑巴",description:"减轻所受到的伤害",id:1826,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"即兴表演结束",description:"抵消一定伤害",id:2697,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"残影",description:"抵消一定伤害",id:488,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"魔罩",description:"抵消一定伤害",id:168,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"守护之光",description:"抵消一定伤害",id:2702,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"守护纹",description:"抵消一定伤害",id:2597,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"抗死",description:"减轻所受到的魔法伤害，同时自身所受体力恢复效果提高",id:2707,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!0},{name:"雪仇",description:"攻击所造成的伤害降低",id:1193,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!1},{name:"牵制",description:"物理攻击和魔法攻击所造成的伤害降低",id:1195,type:"multiplier",performance:{physics:1,magic:.5,darkness:0},isFriendly:!1},{name:"昏乱",description:"物理攻击和魔法攻击所造成的伤害降低",id:1203,type:"multiplier",performance:{physics:.5,magic:1,darkness:0},isFriendly:!1},{name:"武装解除",description:"攻击所造成的伤害降低",id:860,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!1},{name:"减速",description:"战技与魔法的咏唱及复唱时间延长",id:9,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!1},{name:"体力增加",description:"体力最大值提高",id:2120,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"腐臭",description:"造成的伤害降低",id:1715,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!1},{name:"智力精神降低",description:"智力与精神有所降低",id:2115,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!1},{name:"龙之力",description:"受到的伤害降低",id:2500,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"超硬化",description:"无法自由活动，但受到攻击的伤害减少",id:1722,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"玄结界",description:"减轻所受到的伤害，受到一定伤害后将附加玄天武水壁状态",id:2496,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"仙人盾",description:"受到的伤害降低",id:2119,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"强力守护",description:"令自身所受到的伤害减少，同时会以攻击力降低为代价提高自身仇恨",id:1719,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"哥布防御",description:"抵消一定伤害",id:2114,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"铜墙铁盾",description:"减轻所受到的伤害",id:194,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"坚守要塞",description:"减轻所受到的伤害",id:195,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"终极堡垒",description:"减轻所受到的伤害",id:196,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初大地",description:"减轻所受到的伤害",id:863,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"暗黑之力",description:"减轻所受到的伤害",id:864,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"灵魂之青",description:"减轻所受到的伤害",id:1931,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0}],ue=new Map;let De;function fe(C){if(De!==C){const m=C==="Chinese"?Se:Object.assign(Se,{});ue.clear();for(const x of m){const y=je[x.id][1];x.fullIcon=Le(y),ue.set(x.id.toString(16).toUpperCase(),x)}De=C}}fe("Chinese");function Ai(C){return ue.get(C)}const $i=C=>C===1?"useful":C===0?"unuseful":"half-useful",Si=/(?:耐性|防御力)(?:大幅)?(?:降低|提升|低下|下降)|受伤(?:加重|减轻)|体力(?:增加|衰减|减少)|伤害屏障/,Di=/(?:精神|力量|灵巧|智力){1,2}(?:大幅)?降低/,Pe=(C,m)=>Object.entries(je).reduce((x,[y,[s,D]])=>(C.test(s)&&x.set(y,{name:s,icon:D,isFriendly:m}),x),new Map),Hi=Pe(Si,!0),ji=Pe(Di,!1),Li={key:0,class:"testLog"},He="souma-keigenn-record-2",Wi=mi({__name:"keigennRecord2",setup(C){const m=pi("hash"),x=_(m.dev==="1"||m.dev===void 0&&!window.OverlayPluginApi&&!m.OVERLAY_WS&&!m.HOST_PORT);x.value&&setTimeout(()=>{x.value=m.dev==="1"||m.dev===void 0&&!window.OverlayPluginApi&&!m.OVERLAY_WS&&!m.HOST_PORT},1e3);function y(e,i){return typeof i=="boolean"?e==="0"?!1:e==="1"?!0:i:typeof i=="number"?isNaN(+e)?i:+e:i}const s={scale:y(m.scale,1),showHeader:y(m.showHeader,!0),showIcon:y(m.showIcon,!0),showName:y(m.showName,!1),abbrId:y(m.abbrId,!0),anonymous:y(m.anonymous,!0),replaceWithYou:y(m.replaceWithYou,!1),parseAA:y(m.parseAA,!0),parseDoT:y(m.parseDoT,!1),minimize:y(m.minimize,!1),actionCN:y(m.actionCN,!0),statusCN:y(m.statusCN,!0)},D=ce(()=>s.actionCN?"actionCN":"action"),M=_(s.minimize),Me=s.scale>=2||window.devicePixelRatio>=2?"_hr1":"",B={line_height:28*s.scale,time:35*s.scale,action:65*s.scale,target:((s.showIcon?24:0)+(s.showName?s.anonymous||!s.anonymous&&s.abbrId?24:36:0)+7)*s.scale,amount:44*s.scale},Oe={"--vxe-font-size-mini":12*s.scale+"px","--vxe-table-row-line-height":30*s.scale+"px","--vxe-table-row-height-mini":30*s.scale+"px","--vxe-input-height-mini":20*s.scale+"px","--vxe-select-option-height-mini":24*s.scale+"px"},ye={runtime:99,localStorage:3},se=_(!1),Y=_(),K=L("keigenn-record-2-pov-name",""),H=L("keigenn-record-2-pov-id",""),ne=L("keigenn-record-2-party-list",[]),O=L("keigenn-record-2-job-map",{}),Q=L("keigenn-record-2-party-event-party",[]),w=_(0),l=_([{zoneName:"",duration:"00:00",table:[],key:"init"}]),ge={rsv:/^262\|(?<timestamp>[^|]*)\|[^|]*\|[^|]*\|_rsv_(?<id>\d*)[^|]*\|(?<real>[^|]*)\|/i,ability:S.ability(),statusEffectExplicit:S.statusEffectExplicit(),gainsEffect:S.gainsEffect(),losesEffect:S.losesEffect(),inCombat:/^260\|(?<timestamp>[^|]*)\|(?<inACTCombat>[^|]*)\|(?<inGameCombat>[^|]*)\|/i,changeZone:S.changeZone(),partyList:/^11\|(?<timestamp>[^|]*)\|(?<partyCount>\d*)\|(?<list>(?:\w{8}\|){0,})\w{16}/i,primaryPlayer:/^02\|(?<timestamp>[^|]*)\|(?<id>[^|]*)\|(?<name>[^|]*)/,addCombatant:S.addedCombatant(),removingCombatant:S.removingCombatant(),networkDoT:S.networkDoT()},k=_(0),be=L("souma-keigenn-record-2-zone-name",""),he=L("souma-keigenn-record-2-rsv-data",{}),re={},I={friendly:{},enemy:{}},ze=e=>{e.table.length=0,e.zoneName="",e.duration="00:00",e.key="init"},Re=()=>{se.value=!0,k.value=0,w.value=0,l.value.length=1,ze(l.value[0])},Ge=()=>{Ie(),se.value=!1},ve=e=>{ke(e.rawLine)},ke=e=>{var i,c,o;for(const h in ge){const b=ge[h].exec(e);if(b){const t=e.split("|");switch(h){case"statusEffectExplicit":b.groups.targetId.startsWith("1")&&(re[b.groups.targetId]=b.groups.currentShield);break;case"gainsEffect":{const r=t[a.GainsEffect.fields.effectId],d=t[a.GainsEffect.fields.effect],p=t[a.GainsEffect.fields.target],f=t[a.GainsEffect.fields.targetId],T=Number(t[a.GainsEffect.fields.count]);let v=Ai(r);if(!v){const E=f.startsWith("1")&&Hi.get(parseInt(r,16).toString())||f.startsWith("4")&&ji.get(parseInt(r,16).toString());if(!E)return;const W=Le(E.icon),V=T>1?_i(W,T):W;v={type:"multiplier",performance:{physics:1,magic:1,darkness:1},id:parseInt(r,16),fullIcon:V,name:E.name,isFriendly:E.isFriendly}}const R=t[a.GainsEffect.fields.duration],N=t[a.GainsEffect.fields.source],$=t[a.GainsEffect.fields.sourceId],G=new Date(t[a.GainsEffect.fields.timestamp]).getTime()+parseFloat(R)*1e3,U={name:v.name,count:T,effect:d,effectId:r,source:N,sourceId:$,target:p,targetId:f,expirationTimestamp:G,performance:v.performance,fullIcon:v.fullIcon,isPov:H.value===$};f.startsWith("1")&&v.isFriendly?((i=I.friendly)[f]??(i[f]={}))[r]=U:f.startsWith("4")&&!v.isFriendly&&(((c=I.enemy)[p]??(c[p]={}))[r]=U)}break;case"losesEffect":{const r=t[a.LosesEffect.fields.target],d=t[a.LosesEffect.fields.targetId],p=t[a.LosesEffect.fields.effectId];d.startsWith("1")?I.friendly[d]&&Reflect.deleteProperty(I.friendly[d],p):I.enemy[r]&&Reflect.deleteProperty(I.enemy[r],p)}break;case"addCombatant":if(t[a.AddedCombatant.fields.job]!=="00"){const r=t[a.AddedCombatant.fields.job],d=new Date(t[a.AddedCombatant.fields.timestamp]).getTime();O.value[t[a.AddedCombatant.fields.id]]={job:parseInt(r,16),timestamp:d}}break;case"removingCombatant":Reflect.deleteProperty(O.value,t[a.RemovedCombatant.fields.id]);break;case"primaryPlayer":H.value=t[a.ChangedPlayer.fields.id];const ee=t[a.ChangedPlayer.fields.name];if(K.value===ee)return;K.value=ee,Ne(t[a.ChangedPlayer.fields.name]);break;case"partyList":ne.value=((o=b.groups.list)==null?void 0:o.split("|"))??[];break;case"changeZone":be.value=t[a.ChangeZone.fields.name],xe(new Date(t[a.ChangeZone.fields.timestamp]).getTime());break;case"inCombat":{const r=t[a.InCombat.fields.inACTCombat]==="1",d=t[a.InCombat.fields.inGameCombat]==="1",p=new Date(t[a.InCombat.fields.timestamp]).getTime();if(r||d){if(k.value>0)return;l.value[0].table.length!==0&&(l.value[0]=Fi(l.value[0]),l.value.unshift({zoneName:"",duration:"00:00",table:[],key:t[a.InCombat.fields.timestamp]}),l.value.length>=ye.runtime&&l.value.splice(l.value.length-1,1)),k.value=p,l.value[0].zoneName=be.value,w.value=0;return}if(!r&&!d){xe(p);return}}break;case"rsv":{const r=Number(b.groups.id),d=t[a.RSVData.fields.value];he.value[Number(r)]=d}break;case"networkDoT":if(!s.parseDoT)return;{const r=t[a.NetworkDoT.fields.which],d=t[a.NetworkDoT.fields.id];if(r!=="DoT"||d.startsWith("4")||!(d===H.value||ne.value.includes(d)||Q.value.find(V=>V.id===d)))return;const p=t[a.NetworkDoT.fields.name],f=t[a.NetworkDoT.fields.damage],T=parseInt(f,16),v=new Date(t[a.Ability.fields.timestamp]??"???").getTime(),R=Number(t[a.NetworkDoT.fields.currentHp]),N=Number(t[a.NetworkDoT.fields.maxHp]),$=k.value===0?0:v-k.value,ie=X($),G=Fe(d),U=P.nameToFullName(P.jobEnumToJob(G)).simple2,E=G,W=P.jobEnumToIcon(E).toLocaleLowerCase();Ce({timestamp:v,time:ie,id:void 0,action:r,actionCN:r,source:"",target:p,targetId:d,job:U,jobIcon:W,jobEnum:E,amount:T,keigenns:[],currentHp:R,maxHp:N,effect:"damage done",type:"dot",shield:re[d],povId:H.value})}break;case"ability":if(k.value===0)return;{const r=Ni(t);if(r.isAttack&&r.amount>=0){const d=t[a.Ability.fields.sourceId]??"???",p=t[a.Ability.fields.targetId]??"???";if(!(d.startsWith("4")&&p.startsWith("1"))||!(p===H.value||ne.value.includes(p)||Q.value.find(j=>j.id===p)))return;const f=new Date(t[a.Ability.fields.timestamp]??"???").getTime(),T=t[a.Ability.fields.ability],v=T.match(/^_rsv_(?<id>\d+)_/),R=t[a.Ability.fields.id]??"???";let N=T;if(v){const j=Number(v.groups.id);N=he.value[j]??T.match(/^_(?<id>rsv_\d+)_/).groups.id}else if(N=N.replace(/unknown_.*/,"攻击"),s.parseAA===!1&&/^攻击|攻撃|[Aa]ttack$/.test(N))return;const $=wi(parseInt(R,16)),ie=$&&$!==""?$:N,G=Number(t[a.Ability.fields.targetCurrentHp])??"???",U=Number(t[a.Ability.fields.targetMaxHp])??"???",E=t[a.Ability.fields.source]??"???",W=t[a.Ability.fields.target]??"???",{effect:V,type:ni}=Ei(r.flags),ri=k.value===0?0:f-k.value,oi=X(ri),Te=Fe(p),ci=P.nameToFullName(P.jobEnumToJob(Te)).cn.substring(0,2),_e=Te,li=P.jobEnumToIcon(_e).toLocaleLowerCase(),di=Ti(Object.values(I.friendly[p]??[]).concat(Object.values(I.enemy[E]??[])).filter(j=>{const te=Math.max(0,(j.expirationTimestamp-f)/1e3);return j.remainingDuration=te>=999?"":te.toFixed(te>.05&&te<.95?1:0),Number(j.remainingDuration)>-3}));Ce({timestamp:f,time:oi,id:R,action:N,actionCN:ie,source:E,target:W,targetId:p,job:ci,jobIcon:li,jobEnum:_e,amount:r.amount,keigenns:di,currentHp:G,maxHp:U,effect:V,type:ni,shield:re[b.groups.targetId],povId:H.value}),l.value[0].duration=X(new Date(t[a.Ability.fields.timestamp]).getTime()-k.value)}break}}}}},Fe=e=>{const i=O.value[e],c=Q.value.find(o=>o.id===e)??{job:0,timestamp:0};return[i,c].sort((o,h)=>h.timestamp-o.timestamp)[0].job},Ce=e=>{l.value[0].table.unshift(e)},xe=e=>{k.value!==0&&(l.value[0].duration=X(e-k.value),k.value=0,I.friendly={},I.enemy={},Ie())},Ie=()=>{localStorage.setItem(He,JSON.stringify(l.value.slice(0,ye.localStorage)))},Ue=()=>{const e=localStorage.getItem(He);if(e)try{const i=JSON.parse(e);l.value.length=0,l.value.push(...i)}catch(i){console.error(i)}},X=e=>{const i=Math.max(Math.floor(e/6e4),0),c=Math.max(Math.floor((e-i*6e4)/1e3),0);return`${i<10?"0":""}${i}:${c<10?"0":""}${c}`},We=ce(()=>{const e=new Set(l.value[w.value].table.map(i=>s.actionCN?i.actionCN:i.action));return Array.from(e).map(i=>({label:i,value:i}))}),Be=ce(()=>{const e={},i=new Set(l.value[w.value].table.slice().sort((c,o)=>P.enumSortMethod(c.jobEnum,o.jobEnum)).map(c=>(e[c.target]=c.job,c.target)));return Array.from(i).map(c=>({label:`${e[c]}（${c}）`,value:c}))});let oe=e=>e;const Ne=e=>{/^([A-Z])\S+ ([A-Z])\S+$/.test(e)?(s.abbrId&&(oe=i=>i.replace(/^([A-Z])\S+ ([A-Z])\S+$/,"$1.$2.")),fe("Global")):(s.abbrId&&(oe=i=>i.substring(0,2)),fe("Chinese"))};Ne(K.value);const Ee=e=>{const i=e.target;i.src.includes("cafemaker.wakingsands.com")?i.src=i.src.replace("cafemaker.wakingsands.com","xivapi.com"):i.src.includes("xivapi.com")&&(i.src="")},Ve=e=>{K.value=e.charName,H.value=e.charID.toString(16).toUpperCase()},Ze=e=>{Q.value=e.party.map(i=>({...i,timestamp:Date.now()}))};ui(()=>{for(const e in O.value){const i=O.value[e];Date.now()-i.timestamp>1e3*60*60*24*1&&Reflect.deleteProperty(O.value,e)}Ue(),addOverlayListener("LogLine",ve),addOverlayListener("PartyChanged",Ze),addOverlayListener("ChangePrimaryPlayer",Ve),startOverlayEvents()}),fi(()=>{removeOverlayListener("LogLine",ve)});const Je=({row:e})=>n("div",null,[n("span",{class:"target"},[s.showIcon&&n("img",{class:"jobIcon",src:`//cafemaker.wakingsands.com/cj/companion/${e.jobIcon}.png`,alt:"","data-job":s.showName?"":e.job,onError:Ee,loading:"lazy"},null),s.showName&&n("span",{class:`job ${e.jobIcon} ${e.targetId===e.povId?"YOU":""}`,style:!s.abbrId&&s.showName?{overflow:"hidden",textOverflow:"ellipsis"}:{}},[e.targetId===e.povId&&s.replaceWithYou?"YOU":s.anonymous?e.job:oe(e.target)])])]),Ye=({row:e})=>n(Ci,{"append-to":".wrapper",effect:"dark",placement:"right-start",title:"",trigger:"hover",enterable:!1,"hide-after":0,"popper-class":"my-el-popover"},{default:()=>[n(Ke,{row:e},null)],...{reference:()=>n("span",{class:"amount"},[n("span",{class:`${e.type}`},[n("span",{class:`${Xe(e)?"lethal":""}`},[e.amount.toLocaleString().padStart(3,"　")])])])}}),Ke=({row:e})=>n("div",null,[n("span",null,[F("盾:"),Math.round(e.maxHp*+e.shield/100),F(" ("),e.shield,F("%)")]),n("br",null,null),n("span",null,[F("HP:"),e.currentHp,F("/"),e.maxHp,F(" ("),Math.round(e.currentHp/e.maxHp*100),F("%)")]),n("br",null,null),n("span",null,[F("来源:"),e.source]),n("br",null,null),n("span",null,[F("受到伤害:"),e.amount]),n("br",null,null),n("span",null,[F("剩余HP:"),e.currentHp-e.amount,F(" ("),Math.round((e.currentHp-e.amount)/e.maxHp*100),F("%)")])]),Qe=[409 .toString(16).toUpperCase(),810 .toString(16).toUpperCase(),811 .toString(16).toUpperCase(),1836 .toString(16).toUpperCase()],Xe=e=>e.currentHp-e.amount<0&&!e.keigenns.find(i=>Qe.includes(i.effectId)),qe=({row:e})=>n(me,null,[e.type==="dot"?"（不支持）":e.keigenns.map(i=>n("span",{class:"status",title:`${i.name}(${i.source})`,"data-duration":i.remainingDuration,"data-sourcePov":i.isPov},[n("img",{class:`statusIcon ${$i(i.performance[e.type])}`,src:`//cafemaker.wakingsands.com/i/${i.fullIcon}${Me}.png`,alt:i.effect,onError:Ee,loading:"lazy"},null)])),n("span",null,[e.effect==="damage done"?"":pe(e.effect)])]),ei=e=>{const{action:i,actionCN:c,amount:o,job:h,keigenns:g,source:b,target:t,time:ee,type:r}=e,d=e.effect==="damage done"?"":","+pe(e.effect),p=`${ee} [${h}]${t} HP:${e.currentHp}/${e.maxHp}(${Math.round(e.currentHp/e.maxHp*100)}%) + 护盾:${Math.round(e.maxHp*+e.shield/100)}(${e.shield}%) 受到${b}“${i}${c!==i?"("+c+")":""}”的${o.toLocaleString()}点${pe(r)}伤害。剩余HP:${e.currentHp-e.amount}(${Math.round((e.currentHp-e.amount)/e.maxHp*100)}%)。减伤：${g.length===0&&d===""?"无":g.map(f=>s.statusCN?f.name:f.effect).join(",")+d}。`;ii(p)},ii=e=>{navigator.clipboard.writeText(e).catch(()=>{const i=document.createElement("input");i.value=e,document.body.appendChild(i),i.select(),document.execCommand("copy"),document.body.removeChild(i)}),$e.modal.message({content:"已复制到剪贴板",status:"success"})},A=_({target:!1,action:!1}),z=_(),q=yi({className:"my-menus",body:{options:[]}});gi(()=>{var e,i,c;q.body&&q.body.options&&Y.value&&(q.body.options[0]=[{code:"copy",name:"复制详情",prefixIcon:"vxe-icon-copy",className:"my-copy-item"},{code:"clearFilterAction",name:"取消技能筛选",prefixIcon:"vxe-icon-funnel-clear",className:"my-clear-filter",visible:A.value.action,disabled:!1},{code:"filterSelectAction",name:(e=z.value)!=null&&e[D.value]?`只看 ${(i=z.value)==null?void 0:i[D.value]}`:"只看该技能",prefixIcon:"vxe-icon-info-circle",visible:!A.value.action,disabled:!1},{code:"clearFilterTarget",name:"取消玩家筛选",prefixIcon:"vxe-icon-funnel-clear",visible:A.value.target,disabled:!1},{code:"filterSelectTarget",name:(c=z.value)!=null&&c.target?`只看[${z.value.job}] ${z.value.target}`:"只看该玩家",prefixIcon:"vxe-icon-user-fill",visible:!A.value.target,disabled:!1}])});const ti=()=>{M.value=!M.value},ai=({row:e})=>{const i=Y.value;i&&(i.setCurrentRow(e),z.value=e)},si=({menu:e,row:i,column:c})=>{const o=Y.value;switch(e.code){case"copy":if(!i){$e.modal.message({content:"未选中有效数据行",status:"error"});return}ei(i);break;case"clearFilterTarget":o&&(o.clearFilter(o.getColumnByField("target")),A.value.target=!1);break;case"clearFilterAction":o&&(o.clearFilter(o.getColumnByField(D.value)),A.value.action=!1);break;case"filterSelectTarget":if(o){const h=o.getColumnByField("target");if(h){const g=h.filters.find(b=>b.value===i.target);if(!g)return;g.checked=!0,o.updateData().then(()=>{o.scrollToRow(i),A.value.target=!0})}}break;case"filterSelectAction":if(o){const h=o.getColumnByField(D.value);if(h){const g=h.filters.find(b=>b.value===i[D.value]);if(!g)return;g.checked=!0,o.updateData().then(()=>{o.scrollToRow(i),A.value.action=!0})}}break}};return(e,i)=>{const c=Z("vxe-option"),o=Z("vxe-select"),h=Z("vxe-button"),g=Z("vxe-column"),b=Z("vxe-table");return ae(),le(me,null,[de("div",{class:"wrapper",style:Oe},[de("header",null,[we(n(o,{modelValue:u(w),"onUpdate:modelValue":i[0]||(i[0]=t=>hi(w)?w.value=t:null),size:"mini",class:"select"},{default:J(()=>[(ae(!0),le(me,null,bi(u(l).length,t=>(ae(),xi(c,{key:`${u(l)[t-1].key}-${u(l)[t-1].duration}-${u(l)[t-1].zoneName}`,value:t-1,label:`${u(l)[t-1].duration} ${u(l)[t-1].zoneName}`},null,8,["value","label"]))),128))]),_:1},8,["modelValue"]),[[Ae,!u(M)]]),n(h,{class:"minimize",icon:u(M)?"vxe-icon-fullscreen":"vxe-icon-minimize",onClick:ti,style:vi({opacity:u(M)?.5:1})},null,8,["icon","style"])]),we(de("main",null,[n(b,{ref_key:"xTable",ref:Y,size:"mini",class:"vxe-table","show-overflow":"",round:"",height:"100%","scroll-y":{enabled:!0},loading:u(se),"show-header":s.showHeader,data:u(l)[u(w)].table,"row-config":{isHover:!0,height:B.line_height},"header-cell-style":{padding:"0px"},onCellMenu:ai,"menu-config":u(q),onMenuClick:si},{default:J(()=>[n(g,{width:B.time,field:"time",title:"时间",align:"center"},null,8,["width"]),n(g,{width:B.action,field:s.actionCN?"actionCN":"action",title:"技能",filters:u(We),"filter-multiple":!1,resizable:!1,align:"center"},null,8,["width","field","filters"]),n(g,{width:B.target,field:"target",title:s.showName?"目标":"目",filters:u(Be),"filter-multiple":!1,resizable:!s.anonymous&&!s.abbrId,align:"left","header-align":"center"},{default:J(({row:t})=>[n(Je,{row:t},null,8,["row"])]),_:1},8,["width","title","filters","resizable"]),n(g,{width:B.amount,title:"伤害","header-align":"center"},{default:J(({row:t})=>[n(Ye,{row:t},null,8,["row"])]),_:1},8,["width"]),n(g,{title:"减伤",align:"left"},{default:J(({row:t})=>[n(qe,{row:t},null,8,["row"])]),_:1})]),_:1},8,["loading","show-header","data","row-config","menu-config"])],512),[[Ae,!u(M)]])]),u(x)?(ae(),le("div",Li,[n(Ii,{onBeforeHandle:Re,onAfterHandle:Ge,onHandleLine:ke})])):ki("",!0)],64)}}});export{Wi as default};
