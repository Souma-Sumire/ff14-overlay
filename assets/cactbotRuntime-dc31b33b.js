import{d as H,A as k,C as T,o as _,b as y,J as V,K as A,a as C,w as O,u as l,R as $,t as E,aG as ee,F as te,r as D,a3 as ae,g as v,aH as oe,h as F,H as G,p as ne,l as re,c as se}from"./vendor-bfd3a191.js";import{U as r,j as le}from"./util-ef9ccf87.js";import{_ as z}from"./index-a91834b5.js";import{c as ue,a as U}from"./overlay_plugin_api-409cb9ea.js";const ie={flex:"~ col"},ce=H({__name:"dragJob",props:{party:{}},emits:["updateSortArr"],setup(j,{emit:b}){const c=k(),g=k(!0),P=b,L=j,I=()=>{P("updateSortArr",Object.values(u.value).flat().map(o=>o.id))},a=[{name:"tank",color:"blue"},{name:"healer",color:"green"},{name:"dps",color:"red"},{name:"crafter",color:"yellow"},{name:"gatherer",color:"purple"},{name:"none",color:"gray"}];function R(o){return L.party.find(i=>i.job===o)}const x=r.getBattleJobs3(),J=["tank","healer","dps","crafter","gatherer","none"],f=(()=>{const o={},i={tank:r.isTankJob,healer:r.isHealerJob,dps:r.isDpsJob,crafter:r.isCraftingJob,gatherer:r.isGatheringJob};for(const s of J)o[s]=(s==="none"?[]:x.filter(n=>i[s](n))).map(n=>r.jobToJobEnum(n)).sort((n,m)=>r.enumSortMethod(n,m));return o})(),w=Object.values(f).flat().map(o=>({name:r.nameToFullName(r.jobEnumToJob(o)).simple1,id:o})),u=T("cactbotRuntime-jobList",(()=>{const o={};for(const i of J)o[i]=w.filter(s=>f[i].includes(s.id)).sort((s,n)=>f[i].indexOf(s.id)-f[i].indexOf(n.id));return o})());return(o,i)=>(_(),y("div",ie,[(_(),y(V,null,A(a,(s,n)=>C(l(ee),{key:n,ref_for:!0,ref_key:"el",ref:c,disabled:!g.value,modelValue:l(u)[s.name],"onUpdate:modelValue":m=>l(u)[s.name]=m,animation:"150",ghostClass:"ghost",class:"flex flex-row gap-0.25 p-0 m-t-0.25 m-b-0.25 rounded",onUpdate:I,filter:".no-draggable",forceFallback:!0},{default:O(()=>[(_(!0),y(V,null,A(l(u)[s.name],m=>(_(),y("div",{key:m.id,class:$(`${R(m.id)?`draggable bg-${s.color} cursor-move`:"no-draggable bg-gray-700/50"} rounded p-l-0.6 p-r-0.6 p-t-0 p-b-0.3 m-0 color-white`)},E(m.name),3))),128))]),_:2},1032,["disabled","modelValue","onUpdate:modelValue"])),64))]))}});const de=z(ce,[["__scopeId","data-v-9039b8ac"]]),M=j=>(ne("data-v-62fa521f"),j=j(),re(),j),pe=M(()=>v("span",null,"用法",-1)),fe=M(()=>v("p",null,"使悬浮窗的位置分配对应游戏内的实际位置（D1D2等）",-1)),me=M(()=>v("ul",null,[v("li",null,"临时：下拉选择框修改。"),v("li",null,"长期：用鼠标拖动职能顺序。")],-1)),_e={class:"players"},be={class:"name"},ye=H({__name:"cactbotRuntime",setup(j){const b=(e,t)=>Array(t).fill(e).map((d,N)=>d+(+N+1)),c={tank:["MT","ST",...b("T",70)],healer:[...b("H",72)],dps:[...b("D",72)],crafter:[...b("C",72)],gatherer:[...b("G",72)],none:[...b("N",72)]},g=k(!1),P=T("cactbotRuntime-sortArr",le),L=[{id:"10000001",name:"虚构战士",job:21,inParty:!0},{id:"10000002",name:"虚构骑士",job:19,inParty:!0},{id:"10000003",name:"虚构占星",job:33,inParty:!0},{id:"10000004",name:"虚构学者",job:28,inParty:!0},{id:"10000005",name:"虚构忍者",job:30,inParty:!0},{id:"10000006",name:"虚构武士",job:34,inParty:!0},{id:"10000007",name:"虚构黑魔",job:25,inParty:!0},{id:"10000008",name:"虚构舞者",job:38,inParty:!0}],a=T("cactbotRuntime-data",{party:[]}),R=T("cactbotRuntime-showTips",k(!0)),x={tank:0,healer:0,dps:0,crafter:0,gatherer:0,none:0};function J(){x.tank=a.value.party.reduce((e,t)=>u(t.job)==="tank"?e+1:e,0),x.healer=a.value.party.reduce((e,t)=>u(t.job)==="healer"?e+1:e,0),x.dps=a.value.party.reduce((e,t)=>u(t.job)==="dps"?e+1:e,0)}const f=location.href.includes("localhost"),h=k(!1),w=k(f?"虚构占星":"");if(f){const e={party:L};R.value&&(g.value=!0),a.value.party=e.party.map(t=>({...t,rp:"",specify:!1})),o(),J(),n()}function u(e){const t=Number(e);return[1,3,19,21,32,37].includes(t)?"tank":[6,24,28,33,40].includes(t)?"healer":[2,4,5,7,20,22,23,25,26,27,29,30,31,34,35,36,38,39].includes(t)?"dps":r.isCraftingJob(r.jobEnumToJob(e))?"crafter":r.isGatheringJob(r.jobEnumToJob(e))?"gatherer":"none"}function o(){a.value.party.sort((e,t)=>P.value.indexOf(e.job)-P.value.indexOf(t.job));for(const e of a.value.party)e.rp=void 0,e.rp=s(e)}function i(e){a.value.party[e].specify=!0;const t=a.value.party.find(d=>d.rp===a.value.party[e].rp&&d.id!==a.value.party[e].id);t&&(t.rp=s(t),t.specify=!0),n()}function s(e){return c[u(e.job)].find(t=>!a.value.party.find(d=>d.rp===t))??"unknown"}function n(){const e=[...c.tank,...c.healer,...c.dps,...c.crafter,...c.gatherer,...c.none];a.value.party.sort((t,d)=>e.indexOf(t.rp??"")-e.indexOf(d.rp??"")),ue({call:"broadcast",source:"soumaRuntimeJS",msg:{party:a.value.party}})}function m(){h.value=!0}function K(){h.value=!1}function q(e){P.value=e,o(),J(),n()}const Q=e=>r.nameToFullName(r.jobEnumToJob(e)).simple1,W=e=>e;return te(()=>{n(),U("PartyChanged",e=>{R.value&&(g.value=!0),!(f&&e.party.length===0)&&(a.value.party=e.party.filter(t=>t.inParty).map(t=>({...t,rp:"",specify:!1})),o(),J(),n())}),U("ChangePrimaryPlayer",e=>{f||(w.value=e.charName)}),U("BroadcastMessage",e=>{e.source==="soumaUserJS"&&typeof e.msg=="object"&&e.msg!==null&&Reflect.get(e.msg,"text")==="requestData"&&n()}),startOverlayEvents()}),(e,t)=>{const d=D("vxe-modal"),N=D("vxe-option"),X=D("vxe-select"),Y=de;return _(),y("div",{onMouseenter:m,onMouseleave:K},[C(d,{modelValue:l(g),"onUpdate:modelValue":t[0]||(t[0]=p=>ae(g)?g.value=p:null),size:"small",position:{left:10,top:10},width:"90vw"},{title:O(()=>[pe]),default:O(()=>[fe,me]),_:1},8,["modelValue"]),v("main",{class:$(l(h)?"mouseIn":"")},[v("div",_e,[C(oe,{name:"animate__animated animate__bounce","enter-active-class":"animate__fadeInLeft","leave-active-class":"animate__fadeOutLeft"},{default:O(()=>[(_(!0),y(V,null,A(l(a).party,(p,Z)=>F((_(),y("section",{key:p.id,flex:"~ nowrap",class:"player"},[C(X,{modelValue:p.rp,"onUpdate:modelValue":S=>p.rp=S,size:"mini",onChange:S=>i(Z),"class-name":"select"},{default:O(()=>[(_(!0),y(V,null,A(c[u(p.job)],(S,B)=>(_(),se(N,{visible:B<x[u(p.job)],key:B,value:S,label:S},null,8,["visible","value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),v("span",be,E(Q(p.job))+" "+E(l(h)?W(p.name):""),1)])),[[G,l(a).party.length>1&&(l(h)||p.name===l(w))]])),128))]),_:1})]),F(C(Y,{class:"dragJob",onUpdateSortArr:q,party:l(a).party,"m-b-1":"","p-1":""},null,8,["party"]),[[G,l(h)]])],2)],32)}}});const xe=z(ye,[["__scopeId","data-v-62fa521f"]]);export{xe as default};
