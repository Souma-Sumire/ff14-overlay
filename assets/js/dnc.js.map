{"version":3,"file":"dnc.js","sources":["../../../src/pages/jobs/dnc.vue"],"sourcesContent":["<template>\n  <div class=\"dnc-overlay\">\n    <header v-show=\"showSettings\" class=\"settings\">\n      <form>连击X: <el-input-number class=\"input input-number\" v-model=\"settings.combo.left\" size=\"small\" /></form>\n      <form>连击Y: <el-input-number class=\"input input-number\" v-model=\"settings.combo.top\" size=\"small\" /></form>\n      <form>触发3X: <el-input-number class=\"input input-number\" v-model=\"settings.tr3.left\" size=\"small\" /></form>\n      <form>触发3Y: <el-input-number class=\"input input-number\" v-model=\"settings.tr3.top\" size=\"small\" /></form>\n      <form>触发4X: <el-input-number class=\"input input-number\" v-model=\"settings.tr4.left\" size=\"small\" /></form>\n      <form>触发4Y: <el-input-number class=\"input input-number\" v-model=\"settings.tr4.top\" size=\"small\" /></form>\n      <form>百花X: <el-input-number class=\"input input-number\" v-model=\"settings.fl.left\" size=\"small\" /></form>\n      <form>百花Y: <el-input-number class=\"input input-number\" v-model=\"settings.fl.top\" size=\"small\" /></form>\n      <form>剩余警告: <el-input-number class=\"input input-number\" :min=\"-1\" :max=\"30\" v-model=\"settings.warn\" size=\"small\" /></form>\n      <form>常规颜色: <el-input class=\"input input-string\" v-model=\"settings.color\" size=\"small\" /></form>\n      <form>常规阴影: <el-input class=\"input input-string\" v-model=\"settings.shadow\" size=\"small\" /></form>\n      <form>警告颜色: <el-input class=\"input input-string\" v-model=\"settings.warncolor\" size=\"small\" /></form>\n      <form>警告阴影: <el-input class=\"input input-string\" v-model=\"settings.warnshadow\" size=\"small\" /></form>\n      <form>零值文本: <el-input class=\"input input-string\" v-model=\"settings.zeroStr\" size=\"small\" /></form>\n      <form>字号: <el-input-number class=\"input input-number\" v-model=\"settings.size\" size=\"small\" /></form>\n      <form>字体: <el-input class=\"input input-string\" v-model=\"settings.fontFamily\" size=\"small\" /></form>\n      <form>粗体：<el-switch v-model=\"settings.fontWeight\" size=\"small\" /></form>\n      <form>自定义CSS： <br /><el-input v-model=\"settings.userCss\" autosize type=\"textarea\" placeholder=\"\" /></form>\n      <br />\n      <form>\n        <el-popconfirm @confirm=\"resetSettings\" :teleported=\"false\" title=\"确定要重置？\">\n          <template #reference>\n            <el-button>重置全部用户设置</el-button>\n          </template>\n        </el-popconfirm>\n      </form>\n    </header>\n    <main>\n      <div v-for=\"item in data\" :key=\"item.id\">\n        <span :class=\"item.cd <= settings.warn && !showSettings ? 'warning' : ''\" :style=\"item.style\">\n          {{ item.cd >= 0 ? item.cd : showSettings ? \"30\" : settings.zeroStr }}\n        </span>\n      </div>\n    </main>\n  </div>\n  <component is=\"style\">{{ userCss }} </component>\n</template>\n\n<script setup lang=\"ts\">\nimport { RemovableRef } from \"@vueuse/core\";\nimport { template } from \"xe-utils\";\n\nlet now = ref(0);\nconst game = reactive({\n  playerId: \"\",\n  lastCombo: 0,\n  status: new Map([\n    [\"A85\", 0], // 触发3\n    [\"A86\", 0], // 触发4\n    [\"BC9\", 0], // 百花3\n    [\"BCA\", 0], // 百花4\n  ]),\n});\ninterface Settings {\n  combo: { left: number; top: number };\n  tr3: { left: number; top: number };\n  tr4: { left: number; top: number };\n  fl: { left: number; top: number };\n  color: string;\n  shadow: string;\n  size: number;\n  warncolor: string;\n  warnshadow: string;\n  zeroStr: string;\n  warn: number;\n  fontFamily: string;\n  fontWeight: boolean;\n  userCss: string;\n}\nconst settings: RemovableRef<Settings> = useStorage(\n  \"jobs-dnc\",\n  {\n    combo: { left: 10, top: -30 },\n    tr3: { left: 46, top: -22 },\n    tr4: { left: 82, top: -22 },\n    fl: { left: 0, top: -15 },\n    color: \"rgb(255,255,255)\",\n    shadow: \"rgb(0,0,0)\",\n    size: 14,\n    warncolor: \"rgb(255,255,255)\",\n    warnshadow: \"rgb(255,0,0)\",\n    zeroStr: \"\",\n    fontFamily: \"微软雅黑\",\n    fontWeight: false,\n    warn: 5,\n    userCss: ``,\n  },\n  localStorage,\n  { mergeDefaults: true },\n);\nconst showSettings = ref(document.getElementById(\"unlocked\")?.style?.display === \"flex\");\nconst data = reactive([\n  {\n    id: \"combo\",\n    cd: computed(() => {\n      return 30 - Math.floor((now.value - game.lastCombo) / 1000);\n    }),\n    style: { top: computed(() => settings.value.combo.top + \"px\"), left: computed(() => settings.value.combo.left + \"px\") },\n  },\n  {\n    id: \"tr3\",\n    cd: computed(() => {\n      return 30 - Math.floor((now.value - game.status.get(\"A85\")!) / 1000);\n    }),\n    style: { top: computed(() => settings.value.tr3.top + \"px\"), left: computed(() => settings.value.tr3.left + \"px\") },\n  },\n  {\n    id: \"tr4\",\n    cd: computed(() => {\n      return 30 - Math.floor((now.value - game.status.get(\"A86\")!) / 1000);\n    }),\n    style: { top: computed(() => settings.value.tr4.top + \"px\"), left: computed(() => settings.value.tr4.left + \"px\") },\n  },\n  {\n    id: \"fl3\",\n    cd: computed(() => {\n      return 30 - Math.floor((now.value - game.status.get(\"BC9\")!) / 1000);\n    }),\n    style: {\n      top: computed(() => settings.value.tr3.top + settings.value.fl.top + \"px\"),\n      left: computed(() => settings.value.tr3.left + settings.value.fl.left + \"px\"),\n    },\n  },\n  {\n    id: \"fl4\",\n    cd: computed(() => {\n      return 30 - Math.floor((now.value - game.status.get(\"BCA\")!) / 1000);\n    }),\n    style: {\n      top: computed(() => settings.value.tr4.top + settings.value.fl.top + \"px\"),\n      left: computed(() => settings.value.tr4.left + settings.value.fl.left + \"px\"),\n    },\n  },\n]);\nconst color = computed(() => settings.value.color);\nconst shadow = computed(() => settings.value.shadow);\nconst warncolor = computed(() => settings.value.warncolor);\nconst warnshadow = computed(() => settings.value.warnshadow);\nconst fontFamily = computed(() => settings.value.fontFamily);\nconst size = computed(() => settings.value.size + \"px\");\nconst fontWeight = computed(() => (settings.value.fontWeight ? \"bold\" : \"none\"));\nconst userCss = computed(() => settings.value.userCss);\n\nfunction handleOnLogEvent(e: { line: string[] }) {\n  if (e.line[5] === game.playerId && (e.line[0] === \"26\" || e.line[0] === \"30\") && game.status.has(e.line[2])) {\n    game.status.set(e.line[2], e.line[0] === \"26\" ? Date.now() : 0);\n  } else if (e.line[2] === game.playerId && (e.line[0] === \"21\" || e.line[0] === \"22\")) {\n    if ((e.line[4] === \"3E79\" && e.line[0] === \"22\") || (e.line[4] === \"3E75\" && e.line[0] === \"21\")) game.lastCombo = Date.now();\n    else if (e.line[4] === \"3E76\" || e.line[4] === \"3E7A\" || (e.line[0] === \"21\" && e.line[4] === \"3E79\")) game.lastCombo = 0;\n  }\n}\n\nfunction handlePlayerDied() {\n  game.status.set(\"A85\", 0);\n  game.status.set(\"A86\", 0);\n  game.status.set(\"BC9\", 0);\n  game.status.set(\"BCA\", 0);\n  game.lastCombo = 0;\n}\n\nfunction handleChangePrimaryPlayer(e: { charID: number }) {\n  game.playerId = e.charID.toString(16).toUpperCase();\n}\n\nfunction resetSettings() {\n  localStorage.removeItem(\"jobs-dnc\");\n  location.reload();\n}\n\nonMounted(() => {\n  addOverlayListener(\"onPlayerDied\", handlePlayerDied);\n  addOverlayListener(\"LogLine\", handleOnLogEvent);\n  addOverlayListener(\"ChangePrimaryPlayer\", handleChangePrimaryPlayer);\n  startOverlayEvents();\n  document.addEventListener(\"onOverlayStateUpdate\", (e: any) => {\n    showSettings.value = e?.detail?.isLocked === false;\n  });\n});\nonBeforeUnmount(() => {\n  removeOverlayListener(\"onPlayerDied\", handlePlayerDied);\n  removeOverlayListener(\"LogLine\", handleOnLogEvent);\n  removeOverlayListener(\"ChangePrimaryPlayer\", handleChangePrimaryPlayer);\n});\nrequestAnimationFrame(function update() {\n  now.value = Date.now();\n  requestAnimationFrame(update);\n});\n</script>\n<style>\nbody {\n  padding: 0;\n  margin: 0;\n}\n</style>\n<style scoped lang=\"scss\">\n* {\n  user-select: none !important;\n}\n.dnc-overlay {\n  font-family: v-bind(fontFamily);\n  font-weight: v-bind(fontWeight);\n}\n.settings {\n  overflow: visible;\n  position: fixed;\n  right: 3em;\n  z-index: 999999;\n  height: 80vh;\n  color: white;\n  font-weight: bold;\n  display: flex;\n  flex-wrap: wrap;\n  flex-direction: column;\n  align-content: flex-end;\n  font-size: 14px;\n  > form:not(:last-child) {\n    white-space: nowrap;\n    padding: 0px 3px;\n    text-shadow: -1px 0 1px #000, 0 1px 1px #000, 1px 0 1px #000, 0 -1px 1px #000;\n  }\n  :deep(.input-number) {\n    width: 8em;\n    height: 1.15em;\n  }\n  :deep(.input-string) {\n    width: 9em;\n    height: 1.35em;\n  }\n}\nmain {\n  display: flex;\n  align-items: flex-end;\n  height: 100vh;\n  > div {\n    position: relative;\n    > span {\n      position: absolute;\n      text-align: right;\n      width: 1em;\n      color: v-bind(color);\n      $shadow: v-bind(shadow);\n      font-size: v-bind(size);\n      text-shadow: 1px 1px 1px $shadow, -1px -1px 1px $shadow, 1px -1px 1px $shadow, -1px 1px 1px $shadow;\n      &.warning {\n        color: v-bind(warncolor);\n        $warnshadow: v-bind(warnshadow);\n        text-shadow: 1px 1px 1px $warnshadow, -1px -1px 1px $warnshadow, 1px -1px 1px $warnshadow, -1px 1px 1px $warnshadow;\n      }\n      transform: translateX(-50%) translateY(-50%);\n    }\n  }\n}\n</style>\n"],"names":["now","ref","game","reactive","settings","useStorage","showSettings","_b","_a","data","computed","color","shadow","warncolor","warnshadow","fontFamily","size","fontWeight","userCss","handleOnLogEvent","e","handlePlayerDied","handleChangePrimaryPlayer","resetSettings","onMounted","onBeforeUnmount","update"],"mappings":"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"}