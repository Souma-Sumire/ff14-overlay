import{O as I,av as J,d as F,a as R,c as z,f as w,g as A,F as U,m as q,i as B,y,Y as N,w as L,v as C,x as V,h as g,t as Y}from"./index.js";import{U as d}from"./util.js";import{g as P,a as Q}from"./xivapi.js";import{_ as W}from"./_plugin-vue_export-helper.js";var l=(o=>(o.显示范围="displayDuration",o.变色时间="discoloration",o.零后持续="hold",o.战前准备="preBattle",o.TTS提前量="ttsAdvance",o))(l||{});class D{constructor(t,s,c,p){d.iconToJobEnum(s.job)&&(s.job=d.jobEnumToJob(d.iconToJobEnum(s.job))),this.name=t,this.condition=s,this.timeline=c,this.codeFight=p,this.create=new Date().toLocaleString()}}const Z={[l.显示范围]:"显示范围（秒）",[l.变色时间]:"提前变色（秒）",[l.零后持续]:"后续保持（秒）",[l.战前准备]:"倒计时量（秒）",[l.TTS提前量]:"TTS预备（秒）"},k={[l.显示范围]:120,[l.变色时间]:2.75,[l.零后持续]:.5,[l.战前准备]:30,[l.TTS提前量]:1},K={"--timeline-width":"时间轴宽度","--font-size":"字体大小","--normal-scale":"等待缩放","--up-coming-scale":"来临缩放","--opacity":"等待不透明度","--tras-duration":"动画时间"};let G={"--timeline-width":180,"--font-size":18,"--opacity":.33,"--normal-scale":.5,"--up-coming-scale":1,"--tras-duration":1};const ie=I("timeline",{state:()=>({allTimelines:[],configValues:k,configTranslate:Z,settings:{api:""},filters:{},showStyle:G,showStyleTranslate:K}),getters:{},actions:{newTimeline(o="Demo",t={zoneId:"0",job:"NONE"},s=`# 注释的内容不会被解析
# "<技能名>"会被解析为图片 紧接着一个波浪线可快捷重复技能名
-20 "<中间学派>~刷盾"
0 "战斗开始" tts "冲呀"
# 当sync在window的范围内被满足时将进行时间同步
30 "一运" sync / 14:4.{7}:[^:]*:AAAA:/ window 2.5,2.5
# 当存在jump时会进跳转至jump时间
50 "变异化型:蛇" sync / 14:4.{7}:[^:]*:BBBB:/ window 2.5,2.5 jump 1000
50 "变异化型:兽" sync / 14:4.{7}:[^:]*:CCCC:/ window 2.5,2.5 jump 2000
1000 "蛇轴"
2000 "兽轴"
`,c="用户创建"){return this.allTimelines.push(new D(o,t,s,c)),this.sortTimelines(),J.fire({position:"center",icon:"success",title:`“${o}”已创建`,showConfirmButton:!1,timer:1e3}),this.allTimelines.findIndex(m=>m.timeline===s&&m.name===o&&JSON.stringify(m.condition)===JSON.stringify(t)&&m.codeFight===c)},getTimeline(o){return this.allTimelines.filter(t=>(t.condition.zoneId==="0"||t.condition.zoneId===o.zoneId)&&(t.condition.job==="NONE"||t.condition.job===o.job))},saveTimelineSettings(){localStorage.setItem("timelines",JSON.stringify({allTimelines:this.allTimelines,configValues:this.configValues,settings:this.settings,showStyle:this.showStyle,filters:this.filters}))},loadTimelineSettings(){const o=localStorage.getItem("timelines");o&&(Object.assign(this,JSON.parse(o)),this.allTimelines.forEach(t=>{t.condition.jobList&&(t.condition.job=t.condition.jobList[0]??"NONE",delete t.condition.jobList)}),this.sortTimelines()),this.allTimelines.forEach(t=>{d.iconToJobEnum(t.condition.job)&&(t.condition.job=d.jobEnumToJob(d.iconToJobEnum(t.condition.job)))})},sortTimelines(){this.allTimelines.sort((o,t)=>Number(o.condition.zoneId)===Number(t.condition.zoneId)?d.jobToJobEnum(o.condition.job)-d.jobToJobEnum(t.condition.job):Number(o.condition.zoneId)-Number(t.condition.zoneId))}}});function x(o){var s;const t=o.match(/^(?<negative>-)?(?<mm>[^:：]+):(?<ss>[^:：]+)$/);return t?parseFloat(t.groups.mm)*60+parseFloat(t.groups.ss)*((s=t.groups)!=null&&s.negative?-1:1):parseFloat(o)}function M(o){return o.matchAll(/\<(?<name>[^\<\>]*?)!??\>(?<repeat>~)?/g)}async function ae(o){var c,p,m,f,e,i,n,u,h;const t=[],s=[...o.matchAll(/^\s*(?<time>[-:：\d.]+)\s+(?<action>(--|["'])[^"'\n]+?\3).*$/gm)];for(let a=0;a<s.length;a++){const r=s[a],j=(c=r[0].match(new RegExp("(?<=jump ?)[-:：\\d.]+")))==null?void 0:c[0],v=(p=r[0].match(new RegExp("(?<=sync ?\\/).+(?=\\/)")))==null?void 0:p[0],S=(m=r[0].match(new RegExp("(?<=window ?)[-:：\\d.]+")))==null?void 0:m[0],T=(f=r[0].match(new RegExp("(?<=window ?[-:：\\d.]+,)[-:：\\d.]+")))==null?void 0:f[0],O=(i=(e=r[0].match(/ tts ?["'](?<tts>[^"']+)["']/))==null?void 0:e.groups)==null?void 0:i.tts,E=/ tts(?: |$)/.test(r[0])?(h=(u=(n=Array.from(M(r.groups.action)))==null?void 0:n[0])==null?void 0:u.groups)==null?void 0:h.name:void 0;t.push({time:x(r.groups.time),action:r.groups.action||"",alertAlready:!1,sync:v?new RegExp(v):void 0,show:!v,windowBefore:parseFloat(S||T||"2.5"),windowAfter:parseFloat(T||S||"2.5"),jump:j?parseFloat(j):void 0,tts:O||E})}return t.sort((a,r)=>a.time-r.time),t}const X={key:0,class:"skill"},H={class:"skill_icon"},_=["src"],$={style:{padding:"0px 1px"}},b="data:image/png;base64,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",ee=F({__name:"timelineShow",props:{config:{},lines:{},runtime:{},showStyle:{}},setup(o){const t=o,s=R({}),c=z(()=>t.lines.map(e=>{const{action:i}=e,{skillName:n,actionText:u}=p(i);return{...e,skillName:n,actionText:u}}));function p(e){var u,h;e=e.replaceAll(/^["']|["']$/g,"");const i=M(e);if(!i)return{skillName:"",actionText:e};let n="";for(const a of i)(u=a.groups)!=null&&u.name&&(n=a.groups.name,e=e.replace(a[0],(h=a.groups)!=null&&h.repeat?a.groups.name:""));return{skillName:n,actionText:e}}function m(e){return typeof s[e]=="string"?s[e]:(typeof s[e]>"u"&&(s[e]=P(e).then(i=>{i!=null&&i.Icon&&Q(i.Icon).then(n=>(s[e]=n,s[e]))})),b)}function f(e){e.target.src=b}return(e,i)=>e.lines.length?(w(),A("ul",{key:0,class:"loadedTimelines",style:y(e.showStyle)},[(w(!0),A(U,null,q(B(c),(n,u)=>L((w(),A("li",{key:u,class:V({upcoming:n.time-e.runtime<=e.config.discoloration,fade:n.time-e.runtime<=0-e.config.hold,passed:n.time-e.runtime<=0})},[g("aside",{style:y({right:Math.max((n.time-e.runtime)/e.config.displayDuration,0)*100+"%"})},null,4),g("section",null,[n.action?(w(),A("span",X,[g("div",H,[g("img",{style:y(`background-image:url(${b})`),src:m(n.skillName),loading:"auto",onError:f},null,44,_)]),g("span",null,Y(n.actionText),1)])):N("",!0),g("span",$,Y((n.time-e.runtime).toFixed(1)),1)])],2)),[[C,n.show&&n.time-e.runtime>0-e.config.hold-e.showStyle["--tras-duration"]&&n.time-e.runtime<=e.config.displayDuration]])),128))],4)):N("",!0)}});const re=W(ee,[["__scopeId","data-v-0944af6e"]]);export{re as _,ae as p,ie as u};
