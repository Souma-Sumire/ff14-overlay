import{ay as j,aM as he,ax as O,d as ve,b as pe,a as ge,r as me,o as Ce,aN as q,aO as ye,aP as H,f as we,g as _e,h as V,y as xe,i as P,w as $,v as U,k as B,l as N,j as D,F as be,aQ as Fe}from"./index.js";var J={exports:{}},W,Z;function ke(){if(Z)return W;Z=1;var s=1e3,l=s*60,e=l*60,a=e*24,p=a*7,v=a*365.25;W=function(t,n){n=n||{};var u=typeof t;if(u==="string"&&t.length>0)return b(t);if(u==="number"&&isFinite(t))return n.long?d(t):C(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))};function b(t){if(t=String(t),!(t.length>100)){var n=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(n){var u=parseFloat(n[1]),h=(n[2]||"ms").toLowerCase();switch(h){case"years":case"year":case"yrs":case"yr":case"y":return u*v;case"weeks":case"week":case"w":return u*p;case"days":case"day":case"d":return u*a;case"hours":case"hour":case"hrs":case"hr":case"h":return u*e;case"minutes":case"minute":case"mins":case"min":case"m":return u*l;case"seconds":case"second":case"secs":case"sec":case"s":return u*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return u;default:return}}}}function C(t){var n=Math.abs(t);return n>=a?Math.round(t/a)+"d":n>=e?Math.round(t/e)+"h":n>=l?Math.round(t/l)+"m":n>=s?Math.round(t/s)+"s":t+"ms"}function d(t){var n=Math.abs(t);return n>=a?c(t,n,a,"day"):n>=e?c(t,n,e,"hour"):n>=l?c(t,n,l,"minute"):n>=s?c(t,n,s,"second"):t+" ms"}function c(t,n,u,h){var g=n>=u*1.5;return Math.round(t/u)+" "+h+(g?"s":"")}return W}function Be(s){e.debug=e,e.default=e,e.coerce=d,e.disable=v,e.enable=p,e.enabled=b,e.humanize=ke(),e.destroy=c,Object.keys(s).forEach(t=>{e[t]=s[t]}),e.names=[],e.skips=[],e.formatters={};function l(t){let n=0;for(let u=0;u<t.length;u++)n=(n<<5)-n+t.charCodeAt(u),n|=0;return e.colors[Math.abs(n)%e.colors.length]}e.selectColor=l;function e(t){let n,u=null,h,g;function f(...o){if(!f.enabled)return;const _=f,r=Number(new Date),i=r-(n||r);_.diff=i,_.prev=n,_.curr=r,n=r,o[0]=e.coerce(o[0]),typeof o[0]!="string"&&o.unshift("%O");let m=0;o[0]=o[0].replace(/%([a-zA-Z%])/g,(w,x)=>{if(w==="%%")return"%";m++;const F=e.formatters[x];if(typeof F=="function"){const k=o[m];w=F.call(_,k),o.splice(m,1),m--}return w}),e.formatArgs.call(_,o),(_.log||e.log).apply(_,o)}return f.namespace=t,f.useColors=e.useColors(),f.color=e.selectColor(t),f.extend=a,f.destroy=e.destroy,Object.defineProperty(f,"enabled",{enumerable:!0,configurable:!1,get:()=>u!==null?u:(h!==e.namespaces&&(h=e.namespaces,g=e.enabled(t)),g),set:o=>{u=o}}),typeof e.init=="function"&&e.init(f),f}function a(t,n){const u=e(this.namespace+(typeof n>"u"?":":n)+t);return u.log=this.log,u}function p(t){e.save(t),e.namespaces=t,e.names=[],e.skips=[];let n;const u=(typeof t=="string"?t:"").split(/[\s,]+/),h=u.length;for(n=0;n<h;n++)u[n]&&(t=u[n].replace(/\*/g,".*?"),t[0]==="-"?e.skips.push(new RegExp("^"+t.slice(1)+"$")):e.names.push(new RegExp("^"+t+"$")))}function v(){const t=[...e.names.map(C),...e.skips.map(C).map(n=>"-"+n)].join(",");return e.enable(""),t}function b(t){if(t[t.length-1]==="*")return!0;let n,u;for(n=0,u=e.skips.length;n<u;n++)if(e.skips[n].test(t))return!1;for(n=0,u=e.names.length;n<u;n++)if(e.names[n].test(t))return!0;return!1}function C(t){return t.toString().substring(2,t.toString().length-2).replace(/\.\*\?$/,"*")}function d(t){return t instanceof Error?t.stack||t.message:t}function c(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return e.enable(e.load()),e}var Ae=Be;(function(s,l){l.formatArgs=a,l.save=p,l.load=v,l.useColors=e,l.storage=b(),l.destroy=(()=>{let d=!1;return()=>{d||(d=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),l.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function e(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function a(d){if(d[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+d[0]+(this.useColors?"%c ":" ")+"+"+s.exports.humanize(this.diff),!this.useColors)return;const c="color: "+this.color;d.splice(1,0,c,"color: inherit");let t=0,n=0;d[0].replace(/%[a-zA-Z%]/g,u=>{u!=="%%"&&(t++,u==="%c"&&(n=t))}),d.splice(n,0,c)}l.log=console.debug||console.log||(()=>{});function p(d){try{d?l.storage.setItem("debug",d):l.storage.removeItem("debug")}catch{}}function v(){let d;try{d=l.storage.getItem("debug")}catch{}return!d&&typeof process<"u"&&"env"in process&&(d={}.DEBUG),d}function b(){try{return localStorage}catch{}}s.exports=Ae(l);const{formatters:C}=s.exports;C.j=function(d){try{return JSON.stringify(d)}catch(c){return"[UnexpectedJSONParseError]: "+c.message}}})(J,J.exports);var Pe=J.exports;const Ie=j(Pe);var oe={exports:{}};(function(s){var l=Object.prototype.hasOwnProperty,e="~";function a(){}Object.create&&(a.prototype=Object.create(null),new a().__proto__||(e=!1));function p(d,c,t){this.fn=d,this.context=c,this.once=t||!1}function v(d,c,t,n,u){if(typeof t!="function")throw new TypeError("The listener must be a function");var h=new p(t,n||d,u),g=e?e+c:c;return d._events[g]?d._events[g].fn?d._events[g]=[d._events[g],h]:d._events[g].push(h):(d._events[g]=h,d._eventsCount++),d}function b(d,c){--d._eventsCount===0?d._events=new a:delete d._events[c]}function C(){this._events=new a,this._eventsCount=0}C.prototype.eventNames=function(){var c=[],t,n;if(this._eventsCount===0)return c;for(n in t=this._events)l.call(t,n)&&c.push(e?n.slice(1):n);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(t)):c},C.prototype.listeners=function(c){var t=e?e+c:c,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var u=0,h=n.length,g=new Array(h);u<h;u++)g[u]=n[u].fn;return g},C.prototype.listenerCount=function(c){var t=e?e+c:c,n=this._events[t];return n?n.fn?1:n.length:0},C.prototype.emit=function(c,t,n,u,h,g){var f=e?e+c:c;if(!this._events[f])return!1;var o=this._events[f],_=arguments.length,r,i;if(o.fn){switch(o.once&&this.removeListener(c,o.fn,void 0,!0),_){case 1:return o.fn.call(o.context),!0;case 2:return o.fn.call(o.context,t),!0;case 3:return o.fn.call(o.context,t,n),!0;case 4:return o.fn.call(o.context,t,n,u),!0;case 5:return o.fn.call(o.context,t,n,u,h),!0;case 6:return o.fn.call(o.context,t,n,u,h,g),!0}for(i=1,r=new Array(_-1);i<_;i++)r[i-1]=arguments[i];o.fn.apply(o.context,r)}else{var m=o.length,y;for(i=0;i<m;i++)switch(o[i].once&&this.removeListener(c,o[i].fn,void 0,!0),_){case 1:o[i].fn.call(o[i].context);break;case 2:o[i].fn.call(o[i].context,t);break;case 3:o[i].fn.call(o[i].context,t,n);break;case 4:o[i].fn.call(o[i].context,t,n,u);break;default:if(!r)for(y=1,r=new Array(_-1);y<_;y++)r[y-1]=arguments[y];o[i].fn.apply(o[i].context,r)}}return!0},C.prototype.on=function(c,t,n){return v(this,c,t,n,!1)},C.prototype.once=function(c,t,n){return v(this,c,t,n,!0)},C.prototype.removeListener=function(c,t,n,u){var h=e?e+c:c;if(!this._events[h])return this;if(!t)return b(this,h),this;var g=this._events[h];if(g.fn)g.fn===t&&(!u||g.once)&&(!n||g.context===n)&&b(this,h);else{for(var f=0,o=[],_=g.length;f<_;f++)(g[f].fn!==t||u&&!g[f].once||n&&g[f].context!==n)&&o.push(g[f]);o.length?this._events[h]=o.length===1?o[0]:o:b(this,h)}return this},C.prototype.removeAllListeners=function(c){var t;return c?(t=e?e+c:c,this._events[t]&&b(this,t)):(this._events=new a,this._eventsCount=0),this},C.prototype.off=C.prototype.removeListener,C.prototype.addListener=C.prototype.on,C.prefixed=e,C.EventEmitter=C,s.exports=C})(oe);var Le=oe.exports;const Q=j(Le);var R=null;typeof WebSocket<"u"?R=WebSocket:typeof MozWebSocket<"u"?R=MozWebSocket:typeof global<"u"?R=global.WebSocket||global.MozWebSocket:typeof window<"u"?R=window.WebSocket||window.MozWebSocket:typeof self<"u"&&(R=self.WebSocket||self.MozWebSocket);const X=R;var se={exports:{}};function Re(s){throw new Error('Could not dynamically require "'+s+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var G={exports:{}};const Oe={},Se=Object.freeze(Object.defineProperty({__proto__:null,default:Oe},Symbol.toStringTag,{value:"Module"})),Ee=he(Se);var Y;function ie(){return Y||(Y=1,function(s,l){(function(e,a){s.exports=a()})(O,function(){var e=e||function(a,p){var v;if(typeof window<"u"&&window.crypto&&(v=window.crypto),typeof self<"u"&&self.crypto&&(v=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(v=globalThis.crypto),!v&&typeof window<"u"&&window.msCrypto&&(v=window.msCrypto),!v&&typeof O<"u"&&O.crypto&&(v=O.crypto),!v&&typeof Re=="function")try{v=Ee}catch{}var b=function(){if(v){if(typeof v.getRandomValues=="function")try{return v.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof v.randomBytes=="function")try{return v.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},C=Object.create||function(){function r(){}return function(i){var m;return r.prototype=i,m=new r,r.prototype=null,m}}(),d={},c=d.lib={},t=c.Base=function(){return{extend:function(r){var i=C(this);return r&&i.mixIn(r),(!i.hasOwnProperty("init")||this.init===i.init)&&(i.init=function(){i.$super.init.apply(this,arguments)}),i.init.prototype=i,i.$super=this,i},create:function(){var r=this.extend();return r.init.apply(r,arguments),r},init:function(){},mixIn:function(r){for(var i in r)r.hasOwnProperty(i)&&(this[i]=r[i]);r.hasOwnProperty("toString")&&(this.toString=r.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),n=c.WordArray=t.extend({init:function(r,i){r=this.words=r||[],i!=p?this.sigBytes=i:this.sigBytes=r.length*4},toString:function(r){return(r||h).stringify(this)},concat:function(r){var i=this.words,m=r.words,y=this.sigBytes,w=r.sigBytes;if(this.clamp(),y%4)for(var x=0;x<w;x++){var F=m[x>>>2]>>>24-x%4*8&255;i[y+x>>>2]|=F<<24-(y+x)%4*8}else for(var k=0;k<w;k+=4)i[y+k>>>2]=m[k>>>2];return this.sigBytes+=w,this},clamp:function(){var r=this.words,i=this.sigBytes;r[i>>>2]&=4294967295<<32-i%4*8,r.length=a.ceil(i/4)},clone:function(){var r=t.clone.call(this);return r.words=this.words.slice(0),r},random:function(r){for(var i=[],m=0;m<r;m+=4)i.push(b());return new n.init(i,r)}}),u=d.enc={},h=u.Hex={stringify:function(r){for(var i=r.words,m=r.sigBytes,y=[],w=0;w<m;w++){var x=i[w>>>2]>>>24-w%4*8&255;y.push((x>>>4).toString(16)),y.push((x&15).toString(16))}return y.join("")},parse:function(r){for(var i=r.length,m=[],y=0;y<i;y+=2)m[y>>>3]|=parseInt(r.substr(y,2),16)<<24-y%8*4;return new n.init(m,i/2)}},g=u.Latin1={stringify:function(r){for(var i=r.words,m=r.sigBytes,y=[],w=0;w<m;w++){var x=i[w>>>2]>>>24-w%4*8&255;y.push(String.fromCharCode(x))}return y.join("")},parse:function(r){for(var i=r.length,m=[],y=0;y<i;y++)m[y>>>2]|=(r.charCodeAt(y)&255)<<24-y%4*8;return new n.init(m,i)}},f=u.Utf8={stringify:function(r){try{return decodeURIComponent(escape(g.stringify(r)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(r){return g.parse(unescape(encodeURIComponent(r)))}},o=c.BufferedBlockAlgorithm=t.extend({reset:function(){this._data=new n.init,this._nDataBytes=0},_append:function(r){typeof r=="string"&&(r=f.parse(r)),this._data.concat(r),this._nDataBytes+=r.sigBytes},_process:function(r){var i,m=this._data,y=m.words,w=m.sigBytes,x=this.blockSize,F=x*4,k=w/F;r?k=a.ceil(k):k=a.max((k|0)-this._minBufferSize,0);var L=k*x,I=a.min(L*4,w);if(L){for(var E=0;E<L;E+=x)this._doProcessBlock(y,E);i=y.splice(0,L),m.sigBytes-=I}return new n.init(i,I)},clone:function(){var r=t.clone.call(this);return r._data=this._data.clone(),r},_minBufferSize:0});c.Hasher=o.extend({cfg:t.extend(),init:function(r){this.cfg=this.cfg.extend(r),this.reset()},reset:function(){o.reset.call(this),this._doReset()},update:function(r){return this._append(r),this._process(),this},finalize:function(r){r&&this._append(r);var i=this._doFinalize();return i},blockSize:16,_createHelper:function(r){return function(i,m){return new r.init(m).finalize(i)}},_createHmacHelper:function(r){return function(i,m){return new _.HMAC.init(r,m).finalize(i)}}});var _=d.algo={};return d}(Math);return e})}(G)),G.exports}(function(s,l){(function(e,a){s.exports=a(ie())})(O,function(e){return function(a){var p=e,v=p.lib,b=v.WordArray,C=v.Hasher,d=p.algo,c=[],t=[];(function(){function h(_){for(var r=a.sqrt(_),i=2;i<=r;i++)if(!(_%i))return!1;return!0}function g(_){return(_-(_|0))*4294967296|0}for(var f=2,o=0;o<64;)h(f)&&(o<8&&(c[o]=g(a.pow(f,1/2))),t[o]=g(a.pow(f,1/3)),o++),f++})();var n=[],u=d.SHA256=C.extend({_doReset:function(){this._hash=new b.init(c.slice(0))},_doProcessBlock:function(h,g){for(var f=this._hash.words,o=f[0],_=f[1],r=f[2],i=f[3],m=f[4],y=f[5],w=f[6],x=f[7],F=0;F<64;F++){if(F<16)n[F]=h[g+F]|0;else{var k=n[F-15],L=(k<<25|k>>>7)^(k<<14|k>>>18)^k>>>3,I=n[F-2],E=(I<<15|I>>>17)^(I<<13|I>>>19)^I>>>10;n[F]=L+n[F-7]+E+n[F-16]}var ce=m&y^~m&w,le=o&_^o&r^_&r,ue=(o<<30|o>>>2)^(o<<19|o>>>13)^(o<<10|o>>>22),fe=(m<<26|m>>>6)^(m<<21|m>>>11)^(m<<7|m>>>25),K=x+fe+ce+t[F]+n[F],de=ue+le;x=w,w=y,y=m,m=i+K|0,i=r,r=_,_=o,o=K+de|0}f[0]=f[0]+o|0,f[1]=f[1]+_|0,f[2]=f[2]+r|0,f[3]=f[3]+i|0,f[4]=f[4]+m|0,f[5]=f[5]+y|0,f[6]=f[6]+w|0,f[7]=f[7]+x|0},_doFinalize:function(){var h=this._data,g=h.words,f=this._nDataBytes*8,o=h.sigBytes*8;return g[o>>>5]|=128<<24-o%32,g[(o+64>>>9<<4)+14]=a.floor(f/4294967296),g[(o+64>>>9<<4)+15]=f,h.sigBytes=g.length*4,this._process(),this._hash},clone:function(){var h=C.clone.call(this);return h._hash=this._hash.clone(),h}});p.SHA256=C._createHelper(u),p.HmacSHA256=C._createHmacHelper(u)}(Math),e.SHA256})})(se);var Te=se.exports;const ee=j(Te);var ae={exports:{}};(function(s,l){(function(e,a){s.exports=a(ie())})(O,function(e){return function(){var a=e,p=a.lib,v=p.WordArray,b=a.enc;b.Base64={stringify:function(d){var c=d.words,t=d.sigBytes,n=this._map;d.clamp();for(var u=[],h=0;h<t;h+=3)for(var g=c[h>>>2]>>>24-h%4*8&255,f=c[h+1>>>2]>>>24-(h+1)%4*8&255,o=c[h+2>>>2]>>>24-(h+2)%4*8&255,_=g<<16|f<<8|o,r=0;r<4&&h+r*.75<t;r++)u.push(n.charAt(_>>>6*(3-r)&63));var i=n.charAt(64);if(i)for(;u.length%4;)u.push(i);return u.join("")},parse:function(d){var c=d.length,t=this._map,n=this._reverseMap;if(!n){n=this._reverseMap=[];for(var u=0;u<t.length;u++)n[t.charCodeAt(u)]=u}var h=t.charAt(64);if(h){var g=d.indexOf(h);g!==-1&&(c=g)}return C(d,c,n)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};function C(d,c,t){for(var n=[],u=0,h=0;h<c;h++)if(h%4){var g=t[d.charCodeAt(h-1)]<<h%4*2,f=t[d.charCodeAt(h)]>>>6-h%4*2,o=g|f;n[u>>>2]|=o<<24-u%4*8,u++}return v.create(n,u)}}(),e.enc.Base64})})(ae);var ze=ae.exports;const te=j(ze);function M(){return M=Object.assign?Object.assign.bind():function(s){for(var l=1;l<arguments.length;l++){var e=arguments[l];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(s[a]=e[a])}return s},M.apply(this,arguments)}function Me(s,l){if(s==null)return{};var e={},a=Object.keys(s),p,v;for(v=0;v<a.length;v++)p=a[v],!(l.indexOf(p)>=0)&&(e[p]=s[p]);return e}var A;(function(s){s[s.Hello=0]="Hello",s[s.Identify=1]="Identify",s[s.Identified=2]="Identified",s[s.Reidentify=3]="Reidentify",s[s.Event=5]="Event",s[s.Request=6]="Request",s[s.RequestResponse=7]="RequestResponse",s[s.RequestBatch=8]="RequestBatch",s[s.RequestBatchResponse=9]="RequestBatchResponse"})(A||(A={}));var ne;(function(s){s[s.None=0]="None",s[s.General=1]="General",s[s.Config=2]="Config",s[s.Scenes=4]="Scenes",s[s.Inputs=8]="Inputs",s[s.Transitions=16]="Transitions",s[s.Filters=32]="Filters",s[s.Outputs=64]="Outputs",s[s.SceneItems=128]="SceneItems",s[s.MediaInputs=256]="MediaInputs",s[s.Vendors=512]="Vendors",s[s.Ui=1024]="Ui",s[s.All=2047]="All",s[s.InputVolumeMeters=65536]="InputVolumeMeters",s[s.InputActiveStateChanged=131072]="InputActiveStateChanged",s[s.InputShowStateChanged=262144]="InputShowStateChanged",s[s.SceneItemTransformChanged=524288]="SceneItemTransformChanged"})(ne||(ne={}));var re;(function(s){s[s.None=-1]="None",s[s.SerialRealtime=0]="SerialRealtime",s[s.SerialFrame=1]="SerialFrame",s[s.Parallel=2]="Parallel"})(re||(re={}));function qe(s,l,e){const a=te.stringify(ee(e+s));return te.stringify(ee(a+l))}const He=["authentication","rpcVersion"],T=Ie("obs-websocket-js");class z extends Error{constructor(l,e){super(e),this.code=void 0,this.code=l}}class S extends Q{constructor(...l){super(...l),this._identified=!1,this.internalListeners=new Q,this.socket=void 0}static generateMessageId(){return String(S.requestCounter++)}get identified(){return this._identified}async connect(l="ws://127.0.0.1:4455",e,a={}){var p=this;this.socket&&await this.disconnect();try{const v=this.internalEventPromise("ConnectionClosed"),b=this.internalEventPromise("ConnectionError");return await Promise.race([async function(){const C=await p.createConnection(l);return p.emit("Hello",C),p.identify(C,e,a)}(),new Promise((C,d)=>{b.then(c=>{c.message&&d(c)}),v.then(c=>{d(c)})})])}catch(v){throw await this.disconnect(),v}}async disconnect(){if(!this.socket||this.socket.readyState===X.CLOSED)return;const l=this.internalEventPromise("ConnectionClosed");this.socket.close(),await l}async reidentify(l){const e=this.internalEventPromise(`op:${A.Identified}`);return await this.message(A.Reidentify,l),e}async call(l,e){const a=S.generateMessageId(),p=this.internalEventPromise(`res:${a}`);await this.message(A.Request,{requestId:a,requestType:l,requestData:e});const{requestStatus:v,responseData:b}=await p;if(!v.result)throw new z(v.code,v.comment);return b}async callBatch(l,e={}){const a=S.generateMessageId(),p=this.internalEventPromise(`res:${a}`);await this.message(A.RequestBatch,M({requestId:a,requests:l},e));const{results:v}=await p;return v}cleanup(){this.socket&&(this.socket.onopen=null,this.socket.onmessage=null,this.socket.onerror=null,this.socket.onclose=null,this.socket=void 0,this._identified=!1,this.internalListeners.removeAllListeners())}async createConnection(l){var e;const a=this.internalEventPromise("ConnectionOpened"),p=this.internalEventPromise(`op:${A.Hello}`);this.socket=new X(l,this.protocol),this.socket.onopen=this.onOpen.bind(this),this.socket.onmessage=this.onMessage.bind(this),this.socket.onerror=this.onError.bind(this),this.socket.onclose=this.onClose.bind(this),await a;const v=(e=this.socket)==null?void 0:e.protocol;if(!v)throw new z(-1,"Server sent no subprotocol");if(v!==this.protocol)throw new z(-1,"Server sent an invalid subprotocol");return p}async identify(l,e,a={}){let{authentication:p,rpcVersion:v}=l,b=Me(l,He);const C=M({rpcVersion:v},a);p&&e&&(C.authentication=qe(p.salt,p.challenge,e));const d=this.internalEventPromise(`op:${A.Identified}`);await this.message(A.Identify,C);const c=await d;return this._identified=!0,this.emit("Identified",c),M({rpcVersion:v},b,c)}async message(l,e){if(!this.socket)throw new Error("Not connected");if(!this.identified&&l!==1)throw new Error("Socket not identified");const a=await this.encodeMessage({op:l,d:e});this.socket.send(a)}async internalEventPromise(l){return new Promise(e=>{this.internalListeners.once(l,e)})}onOpen(l){T("socket.open"),this.emit("ConnectionOpened"),this.internalListeners.emit("ConnectionOpened",l)}async onMessage(l){try{const{op:e,d:a}=await this.decodeMessage(l.data);if(T("socket.message: %d %j",e,a),e===void 0||a===void 0)return;switch(e){case A.Event:{const{eventType:p,eventData:v}=a;this.emit(p,v);return}case A.RequestResponse:case A.RequestBatchResponse:{const{requestId:p}=a;this.internalListeners.emit(`res:${p}`,a);return}default:this.internalListeners.emit(`op:${e}`,a)}}catch(e){T("error handling message: %o",e)}}onError(l){T("socket.error: %o",l);const e=new z(-1,l.message);this.emit("ConnectionError",e),this.internalListeners.emit("ConnectionError",e)}onClose(l){T("socket.close: %s (%d)",l.reason,l.code);const e=new z(l.code,l.reason);this.emit("ConnectionClosed",e),this.internalListeners.emit("ConnectionClosed",e),this.cleanup()}}S.requestCounter=1;typeof exports<"u"&&Object.defineProperty(exports,"__esModule",{value:!0});class Ve extends S{constructor(...l){super(...l),this.protocol="obswebsocket.json"}async encodeMessage(l){return JSON.stringify(l)}async decodeMessage(l){return JSON.parse(l)}}const $e={"p-b-2":""},Ne=ve({__name:"obs",setup(s){var g;const l=(g=JSON.parse(window.localStorage.getItem("obs-data")??"{}"))==null?void 0:g.password,e=pe("obs2-data",{port:"4455",password:l??"",greaterThanOrEqualTo:4,partyLength:1,autoHide:!1},localStorage,{mergeDefaults:!0}),a=ge({connecting:!1,recording:!1,inACTCombat:!1}),p=new Ve,v=me(!0);Ce(async()=>{v.value=!e.value.autoHide,p.on("ExitStarted",c),p.on("ConnectionClosed",c),p.on("ConnectionError",c),p.on("RecordStateChanged",t),addOverlayListener("onLogEvent",n),addOverlayListener("onInCombatChangedEvent",u),addOverlayListener("PartyChanged",h),startOverlayEvents(),e.value.password!==""?(await b(!1),p.call("GetRecordStatus").then(f=>a.recording=f.outputActive)):q.modal.alert({content:"先锁定悬浮窗，再填写端口与密码",title:"初次使用",width:"80%",size:"mini"})}),ye(()=>{p.off("ExitStarted",c),p.off("ConnectionClosed",c),p.off("ConnectionError",c),p.off("RecordStateChanged",t),removeOverlayListener("onLogEvent",n),removeOverlayListener("onInCombatChangedEvent",u),removeOverlayListener("PartyChanged",h),p.disconnect()});async function b(f=!1){return p.connect(`ws://127.0.0.1:${e.value.port}`,e.value.password).then(o=>{q.modal.message({content:"连接成功",status:"success",width:"7rem",size:"mini",top:8}),a.connecting=!0,v.value=!1}).catch(o=>{f&&q.modal.message({content:"连接失败",status:"error",width:"7rem",size:"mini",top:8}),a.connecting=!1})}async function C(f=!0,o=!1){if(!o&&e.value.partyLength<e.value.greaterThanOrEqualTo)return Promise.resolve();a.connecting||await b(),a.recording&&f?p.call("StopRecord").then(()=>setTimeout(()=>p.call("StartRecord").catch(()=>{}),1500)).catch(()=>{}):p.call("StartRecord").catch(()=>{})}async function d(){return a.recording?p.call("StopRecord").catch(()=>{}):Promise.resolve()}function c(){a.connecting=!1}function t(f){switch(f.outputState){case"OBS_WEBSOCKET_OUTPUT_STARTED":a.recording=!0;return;case"OBS_WEBSOCKET_OUTPUT_STOPPED":a.recording=!1;return}}async function n(f){for(const o of f.detail.logs)/^.{14} \w+ 00:(?:00B9|0[12]39)::?(?:距离战斗开始还有|Battle commencing in |戦闘開始まで)\d+[^（(]+[（(]/i.test(o)?C():/^.{14} (?:Director 21:.{8}:4000000F|Territory 01:|ChatLog 00:0038::end$|ChatLog 00:(?:00B9|0[12]39)::(?:.+取消了战斗开始倒计时。|Countdown canceled by .+\.|.+により、戦闘開始カウントがキャンセルされました。))/i.test(o)&&d()}async function u(f){!a.inACTCombat&&f.detail.inACTCombat&&C(!1),a.inACTCombat&&!f.detail.inACTCombat&&d(),a.inACTCombat=f.detail.inACTCombat}function h(f){var o;e.value.partyLength=((o=f.party)==null?void 0:o.length)??0}return(f,o)=>{const _=H("vxe-button"),r=H("vxe-input"),i=H("vxe-form-item"),m=H("vxe-form"),y=Fe;return we(),_e(be,null,[V("header",null,[V("div",null,[V("i",{class:"vxe-icon-dot icon",style:xe({color:P(a).recording?"red":"gray",textShadow:"0px  0px 3px black"})},null,4),$(B(_,{class:"btns",icon:"vxe-icon-caret-right",onClick:o[0]||(o[0]=w=>C(!1,!0))},null,512),[[U,!P(a).recording]]),$(B(_,{class:"btns",icon:"vxe-icon-close",onClick:d,size:"mini"},null,512),[[U,P(a).recording]]),B(_,{class:"btns",icon:"vxe-icon-setting",onClick:o[1]||(o[1]=w=>v.value=!P(v)),size:"mini"}),$(B(_,{class:"btns",icon:"vxe-icon-cut",onClick:o[2]||(o[2]=w=>C(!0,!0)),size:"mini"},null,512),[[U,P(a).recording]])])]),$(V("main",$e,[B(m,{data:P(e)},{default:N(()=>[B(i,{span:"24"},{default:N(({data:w})=>[D(" 自动录制最少小队人数 "),B(r,{modelValue:w.greaterThanOrEqualTo,"onUpdate:modelValue":x=>w.greaterThanOrEqualTo=x,size:"small",type:"integer",min:"0",max:"8",style:{width:"3rem","margin-right":"5px"}},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),B(i,{span:"24"},{default:N(({data:w})=>[D(" 端口 "),B(r,{modelValue:w.port,"onUpdate:modelValue":x=>w.port=x,size:"small",placeholder:"端口号",style:{width:"4rem","margin-right":"5px"}},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),B(i,{span:"24"},{default:N(({data:w})=>[D(" 密码 "),B(r,{modelValue:w.password,"onUpdate:modelValue":x=>w.password=x,size:"small",placeholder:"密码",type:"password",style:{width:"12rem"}},null,8,["modelValue","onUpdate:modelValue"]),B(_,{content:"无法输入",size:"mini",icon:"vxe-icon-question",type:"text",status:"info",onClick:o[3]||(o[3]=x=>P(q).modal.message({content:"先点击ACT，再点击悬浮窗，即可正常输入"}))})]),_:1})]),_:1},8,["data"]),B(_,{size:"mini",status:"primary",icon:"vxe-icon-swap",content:"连接",onClick:o[4]||(o[4]=w=>b(!0))}),B(y,{style:{"margin-left":"1em"},modelValue:P(e).autoHide,"onUpdate:modelValue":o[5]||(o[5]=w=>P(e).autoHide=w),label:"启动时隐藏设置界面（即使连接失败）"},null,8,["modelValue"])],512),[[U,P(v)]])],64)}}});export{Ne as default};
