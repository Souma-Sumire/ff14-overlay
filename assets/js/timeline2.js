import{d as z,f as p,g as h,F as B,m as J,y as _,Y as E,w as F,v as L,x as O,h as u,t as $,O as D,av as M}from"./index.js";import{_ as H}from"./_plugin-vue_export-helper.js";import{U as l}from"./util.js";import{g as k,a as C}from"./xivapi.js";const V=["innerHTML"],P={style:{padding:"0px 1px"}},U=z({__name:"timelineShow",props:{config:{},lines:{},runtime:{},showStyle:{}},setup(e){const o=e;return(n,s)=>n.lines.length?(p(),h("ul",{key:0,class:"loadedTimelines",style:_(n.showStyle)},[(p(!0),h(B,null,J(o.lines,(t,a)=>F((p(),h("li",{key:a,class:O({upcoming:t.time-n.runtime<=n.config.discoloration,fade:t.time-n.runtime<=0-n.config.hold,passed:t.time-n.runtime<=0})},[u("aside",{style:_({right:Math.max((t.time-n.runtime)/n.config.displayDuration,0)*100+"%"})},null,4),u("section",null,[u("span",{innerHTML:t.actionHTML},null,8,V),u("span",P,$((t.time-n.runtime).toFixed(1)),1)])],2)),[[L,t.show&&t.time-n.runtime>0-n.config.hold-n.showStyle["--tras-duration"]&&t.time-n.runtime<=n.config.displayDuration]])),128))],4)):E("",!0)}});const oe=H(U,[["__scopeId","data-v-6bdcc759"]]);var r=(e=>(e.显示范围="displayDuration",e.变色时间="discoloration",e.零后持续="hold",e.战前准备="preBattle",e.TTS提前量="ttsAdvance",e))(r||{});class R{constructor(o,n,s,t){l.iconToJobEnum(n.job)&&(n.job=l.jobEnumToJob(l.iconToJobEnum(n.job))),this.name=o,this.condition=n,this.timeline=s,this.codeFight=t,this.create=new Date().toLocaleString()}}const Y={[r.显示范围]:"显示范围（秒）",[r.变色时间]:"提前变色（秒）",[r.零后持续]:"后续保持（秒）",[r.战前准备]:"倒计时量（秒）",[r.TTS提前量]:"TTS预备（秒）"},q={[r.显示范围]:120,[r.变色时间]:2.75,[r.零后持续]:.5,[r.战前准备]:30,[r.TTS提前量]:1},G={"--timeline-width":"时间轴宽度","--font-size":"字体大小","--normal-scale":"等待缩放","--up-coming-scale":"来临缩放","--opacity":"等待不透明度","--tras-duration":"动画时间"};let K={"--timeline-width":180,"--font-size":18,"--opacity":.33,"--normal-scale":.5,"--up-coming-scale":1,"--tras-duration":1};const ne=D("timeline",{state:()=>({allTimelines:[],configValues:q,configTranslate:Y,settings:{api:""},filters:{},showStyle:K,showStyleTranslate:G}),getters:{},actions:{newTimeline(e="Demo",o={zoneId:"0",job:"NONE"},n=`# 注释的内容不会被解析
# "<技能名>"会被解析为图片 紧接着一个波浪线可快捷重复技能名
-20 "<中间学派>~刷盾"
0 "战斗开始" tts "冲呀"
# 当sync在window的范围内被满足时将进行时间同步
30 "一运" sync / 14:4.{7}:[^:]*:AAAA:/ window 2.5,2.5
# 当存在jump时会进跳转至jump时间
50 "变异化型:蛇" sync / 14:4.{7}:[^:]*:BBBB:/ window 2.5,2.5 jump 1000
50 "变异化型:兽" sync / 14:4.{7}:[^:]*:CCCC:/ window 2.5,2.5 jump 2000
1000 "蛇轴"
2000 "兽轴"
`,s="用户创建"){return this.allTimelines.push(new R(e,o,n,s)),this.sortTimelines(),M.fire({position:"center",icon:"success",title:`“${e}”已创建`,showConfirmButton:!1,timer:1e3}),this.allTimelines.findIndex(a=>a.timeline===n&&a.name===e&&JSON.stringify(a.condition)===JSON.stringify(o)&&a.codeFight===s)},getTimeline(e){return this.allTimelines.filter(o=>(o.condition.zoneId==="0"||o.condition.zoneId===e.zoneId)&&(o.condition.job==="NONE"||o.condition.job===e.job))},saveTimelineSettings(){localStorage.setItem("timelines",JSON.stringify({allTimelines:this.allTimelines,configValues:this.configValues,settings:this.settings,showStyle:this.showStyle,filters:this.filters}))},loadTimelineSettings(){const e=localStorage.getItem("timelines");e&&(Object.assign(this,JSON.parse(e)),this.allTimelines.forEach(o=>{o.condition.jobList&&(o.condition.job=o.condition.jobList[0]??"NONE",delete o.condition.jobList)}),this.sortTimelines()),this.allTimelines.forEach(o=>{l.iconToJobEnum(o.condition.job)&&(o.condition.job=l.jobEnumToJob(l.iconToJobEnum(o.condition.job)))})},sortTimelines(){this.allTimelines.sort((e,o)=>Number(e.condition.zoneId)===Number(o.condition.zoneId)?l.jobToJobEnum(e.condition.job)-l.jobToJobEnum(o.condition.job):Number(e.condition.zoneId)-Number(o.condition.zoneId))}}});function Q(e){var n;const o=e.match(/^(?<negative>-)?(?<mm>[^:：]+):(?<ss>[^:：]+)$/);return o?parseFloat(o.groups.mm)*60+parseFloat(o.groups.ss)*((n=o.groups)!=null&&n.negative?-1:1):parseFloat(e)}function N(e){return e.matchAll(/\<(?<name>[^\<\>]*?)!??\>(?<repeat>~)?/g)}async function W(e){var n,s;e=e.replaceAll(/^["']|["']$/g,"");const o=N(e);if(!o)return Promise.resolve(e);for(const t of o)if((n=t.groups)!=null&&n.name){const a=await k(t.groups.name),c=await C(a.Icon);e=e.replace(t[0],`${c?`<div class="skill_icon"><img src='${c}' loading="auto"/></div>`:""}<span>${(s=t.groups)!=null&&s.repeat?t.groups.name:""}</span>`)}return Promise.resolve(e)}async function te(e){var s,t,a,c,g,f,w,T,y;const o=[],n=[...e.matchAll(/^\s*(?<time>[-:：\d.]+)\s+(?<action>(--|["'])[^"'\n]+?\3).*$/gm)];for(let m=0;m<n.length;m++){const i=n[m],b=(s=i[0].match(new RegExp("(?<=jump ?)[-:：\\d.]+")))==null?void 0:s[0],d=(t=i[0].match(new RegExp("(?<=sync ?\\/).+(?=\\/)")))==null?void 0:t[0],S=(a=i[0].match(new RegExp("(?<=window ?)[-:：\\d.]+")))==null?void 0:a[0],j=(c=i[0].match(new RegExp("(?<=window ?[-:：\\d.]+,)[-:：\\d.]+")))==null?void 0:c[0],v=(f=(g=i[0].match(/ tts ?["'](?<tts>[^"']+)["']/))==null?void 0:g.groups)==null?void 0:f.tts,A=/ tts(?: |$)/.test(i[0])?(y=(T=(w=Array.from(N(i.groups.action)))==null?void 0:w[0])==null?void 0:T.groups)==null?void 0:y.name:void 0,I=await W(i.groups.action);o.push({time:Q(i.groups.time),actionHTML:i.groups.action?I:"",alertAlready:!1,sync:d?new RegExp(d):void 0,show:!d,windowBefore:parseFloat(S||j||"2.5"),windowAfter:parseFloat(j||S||"2.5"),jump:b?parseFloat(b):void 0,tts:v||A})}return o.sort((m,i)=>m.time-i.time),o}export{oe as _,te as p,ne as u};
