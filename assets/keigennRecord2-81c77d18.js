import{d as di,at as mi,v as _,A as ce,y as L,B as pi,au as ui,x as fi,Z as yi,r as Z,o as ne,b as le,f as de,D as we,F as Ae,u,a as s,w as J,H as me,I as gi,a1 as bi,Q as hi,g as vi,av as ki,ay as Fi,G as F,aw as $e,c as Ci}from"./vendor-834361d8.js";import{a as xi,p as Ii,b as Ni,d as Ei,t as pe}from"./deepClone-46de3b63.js";import{N as S,l as n}from"./netregexes-bb7ceaea.js";import{U as P}from"./util-f6d3a594.js";import{c as je,s as Ti,a as _i}from"./status-2cacdfd9.js";import{g as wi}from"./actionChinese-71b7e526.js";import"./index-f634aad1.js";const Se=[{name:"铁壁",description:"减轻所受到的伤害",id:1191,icon:13911,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"盾阵",description:"受到攻击时必定发动格挡",id:1856,icon:12510,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"干预",description:"减轻所受到的伤害",id:1174,icon:12511,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"预警",description:"减轻所受到的伤害",id:74,icon:10151,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"武装",description:"减轻所受到的伤害",id:1176,icon:12513,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"神圣领域",description:"除特定攻击之外其他所有攻击均无效化",id:82,icon:12504,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"圣光幕帘",description:"抵消一定伤害",id:1362,icon:12509,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"圣盾阵",description:"受到攻击时必定发动格挡",id:2674,icon:12515,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"骑士的坚守",description:"减轻所受到的伤害",id:2675,icon:12516,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"壁垒",description:"受到攻击时必定发动格挡",id:77,icon:10156,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的直觉",description:"自身发动战技命中时可以恢复体力，同时减轻所受到的伤害",id:735,icon:12555,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的勇猛",description:"自身发动战技命中时可以恢复体力",id:1857,icon:12558,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的武猛",description:`附加此效果的战士受到原初的勇猛的恢复体力的效果时，会获得相当于其100%的恢复效果
另外受到攻击的伤害减少`,id:1858,icon:12559,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"战栗",description:`体力最大值提高
习得战栗效果提高后追加效果：自身所受的治疗效果提高`,id:87,icon:10254,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"复仇",description:"受到攻击的伤害减少并且受到物理攻击时会发动反击",id:89,icon:10256,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"摆脱",description:"抵消一定伤害",id:1457,icon:12557,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"死斗",description:"除特定攻击之外其他所有对自身发动的攻击均无法令体力减少到1以下",id:409,icon:10266,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的血气",description:"自身发动战技命中时可以恢复体力，同时减轻所受到的伤害",id:2678,icon:12562,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的血潮",description:"减轻所受到的伤害",id:2679,icon:12563,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的血烟",description:"抵消一定伤害",id:2680,icon:12564,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"至黑之夜",description:"抵消一定伤害",id:1178,icon:13118,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"弃明投暗",description:"减轻所受到的魔法伤害",id:746,icon:13114,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!0},{name:"暗影墙",description:"减轻所受到的伤害",id:747,icon:13113,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"暗黑布道",description:"减轻所受到的魔法伤害",id:1894,icon:13122,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!0},{name:"行尸走肉",description:`受到致命伤害时体力减为1，并附加死而不僵状态
但是对部分攻击无效`,id:810,icon:13115,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"死而不僵",description:"除特定攻击之外其他所有对自身发动的攻击均无法令体力减少到1以下",id:811,icon:13116,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"出死入生",description:"除特定攻击之外其他所有对自身发动的攻击均无法令体力减少到1以下",id:3255,icon:13124,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"献奉",description:"减轻所受到的伤害",id:2682,icon:13123,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"石之心",description:"减轻所受到的伤害",id:1840,icon:13610,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"残暴弹",description:"抵消一定伤害",id:1898,icon:13614,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"伪装",description:"招架发动率提高，减轻所受到的伤害",id:1832,icon:13602,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"星云",description:"减轻所受到的伤害",id:1834,icon:13604,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"光之心",description:"减轻所受到的魔法伤害",id:1839,icon:13609,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!0},{name:"超火流星",description:"除特定攻击之外其他所有攻击均无效化",id:1836,icon:13606,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"刚玉之心",description:"减轻所受到的伤害",id:2683,icon:13615,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"刚玉之清",description:"减轻所受到的伤害",id:2684,icon:13616,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"神祝祷",description:"抵消一定伤害",id:1218,icon:12632,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"节制",description:"减轻所受到的伤害",id:1873,icon:12633,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"水流幕",description:"减轻所受到的伤害",id:2708,icon:12638,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"鼓舞",description:"抵消一定伤害",id:297,icon:12801,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"激励",description:"抵消一定伤害",id:1918,icon:12814,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"炽天的幕帘",description:"抵消一定伤害",id:1917,icon:12848,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"野战治疗阵",description:"减轻所受到的伤害",id:299,icon:12803,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"异想的幻光",description:"发动治疗魔法的治疗量提高，且受到魔法攻击的伤害减少",id:317,icon:12828,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!0},{name:"炽天的幻光",description:"发动治疗魔法的治疗量提高，且受到魔法攻击的伤害减少",id:1875,icon:12847,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!0},{name:"生命回生法",description:"体力最大值提高，同时自身所受体力恢复效果提高",id:2710,icon:12815,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"怒涛之计",description:"减轻所受到的伤害",id:2711,icon:12816,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"命运之轮",description:"减轻所受到的伤害",id:849,icon:13226,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"天星交错",description:"抵消一定伤害",id:1889,icon:13250,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"擢升",description:"减轻所受到的伤害",id:2717,icon:13262,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"中间学派",description:"抵消一定伤害",id:1921,icon:13255,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"均衡诊断",description:"抵消一定伤害",id:2607,icon:12954,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"齐衡诊断",description:"抵消一定伤害",id:2608,icon:12955,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"均衡预后",description:"抵消一定伤害",id:2609,icon:12954,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"坚角清汁",description:"减轻所受到的伤害",id:2618,icon:12964,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"白牛清汁",description:"减轻所受到的伤害",id:2619,icon:12965,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"整体论",description:"减轻所受到的伤害",id:3003,icon:12971,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"整体盾",description:"抵消一定伤害",id:3365,icon:12972,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"输血",description:"抵消一定伤害",id:2612,icon:12958,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"泛输血",description:"抵消一定伤害",id:2613,icon:12959,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"心眼",description:"下次受到攻击时所受到的伤害减轻",id:1232,icon:13307,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"金刚极意",description:"减轻所受到的一部分伤害",id:1179,icon:12527,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"行吟",description:"减轻所受到的伤害",id:1934,icon:12615,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"策动",description:"减轻所受到的伤害",id:1951,icon:13021,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"防守之桑巴",description:"减轻所受到的伤害",id:1826,icon:13715,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"即兴表演结束",description:"抵消一定伤害",id:2697,icon:13721,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"残影",description:"抵消一定伤害",id:488,icon:10605,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"魔罩",description:"抵消一定伤害",id:168,icon:10456,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"守护之光",description:"抵消一定伤害",id:2702,icon:12691,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"守护纹",description:"抵消一定伤害",id:2597,icon:12934,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"抗死",description:"减轻所受到的魔法伤害，同时自身所受体力恢复效果提高",id:2707,icon:13408,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!0},{name:"雪仇",description:"攻击所造成的伤害降低",id:1193,icon:13901,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!1},{name:"牵制",description:"物理攻击和魔法攻击所造成的伤害降低",id:1195,icon:13904,type:"multiplier",performance:{physics:1,magic:.5,darkness:0},isFriendly:!1},{name:"昏乱",description:"物理攻击和魔法攻击所造成的伤害降低",id:1203,icon:13917,type:"multiplier",performance:{physics:.5,magic:1,darkness:0},isFriendly:!1},{name:"武装解除",description:"攻击所造成的伤害降低",id:860,icon:13009,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!1},{name:"减速",description:"战技与魔法的咏唱及复唱时间延长",id:9,icon:15009,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!1},{name:"体力增加",description:"体力最大值提高",id:2120,icon:13523,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"腐臭",description:"造成的伤害降低",id:1715,icon:13502,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!1},{name:"智力精神降低",description:"智力与精神有所降低",id:2115,icon:13518,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!1},{name:"龙之力",description:"受到的伤害降低",id:2500,icon:13539,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"超硬化",description:"无法自由活动，但受到攻击的伤害减少",id:1722,icon:13509,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"玄结界",description:"减轻所受到的伤害，受到一定伤害后将附加玄天武水壁状态",id:2496,icon:13535,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"仙人盾",description:"受到的伤害降低",id:2119,icon:13522,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"强力守护",description:"令自身所受到的伤害减少，同时会以攻击力降低为代价提高自身仇恨",id:1719,icon:13506,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"哥布防御",description:"抵消一定伤害",id:2114,icon:13517,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"铜墙铁盾",description:"减轻所受到的伤害",id:194,icon:16306,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"坚守要塞",description:"减轻所受到的伤害",id:195,icon:16306,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"终极堡垒",description:"减轻所受到的伤害",id:196,icon:16306,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初大地",description:"减轻所受到的伤害",id:863,icon:16306,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"暗黑之力",description:"减轻所受到的伤害",id:864,icon:16306,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"灵魂之青",description:"减轻所受到的伤害",id:1931,icon:16306,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0}],ue=new Map;let De;function fe(C){if(De!==C){const m=C==="Chinese"?Se:Object.assign(Se,{});ue.clear();for(const x of m)x.fullIcon=je(x.icon),ue.set(x.id.toString(16).toUpperCase(),x);De=C}}fe("Chinese");function Ai(C){return ue.get(C)}const $i=C=>C===1?"useful":C===0?"unuseful":"half-useful",Si=/(?:耐性|防御力)(?:大幅)?(?:降低|提升|低下|下降)|受伤(?:加重|减轻)|体力(?:增加|衰减|减少)|伤害屏障/,Di=/(?:精神|力量|灵巧|智力){1,2}(?:大幅)?降低/,Le=(C,m)=>Object.entries(Ti).reduce((x,[b,[a,D]])=>(C.test(a)&&x.set(b,{name:a,icon:D,isFriendly:m}),x),new Map),Hi=Le(Si,!0),ji=Le(Di,!1),Li={key:0,class:"testLog"},He="souma-keigenn-record-2",Wi=di({__name:"keigennRecord2",setup(C){const m=mi("hash"),x=_(m.dev==="1"||m.dev===void 0&&!window.OverlayPluginApi&&!m.OVERLAY_WS&&!m.HOST_PORT);x.value&&setTimeout(()=>{x.value=m.dev==="1"||m.dev===void 0&&!window.OverlayPluginApi&&!m.OVERLAY_WS&&!m.HOST_PORT},1e3);function b(e,i){return typeof i=="boolean"?e==="0"?!1:e==="1"?!0:i:typeof i=="number"?isNaN(+e)?i:+e:i}const a={scale:b(m.scale,1),showHeader:b(m.showHeader,!0),showIcon:b(m.showIcon,!0),showName:b(m.showName,!1),abbrId:b(m.abbrId,!0),anonymous:b(m.anonymous,!0),replaceWithYou:b(m.replaceWithYou,!1),parseAA:b(m.parseAA,!0),parseDoT:b(m.parseDoT,!1),minimize:b(m.minimize,!1),actionCN:b(m.actionCN,!0),statusCN:b(m.statusCN,!0)},D=ce(()=>a.actionCN?"actionCN":"action"),M=_(a.minimize),Pe=a.scale>=2||window.devicePixelRatio>=2?"_hr1":"",B={line_height:28*a.scale,time:35*a.scale,action:65*a.scale,target:((a.showIcon?24:0)+(a.showName?a.anonymous||!a.anonymous&&a.abbrId?24:36:0)+7)*a.scale,amount:44*a.scale},Me={"--vxe-font-size-mini":12*a.scale+"px","--vxe-table-row-line-height":30*a.scale+"px","--vxe-table-row-height-mini":30*a.scale+"px","--vxe-input-height-mini":20*a.scale+"px","--vxe-select-option-height-mini":24*a.scale+"px"},ye={runtime:99,localStorage:3},ae=_(!1),Y=_(),K=L("keigenn-record-2-pov-name",""),H=L("keigenn-record-2-pov-id",""),se=L("keigenn-record-2-party-list",[]),O=L("keigenn-record-2-job-map",{}),Q=L("keigenn-record-2-party-event-party",[]),w=_(0),l=_([{zoneName:"",duration:"00:00",table:[],key:"init"}]),ge={rsv:/^262\|(?<timestamp>[^|]*)\|[^|]*\|[^|]*\|_rsv_(?<id>\d*)[^|]*\|(?<real>[^|]*)\|/i,ability:S.ability(),statusEffectExplicit:S.statusEffectExplicit(),gainsEffect:S.gainsEffect(),losesEffect:S.losesEffect(),inCombat:/^260\|(?<timestamp>[^|]*)\|(?<inACTCombat>[^|]*)\|(?<inGameCombat>[^|]*)\|/i,changeZone:S.changeZone(),partyList:/^11\|(?<timestamp>[^|]*)\|(?<partyCount>\d*)\|(?<list>(?:\w{8}\|){0,})\w{16}/i,primaryPlayer:/^02\|(?<timestamp>[^|]*)\|(?<id>[^|]*)\|(?<name>[^|]*)/,addCombatant:S.addedCombatant(),removingCombatant:S.removingCombatant(),networkDoT:S.networkDoT()},k=_(0),be=L("souma-keigenn-record-2-zone-name",""),he=L("souma-keigenn-record-2-rsv-data",{}),re={},N={friendly:{},enemy:{}},Oe=e=>{e.table.length=0,e.zoneName="",e.duration="00:00",e.key="init"},ze=()=>{ae.value=!0,k.value=0,w.value=0,l.value.length=1,Oe(l.value[0])},Re=()=>{Ie(),ae.value=!1},ve=e=>{ke(e.rawLine)},ke=e=>{var i,c,o;for(const h in ge){const g=ge[h].exec(e);if(g){const t=e.split("|");switch(h){case"statusEffectExplicit":g.groups.targetId.startsWith("1")&&(re[g.groups.targetId]=g.groups.currentShield);break;case"gainsEffect":{const r=t[n.GainsEffect.fields.effectId],d=t[n.GainsEffect.fields.effect],p=t[n.GainsEffect.fields.target],f=t[n.GainsEffect.fields.targetId],T=Number(t[n.GainsEffect.fields.count]);let v=Ai(r);if(!v){const I=f.startsWith("1")&&Hi.get(parseInt(r,16).toString())||f.startsWith("4")&&ji.get(parseInt(r,16).toString());if(!I)return;const W=je(I.icon),V=T>1?_i(W,T):W;v={type:"multiplier",performance:{physics:1,magic:1,darkness:1},id:parseInt(r,16),icon:I.icon,fullIcon:V,name:I.name,isFriendly:I.isFriendly}}const R=t[n.GainsEffect.fields.duration],E=t[n.GainsEffect.fields.source],$=t[n.GainsEffect.fields.sourceId],G=new Date(t[n.GainsEffect.fields.timestamp]).getTime()+parseFloat(R)*1e3,U={name:v.name,count:T,effect:d,effectId:r,source:E,sourceId:$,target:p,targetId:f,expirationTimestamp:G,performance:v.performance,fullIcon:v.fullIcon,isPov:H.value===$};f.startsWith("1")&&v.isFriendly?((i=N.friendly)[f]??(i[f]={}))[r]=U:f.startsWith("4")&&!v.isFriendly&&(((c=N.enemy)[p]??(c[p]={}))[r]=U)}break;case"losesEffect":{const r=t[n.LosesEffect.fields.target],d=t[n.LosesEffect.fields.targetId],p=t[n.LosesEffect.fields.effectId];d.startsWith("1")?N.friendly[d]&&Reflect.deleteProperty(N.friendly[d],p):N.enemy[r]&&Reflect.deleteProperty(N.enemy[r],p)}break;case"addCombatant":if(t[n.AddedCombatant.fields.job]!=="00"){const r=t[n.AddedCombatant.fields.job],d=new Date(t[n.AddedCombatant.fields.timestamp]).getTime();O.value[t[n.AddedCombatant.fields.id]]={job:parseInt(r,16),timestamp:d}}break;case"removingCombatant":Reflect.deleteProperty(O.value,t[n.RemovedCombatant.fields.id]);break;case"primaryPlayer":H.value=t[n.ChangedPlayer.fields.id];const ee=t[n.ChangedPlayer.fields.name];if(K.value===ee)return;K.value=ee,Ne(t[n.ChangedPlayer.fields.name]);break;case"partyList":se.value=((o=g.groups.list)==null?void 0:o.split("|"))??[];break;case"changeZone":be.value=t[n.ChangeZone.fields.name],xe(new Date(t[n.ChangeZone.fields.timestamp]).getTime());break;case"inCombat":{const r=t[n.InCombat.fields.inACTCombat]==="1",d=t[n.InCombat.fields.inGameCombat]==="1",p=new Date(t[n.InCombat.fields.timestamp]).getTime();if(r||d){if(k.value>0)return;l.value[0].table.length!==0&&(l.value[0]=ki(l.value[0]),l.value.unshift({zoneName:"",duration:"00:00",table:[],key:t[n.InCombat.fields.timestamp]}),l.value.length>=ye.runtime&&l.value.splice(l.value.length-1,1)),k.value=p,l.value[0].zoneName=be.value,w.value=0;return}if(!r&&!d){xe(p);return}}break;case"rsv":{const r=Number(g.groups.id),d=t[n.RSVData.fields.value];he.value[Number(r)]=d}break;case"networkDoT":if(!a.parseDoT)return;{const r=t[n.NetworkDoT.fields.which],d=t[n.NetworkDoT.fields.id];if(r!=="DoT"||d.startsWith("4")||!(d===H.value||se.value.includes(d)||Q.value.find(V=>V.id===d)))return;const p=t[n.NetworkDoT.fields.name],f=t[n.NetworkDoT.fields.damage],T=parseInt(f,16),v=new Date(t[n.Ability.fields.timestamp]??"???").getTime(),R=Number(t[n.NetworkDoT.fields.currentHp]),E=Number(t[n.NetworkDoT.fields.maxHp]),$=k.value===0?0:v-k.value,ie=X($),G=Fe(d),U=P.nameToFullName(P.jobEnumToJob(G)).simple2,I=G,W=P.jobEnumToIcon(I).toLocaleLowerCase();Ce({timestamp:v,time:ie,id:void 0,action:r,actionCN:r,source:"",target:p,targetId:d,job:U,jobIcon:W,jobEnum:I,amount:T,keigenns:[],currentHp:R,maxHp:E,effect:"damage done",type:"dot",shield:re[d],povId:H.value})}break;case"ability":if(k.value===0)return;{const r=Ii(t);if(r.isAttack&&r.amount>=0){const d=t[n.Ability.fields.sourceId]??"???",p=t[n.Ability.fields.targetId]??"???";if(!(d.startsWith("4")&&p.startsWith("1"))||!(p===H.value||se.value.includes(p)||Q.value.find(j=>j.id===p)))return;const f=new Date(t[n.Ability.fields.timestamp]??"???").getTime(),T=t[n.Ability.fields.ability],v=T.match(/^_rsv_(?<id>\d+)_/),R=t[n.Ability.fields.id]??"???";let E=T;if(v){const j=Number(v.groups.id);E=he.value[j]??T.match(/^_(?<id>rsv_\d+)_/).groups.id}else if(E=E.replace(/unknown_.*/,"攻击"),a.parseAA===!1&&/^攻击|攻撃|[Aa]ttack$/.test(E))return;const $=wi(parseInt(R,16)),ie=$&&$!==""?$:E,G=Number(t[n.Ability.fields.targetCurrentHp])??"???",U=Number(t[n.Ability.fields.targetMaxHp])??"???",I=t[n.Ability.fields.source]??"???",W=t[n.Ability.fields.target]??"???",{effect:V,type:ai}=Ni(r.flags),si=k.value===0?0:f-k.value,ri=X(si),Te=Fe(p),oi=P.nameToFullName(P.jobEnumToJob(Te)).cn.substring(0,2),_e=Te,ci=P.jobEnumToIcon(_e).toLocaleLowerCase(),li=Ei(Object.values(N.friendly[p]??[]).concat(Object.values(N.enemy[I]??[])).filter(j=>{const te=Math.max(0,(j.expirationTimestamp-f)/1e3);return j.remainingDuration=te>=999?"":te.toFixed(te>.05&&te<.95?1:0),Number(j.remainingDuration)>-3}));Ce({timestamp:f,time:ri,id:R,action:E,actionCN:ie,source:I,target:W,targetId:p,job:oi,jobIcon:ci,jobEnum:_e,amount:r.amount,keigenns:li,currentHp:G,maxHp:U,effect:V,type:ai,shield:re[g.groups.targetId],povId:H.value}),l.value[0].duration=X(new Date(t[n.Ability.fields.timestamp]).getTime()-k.value)}break}}}}},Fe=e=>{const i=O.value[e],c=Q.value.find(o=>o.id===e)??{job:0,timestamp:0};return[i,c].sort((o,h)=>h.timestamp-o.timestamp)[0].job},Ce=e=>{l.value[0].table.unshift(e)},xe=e=>{k.value!==0&&(l.value[0].duration=X(e-k.value),k.value=0,N.friendly={},N.enemy={},Ie())},Ie=()=>{localStorage.setItem(He,JSON.stringify(l.value.slice(0,ye.localStorage)))},Ge=()=>{const e=localStorage.getItem(He);if(e)try{const i=JSON.parse(e);l.value.length=0,l.value.push(...i)}catch(i){console.error(i)}},X=e=>{const i=Math.max(Math.floor(e/6e4),0),c=Math.max(Math.floor((e-i*6e4)/1e3),0);return`${i<10?"0":""}${i}:${c<10?"0":""}${c}`},Ue=ce(()=>{const e=new Set(l.value[w.value].table.map(i=>a.actionCN?i.actionCN:i.action));return Array.from(e).map(i=>({label:i,value:i}))}),We=ce(()=>{const e={},i=new Set(l.value[w.value].table.slice().sort((c,o)=>P.enumSortMethod(c.jobEnum,o.jobEnum)).map(c=>(e[c.target]=c.job,c.target)));return Array.from(i).map(c=>({label:`${e[c]}（${c}）`,value:c}))});let oe=e=>e;const Ne=e=>{/^([A-Z])\S+ ([A-Z])\S+$/.test(e)?(a.abbrId&&(oe=i=>i.replace(/^([A-Z])\S+ ([A-Z])\S+$/,"$1.$2.")),fe("Global")):(a.abbrId&&(oe=i=>i.substring(0,2)),fe("Chinese"))};Ne(K.value);const Ee=e=>{const i=e.target;i.src.includes("cafemaker.wakingsands.com")?i.src=i.src.replace("cafemaker.wakingsands.com","xivapi.com"):i.src.includes("xivapi.com")&&(i.src="")},Be=e=>{K.value=e.charName,H.value=e.charID.toString(16).toUpperCase()},Ve=e=>{Q.value=e.party.map(i=>({...i,timestamp:Date.now()}))};pi(()=>{for(const e in O.value){const i=O.value[e];Date.now()-i.timestamp>1e3*60*60*24*1&&Reflect.deleteProperty(O.value,e)}Ge(),addOverlayListener("LogLine",ve),addOverlayListener("PartyChanged",Ve),addOverlayListener("ChangePrimaryPlayer",Be),startOverlayEvents()}),ui(()=>{removeOverlayListener("LogLine",ve)});const Ze=({row:e})=>s("div",null,[s("span",{class:"target"},[a.showIcon&&s("img",{class:"jobIcon",src:`//cafemaker.wakingsands.com/cj/companion/${e.jobIcon}.png`,alt:"","data-job":a.showName?"":e.job,onError:Ee,loading:"lazy"},null),a.showName&&s("span",{class:`job ${e.jobIcon} ${e.targetId===e.povId?"YOU":""}`,style:!a.abbrId&&a.showName?{overflow:"hidden",textOverflow:"ellipsis"}:{}},[e.targetId===e.povId&&a.replaceWithYou?"YOU":a.anonymous?e.job:oe(e.target)])])]),Je=({row:e})=>s(Fi,{"append-to":".wrapper",effect:"dark",placement:"right-start",title:"",trigger:"hover",enterable:!1,"hide-after":0,"popper-class":"my-el-popover"},{default:()=>[s(Ye,{row:e},null)],...{reference:()=>s("span",{class:"amount"},[s("span",{class:`${e.type}`},[s("span",{class:`${Qe(e)?"lethal":""}`},[e.amount.toLocaleString().padStart(3,"　")])])])}}),Ye=({row:e})=>s("div",null,[s("span",null,[F("盾:"),Math.round(e.maxHp*+e.shield/100),F(" ("),e.shield,F("%)")]),s("br",null,null),s("span",null,[F("HP:"),e.currentHp,F("/"),e.maxHp,F(" ("),Math.round(e.currentHp/e.maxHp*100),F("%)")]),s("br",null,null),s("span",null,[F("来源:"),e.source]),s("br",null,null),s("span",null,[F("受到伤害:"),e.amount]),s("br",null,null),s("span",null,[F("剩余HP:"),e.currentHp-e.amount,F(" ("),Math.round((e.currentHp-e.amount)/e.maxHp*100),F("%)")])]),Ke=[409 .toString(16).toUpperCase(),810 .toString(16).toUpperCase(),811 .toString(16).toUpperCase(),1836 .toString(16).toUpperCase()],Qe=e=>e.currentHp-e.amount<0&&!e.keigenns.find(i=>Ke.includes(i.effectId)),Xe=({row:e})=>s(me,null,[e.type==="dot"?"（不支持）":e.keigenns.map(i=>s("span",{class:"status",title:`${i.name}(${i.source})`,"data-duration":i.remainingDuration,"data-sourcePov":i.isPov},[s("img",{class:`statusIcon ${$i(i.performance[e.type])}`,src:`//cafemaker.wakingsands.com/i/${i.fullIcon}${Pe}.png`,alt:i.effect,onError:Ee,loading:"lazy"},null)])),s("span",null,[e.effect==="damage done"?"":pe(e.effect)])]),qe=e=>{const{action:i,actionCN:c,amount:o,job:h,keigenns:y,source:g,target:t,time:ee,type:r}=e,d=e.effect==="damage done"?"":","+pe(e.effect),p=`${ee} [${h}]${t} HP:${e.currentHp}/${e.maxHp}(${Math.round(e.currentHp/e.maxHp*100)}%) + 护盾:${Math.round(e.maxHp*+e.shield/100)}(${e.shield}%) 受到${g}“${i}${c!==i?"("+c+")":""}”的${o.toLocaleString()}点${pe(r)}伤害。剩余HP:${e.currentHp-e.amount}(${Math.round((e.currentHp-e.amount)/e.maxHp*100)}%)。减伤：${y.length===0&&d===""?"无":y.map(f=>a.statusCN?f.name:f.effect).join(",")+d}。`;ei(p)},ei=e=>{navigator.clipboard.writeText(e).catch(()=>{const i=document.createElement("input");i.value=e,document.body.appendChild(i),i.select(),document.execCommand("copy"),document.body.removeChild(i)}),$e.modal.message({content:"已复制到剪贴板",status:"success"})},A=_({target:!1,action:!1}),z=_(),q=fi({className:"my-menus",body:{options:[]}});yi(()=>{var e,i,c;q.body&&q.body.options&&Y.value&&(q.body.options[0]=[{code:"copy",name:"复制详情",prefixIcon:"vxe-icon-copy",className:"my-copy-item"},{code:"clearFilterAction",name:"取消技能筛选",prefixIcon:"vxe-icon-funnel-clear",className:"my-clear-filter",visible:A.value.action,disabled:!1},{code:"filterSelectAction",name:(e=z.value)!=null&&e[D.value]?`只看 ${(i=z.value)==null?void 0:i[D.value]}`:"只看该技能",prefixIcon:"vxe-icon-info-circle",visible:!A.value.action,disabled:!1},{code:"clearFilterTarget",name:"取消玩家筛选",prefixIcon:"vxe-icon-funnel-clear",visible:A.value.target,disabled:!1},{code:"filterSelectTarget",name:(c=z.value)!=null&&c.target?`只看[${z.value.job}] ${z.value.target}`:"只看该玩家",prefixIcon:"vxe-icon-user-fill",visible:!A.value.target,disabled:!1}])});const ii=()=>{M.value=!M.value},ti=({row:e})=>{const i=Y.value;i&&(i.setCurrentRow(e),z.value=e)},ni=({menu:e,row:i,column:c})=>{const o=Y.value;switch(e.code){case"copy":if(!i){$e.modal.message({content:"未选中有效数据行",status:"error"});return}qe(i);break;case"clearFilterTarget":o&&(o.clearFilter(o.getColumnByField("target")),A.value.target=!1);break;case"clearFilterAction":o&&(o.clearFilter(o.getColumnByField(D.value)),A.value.action=!1);break;case"filterSelectTarget":if(o){const h=o.getColumnByField("target");if(h){const y=h.filters.find(g=>g.value===i.target);if(!y)return;y.checked=!0,o.updateData().then(()=>{o.scrollToRow(i),A.value.target=!0})}}break;case"filterSelectAction":if(o){const h=o.getColumnByField(D.value);if(h){const y=h.filters.find(g=>g.value===i[D.value]);if(!y)return;y.checked=!0,o.updateData().then(()=>{o.scrollToRow(i),A.value.action=!0})}}break}};return(e,i)=>{const c=Z("vxe-option"),o=Z("vxe-select"),h=Z("vxe-button"),y=Z("vxe-column"),g=Z("vxe-table");return ne(),le(me,null,[de("div",{class:"wrapper",style:Me},[de("header",null,[we(s(o,{modelValue:u(w),"onUpdate:modelValue":i[0]||(i[0]=t=>bi(w)?w.value=t:null),size:"mini",class:"select"},{default:J(()=>[(ne(!0),le(me,null,gi(u(l).length,t=>(ne(),Ci(c,{key:`${u(l)[t-1].key}-${u(l)[t-1].duration}-${u(l)[t-1].zoneName}`,value:t-1,label:`${u(l)[t-1].duration} ${u(l)[t-1].zoneName}`},null,8,["value","label"]))),128))]),_:1},8,["modelValue"]),[[Ae,!u(M)]]),s(h,{class:"minimize",icon:u(M)?"vxe-icon-fullscreen":"vxe-icon-minimize",onClick:ii,style:hi({opacity:u(M)?.5:1})},null,8,["icon","style"])]),we(de("main",null,[s(g,{ref_key:"xTable",ref:Y,size:"mini",class:"vxe-table","show-overflow":"",round:"",height:"100%","scroll-y":{enabled:!0},loading:u(ae),"show-header":a.showHeader,data:u(l)[u(w)].table,"row-config":{isHover:!0,height:B.line_height},"header-cell-style":{padding:"0px"},onCellMenu:ti,"menu-config":u(q),onMenuClick:ni},{default:J(()=>[s(y,{width:B.time,field:"time",title:"时间",align:"center"},null,8,["width"]),s(y,{width:B.action,field:a.actionCN?"actionCN":"action",title:"技能",filters:u(Ue),"filter-multiple":!1,resizable:!1,align:"center"},null,8,["width","field","filters"]),s(y,{width:B.target,field:"target",title:a.showName?"目标":"目",filters:u(We),"filter-multiple":!1,resizable:!a.anonymous&&!a.abbrId,align:"left","header-align":"center"},{default:J(({row:t})=>[s(Ze,{row:t},null,8,["row"])]),_:1},8,["width","title","filters","resizable"]),s(y,{width:B.amount,title:"伤害","header-align":"center"},{default:J(({row:t})=>[s(Je,{row:t},null,8,["row"])]),_:1},8,["width"]),s(y,{title:"减伤",align:"left"},{default:J(({row:t})=>[s(Xe,{row:t},null,8,["row"])]),_:1})]),_:1},8,["loading","show-header","data","row-config","menu-config"])],512),[[Ae,!u(M)]])]),u(x)?(ne(),le("div",Li,[s(xi,{onBeforeHandle:ze,onAfterHandle:Re,onHandleLine:ke})])):vi("",!0)],64)}}});export{Wi as default};
