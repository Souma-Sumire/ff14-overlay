import{d as H,A as k,C as T,o as m,b as _,J as A,K as D,a as w,w as R,u as n,R as z,t as E,aG as ae,B as oe,_ as ne,F as re,r as M,a3 as se,g as f,aH as le,h as F,H as G,i as ie,p as ce,l as ue,c as de}from"./vendor-bfd3a191.js";import{U as r,j as pe}from"./util-ef9ccf87.js";import{_ as K}from"./index-be2522ee.js";import{a as U,c as me}from"./overlay_plugin_api-409cb9ea.js";const fe={flex:"~ col"},_e=H({__name:"dragJob",props:{party:{}},emits:["updateSortArr"],setup(j,{emit:b}){const p=k(),g=k(!0),S=b,L=j,I=()=>{S("updateSortArr",Object.values(v.value).flat().map(o=>o.id))},a=[{name:"tank",color:"blue"},{name:"healer",color:"green"},{name:"dps",color:"red"},{name:"crafter",color:"yellow"},{name:"gatherer",color:"purple"},{name:"none",color:"gray"}];function N(o){return L.party.find(d=>d.job===o)}const x=r.getBattleJobs3(),V=["tank","healer","dps","crafter","gatherer","none"],J=(()=>{const o={},d={tank:r.isTankJob,healer:r.isHealerJob,dps:r.isDpsJob,crafter:r.isCraftingJob,gatherer:r.isGatheringJob};for(const s of V)o[s]=(s==="none"?[]:x.filter(i=>d[s](i))).map(i=>r.jobToJobEnum(i)).sort((i,c)=>r.enumSortMethod(i,c));return o})(),y=Object.values(J).flat().map(o=>({name:r.nameToFullName(r.jobEnumToJob(o)).simple1,id:o})),v=T("cactbotRuntime-jobList",(()=>{const o={};for(const d of V)o[d]=y.filter(s=>J[d].includes(s.id)).sort((s,i)=>J[d].indexOf(s.id)-J[d].indexOf(i.id));return o})());return(o,d)=>(m(),_("div",fe,[(m(),_(A,null,D(a,(s,i)=>w(n(ae),{key:i,ref_for:!0,ref_key:"el",ref:p,disabled:!g.value,modelValue:n(v)[s.name],"onUpdate:modelValue":c=>n(v)[s.name]=c,animation:"150",ghostClass:"ghost",class:"flex flex-row gap-0.25 p-0 m-t-0.25 m-b-0.25 rounded",onUpdate:I,filter:".no-draggable",forceFallback:!0},{default:R(()=>[(m(!0),_(A,null,D(n(v)[s.name],c=>(m(),_("div",{key:c.id,class:z(`${N(c.id)?`draggable bg-${s.color} cursor-move`:"no-draggable bg-gray-700/50"} rounded p-l-0.6 p-r-0.6 p-t-0 p-b-0.3 m-0 color-white`)},E(c.name),3))),128))]),_:2},1032,["disabled","modelValue","onUpdate:modelValue"])),64))]))}});const be=K(_e,[["__scopeId","data-v-9039b8ac"]]),B=j=>(ce("data-v-3bc196c6"),j=j(),ue(),j),ye=B(()=>f("span",null,"用法",-1)),ve=B(()=>f("p",null,"使悬浮窗的位置分配对应游戏内的实际位置（D1D2等）",-1)),ge=B(()=>f("ul",null,[f("li",null,"临时：下拉选择框修改。"),f("li",null,"长期：用鼠标拖动职能顺序。")],-1)),he={class:"players"},je={class:"name"},xe={key:0,style:{position:"fixed",bottom:"0"}},Je=H({__name:"cactbotRuntime",setup(j){const b=(e,t)=>Array(t).fill(e).map((l,C)=>l+(+C+1)),p={tank:["MT","ST",...b("T",6)],healer:[...b("H",8)],dps:[...b("D",8)],crafter:[...b("C",8)],gatherer:[...b("G",8)],none:[...b("N",8)]},g=k(!1),S=T("cactbotRuntime-sortArr",pe),L=[{id:"10000001",name:"虚构战士",job:21,inParty:!0},{id:"10000002",name:"虚构骑士",job:19,inParty:!0},{id:"10000003",name:"虚构占星",job:33,inParty:!0},{id:"10000004",name:"虚构学者",job:28,inParty:!0},{id:"10000005",name:"虚构忍者",job:30,inParty:!0},{id:"10000006",name:"虚构武士",job:34,inParty:!0},{id:"10000007",name:"虚构SMN",job:27,inParty:!0},{id:"10000008",name:"虚构BRD",job:23,inParty:!0}],a=T("cactbotRuntime-data",{party:[]}),N=T("cactbotRuntime-showTips",k(!0)),x=oe({tank:0,healer:0,dps:0,crafter:0,gatherer:0,none:0});function V(){for(const e in x)Object.prototype.hasOwnProperty.call(x,e)&&(x[e]=a.value.party.reduce((t,l)=>o(l.job)===e?t+1:t,0))}const J=e=>{const t=o(e);return p[t].filter((l,C)=>C<x[t])},P=location.href.includes("localhost"),y=k(!1),v=k(P?"虚构SMN":""),o=e=>{const t=Number(e);return[1,3,19,21,32,37].includes(t)?"tank":[6,24,28,33,40].includes(t)?"healer":[2,4,5,7,20,22,23,25,26,27,29,30,31,34,35,36,38,39].includes(t)?"dps":r.isCraftingJob(r.jobEnumToJob(e))?"crafter":r.isGatheringJob(r.jobEnumToJob(e))?"gatherer":"none"},d=()=>{a.value.party.sort((e,t)=>S.value.indexOf(e.job)-S.value.indexOf(t.job));for(const e of a.value.party)e.rp=void 0,e.rp=i(e)},s=e=>{a.value.party[e].specify=!0;const t=a.value.party.find(l=>l.rp===a.value.party[e].rp&&l.id!==a.value.party[e].id);t&&(t.rp=i(t),t.specify=!0),c()},i=e=>p[o(e.job)].find(t=>!a.value.party.find(l=>l.rp===t))??"unknown",c=()=>{const e=[...p.tank,...p.healer,...p.dps,...p.crafter,...p.gatherer,...p.none];a.value.party.sort((t,l)=>e.indexOf(t.rp??"")-e.indexOf(l.rp??"")),me({call:"broadcast",source:"soumaRuntimeJS",msg:{party:a.value.party}})},q=()=>{y.value=!0},Q=()=>{y.value=!1},W=e=>{S.value=e,$()},X=e=>r.nameToFullName(r.jobEnumToJob(e)).simple1,Y=e=>e,$=()=>{d(),V(),c()};return ne(()=>a.value.party,()=>{$()},{immediate:!0}),re(()=>{c(),U("PartyChanged",e=>{N.value&&(g.value=!0),!(P&&e.party.length===0)&&(a.value.party=e.party.filter(t=>t.inParty).map(t=>({...t,rp:"",specify:!1})))}),U("ChangePrimaryPlayer",e=>{P||(v.value=e.charName)}),U("BroadcastMessage",e=>{e.source==="soumaUserJS"&&typeof e.msg=="object"&&e.msg!==null&&Reflect.get(e.msg,"text")==="requestData"&&c()}),startOverlayEvents()}),(e,t)=>{const l=M("vxe-modal"),C=M("vxe-option"),Z=M("vxe-select"),ee=be;return m(),_("div",{onMouseenter:q,onMouseleave:Q},[w(l,{modelValue:n(g),"onUpdate:modelValue":t[0]||(t[0]=u=>se(g)?g.value=u:null),size:"small",position:{left:10,top:10},width:"90vw",onClose:t[1]||(t[1]=u=>{g.value=!1,N.value=!1})},{title:R(()=>[ye]),default:R(()=>[ve,ge]),_:1},8,["modelValue"]),f("main",{class:z(n(y)?"mouseIn":"")},[f("div",he,[w(le,{name:"animate__animated animate__bounce","enter-active-class":"animate__fadeInLeft","leave-active-class":"animate__fadeOutLeft"},{default:R(()=>[(m(!0),_(A,null,D(n(a).party,(u,O)=>F((m(),_("section",{key:u.id,flex:"~ nowrap",class:"player"},[w(Z,{modelValue:u.rp,"onUpdate:modelValue":h=>u.rp=h,size:"mini",onChange:h=>s(O),"class-name":"select"},{default:R(()=>[(m(!0),_(A,null,D(J(u.job),(h,te)=>(m(),de(C,{key:te,value:h,label:h},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),f("span",je,E(X(u.job))+" "+E(n(y)?Y(u.name):""),1)])),[[G,n(y)||u.name===n(v)]])),128))]),_:1})]),F(w(ee,{class:"dragJob",onUpdateSortArr:W,party:n(a).party,"m-b-1":"","p-1":""},null,8,["party"]),[[G,n(y)]])],2),n(P)?(m(),_("div",xe,[f("button",{onClick:t[2]||(t[2]=u=>{n(a).party=n(a).party.filter(O=>O.name===n(v))})}," 测试单人 "),f("button",{onClick:t[3]||(t[3]=u=>{{const O={party:L};n(a).party=O.party.map(h=>({...h,rp:"",specify:!1}))}})}," 测试组队 ")])):ie("",!0)],32)}}});const Oe=K(Je,[["__scopeId","data-v-3bc196c6"]]);export{Oe as default};
