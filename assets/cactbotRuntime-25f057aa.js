import{d as K,A as x,C as S,r as N,o as m,b as y,a as w,w as V,I as ae,J as M,K as E,u as o,h as D,R as oe,t as B,H as U,aG as ne,F as re,g as p,a3 as le,aH as se,S as q,i as ie,p as ue,l as ce,c as de}from"./vendor-cc98dd31.js";import{U as l,j as pe}from"./util-ef9ccf87.js";import{_ as Q}from"./index-6834f2cf.js";import{a as z,c as fe}from"./overlay_plugin_api-409cb9ea.js";const me={flex:"~ col",style:{position:"relative"}},_e=K({__name:"dragJob",props:{party:{}},emits:["updateSortArr"],setup(j,{emit:b}){const _=j,C=b,A=x(),H=x(!0),a=x(!1),h=[{role:"tank",color:"blue"},{role:"healer",color:"green"},{role:"dps",color:"red"},{role:"crafter",color:"yellow"},{role:"gatherer",color:"purple"},{role:"none",color:"gray"}];function k(r){return _.party.find(s=>s.job===r)}const f=l.getBattleJobs3(),J=(()=>{const r={},s={tank:l.isTankJob,healer:l.isHealerJob,dps:l.isDpsJob,crafter:l.isCraftingJob,gatherer:l.isGatheringJob};for(const i of h.map(n=>n.role))r[i]=(i==="none"?[]:f.filter(n=>s[i](n))).map(n=>l.jobToJobEnum(n)).sort((n,v)=>l.enumSortMethod(n,v));return r})(),P=Object.values(J).flat().map(r=>({name:l.nameToFullName(l.jobEnumToJob(r)).simple1,id:r})),d=S("cactbotRuntime-jobList",(()=>{const r={};for(const s of h.map(i=>i.role))r[s]=P.filter(i=>J[s].includes(i.id)).sort((i,n)=>J[s].indexOf(i.id)-J[s].indexOf(n.id));return r})());function O(){C("updateSortArr",Object.values(d.value).flat().map(r=>r.id))}return(r,s)=>{const i=N("vxe-checkbox");return m(),y("div",me,[w(i,{modelValue:a.value,"onUpdate:modelValue":s[0]||(s[0]=n=>a.value=n),size:"mini",style:{"--vxe-primary-color":"none",position:"absolute",top:"0.25rem",right:"0.25rem",background:"rgba(30, 30, 30, 0.33)",color:"white","border-radius":"0.25rem",padding:"0.08rem 0.16rem","font-size":"0.75rem","line-height":"1","box-shadow":"0 0 2px black"}},{default:V(()=>[ae(" 解除限制 ")]),_:1},8,["modelValue"]),(m(),y(M,null,E(h,(n,v)=>w(o(ne),{key:v,ref_for:!0,ref_key:"el",ref:A,modelValue:o(d)[n.role],"onUpdate:modelValue":g=>o(d)[n.role]=g,disabled:!H.value,animation:"150","ghost-class":"ghost",class:"p-0 flex flex-row gap-0.25 m-t-0.25 m-b-0.25 rounded",filter:".no-draggable","force-fallback":!0,onUpdate:O},{default:V(()=>[(m(!0),y(M,null,E(o(d)[n.role],g=>D((m(),y("div",{key:g.id,class:oe(`${a.value||k(g.id)?`draggable bg-${n.color} cursor-move`:"no-draggable bg-gray-700/50 opacity-75"} rounded p-l-0.6 p-r-0.6 p-t-0 p-b-0.3 m-0 color-white`)},B(g.name),3)),[[U,_.party.find(I=>I.job===36)?!0:g.id!==36]])),128))]),_:2},1032,["modelValue","onUpdate:modelValue","disabled"])),64))])}}});const ye=Q(_e,[["__scopeId","data-v-210b3900"]]),G=j=>(ue("data-v-69203e2c"),j=j(),ce(),j),be={class:"text-white text-shadow-sm text-shadow-color-black"},ve=G(()=>p("span",null,"用法",-1)),ge=G(()=>p("p",null,"使悬浮窗的位置分配对应游戏内的实际位置（D1D2等）",-1)),he=G(()=>p("ul",null,[p("li",null,"临时：下拉选择框修改。"),p("li",null,"长期：用鼠标拖动职能顺序。")],-1)),xe={class:"players"},je={class:"name"},ke={key:0,style:{position:"fixed",bottom:"0"}},Je=K({__name:"cactbotRuntime",setup(j){function b(e,t){return Array(t).fill(e).map((u,R)=>u+(+R+1))}const _=x(!1),C=S("cactbotRuntime-sortArr",pe),A=[{id:"10000001",name:"虚构战士",job:21,inParty:!0},{id:"10000002",name:"虚构骑士",job:19,inParty:!0},{id:"10000003",name:"虚构占星",job:33,inParty:!0},{id:"10000004",name:"虚构学者",job:28,inParty:!0},{id:"10000005",name:"虚构忍者",job:30,inParty:!0},{id:"10000006",name:"虚构武士",job:34,inParty:!0},{id:"10000008",name:"虚构诗人",job:23,inParty:!0},{id:"10000007",name:"虚构召唤",job:27,inParty:!0}],a=S("cactbotRuntime-data",{party:[]}),h=S("cactbotRuntime-showTips",x(!0)),k=S("cactbotRuntime-roleSelectLength",{tank:0,healer:0,dps:0,crafter:0,gatherer:0,none:0}),f=S("cactbotRuntime-roleAssignLocationNames",{tank:["MT","ST",...b("T",6)],healer:[...b("H",8)],dps:[...b("D",8)],crafter:[...b("C",8)],gatherer:[...b("G",8)],none:[...b("N",8)]});function J(){for(const e in k.value)Object.prototype.hasOwnProperty.call(k.value,e)&&(k.value[e]=a.value.party.reduce((t,u)=>r(u.job)===e?t+1:t,0))}function F(e){const t=r(e);return f.value[t].filter((u,R)=>R<k.value[t])}const P=location.href.includes("localhost"),d=x(!1),O=x(P?A[2].name:"");function r(e){return[1,3,19,21,32,37].includes(e)?"tank":[6,24,28,33,40].includes(e)?"healer":[2,4,5,7,20,22,23,25,26,27,29,30,31,34,35,36,38,39].includes(e)?"dps":l.isCraftingJob(l.jobEnumToJob(e))?"crafter":l.isGatheringJob(l.jobEnumToJob(e))?"gatherer":"none"}function s(){a.value.party.sort((e,t)=>C.value.indexOf(e.job)-C.value.indexOf(t.job));for(const e of a.value.party)e.rp=void 0,e.rp=n(e)}function i(e){a.value.party[e].specify=!0;const t=a.value.party.find(u=>u.rp===a.value.party[e].rp&&u.id!==a.value.party[e].id);t&&(t.rp=n(t),t.specify=!0),v()}function n(e){return f.value[r(e.job)].find(t=>!a.value.party.find(u=>u.rp===t))??"unknown"}function v(){const e=[...f.value.tank,...f.value.healer,...f.value.dps,...f.value.crafter,...f.value.gatherer,...f.value.none];a.value.party.sort((t,u)=>e.indexOf(t.rp??"")-e.indexOf(u.rp??"")),fe({call:"broadcast",source:"soumaRuntimeJS",msg:{party:a.value.party}})}function g(){d.value=!0}function I(){d.value=!1}function W(e){C.value=e,L()}function X(e){return l.nameToFullName(l.jobEnumToJob(e)).simple1}function Pe(e){return e}function L(){s(),J(),v()}re(()=>{v(),z("PartyChanged",e=>{h.value&&(_.value=!0),!(P&&e.party.length===0)&&(a.value.party=e.party.filter(t=>t.inParty).map(t=>({...t,rp:"",specify:!1})),L())}),z("ChangePrimaryPlayer",e=>{P||(O.value=e.charName)}),z("BroadcastMessage",e=>{e.source==="soumaUserJS"&&typeof e.msg=="object"&&e.msg!==null&&Reflect.get(e.msg,"text")==="requestData"&&v()})});function Y(){const e={party:A};h.value&&(_.value=!0),a.value.party=e.party.filter(t=>t.inParty).map(t=>({...t,rp:"",specify:!1})),L()}return(e,t)=>{const u=N("vxe-modal"),R=N("vxe-option"),Z=N("vxe-select"),ee=ye;return m(),y("div",{onMouseenter:g,onMouseleave:I},[D(p("span",be,"...",512),[[U,o(a).party.length<=1]]),w(u,{modelValue:o(_),"onUpdate:modelValue":t[0]||(t[0]=c=>le(_)?_.value=c:null),size:"small",position:{left:10,top:10},width:"90vw",onClose:t[1]||(t[1]=c=>{_.value=!1,h.value=!1})},{title:V(()=>[ve]),default:V(()=>[ge,he]),_:1},8,["modelValue"]),p("main",{style:q({width:o(d)?`${15.5+ +(o(a).party.find(c=>c.job===36)?1:0)}em`:"4em"})},[p("div",xe,[w(se,{name:"animate__animated animate__bounce","enter-active-class":"animate__fadeInLeft","leave-active-class":"animate__fadeOutLeft"},{default:V(()=>[(m(!0),y(M,null,E(o(a).party,(c,$)=>D((m(),y("section",{key:c.id,flex:"~ nowrap",style:q({opacity:o(d)?1:.5}),class:"player"},[w(Z,{modelValue:c.rp,"onUpdate:modelValue":T=>c.rp=T,size:"mini","class-name":"select",onChange:T=>i($)},{default:V(()=>[(m(!0),y(M,null,E(F(c.job),(T,te)=>(m(),de(R,{key:te,value:T,label:T},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),p("span",je,B(X(c.job))+" "+B(o(d)?c.name:""),1)],4)),[[U,o(a).party.length>1&&(o(d)||c.name===o(O))]])),128))]),_:1})]),D(w(ee,{party:o(a).party,"m-b-1":"","p-1":"",onUpdateSortArr:W},null,8,["party"]),[[U,o(d)]])],4),o(P)?(m(),y("div",ke,[p("button",{onClick:t[2]||(t[2]=c=>{o(a).party=o(a).party.filter($=>$.name===o(O)),L()})}," 测试单人 "),p("button",{onClick:Y}," 测试组队 ")])):ie("",!0)],32)}}});const Oe=Q(Je,[["__scopeId","data-v-69203e2c"]]);export{Oe as default};
