import{d as Me,s as D,A as ze,ay as Re,o as ee,b as le,f as j,p as ut,i as ft,az as yt,y as pe,x as V,v as gt,Y as ht,r as q,C as De,D as Se,u as v,a as o,w as Q,G as ue,H as bt,a0 as vt,P as kt,F as _,a5 as Ft,aA as xt,au as Ct,ax as He,c as It}from"./vendor-2418a256.js";import{_ as _t}from"./index-57c17a6e.js";import{N as R,l as s}from"./netregexes-7057d210.js";import{U as B}from"./util-f6d3a594.js";import{c as je,s as Et,a as wt}from"./status-2cacdfd9.js";import{g as Nt}from"./actionChinese-71b7e526.js";const $t=i=>(ut("data-v-d140243c"),i=i(),ft(),i),Tt={class:"upload select"},At=$t(()=>j("div",{class:"upload text"},[j("span",null,"+"),j("p",null,"上传或拖入ACT日志")],-1)),Dt=Me({__name:"testLog",emits:["handleLine","beforeHandle","afterHandle"],setup(i,{emit:r}){const c=r,l=D(null),a=D(null),E=async h=>{var N,U;(N=a.value)==null||N.classList.remove("drag");const g=h.target.files;if(!(!g||g.length==0)){c("beforeHandle");for(let H=0;H<g.length;H++)(await g[H].text()).split(`
`).forEach(P=>{c("handleLine",P)});c("afterHandle"),(U=a.value)==null||U.classList.remove("drag")}},C=h=>{var g;h.preventDefault(),(g=a.value)==null||g.classList.add("drag")},te=h=>{var g;h.preventDefault(),(g=a.value)==null||g.classList.remove("drag")};return ze(()=>{var h,g,N;(h=l.value)==null||h.addEventListener("change",E),(g=a.value)==null||g.addEventListener("dragover",C),(N=a.value)==null||N.addEventListener("dragleave",te)}),Re(()=>{var h,g,N;(h=l.value)==null||h.removeEventListener("change",E),(g=a.value)==null||g.removeEventListener("dragover",C),(N=a.value)==null||N.removeEventListener("dragleave",te)}),(h,g)=>(ee(),le("div",Tt,[j("div",{class:"upload-select",ref_key:"select",ref:a},[At,j("input",{type:"file",ref_key:"input",ref:l},null,512)],512)]))}});const St=_t(Dt,[["__scopeId","data-v-d140243c"]]);function fe(i){switch(i){case"dodge":return"闪避";case"damage done":return"击中";case"blocked damage":return"格挡";case"parried damage":return"招架";case"instant death":return"即死";case"heal":return"治疗";case"crit heal":return"暴击治疗";case"damage":return"普通";case"crit damage":return"暴击";case"direct hit damage":return"直击";case"crit direct hit damage":return"直暴";case"physics":return"物理";case"magic":return"魔法";case"darkness":return"暗黑";default:throw new Error("Unknown type")}}function Ht(i){const r=Lt(i),c=Pt(i),l=Ot(i);return{effect:r,properties:c,type:l}}function Lt(i){switch(!0){case/1$/.test(i):return"dodge";case/3$/.test(i):return"damage done";case/5$/.test(i):return"blocked damage";case/6$/.test(i):return"parried damage";case/33$/.test(i):return"instant death";case/4$/.test(i):return"heal";case/2\w{4}4$/.test(i):return"crit heal";default:throw new Error("Unknown effect flag "+i)}}function Pt(i){switch(!0){case/2\w{3}$/.test(i):return"crit damage";case/4\w{3}$/.test(i):return"direct hit damage";case/6\w{3}$/.test(i):return"crit direct hit damage";default:return"damage"}}function Ot(i){switch(!0){case/7?[1234]\w{3}[35]$|[16]$/.test(i):return"physics";case/^E$/.test(i):case/5\w{4}$/.test(i):return"magic";case/^(?:\d0)?3$/.test(i):case/6\w{4}$/.test(i):return"darkness";default:return console.error("Unknown type flag "+i),"physics"}}const Mt=["3E","113","213","313"],zt=["A10","E"],Rt=["04"],jt="36",Ut=["01","03","05","06",jt],Gt=i=>{let c=0,l=i[8]??"",a=i[8+1]??"";Mt.includes(l)&&(c+=2,l=i[8+c]??l,a=i[8+c+1]??a),zt.includes(l)&&(c+=2,l=i[8+c]??l,a=i[8+c+1]??a);const E=Vt(a),C=`00${l}`.slice(-2);return{amount:E,lowByte:C,flags:l,isHeal:Rt.includes(C),isAttack:Ut.includes(C)}},Vt=i=>{if(i===void 0)return 0;const r=i.length;if(r<=4)return 0;let c=parseInt(i.slice(0,r-4),16);if(i[r-4]==="4"){const l=parseInt(i.slice(r-2,r),16);c=c-l+(l<<16)}return c},Le=[{name:"铁壁",description:"减轻所受到的伤害",id:1191,icon:13911,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"盾阵",description:"受到攻击时必定发动格挡",id:1856,icon:12510,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"干预",description:"减轻所受到的伤害",id:1174,icon:12511,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"预警",description:"减轻所受到的伤害",id:74,icon:10151,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"武装",description:"减轻所受到的伤害",id:1176,icon:12513,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"神圣领域",description:"除特定攻击之外其他所有攻击均无效化",id:82,icon:12504,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"圣光幕帘",description:"抵消一定伤害",id:1362,icon:12509,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"圣盾阵",description:"受到攻击时必定发动格挡",id:2674,icon:12515,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"骑士的坚守",description:"减轻所受到的伤害",id:2675,icon:12516,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"壁垒",description:"受到攻击时必定发动格挡",id:77,icon:10156,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的直觉",description:"自身发动战技命中时可以恢复体力，同时减轻所受到的伤害",id:735,icon:12555,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的勇猛",description:"自身发动战技命中时可以恢复体力",id:1857,icon:12558,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的武猛",description:`附加此效果的战士受到原初的勇猛的恢复体力的效果时，会获得相当于其100%的恢复效果
另外受到攻击的伤害减少`,id:1858,icon:12559,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"战栗",description:`体力最大值提高
习得战栗效果提高后追加效果：自身所受的治疗效果提高`,id:87,icon:10254,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"复仇",description:"受到攻击的伤害减少并且受到物理攻击时会发动反击",id:89,icon:10256,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"摆脱",description:"抵消一定伤害",id:1457,icon:12557,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"死斗",description:"除特定攻击之外其他所有对自身发动的攻击均无法令体力减少到1以下",id:409,icon:10266,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的血气",description:"自身发动战技命中时可以恢复体力，同时减轻所受到的伤害",id:2678,icon:12562,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的血潮",description:"减轻所受到的伤害",id:2679,icon:12563,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的血烟",description:"抵消一定伤害",id:2680,icon:12564,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"至黑之夜",description:"抵消一定伤害",id:1178,icon:13118,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"弃明投暗",description:"减轻所受到的魔法伤害",id:746,icon:13114,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!0},{name:"暗影墙",description:"减轻所受到的伤害",id:747,icon:13113,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"暗黑布道",description:"减轻所受到的魔法伤害",id:1894,icon:13122,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!0},{name:"行尸走肉",description:`受到致命伤害时体力减为1，并附加死而不僵状态
但是对部分攻击无效`,id:810,icon:13115,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"死而不僵",description:"除特定攻击之外其他所有对自身发动的攻击均无法令体力减少到1以下",id:811,icon:13116,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"出死入生",description:"除特定攻击之外其他所有对自身发动的攻击均无法令体力减少到1以下",id:3255,icon:13124,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"献奉",description:"减轻所受到的伤害",id:2682,icon:13123,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"石之心",description:"减轻所受到的伤害",id:1840,icon:13610,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"残暴弹",description:"抵消一定伤害",id:1898,icon:13614,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"伪装",description:"招架发动率提高，减轻所受到的伤害",id:1832,icon:13602,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"星云",description:"减轻所受到的伤害",id:1834,icon:13604,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"光之心",description:"减轻所受到的魔法伤害",id:1839,icon:13609,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!0},{name:"超火流星",description:"除特定攻击之外其他所有攻击均无效化",id:1836,icon:13606,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"刚玉之心",description:"减轻所受到的伤害",id:2683,icon:13615,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"刚玉之清",description:"减轻所受到的伤害",id:2684,icon:13616,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"神祝祷",description:"抵消一定伤害",id:1218,icon:12632,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"节制",description:"减轻所受到的伤害",id:1873,icon:12633,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"水流幕",description:"减轻所受到的伤害",id:2708,icon:12638,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"鼓舞",description:"抵消一定伤害",id:297,icon:12801,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"激励",description:"抵消一定伤害",id:1918,icon:12814,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"炽天的幕帘",description:"抵消一定伤害",id:1917,icon:12848,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"野战治疗阵",description:"减轻所受到的伤害",id:299,icon:12803,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"异想的幻光",description:"发动治疗魔法的治疗量提高，且受到魔法攻击的伤害减少",id:317,icon:12828,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!0},{name:"炽天的幻光",description:"发动治疗魔法的治疗量提高，且受到魔法攻击的伤害减少",id:1875,icon:12847,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!0},{name:"生命回生法",description:"体力最大值提高，同时自身所受体力恢复效果提高",id:2710,icon:12815,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"怒涛之计",description:"减轻所受到的伤害",id:2711,icon:12816,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"命运之轮",description:"减轻所受到的伤害",id:849,icon:13226,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"天星交错",description:"抵消一定伤害",id:1889,icon:13250,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"擢升",description:"减轻所受到的伤害",id:2717,icon:13262,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"中间学派",description:"抵消一定伤害",id:1921,icon:13255,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"均衡诊断",description:"抵消一定伤害",id:2607,icon:12954,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"齐衡诊断",description:"抵消一定伤害",id:2608,icon:12955,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"均衡预后",description:"抵消一定伤害",id:2609,icon:12954,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"坚角清汁",description:"减轻所受到的伤害",id:2618,icon:12964,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"白牛清汁",description:"减轻所受到的伤害",id:2619,icon:12965,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"整体论",description:"减轻所受到的伤害",id:3003,icon:12971,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"整体盾",description:"抵消一定伤害",id:3365,icon:12972,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"输血",description:"抵消一定伤害",id:2612,icon:12958,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"泛输血",description:"抵消一定伤害",id:2613,icon:12959,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"心眼",description:"下次受到攻击时所受到的伤害减轻",id:1232,icon:13307,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"金刚极意",description:"减轻所受到的一部分伤害",id:1179,icon:12527,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"行吟",description:"减轻所受到的伤害",id:1934,icon:12615,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"策动",description:"减轻所受到的伤害",id:1951,icon:13021,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"防守之桑巴",description:"减轻所受到的伤害",id:1826,icon:13715,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"即兴表演结束",description:"抵消一定伤害",id:2697,icon:13721,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"残影",description:"抵消一定伤害",id:488,icon:10605,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"魔罩",description:"抵消一定伤害",id:168,icon:10456,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"守护之光",description:"抵消一定伤害",id:2702,icon:12691,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"守护纹",description:"抵消一定伤害",id:2597,icon:12934,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"抗死",description:"减轻所受到的魔法伤害，同时自身所受体力恢复效果提高",id:2707,icon:13408,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!0},{name:"雪仇",description:"攻击所造成的伤害降低",id:1193,icon:13901,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!1},{name:"牵制",description:"物理攻击和魔法攻击所造成的伤害降低",id:1195,icon:13904,type:"multiplier",performance:{physics:1,magic:.5,darkness:0},isFriendly:!1},{name:"昏乱",description:"物理攻击和魔法攻击所造成的伤害降低",id:1203,icon:13917,type:"multiplier",performance:{physics:.5,magic:1,darkness:0},isFriendly:!1},{name:"武装解除",description:"攻击所造成的伤害降低",id:860,icon:13009,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!1},{name:"减速",description:"战技与魔法的咏唱及复唱时间延长",id:9,icon:15009,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!1},{name:"体力增加",description:"体力最大值提高",id:2120,icon:13523,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"腐臭",description:"造成的伤害降低",id:1715,icon:13502,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!1},{name:"智力精神降低",description:"智力与精神有所降低",id:2115,icon:13518,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!1},{name:"龙之力",description:"受到的伤害降低",id:2500,icon:13539,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"超硬化",description:"无法自由活动，但受到攻击的伤害减少",id:1722,icon:13509,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"玄结界",description:"减轻所受到的伤害，受到一定伤害后将附加玄天武水壁状态",id:2496,icon:13535,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"仙人盾",description:"受到的伤害降低",id:2119,icon:13522,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"强力守护",description:"令自身所受到的伤害减少，同时会以攻击力降低为代价提高自身仇恨",id:1719,icon:13506,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"哥布防御",description:"抵消一定伤害",id:2114,icon:13517,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"铜墙铁盾",description:"减轻所受到的伤害",id:194,icon:16306,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"坚守要塞",description:"减轻所受到的伤害",id:195,icon:16306,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"终极堡垒",description:"减轻所受到的伤害",id:196,icon:16306,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初大地",description:"减轻所受到的伤害",id:863,icon:16306,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"暗黑之力",description:"减轻所受到的伤害",id:864,icon:16306,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"灵魂之青",description:"减轻所受到的伤害",id:1931,icon:16306,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0}],ye=new Map;let Pe;function ge(i){if(Pe!==i){const r=i==="Chinese"?Le:Object.assign(Le,{});ye.clear();for(const c of r)c.fullIcon=je(c.icon),ye.set(c.id.toString(16).toUpperCase(),c);Pe=i}}ge("Chinese");function Bt(i){return ye.get(i)}const Jt=i=>i===1?"useful":i===0?"unuseful":"half-useful",Yt=/(?:耐性|防御力)(?:大幅)?(?:降低|提升|低下|下降)|受伤(?:加重|减轻)|体力(?:增加|衰减|减少)|伤害屏障/,Zt=/(?:精神|力量|灵巧|智力){1,2}(?:大幅)?降低/,Ue=(i,r)=>Object.entries(Et).reduce((c,[l,[a,E]])=>(i.test(a)&&c.set(l,{name:a,icon:E,isFriendly:r}),c),new Map),Wt=Ue(Yt,!0),Kt=Ue(Zt,!1),he=(()=>typeof structuredClone=="function"?structuredClone:i=>{if(i===null||typeof i!="object")return i;if(i instanceof Date)return new Date(i.getTime());if(i instanceof RegExp)return new RegExp(i.source,i.flags);if(i instanceof Array)return i.map(c=>he(c));const r=new i.constructor;for(const c in i)i.hasOwnProperty(c)&&(r[c]=he(i[c]));return r})(),Xt={key:0,class:"testLog"},Oe="souma-keigenn-record-2",ai=Me({__name:"keigennRecord2",setup(i){const r=yt("hash"),c=D(r.dev==="1"||r.dev===void 0&&!window.OverlayPluginApi&&!r.OVERLAY_WS&&!r.HOST_PORT);c.value&&setTimeout(()=>{c.value=r.dev==="1"||r.dev===void 0&&!window.OverlayPluginApi&&!r.OVERLAY_WS&&!r.HOST_PORT},1e3);function l(e,t){return typeof t=="boolean"?e==="0"?!1:e==="1"?!0:t:typeof t=="number"?isNaN(+e)?t:+e:t}const a={scale:l(r.scale,1),showHeader:l(r.showHeader,!0),showIcon:l(r.showIcon,!0),showName:l(r.showName,!1),abbrId:l(r.abbrId,!0),anonymous:l(r.anonymous,!0),replaceWithYou:l(r.replaceWithYou,!1),parseAA:l(r.parseAA,!0),parseDoT:l(r.parseDoT,!1),minimize:l(r.minimize,!1),actionCN:l(r.actionCN,!0),statusCN:l(r.statusCN,!0)},E=pe(()=>a.actionCN?"actionCN":"action"),C=D(a.minimize),te=a.scale>=2||window.devicePixelRatio>=2?"_hr1":"",h={line_height:28*a.scale,time:40*a.scale,action:65*a.scale,target:((a.showIcon?24:0)+(a.showName?a.anonymous||!a.anonymous&&a.abbrId?24:36:0)+7)*a.scale,source:90*a.scale,amount:47*a.scale},g={"--vxe-font-size-mini":12*a.scale+"px","--vxe-table-row-line-height":30*a.scale+"px","--vxe-table-row-height-mini":30*a.scale+"px","--vxe-input-height-mini":20*a.scale+"px","--vxe-select-option-height-mini":24*a.scale+"px"},N={runtime:99,localStorage:3},U=D(),H=V("keigenn-record-2-pov-name",""),L=V("keigenn-record-2-pov-id",""),ie=V("keigenn-record-2-party-list",[]),P=V("keigenn-record-2-job-map",{}),ne=V("keigenn-record-2-party-event-party",[]),O=D(0),u=D([{zoneName:"",duration:"00:00",table:[],key:"init"}]),be={rsv:/^262\|(?<timestamp>[^|]*)\|[^|]*\|[^|]*\|_rsv_(?<id>\d*)[^|]*\|(?<real>[^|]*)\|/i,ability:R.ability(),statusEffectExplicit:R.statusEffectExplicit(),gainsEffect:R.gainsEffect(),losesEffect:R.losesEffect(),inCombat:/^260\|(?<timestamp>[^|]*)\|(?<inACTCombat>[^|]*)\|(?<inGameCombat>[^|]*)\|/i,changeZone:R.changeZone(),partyList:/^11\|(?<timestamp>[^|]*)\|(?<partyCount>\d*)\|(?<list>(?:\w{8}\|){0,})\w{16}/i,primaryPlayer:/^02\|(?<timestamp>[^|]*)\|(?<id>[^|]*)\|(?<name>[^|]*)/,addCombatant:R.addedCombatant(),removingCombatant:R.removingCombatant(),networkDoT:R.networkDoT()},w=D(0),ve=V("souma-keigenn-record-2-zone-name",""),ke=V("souma-keigenn-record-2-rsv-data",{}),de={},T={friendly:{},enemy:{}},Ge=e=>{e.table.length=0,e.zoneName="",e.duration="00:00",e.key="init"},Ve=()=>{w.value=0,O.value=0,u.value.length=1,Ge(u.value[0])},Be=()=>{Ee()},Fe=e=>{xe(e.rawLine)},xe=e=>{var t,p,m;for(const x in be){const F=be[x].exec(e);if(F){const n=e.split("|");switch(x){case"statusEffectExplicit":F.groups.targetId[0]==="1"&&(de[F.groups.targetId]=F.groups.currentShield);break;case"gainsEffect":{const d=n[s.GainsEffect.fields.effectId],f=n[s.GainsEffect.fields.effect],y=n[s.GainsEffect.fields.target],b=n[s.GainsEffect.fields.targetId],S=Number(n[s.GainsEffect.fields.count]);let I=Bt(d);if(!I){const $=b.startsWith("1")&&Wt.get(parseInt(d,16).toString())||b.startsWith("4")&&Kt.get(parseInt(d,16).toString());if(!$)return;const K=je($.icon),X=S>1?wt(K,S):K;I={type:"multiplier",performance:{physics:1,magic:1,darkness:1},id:parseInt(d,16),icon:$.icon,fullIcon:X,name:$.name,isFriendly:$.isFriendly}}const Y=n[s.GainsEffect.fields.duration],A=n[s.GainsEffect.fields.source],z=n[s.GainsEffect.fields.sourceId],Z=new Date(n[s.GainsEffect.fields.timestamp]).getTime()+parseFloat(Y)*1e3,W={name:I.name,count:S,effect:f,effectId:d,source:A,sourceId:z,target:y,targetId:b,expirationTimestamp:Z,performance:I.performance,fullIcon:I.fullIcon,isPov:L.value===z};b[0]==="1"&&I.isFriendly?((t=T.friendly)[b]??(t[b]={}))[d]=W:b[0]==="4"&&!I.isFriendly&&(((p=T.enemy)[y]??(p[y]={}))[d]=W)}break;case"losesEffect":{const d=n[s.LosesEffect.fields.target],f=n[s.LosesEffect.fields.targetId],y=n[s.LosesEffect.fields.effectId];f[0]==="1"?T.friendly[f]&&Reflect.deleteProperty(T.friendly[f],y):T.enemy[d]&&Reflect.deleteProperty(T.enemy[d],y)}break;case"addCombatant":if(n[s.AddedCombatant.fields.job]!=="00"){const d=n[s.AddedCombatant.fields.job],f=new Date(n[s.AddedCombatant.fields.timestamp]).getTime();P.value[n[s.AddedCombatant.fields.id]]={job:parseInt(d,16),timestamp:f}}break;case"removingCombatant":Reflect.deleteProperty(P.value,n[s.RemovedCombatant.fields.id]);break;case"primaryPlayer":L.value=n[s.ChangedPlayer.fields.id];const re=n[s.ChangedPlayer.fields.name];if(H.value===re)return;H.value=re,we(n[s.ChangedPlayer.fields.name]);break;case"partyList":ie.value=((m=F.groups.list)==null?void 0:m.split("|"))??[];break;case"changeZone":ve.value=n[s.ChangeZone.fields.name],_e(new Date(n[s.ChangeZone.fields.timestamp]).getTime());break;case"inCombat":{const d=n[s.InCombat.fields.inACTCombat]==="1",f=n[s.InCombat.fields.inGameCombat]==="1",y=new Date(n[s.InCombat.fields.timestamp]).getTime();if(d||f){if(w.value>0)return;u.value[0].table.length!==0&&(u.value[0]=xt(u.value[0]),u.value.unshift({zoneName:"",duration:"00:00",table:[],key:n[s.InCombat.fields.timestamp]}),u.value.length>=N.runtime&&u.value.splice(u.value.length-1,1)),w.value=y,u.value[0].zoneName=ve.value,O.value=0;return}if(!d&&!f){_e(y);return}}break;case"rsv":{const d=Number(F.groups.id),f=n[s.RSVData.fields.value];ke.value[Number(d)]=f}break;case"networkDoT":if(!a.parseDoT)return;{const d=n[s.NetworkDoT.fields.which],f=n[s.NetworkDoT.fields.id];if(d!=="DoT"||f[0]==="4"||!(f===L.value||ie.value.includes(f)||ne.value.find(X=>X.id===f)))return;const y=n[s.NetworkDoT.fields.name],b=n[s.NetworkDoT.fields.damage],S=parseInt(b,16),I=new Date(n[s.Ability.fields.timestamp]??"???").getTime(),Y=Number(n[s.NetworkDoT.fields.currentHp]),A=Number(n[s.NetworkDoT.fields.maxHp]),z=w.value===0?0:I-w.value,ce=ae(z),Z=Ce(f),W=B.nameToFullName(B.jobEnumToJob(Z)).simple2,$=Z,K=B.jobEnumToIcon($).toLocaleLowerCase();Ie({timestamp:I,time:ce,id:void 0,action:d,actionCN:d,source:"",target:y,targetId:f,job:W,jobIcon:K,jobEnum:$,amount:S,keigenns:[],currentHp:Y,maxHp:A,effect:"damage done",type:"dot",shield:de[f],povId:L.value})}break;case"ability":if(w.value===0)return;{const d=Gt(n);if(d.isAttack&&d.amount>=0){const f=n[s.Ability.fields.sourceId]??"???",y=n[s.Ability.fields.targetId]??"???";if(!(f[0]==="4"&&y[0]==="1")||!(y===L.value||ie.value.includes(y)||ne.value.find(G=>G.id===y)))return;const b=new Date(n[s.Ability.fields.timestamp]??"???").getTime(),S=n[s.Ability.fields.ability],I=S.match(/^_rsv_(?<id>\d+)_/),Y=n[s.Ability.fields.id]??"???";let A=S;if(I){const G=Number(I.groups.id);A=ke.value[G]??S.match(/^_(?<id>rsv_\d+)_/).groups.id}else if(A=A.replace(/unknown_.*/,"攻击"),a.parseAA===!1&&/^攻击|攻撃|[Aa]ttack$/.test(A))return;const z=Nt(parseInt(Y,16)),ce=z&&z!==""?z:A,Z=Number(n[s.Ability.fields.targetCurrentHp])??"???",W=Number(n[s.Ability.fields.targetMaxHp])??"???",$=n[s.Ability.fields.source]??"???",K=n[s.Ability.fields.target]??"???",{effect:X,type:ct}=Ht(d.flags),ot=w.value===0?0:b-w.value,lt=ae(ot),Te=Ce(y),dt=B.nameToFullName(B.jobEnumToJob(Te)).cn.substring(0,2),Ae=Te,mt=B.jobEnumToIcon(Ae).toLocaleLowerCase(),pt=he(Object.values(T.friendly[y]??[]).concat(Object.values(T.enemy[$]??[])).filter(G=>{const oe=Math.max(0,(G.expirationTimestamp-b)/1e3);return G.remainingDuration=oe>=999?"":oe.toFixed(oe>.05&&oe<.95?1:0),Number(G.remainingDuration)>-3}));Ie({timestamp:b,time:lt,id:Y,action:A,actionCN:ce,source:$,target:K,targetId:y,job:dt,jobIcon:mt,jobEnum:Ae,amount:d.amount,keigenns:pt,currentHp:Z,maxHp:W,effect:X,type:ct,shield:de[F.groups.targetId],povId:L.value}),u.value[0].duration=ae(new Date(n[s.Ability.fields.timestamp]).getTime()-w.value)}break}}}}},Ce=e=>{const t=P.value[e],p=ne.value.find(m=>m.id===e)??{job:0,timestamp:0};return[t,p].sort((m,x)=>x.timestamp-m.timestamp)[0].job},Ie=e=>{u.value[0].table.unshift(e)},_e=e=>{w.value!==0&&(u.value[0].duration=ae(e-w.value),w.value=0,T.friendly={},T.enemy={},Ee())},Ee=()=>{localStorage.setItem(Oe,JSON.stringify(u.value.slice(0,N.localStorage)))},Je=()=>{const e=localStorage.getItem(Oe);if(e)try{const t=JSON.parse(e);u.value.length=0,u.value.push(...t)}catch(t){console.error(t)}},ae=e=>{const t=Math.max(Math.floor(e/6e4),0),p=Math.max(Math.floor((e-t*6e4)/1e3),0);return`${t<10?"0":""}${t}:${p<10?"0":""}${p}`},Ye=pe(()=>{const e=new Set(u.value[O.value].table.map(t=>a.actionCN?t.actionCN:t.action));return Array.from(e).map(t=>({label:t,value:t}))}),Ze=pe(()=>{const e={},t=new Set(u.value[O.value].table.slice().sort((p,m)=>B.enumSortMethod(p.jobEnum,m.jobEnum)).map(p=>(e[p.target]=p.job,p.target)));return Array.from(t).map(p=>({label:`${e[p]}（${p}）`,value:p}))});let me=e=>e;const we=e=>{/^([A-Z])\S+ ([A-Z])\S+$/.test(e)?(a.abbrId&&(me=t=>t.replace(/^([A-Z])\S+ ([A-Z])\S+$/,"$1.$2.")),ge("Global")):(a.abbrId&&(me=t=>t.substring(0,2)),ge("Chinese"))};we(H.value);const Ne=e=>{const t=e.target;t.src.includes("cafemaker.wakingsands.com")?t.src=t.src.replace("cafemaker.wakingsands.com","xivapi.com"):t.src.includes("xivapi.com")&&(t.src="")},We=e=>{H.value=e.charName,L.value=e.charID.toString(16).toUpperCase()},Ke=e=>{ne.value=e.party.map(t=>({...t,timestamp:Date.now()}))};ze(()=>{for(const e in P.value){const t=P.value[e];Date.now()-t.timestamp>1e3*60*60*24*1&&Reflect.deleteProperty(P.value,e)}Je(),addOverlayListener("LogLine",Fe),addOverlayListener("PartyChanged",Ke),addOverlayListener("ChangePrimaryPlayer",We),startOverlayEvents()}),Re(()=>{removeOverlayListener("LogLine",Fe)});const Xe=({row:e})=>o("div",null,[o("span",{class:"target"},[a.showIcon&&o("img",{class:"jobIcon",src:`//cafemaker.wakingsands.com/cj/companion/${e.jobIcon}.png`,alt:"",onError:Ne,loading:"lazy"},null),a.showName&&o("span",{class:`job ${e.jobIcon} ${e.targetId===e.povId?"YOU":""}`,style:!a.abbrId&&a.showName?{overflow:"hidden",textOverflow:"ellipsis"}:{}},[e.targetId===e.povId&&a.replaceWithYou?"YOU":a.anonymous?e.job:me(e.target)])])]),qe=({row:e})=>o(Ct,{"append-to":".wrapper",effect:"dark",placement:"right-start",title:"",trigger:"hover",enterable:!1,"hide-after":0,"popper-class":"my-el-popover"},{default:()=>[o(Qe,{row:e},null)],...{reference:()=>o("span",{class:`damage ${e.type} ${$e(e)?"lethal":""} `},[e.amount.toLocaleString().padStart(3,"　")])}}),Qe=({row:e})=>o("div",null,[o("span",null,[_("盾:"),Math.round(e.maxHp*+e.shield/100),_(" ("),e.shield,_("%)")]),o("br",null,null),o("span",null,[_("HP:"),e.currentHp,_("/"),e.maxHp,_(" ("),Math.round(e.currentHp/e.maxHp*100),_("%)")]),o("br",null,null),o("span",null,[_("来源:"),e.source]),o("br",null,null),o("span",null,[_("受到伤害:"),e.amount]),o("br",null,null),o("span",null,[_("剩余HP:"),e.currentHp-e.amount,_(" ("),Math.round((e.currentHp-e.amount)/e.maxHp*100),_("%)")])]),et=[409 .toString(16).toUpperCase(),810 .toString(16).toUpperCase(),811 .toString(16).toUpperCase(),1836 .toString(16).toUpperCase()],$e=e=>e.currentHp-e.amount<0&&!e.keigenns.find(t=>et.includes(t.effectId)),tt=({row:e})=>o(ue,null,[o("span",null,[$e(e)?"💀致死 ":""]),e.type==="dot"?"（不支持）":e.keigenns.map(t=>o("span",{class:"status",title:`${t.name}(${t.source})`,"data-duration":t.remainingDuration,"data-sourcePov":t.isPov},[o("img",{class:`statusIcon ${Jt(t.performance[e.type])}`,src:`//cafemaker.wakingsands.com/i/${t.fullIcon}${te}.png`,alt:t.effect,onError:Ne,loading:"lazy"},null)])),o("span",null,[e.effect==="damage done"?"":fe(e.effect)])]),it=e=>{const{action:t,actionCN:p,amount:m,job:x,keigenns:k,source:F,target:n,time:re,type:d}=e,f=e.effect==="damage done"?"":","+fe(e.effect),y=`${re} [${x}]${n} HP:${e.currentHp}/${e.maxHp}(${Math.round(e.currentHp/e.maxHp*100)}%) + 护盾:${Math.round(e.maxHp*+e.shield/100)}(${e.shield}%) 受到${F}“${t}${p!==t?"("+p+")":""}”的${m.toLocaleString()}点${fe(d)}伤害。剩余HP:${e.currentHp-e.amount}(${Math.round((e.currentHp-e.amount)/e.maxHp*100)}%)。减伤：${k.length===0&&f===""?"无":k.map(b=>a.statusCN?b.name:b.effect).join(",")+f}。`;nt(y)},nt=e=>{navigator.clipboard.writeText(e).catch(()=>{const t=document.createElement("input");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}),He.modal.message({content:"已复制到剪贴板",status:"success"})},M=D({target:!1,action:!1}),J=D(),se=gt({className:"my-menus",body:{options:[]}});ht(()=>{var e,t,p;se.body&&se.body.options&&U.value&&(se.body.options[0]=[{code:"copy",name:"复制详情",prefixIcon:"vxe-icon-copy",className:"my-copy-item"},{code:"clearFilterAction",name:"取消技能筛选",prefixIcon:"vxe-icon-funnel-clear",className:"my-clear-filter",visible:M.value.action,disabled:!1},{code:"filterSelectAction",name:(e=J.value)!=null&&e[E.value]?`只看 ${(t=J.value)==null?void 0:t[E.value]}`:"只看该技能",prefixIcon:"vxe-icon-info-circle",visible:!M.value.action,disabled:!1},{code:"clearFilterTarget",name:"取消玩家筛选",prefixIcon:"vxe-icon-funnel-clear",visible:M.value.target,disabled:!1},{code:"filterSelectTarget",name:(p=J.value)!=null&&p.target?`只看[${J.value.job}] ${J.value.target}`:"只看该玩家",prefixIcon:"vxe-icon-user-fill",visible:!M.value.target,disabled:!1}])});const at=()=>{C.value=!C.value},st=({row:e})=>{const t=U.value;t&&(t.setCurrentRow(e),J.value=e)},rt=({menu:e,row:t,column:p})=>{const m=U.value;switch(e.code){case"copy":if(!t){He.modal.message({content:"未选中有效数据行",status:"error"});return}it(t);break;case"clearFilterTarget":m&&(m.clearFilter(m.getColumnByField("target")),M.value.target=!1);break;case"clearFilterAction":m&&(m.clearFilter(m.getColumnByField(E.value)),M.value.action=!1);break;case"filterSelectTarget":if(m){const x=m.getColumnByField("target");if(x){const k=x.filters.find(F=>F.value===t.target);if(!k)return;k.checked=!0,m.updateData().then(()=>{m.scrollToRow(t),M.value.target=!0})}}break;case"filterSelectAction":if(m){const x=m.getColumnByField(E.value);if(x){const k=x.filters.find(F=>F.value===t[E.value]);if(!k)return;k.checked=!0,m.updateData().then(()=>{m.scrollToRow(t),M.value.action=!0})}}break}};return(e,t)=>{const p=q("vxe-option"),m=q("vxe-select"),x=q("vxe-button"),k=q("vxe-column"),F=q("vxe-table");return ee(),le(ue,null,[j("div",{class:"wrapper",style:g},[j("header",null,[De(o(m,{modelValue:v(O),"onUpdate:modelValue":t[0]||(t[0]=n=>vt(O)?O.value=n:null),size:"mini",class:"select"},{default:Q(()=>[(ee(!0),le(ue,null,bt(v(u).length,n=>(ee(),It(p,{key:`${v(u)[n-1].key}-${v(u)[n-1].duration}-${v(u)[n-1].zoneName}`,value:n-1,label:`${v(u)[n-1].duration} ${v(u)[n-1].zoneName}`},null,8,["value","label"]))),128))]),_:1},8,["modelValue"]),[[Se,!v(C)]]),o(x,{class:"minimize",icon:v(C)?"vxe-icon-fullscreen":"vxe-icon-minimize",onClick:at,style:kt({opacity:v(C)?.5:1})},null,8,["icon","style"])]),De(j("main",null,[o(F,{ref_key:"xTable",ref:U,size:"mini",class:"vxe-table","show-overflow":"",round:"",height:"100%","scroll-y":{enabled:!0},"show-header":a.showHeader,data:v(u)[v(O)].table,"row-config":{isHover:!0,height:h.line_height},"header-cell-style":{padding:"0px"},onCellMenu:st,"menu-config":v(se),onMenuClick:rt},{default:Q(()=>[_(" > "),o(k,{width:h.time,field:"time",title:"时间",align:"center"},null,8,["width"]),o(k,{width:h.action,field:a.actionCN?"actionCN":"action",title:"技能",filters:v(Ye),"filter-multiple":!1,resizable:!1,align:"center"},null,8,["width","field","filters"]),o(k,{width:h.target,field:"target",title:a.showName?"目标":"目",filters:v(Ze),"filter-multiple":!1,resizable:!a.anonymous&&!a.abbrId,align:"left","header-align":"center"},{default:Q(({row:n})=>[o(Xe,{row:n},null,8,["row"])]),_:1},8,["width","title","filters","resizable"]),o(k,{width:h.amount,title:"伤害",align:"right","header-align":"center"},{default:Q(({row:n})=>[o(qe,{row:n},null,8,["row"])]),_:1},8,["width"]),o(k,{title:"减伤",align:"left"},{default:Q(({row:n})=>[o(tt,{row:n},null,8,["row"])]),_:1})]),_:1},8,["show-header","data","row-config","menu-config"])],512),[[Se,!v(C)]])]),v(c)?(ee(),le("div",Xt,[o(St,{onBeforeHandle:Ve,onAfterHandle:Be,onHandleLine:xe})])):Ft("",!0)],64)}}});export{ai as default};
