import{d as E,v as I,y as O,Z as T,o as g,b as m,f as o,H as b,I as B,u as k,D,ar as V,a1 as W,F as j,t as F,Q as z}from"./vendor-834361d8.js";import{_ as H}from"./index-88de3c11.js";const L=E({__name:"hexcode",setup(M){const S=I([]),x=O("hexcode",""),y=I([]);function R(u){const t=u.target.files[0],e=new FileReader;e.onload=function(a){var r;const s=(r=a.target)==null?void 0:r.result;s&&s.toString().split(`
`).map((i,n)=>{if(n<=4)return;const[f,d]=i.split(",");if(f&&d){const p=w(f,d);console.log(p),S.value.push({key:f,result:p})}})},e.readAsText(t)}function w(u,t){let e=0;const a=[];for(;e<t.length;){const s=t.indexOf("<hex:02",e),r=t.indexOf("<hex:FF",e);if(s===-1&&r===-1)break;const i=s===-1?r:s,n=i===r?-2:0;s!==-1?e=s+1:r!==-1&&(e=r+1);const f=t.slice(e+6+n,e+8+n),d=t.slice(e+8+n,e+10+n),p=parseInt(d,16),A=`指令${f} 长度${d}(${p})`;let c=0,h=0,v=!0,_=!0;for(;h<p;c++){const l=t[i+n+c+11],C=t.slice(i+n+c+11,i+n+c+11+5);if(l===void 0)break;if(l==="<"&&(v=!0,_=!1),!(v&&!_)){if(l===">"&&_)continue;if(l==="<"&&C==="<hex:")continue;/[\u0000-\u007f]/.test(l)?(h+=v?.5:1,console.debug(l,"+"+v?.5:1,`已数${h}`)):/[\ue000-\uf8ff\uff00-\uffef]/.test(l)?(h+=3,console.debug(l,"+3",`已数${h}`)):console.error(`未知的${u} ${l} \\u${l.charCodeAt(0).toString(16).padStart(4,"0")}`)}l===":"&&(_=!0),l===">"&&(v=!1,_=!1)}const $=t.slice(e+n+c+3,e+n+c+11);a.push({passed:$.endsWith("03>")||$.startsWith("<hex:FF"),over:$,msg:A})}return a}return T(()=>{y.value.length=0;const u=w("input",x.value);y.value.push(...u)}),(u,t)=>(g(),m(b,null,[o("div",null,[o("div",null,[o("input",{type:"file",name:"",id:"",onInput:R},null,32)]),o("div",null,[o("ul",null,[(g(!0),m(b,null,B(k(S),(e,a)=>D((g(),m("li",{key:a},F(e.key)+" "+F(e.result.every(s=>s.passed)?"全部通过":e.result.filter(s=>s.passed===!1).map(s=>`${s.msg}${s.over}`).join("")),1)),[[j,!e.result.every(s=>s.passed)]])),128))])])]),o("main",null,[D(o("textarea",{name:"",id:"",cols:"100",rows:"5","onUpdate:modelValue":t[0]||(t[0]=e=>W(x)?x.value=e:null)},null,512),[[V,k(x)]]),o("article",null,[o("ul",null,[(g(!0),m(b,null,B(k(y),(e,a)=>(g(),m("li",{key:a},[o("span",{style:z({color:e.passed?"black":"red"})},F(`${e.msg} ${e.passed?"通过":`错误${e.over}`}`),5)]))),128))])])])],64))}});const U=H(L,[["__scopeId","data-v-c45478b5"]]);export{U as default};
