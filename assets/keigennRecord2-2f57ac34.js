import{av as yt,U as gt,d as ce,o as $,b as T,J as Ne,K as We,g as m,t as N,u as c,R as oe,I as ne,c as Ve,w as S,a as h,aA as ht,S as Je,i as $e,D as Ie,A as M,C as W,F as bt,B as vt,a0 as kt,r as re,h as Pe,H as Me,a3 as wt,ax as Ft,ay as Be}from"./vendor-11731512.js";import{s as Ke,c as Ze,a as _t}from"./status-5d5f450e.js";import{t as De,a as Ct,p as It,b as xt,d as Nt}from"./deepClone-a70a67db.js";import{h as ke}from"./xivapi-cae66b04.js";import{N as B,l as r}from"./netregexes-2830d8aa.js";import{U as V}from"./util-ef9ccf87.js";import{g as $t}from"./actionChinese-91930ff4.js";import{a as xe}from"./overlay_plugin_api-409cb9ea.js";import"./index-83851854.js";import"./queryParams-cf2e4fb1.js";const Ye=[{name:"铁壁",description:"减轻所受到的伤害",id:1191,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"盾阵",description:"受到攻击时必定发动格挡",id:1856,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"干预",description:"减轻所受到的伤害",id:1174,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"预警",description:"减轻所受到的伤害",id:74,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"武装",description:"减轻所受到的伤害",id:1176,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"神圣领域",description:"除特定攻击之外其他所有攻击均无效化",id:82,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"圣光幕帘",description:"抵消一定伤害",id:1362,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"圣盾阵",description:"受到攻击时必定发动格挡",id:2674,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"骑士的坚守",description:"减轻所受到的伤害",id:2675,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"壁垒",description:"受到攻击时必定发动格挡",id:77,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的直觉",description:"自身发动战技命中时可以恢复体力，同时减轻所受到的伤害",id:735,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的勇猛",description:"自身发动战技命中时可以恢复体力",id:1857,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的武猛",description:`附加此效果的战士受到原初的勇猛的恢复体力的效果时，会获得相当于其100%的恢复效果
另外受到攻击的伤害减少`,id:1858,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"战栗",description:`体力最大值提高
习得战栗效果提高后追加效果：自身所受的治疗效果提高`,id:87,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"复仇",description:"受到攻击的伤害减少并且受到物理攻击时会发动反击",id:89,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"摆脱",description:"抵消一定伤害",id:1457,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"死斗",description:"除特定攻击之外其他所有对自身发动的攻击均无法令体力减少到1以下",id:409,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的血气",description:"自身发动战技命中时可以恢复体力，同时减轻所受到的伤害",id:2678,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的血潮",description:"减轻所受到的伤害",id:2679,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的血烟",description:"抵消一定伤害",id:2680,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"至黑之夜",description:"抵消一定伤害",id:1178,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"弃明投暗",description:"减轻所受到的魔法伤害",id:746,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!0},{name:"暗影墙",description:"减轻所受到的伤害",id:747,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"暗黑布道",description:"减轻所受到的魔法伤害",id:1894,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!0},{name:"行尸走肉",description:`受到致命伤害时体力减为1，并附加死而不僵状态
但是对部分攻击无效`,id:810,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"死而不僵",description:"除特定攻击之外其他所有对自身发动的攻击均无法令体力减少到1以下",id:811,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"出死入生",description:"除特定攻击之外其他所有对自身发动的攻击均无法令体力减少到1以下",id:3255,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"献奉",description:"减轻所受到的伤害",id:2682,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"石之心",description:"减轻所受到的伤害",id:1840,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"残暴弹",description:"抵消一定伤害",id:1898,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"伪装",description:"招架发动率提高，减轻所受到的伤害",id:1832,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"星云",description:"减轻所受到的伤害",id:1834,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"光之心",description:"减轻所受到的魔法伤害",id:1839,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!0},{name:"超火流星",description:"除特定攻击之外其他所有攻击均无效化",id:1836,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"刚玉之心",description:"减轻所受到的伤害",id:2683,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"刚玉之清",description:"减轻所受到的伤害",id:2684,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"神祝祷",description:"抵消一定伤害",id:1218,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"节制",description:"减轻所受到的伤害",id:1873,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"水流幕",description:"减轻所受到的伤害",id:2708,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"鼓舞",description:"抵消一定伤害",id:297,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"激励",description:"抵消一定伤害",id:1918,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"炽天的幕帘",description:"抵消一定伤害",id:1917,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"野战治疗阵",description:"减轻所受到的伤害",id:299,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"异想的幻光",description:"发动治疗魔法的治疗量提高，且受到魔法攻击的伤害减少",id:317,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!0},{name:"炽天的幻光",description:"发动治疗魔法的治疗量提高，且受到魔法攻击的伤害减少",id:1875,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!0},{name:"生命回生法",description:"体力最大值提高，同时自身所受体力恢复效果提高",id:2710,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"怒涛之计",description:"减轻所受到的伤害",id:2711,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"命运之轮",description:"减轻所受到的伤害",id:849,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"天星交错",description:"抵消一定伤害",id:1889,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"擢升",description:"减轻所受到的伤害",id:2717,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"中间学派",description:"抵消一定伤害",id:1921,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"均衡诊断",description:"抵消一定伤害",id:2607,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"齐衡诊断",description:"抵消一定伤害",id:2608,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"均衡预后",description:"抵消一定伤害",id:2609,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"坚角清汁",description:"减轻所受到的伤害",id:2618,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"白牛清汁",description:"减轻所受到的伤害",id:2619,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"整体论",description:"减轻所受到的伤害",id:3003,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"整体盾",description:"抵消一定伤害",id:3365,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"输血",description:"抵消一定伤害",id:2612,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"泛输血",description:"抵消一定伤害",id:2613,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"心眼",description:"下次受到攻击时所受到的伤害减轻",id:1232,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"金刚极意",description:"减轻所受到的一部分伤害",id:1179,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"行吟",description:"减轻所受到的伤害",id:1934,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"策动",description:"减轻所受到的伤害",id:1951,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"防守之桑巴",description:"减轻所受到的伤害",id:1826,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"即兴表演结束",description:"抵消一定伤害",id:2697,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"残影",description:"抵消一定伤害",id:488,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"魔罩",description:"抵消一定伤害",id:168,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"守护之光",description:"抵消一定伤害",id:2702,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"守护纹",description:"抵消一定伤害",id:2597,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"抗死",description:"减轻所受到的魔法伤害，同时自身所受体力恢复效果提高",id:2707,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!0},{name:"雪仇",description:"攻击所造成的伤害降低",id:1193,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!1},{name:"牵制",description:"物理攻击和魔法攻击所造成的伤害降低",id:1195,type:"multiplier",performance:{physics:1,magic:.5,darkness:0},isFriendly:!1},{name:"昏乱",description:"物理攻击和魔法攻击所造成的伤害降低",id:1203,type:"multiplier",performance:{physics:.5,magic:1,darkness:0},isFriendly:!1},{name:"武装解除",description:"攻击所造成的伤害降低",id:860,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!1},{name:"减速",description:"战技与魔法的咏唱及复唱时间延长",id:9,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!1},{name:"体力增加",description:"体力最大值提高",id:2120,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"腐臭",description:"造成的伤害降低",id:1715,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!1},{name:"智力精神降低",description:"智力与精神有所降低",id:2115,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!1},{name:"龙之力",description:"受到的伤害降低",id:2500,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"超硬化",description:"无法自由活动，但受到攻击的伤害减少",id:1722,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"玄结界",description:"减轻所受到的伤害，受到一定伤害后将附加玄天武水壁状态",id:2496,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"仙人盾",description:"受到的伤害降低",id:2119,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"强力守护",description:"令自身所受到的伤害减少，同时会以攻击力降低为代价提高自身仇恨",id:1719,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"哥布防御",description:"抵消一定伤害",id:2114,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"铜墙铁盾",description:"减轻所受到的伤害",id:194,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"坚守要塞",description:"减轻所受到的伤害",id:195,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"终极堡垒",description:"减轻所受到的伤害",id:196,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初大地",description:"减轻所受到的伤害",id:863,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"暗黑之力",description:"减轻所受到的伤害",id:864,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"灵魂之青",description:"减轻所受到的伤害",id:1931,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0}],Dt=[...Ye],ve=new Map;let Ge="Chinese";function Ae(n){if(Ge!==n||ve.size===0){ve.clear();for(const t of n==="Chinese"?Ye:Dt){const s=Ke[t.id][1];t.fullIcon=Ze(s),ve.set(t.id.toString(16).toUpperCase().padStart(2,"0"),t)}Ge=n}}Ae("Chinese");function At(n){return ve.get(n)}const St=n=>n===1?"useful":n===0?"unuseful":"half-useful",Tt=/(?:耐性|防御力)(?:大幅)?(?:降低|提升|低下|下降)|受伤(?:加重|减轻)|体力(?:增加|衰减|减少)|伤害屏障/,Et=/(?:精神|力量|灵巧|智力){1,2}(?:大幅)?降低/,qe=(n,t)=>Object.entries(Ke).reduce((s,[I,[k,F]])=>(n.test(k)&&s.set(I,{name:k,icon:F,isFriendly:t}),s),new Map),jt=qe(Tt,!0),Ht=qe(Et,!1),v=yt("hash"),Se=gt("keigennRecord2",{state:()=>({userOptions:{scale:D(v.scale,1),showHeader:D(v.showHeader,!0),showIcon:D(v.showIcon,!0),showName:D(v.showName,!1),abbrId:D(v.abbrId,!0),anonymous:D(v.anonymous,!0),replaceWithYou:D(v.replaceWithYou,!1),parseAA:D(v.parseAA,!0),parseDoT:D(v.parseDoT,!1),minimize:D(v.minimize,!1),actionCN:D(v.actionCN,!0),statusCN:D(v.statusCN,!0)},isDev:!1}),getters:{icon4k(n){return n.userOptions.scale>=2||window.devicePixelRatio>=2?"_hr1":""}},actions:{recheckIsDev(){this.isDev=v.dev==="1"||v.dev===void 0&&!window.OverlayPluginApi&&!v.OVERLAY_WS&&!v.HOST_PORT,this.isDev&&setTimeout(this.recheckIsDev,1e3)},formatterName(n){return n},initEnvironment(n){/^([A-Z])\S+ ([A-Z])\S+$/.test(n)?(this.userOptions.abbrId&&(this.formatterName=t=>t.replace(/^([A-Z])\S+ ([A-Z])\S+$/,"$1.$2.")),Ae("Global")):(this.userOptions.abbrId&&(this.formatterName=t=>t.substring(0,2)),Ae("Chinese"))}}});function D(n,t){return typeof t=="boolean"?n==="0"?!1:n==="1"?!0:t:typeof t=="number"?Number.isNaN(+n)?t:+n:t}const Ot={key:0},Lt={key:1},Rt=["title","data-duration","data-sourcePov"],zt=["src","alt"],Pt=ce({__name:"StatusShow",props:{row:{type:Object,required:!0}},setup(n){const s=Se().icon4k,I=n;return(k,F)=>I.row.type==="dot"?($(),T("div",Ot,"（不支持）")):($(),T("div",Lt,[($(!0),T(Ne,null,We(I.row.keigenns,(O,le)=>($(),T("span",{key:le},[m("span",{class:"status",title:`${O.name}(${O.source})`,"data-duration":O.remainingDuration,"data-sourcePov":O.isPov},[m("img",{class:oe(`statusIcon ${c(St)(O.performance[n.row.type])}`),src:`//cafemaker.wakingsands.com/i/${O.fullIcon}${c(s)}.png`,alt:O.effect,onError:F[0]||(F[0]=(...se)=>c(ke)&&c(ke)(...se)),loading:"lazy"},null,42,zt)],8,Rt)]))),128)),m("span",null,N(n.row.effect==="damage done"?"":c(De)(n.row.effect)),1)]))}}),Mt=m("br",null,null,-1),Bt=m("br",null,null,-1),Gt=m("br",null,null,-1),Ut=m("br",null,null,-1),Wt=m("br",null,null,-1),Vt=ce({__name:"AmountDetails",props:{row:{type:Object,required:!0}},setup(n){const t=n;return(s,I)=>($(),T("div",null,[m("span",null,"来源:"+N(t.row.source),1),Mt,m("span",null,"目标:"+N(t.row.target),1),Bt,m("span",null," 护盾:"+N(Math.round(t.row.maxHp*+t.row.shield/100))+" ("+N(t.row.shield)+"%) ",1),Gt,m("span",null," 血量:"+N(t.row.currentHp)+"/"+N(t.row.maxHp)+" ("+N(Math.round(t.row.currentHp/t.row.maxHp*100))+"%) ",1),Ut,m("span",null,[ne("伤害:"),m("span",{class:oe(t.row.type)},N(t.row.amount),3)]),Wt,m("span",null," 剩余:"+N(t.row.currentHp-t.row.amount)+" ("+N(Math.round((t.row.currentHp-t.row.amount)/t.row.maxHp*100))+"%) ",1)]))}}),Jt=[409 .toString(16).toUpperCase(),810 .toString(16).toUpperCase(),811 .toString(16).toUpperCase(),1836 .toString(16).toUpperCase()],Kt=n=>n.currentHp-n.amount<0&&!n.keigenns.find(t=>Jt.includes(t.effectId)),Zt={class:"amount"},Yt=ce({__name:"Amount",props:{row:{type:Object,required:!0}},setup(n){const t=n;return(s,I)=>{const k=Vt,F=ht;return $(),Ve(F,{"append-to":".wrapper",effect:"dark",placement:"right-start",title:"",trigger:"hover",enterable:!1,"hide-after":0,"popper-class":"my-el-popover"},{reference:S(()=>[m("span",Zt,[m("span",{class:oe(t.row.type)},[m("span",{class:oe(`${c(Kt)(n.row)?"lethal":""}`)},N(n.row.amount.toLocaleString().padStart(3,"　")),3)],2)])]),default:S(()=>[h(k,{row:n.row},null,8,["row"])]),_:1})}}}),qt={key:0,class:"target"},Xt=["src","data-job"],Qt=ce({__name:"Target",props:{row:{type:Object,required:!0}},setup(n){const t=Se(),s=n;return(I,k)=>($(),T("div",null,[c(t).userOptions.showIcon?($(),T("span",qt,[m("img",{class:"jobIcon",src:`//cafemaker.wakingsands.com/cj/companion/${s.row.jobIcon}.png`,alt:"","data-job":c(t).userOptions.showName?"":s.row.job,onError:k[0]||(k[0]=(...F)=>c(ke)&&c(ke)(...F)),loading:"lazy"},null,40,Xt),c(t).userOptions.showName?($(),T("span",{key:0,class:oe(`job ${s.row.jobIcon} ${s.row.targetId===s.row.povId?"YOU":""}`),style:Je(!c(t).userOptions.abbrId&&c(t).userOptions.showName?{overflow:"hidden",textOverflow:"ellipsis"}:{})},N(s.row.targetId===s.row.povId&&c(t).userOptions.replaceWithYou?"YOU":c(t).userOptions.anonymous?s.row.job:c(t).formatterName(s.row.target)),7)):$e("",!0)])):$e("",!0)]))}}),ei={key:0,class:"testLog"},ti={class:"test-buttons"},Ue="souma-keigenn-record-2",pi=ce({__name:"keigennRecord2",setup(n){const t=Se(),s=t.userOptions;t.recheckIsDev();const I=Ie(()=>s.actionCN?"actionCN":"action"),k=M(s.minimize),F={line_height:28*s.scale,time:35*s.scale,action:65*s.scale,target:((s.showIcon?24:0)+(s.showName?s.anonymous||!s.anonymous&&s.abbrId?24:36:0)+7)*s.scale,amount:44*s.scale},O={"--vxe-font-size-mini":`${12*s.scale}px`,"--vxe-table-row-line-height":`${30*s.scale}px`,"--vxe-table-row-height-mini":`${30*s.scale}px`,"--vxe-input-height-mini":`${20*s.scale}px`,"--vxe-select-option-height-mini":`${24*s.scale}px`},le={runtime:99,localStorage:3},se=M(!1),de=M(),E=W("keigenn-record-2-pov-name",""),A=W("keigenn-record-2-pov-id",""),we=W("keigenn-record-2-party-list",[]),J=W("keigenn-record-2-job-map",{}),me=W("keigenn-record-2-party-event-party",[]),L=M(0),l=M([{zoneName:"",duration:"00:00",table:[],key:"init"}]),Te={rsv:/^262\|(?<timestamp>[^|]*)\|[^|]*\|[^|]*\|_rsv_(?<id>\d*)[^|]*\|(?<real>[^|]*)\|/i,ability:B.ability(),statusEffectExplicit:B.statusEffectExplicit(),gainsEffect:B.gainsEffect(),losesEffect:B.losesEffect(),inCombat:/^260\|(?<timestamp>[^|]*)\|(?<inACTCombat>[^|]*)\|(?<inGameCombat>[^|]*)\|/i,changeZone:B.changeZone(),partyList:/^11\|(?<timestamp>[^|]*)\|(?<partyCount>\d*)\|(?<list>(?:\w{8}\|){0,})\w{16}/i,primaryPlayer:/^02\|(?<timestamp>[^|]*)\|(?<id>[^|]*)\|(?<name>[^|]*)/,addCombatant:B.addedCombatant(),removingCombatant:B.removingCombatant(),networkDoT:B.networkDoT()},_=M(0),Ee=W("souma-keigenn-record-2-zone-name",""),je=W("souma-keigenn-record-2-rsv-data",{}),Fe={},b={friendly:{},enemy:{}},Xe=e=>{e.table.length=0,e.zoneName="",e.duration="00:00",e.key="init"},Qe=()=>{se.value=!0,_.value=0,L.value=0,l.value.length=1,Xe(l.value[0])},et=()=>{ue(),se.value=!1},pe=e=>{var i,o,u,g,w,Z,Y,q,X,f;for(const ge in Te){const G=Te[ge].exec(e);if(G){const a=e.split("|");switch(ge){case"statusEffectExplicit":(i=G.groups)!=null&&i.targetId.startsWith("1")&&(Fe[(o=G.groups)==null?void 0:o.targetId]=(u=G.groups)==null?void 0:u.currentShield);break;case"gainsEffect":{const d=a[r.GainsEffect.fields.effectId],p=a[r.GainsEffect.fields.effect],y=a[r.GainsEffect.fields.target],C=a[r.GainsEffect.fields.targetId],R=Number.parseInt(a[r.GainsEffect.fields.count],16);let x=At(d);if(!x){const H=C.startsWith("1")&&jt.get(Number.parseInt(d,16).toString())||C.startsWith("4")&&Ht.get(Number.parseInt(d,16).toString());if(!H)return;const ie=Ze(H.icon),ae=R>1?_t(ie,R):ie;x={type:"multiplier",performance:{physics:1,magic:1,darkness:1},id:Number.parseInt(d,16),fullIcon:ae,name:H.name,isFriendly:H.isFriendly}}const Q=a[r.GainsEffect.fields.duration],j=a[r.GainsEffect.fields.source],P=a[r.GainsEffect.fields.sourceId],ee=new Date(a[r.GainsEffect.fields.timestamp]).getTime()+Number.parseFloat(Q)*1e3,te={name:x.name,count:R,effect:p,effectId:d,source:j,sourceId:P,target:y,targetId:C,expirationTimestamp:ee,performance:x.performance,fullIcon:x.fullIcon,isPov:A.value===P};C.startsWith("1")&&x.isFriendly?(b.friendly[C]===void 0&&(b.friendly[C]={}),b.friendly[C][d]=te):C.startsWith("4")&&!x.isFriendly&&(b.enemy[y]===void 0&&(b.enemy[y]={}),b.enemy[y][d]=te)}break;case"losesEffect":{const d=a[r.LosesEffect.fields.target],p=a[r.LosesEffect.fields.targetId],y=a[r.LosesEffect.fields.effectId];p.startsWith("1")?b.friendly[p]&&Reflect.deleteProperty(b.friendly[p],y):b.enemy[d]&&Reflect.deleteProperty(b.enemy[d],y)}break;case"addCombatant":if(a[r.AddedCombatant.fields.job]!=="00"){const d=a[r.AddedCombatant.fields.job],p=new Date(a[r.AddedCombatant.fields.timestamp]).getTime();J.value[a[r.AddedCombatant.fields.id]]={job:Number.parseInt(d,16),timestamp:p}}break;case"removingCombatant":Reflect.deleteProperty(J.value,a[r.RemovedCombatant.fields.id]);break;case"primaryPlayer":{A.value=a[r.ChangedPlayer.fields.id];const d=a[r.ChangedPlayer.fields.name];if(E.value===d)return;E.value=d,t.initEnvironment(a[r.ChangedPlayer.fields.name]);break}case"partyList":we.value=((w=(g=G.groups)==null?void 0:g.list)==null?void 0:w.split("|"))??[];break;case"changeZone":Ee.value=a[r.ChangeZone.fields.name],Le(new Date(a[r.ChangeZone.fields.timestamp]).getTime());break;case"inCombat":{const d=a[r.InCombat.fields.inACTCombat]==="1",p=a[r.InCombat.fields.inGameCombat]==="1",y=new Date(a[r.InCombat.fields.timestamp]).getTime();if(d||p){if(_.value>0)return;l.value[0].table.length!==0&&(l.value[0]=Ft(l.value[0]),l.value.unshift({zoneName:"",duration:"00:00",table:[],key:a[r.InCombat.fields.timestamp]}),l.value.length>=le.runtime&&l.value.splice(l.value.length-1,1)),_.value=y,l.value[0].zoneName=Ee.value,L.value=0;return}if(!d&&!p){Le(y);return}}break;case"rsv":{const d=Number((Z=G.groups)==null?void 0:Z.id),p=a[r.RSVData.fields.value];je.value[Number(d)]=p}break;case"networkDoT":if(!s.parseDoT)return;{const d=a[r.NetworkDoT.fields.which],p=a[r.NetworkDoT.fields.id];if(d!=="DoT"||p.startsWith("4")||!(p===A.value||we.value.includes(p)||me.value.find(ae=>ae.id===p)))return;const y=a[r.NetworkDoT.fields.name],C=a[r.NetworkDoT.fields.damage],R=Number.parseInt(C,16),x=new Date(a[r.Ability.fields.timestamp]??"???").getTime(),Q=Number(a[r.NetworkDoT.fields.currentHp]),j=Number(a[r.NetworkDoT.fields.maxHp]),P=_.value===0?0:x-_.value,he=fe(P),ee=He(p),te=V.nameToFullName(V.jobEnumToJob(ee)).simple2,H=ee,ie=V.jobEnumToIcon(H).toLowerCase();Oe({timestamp:x,time:he,id:void 0,action:d,actionCN:d,source:"",target:y,targetId:p,job:te,jobIcon:ie,jobEnum:H,amount:R,keigenns:[],currentHp:Q,maxHp:j,effect:"damage done",type:"dot",shield:Fe[p],povId:A.value})}break;case"ability":if(_.value===0)return;{const d=It(a);if(d.isAttack&&d.amount>=0){const p=a[r.Ability.fields.sourceId]??"???",y=a[r.Ability.fields.targetId]??"???";if(!(p.startsWith("4")&&y.startsWith("1"))||!(y===A.value||we.value.includes(y)||me.value.find(U=>U.id===y)))return;const C=new Date(a[r.Ability.fields.timestamp]??"???").getTime(),R=a[r.Ability.fields.ability],x=R.match(/^_rsv_(?<id>\d+)_/),Q=a[r.Ability.fields.id]??"???";let j=R;if(x){const U=Number((Y=x.groups)==null?void 0:Y.id);j=je.value[U]??((X=(q=R.match(/^_(?<id>rsv_\d+)_/))==null?void 0:q.groups)==null?void 0:X.id)}else if(j=j.replace(/unknown_.*/,"攻击"),s.parseAA===!1&&/^攻击|攻撃|[Aa]ttack$/.test(j))return;const P=$t(Number.parseInt(Q,16)),he=P&&P!==""?P:j,ee=Number(a[r.Ability.fields.targetCurrentHp])??"???",te=Number(a[r.Ability.fields.targetMaxHp])??"???",H=a[r.Ability.fields.source]??"???",ie=a[r.Ability.fields.target]??"???",{effect:ae,type:lt}=xt(d.flags),dt=_.value===0?0:C-_.value,mt=fe(dt),Re=He(y),pt=V.nameToFullName(V.jobEnumToJob(Re)).cn.substring(0,2),ze=Re,ut=V.jobEnumToIcon(ze).toLowerCase(),ft=Nt(Object.values(b.friendly[y]??[]).concat(Object.values(b.enemy[H]??[])).filter(U=>{const be=Math.max(0,(U.expirationTimestamp-C)/1e3);return U.remainingDuration=be>=999?"":be.toFixed(be>.05&&be<.95?1:0),Number(U.remainingDuration)>-3}));Oe({timestamp:C,time:mt,id:Q,action:j,actionCN:he,source:H,target:ie,targetId:y,job:pt,jobIcon:ut,jobEnum:ze,amount:d.amount,keigenns:ft,currentHp:ee,maxHp:te,effect:ae,type:lt,shield:Fe[((f=G.groups)==null?void 0:f.targetId)??""],povId:A.value}),l.value[0].duration=fe(new Date(a[r.Ability.fields.timestamp]).getTime()-_.value)}break}}}}},He=e=>{const i=J.value[e],o=me.value.find(u=>u.id===e)??{job:0,timestamp:0};return[i,o].sort((u,g)=>g.timestamp-u.timestamp)[0].job},Oe=e=>{l.value[0].table.unshift(e)},Le=e=>{_.value!==0&&(l.value[0].duration=fe(e-_.value),_.value=0,b.friendly={},b.enemy={},ue())},ue=()=>{localStorage.setItem(Ue,JSON.stringify(l.value.slice(0,le.localStorage)))},tt=()=>{const e=localStorage.getItem(Ue);if(e)try{const i=JSON.parse(e);l.value.length=0,l.value.push(...i)}catch(i){console.error(i)}},fe=e=>{const i=Math.max(Math.floor(e/6e4),0),o=Math.max(Math.floor((e-i*6e4)/1e3),0);return`${i<10?"0":""}${i}:${o<10?"0":""}${o}`},it=Ie(()=>{const e=new Set(l.value[L.value].table.map(i=>s.actionCN?i.actionCN:i.action));return Array.from(e).map(i=>({label:i,value:i}))}),st=Ie(()=>{const e={},i=new Set(l.value[L.value].table.slice().sort((o,u)=>V.enumSortMethod(o.jobEnum,u.jobEnum)).map(o=>(e[o.target]=o.job,o.target)));return Array.from(i).map(o=>({label:`${e[o]}（${o}）`,value:o}))});t.isDev&&(E.value="测试用户"),E.value!==""&&t.initEnvironment(E.value),bt(()=>{for(const e in J.value){const i=J.value[e];Date.now()-i.timestamp>1e3*60*60*24*1&&Reflect.deleteProperty(J.value,e)}tt(),xe("LogLine",e=>{pe(e.rawLine)}),xe("PartyChanged",e=>{me.value=e.party.map(i=>({...i,timestamp:Date.now()}))}),xe("ChangePrimaryPlayer",e=>{E.value=e.charName,A.value=Number(e.charID).toString(16).toUpperCase()})});const at=e=>{const{action:i,actionCN:o,amount:u,job:g,keigenns:w,source:Z,target:Y,time:q,type:X}=e,f=e.effect==="damage done"?"":`,${De(e.effect)}`,ge=`${q} [${g}]${Y} HP:${e.currentHp}/${e.maxHp}(${Math.round(e.currentHp/e.maxHp*100)}%)+盾:${Math.round(e.maxHp*+e.shield/100)}(${e.shield}%),受到${Z}“${i}${o!==i?`(${o})`:""}”的 ${u.toLocaleString()} 点${De(X)}伤害。减伤:${w.length===0&&f===""?"无":w.map(Ce=>s.statusCN?Ce.name:Ce.effect).join(",")+f}`;rt(ge)},rt=e=>{navigator.clipboard.writeText(e).catch(()=>{const i=document.createElement("input");i.value=e,document.body.appendChild(i),i.select(),document.execCommand("copy"),document.body.removeChild(i)}),Be.modal.message({content:"已复制到剪贴板",status:"success"})},z=M({target:!1,action:!1}),K=M(),_e=vt({className:"my-menus",body:{options:[]}});kt(()=>{var e,i,o,u;(e=_e.body)!=null&&e.options&&de.value&&(_e.body.options[0]=[{code:"copy",name:"复制详情",prefixIcon:"vxe-icon-copy",className:"my-copy-item"},{code:"clearFilterAction",name:"取消技能筛选",prefixIcon:"vxe-icon-funnel-clear",className:"my-clear-filter",visible:z.value.action,disabled:!1},{code:"filterSelectAction",name:(i=K.value)!=null&&i[I.value]?`只看 ${(o=K.value)==null?void 0:o[I.value]}`:"只看该技能",prefixIcon:"vxe-icon-info-circle",visible:!z.value.action,disabled:!1},{code:"clearFilterTarget",name:"取消玩家筛选",prefixIcon:"vxe-icon-funnel-clear",visible:z.value.target,disabled:!1},{code:"filterSelectTarget",name:(u=K.value)!=null&&u.target?`只看[${K.value.job}] ${K.value.target}`:"只看该玩家",prefixIcon:"vxe-icon-user-fill",visible:!z.value.target,disabled:!1}])});const nt=()=>{k.value=!k.value},ot=({row:e})=>{const i=de.value;i&&(i.setCurrentRow(e),K.value=e)},ct=({menu:e,row:i})=>{const o=de.value;switch(e.code){case"copy":if(!i){Be.modal.message({content:"未选中有效数据行",status:"error"});return}at(i);break;case"clearFilterTarget":o&&(o.clearFilter(o.getColumnByField("target")),z.value.target=!1);break;case"clearFilterAction":o&&(o.clearFilter(o.getColumnByField(I.value)),z.value.action=!1);break;case"filterSelectTarget":if(o){const u=o.getColumnByField("target");if(u){const g=u.filters.find(w=>w.value===i.target);if(!g)return;g.checked=!0,o.updateData().then(()=>{o.scrollToRow(i),z.value.target=!0})}}break;case"filterSelectAction":if(o){const u=o.getColumnByField(I.value);if(u){const g=u.filters.find(w=>w.value===i[I.value]);if(!g)return;g.checked=!0,o.updateData().then(()=>{o.scrollToRow(i),z.value.action=!0})}}break}},ye={clearData:()=>{L.value=0,l.value.length=0,l.value.push({key:Date.now().toString(),zoneName:"测试地区",duration:"00:00",table:[]}),_.value=0,b.friendly={},b.enemy={},ue()},fakeData:()=>{l.value[0].table.push({timestamp:1e4,time:l.value[0].table.length.toString(),id:void 0,action:"测试动作",actionCN:"测试动作",source:"测试敌人",target:E.value,targetId:"1234567890",job:"战士",jobIcon:"warrior",jobEnum:0,amount:1e3,keigenns:[{name:"整体盾",count:0,effect:"整体盾",effectId:"D25",source:"芸豆角包子",sourceId:"1011A008",target:"芸豆角包子",targetId:"1011A008",expirationTimestamp:1712757148883,performance:{physics:1,magic:1,darkness:1},fullIcon:"012000/012972",isPov:!1,remainingDuration:"14"},{name:"整体论",count:0,effect:"整体论",effectId:"BBB",source:"芸豆角包子",sourceId:"1011A008",target:"芸豆角包子",targetId:"1011A008",expirationTimestamp:1712757138883,performance:{physics:1,magic:1,darkness:1},fullIcon:"012000/012971",isPov:!1,remainingDuration:"4"},{name:"均衡预后",count:0,effect:"均衡预后",effectId:"A31",source:"芸豆角包子",sourceId:"1011A008",target:"芸豆角包子",targetId:"1011A008",expirationTimestamp:1712757153915,performance:{physics:1,magic:1,darkness:1},fullIcon:"012000/012954",isPov:!1,remainingDuration:"19"}],currentHp:1e3,maxHp:1e3,effect:"damage done",type:"magic",shield:"0",povId:A.value}),ue()},fakeLogDamage:()=>{_.value=Date.now(),pe(`21|${new Date}|4000044A|万魔殿|829A|尖脚|${A.value}|${E.value}|720203|B0F10000|9F0E|8200000|1B|829A8000|0|0|0|0|0|0|0|0|0|0|155065|155065|10000|10000|||94.62|98.28|0.00|-3.13|44|44|0|10000|||92.00|100.00|0.00|0.00|000010B3|0|1|fd5fa47ff773c3ca`)},fakeLogStatus:()=>{pe(`26|${new Date}|59|复仇|15.00|${A.value}|${E.value}|${A.value}|${E.value}|64|129221|129221|b6388ee76760c33b`)}};return(e,i)=>{const o=re("vxe-option"),u=re("vxe-select"),g=re("vxe-button"),w=re("vxe-column"),Z=Qt,Y=Yt,q=Pt,X=re("vxe-table");return $(),T(Ne,null,[m("div",{class:"wrapper",style:O},[m("header",null,[Pe(h(u,{modelValue:c(L),"onUpdate:modelValue":i[0]||(i[0]=f=>wt(L)?L.value=f:null),size:"mini",class:"select"},{default:S(()=>[($(!0),T(Ne,null,We(c(l).length,f=>($(),Ve(o,{key:`${c(l)[f-1].key}-${c(l)[f-1].duration}-${c(l)[f-1].zoneName}`,value:f-1,label:`${c(l)[f-1].duration} ${c(l)[f-1].zoneName}`},null,8,["value","label"]))),128))]),_:1},8,["modelValue"]),[[Me,!c(k)]]),h(g,{class:"minimize",icon:c(k)?"vxe-icon-fullscreen":"vxe-icon-minimize",onClick:nt,style:Je({opacity:c(k)?.5:1})},null,8,["icon","style"])]),Pe(m("main",null,[h(X,{ref_key:"xTable",ref:de,size:"mini",class:"vxe-table","show-overflow":"tooltip",round:"",height:"100%","scroll-y":{enabled:!0},loading:c(se),"show-header":c(s).showHeader,data:c(l)[c(L)].table,"row-config":{isHover:!0,height:F.line_height},"header-cell-style":{padding:"0px"},onCellMenu:ot,"menu-config":c(_e),onMenuClick:ct},{default:S(()=>[h(w,{width:F.time,field:"time",title:"时间",align:"center"},null,8,["width"]),h(w,{width:F.action,field:c(s).actionCN?"actionCN":"action",title:"技能",filters:c(it),"filter-multiple":!1,resizable:!1,align:"center"},null,8,["width","field","filters"]),h(w,{width:F.target,field:"target",title:c(s).showName?"目标":"目",filters:c(st),"filter-multiple":!1,resizable:!c(s).anonymous&&!c(s).abbrId,align:"left","header-align":"center"},{default:S(({row:f})=>[h(Z,{row:f},null,8,["row"])]),_:1},8,["width","title","filters","resizable"]),h(w,{width:F.amount,title:"伤害","header-align":"center"},{default:S(({row:f})=>[h(Y,{row:f},null,8,["row"])]),_:1},8,["width"]),h(w,{title:"减伤",align:"left"},{default:S(({row:f})=>[h(q,{row:f},null,8,["row"])]),_:1})]),_:1},8,["loading","show-header","data","row-config","menu-config"])],512),[[Me,!c(k)]])]),c(t).isDev?($(),T("div",ei,[m("div",ti,[h(g,{class:"test-button",type:"primary",onClick:ye.clearData},{default:S(()=>[ne(" 清空 ")]),_:1},8,["onClick"]),h(g,{class:"test-button",type:"primary",onClick:ye.fakeData},{default:S(()=>[ne(" 假条目 ")]),_:1},8,["onClick"]),h(g,{class:"test-button",type:"primary",onClick:ye.fakeLogDamage},{default:S(()=>[ne(" 假伤害 ")]),_:1},8,["onClick"]),h(g,{class:"test-button",type:"primary",onClick:ye.fakeLogStatus},{default:S(()=>[ne(" 假状态 ")]),_:1},8,["onClick"])]),h(Ct,{onBeforeHandle:Qe,onAfterHandle:et,onHandleLine:pe})])):$e("",!0)],64)}}});export{pi as default};
