import{az as Y,q as A,Y as te,b as q,o as h,e as O,t as c,a as o,w as a,F as ne,L as oe,u as e,c as N,a1 as ae,ad as se,a2 as le,G as ce,H as ie,d as re,n as P,aA as de,y as r,a0 as $,x as v,aB as E,aC as ue,J as pe,ah as me,B as _e,ak as fe,N as he,al as be,aD as we,aE as ge,as as ve,ap as Ce,af as ye,C as Se,ag as Ee}from"./vendor-8bdaa26a.js";import{_ as M}from"./_plugin-vue_export-helper-c27b6911.js";import{C as G}from"./content_type-52b79aff.js";import{a as j,r as Ve,c as Re}from"./overlay_plugin_api-409cb9ea.js";import{N as Z,c as Te,l as H}from"./netregexes-60f54b26.js";import{z as ke}from"./zoneInfo-a419d684.js";const xe=V=>(ce("data-v-179b86b4"),V=V(),ie(),V),Oe={class:"language-switcher"},Ue={class:"select-wrapper"},Be=xe(()=>c("svg",{class:"globe-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[c("circle",{cx:"12",cy:"12",r:"10"}),c("line",{x1:"2",y1:"12",x2:"22",y2:"12"}),c("path",{d:"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"})],-1)),Le={__name:"LanguageSwitcher",setup(V){const{locale:t,availableLocales:u}=Y(),m={zhCn:"简体中文",en:"English",ja:"日本語"},b=A("user-locale",t.value);return te(b,C=>{t.value=C}),q(()=>{t.value=b.value}),(C,U)=>{const z=se,B=le;return h(),O("div",Oe,[c("div",Ue,[Be,o(B,{modelValue:e(b),"onUpdate:modelValue":U[0]||(U[0]=y=>ae(b)?b.value=y:null),size:"small",class:"language-select"},{default:a(()=>[(h(!0),O(ne,null,oe(e(u),(y,L)=>(h(),N(z,{key:L,value:y,label:m[y]},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])])])}}},De=M(Le,[["__scopeId","data-v-179b86b4"]]),Ie={class:"obs-container"},Pe={class:"card-header"},Ae={class:"act-not-ready-content"},Ne={key:1},ze={class:"card-header"},$e={key:1},Ge={class:"card-header"},Fe={class:"status-info"},We={class:"button-container"},je={class:"card-header"},Ze=re({__name:"obs2",setup(V){const{t}=Y(),u=A("obs-user-config",{host:4455,password:""}),m=A("obs-user-content-setting",[]),b=A("obs-is-first-time",!0),C=P(!1),U=P(!1),z=P([]),B=P("");function y(){return new Promise(d=>{Re({call:"cactbotRequestState"}).then(()=>{C.value=!0,d()}),setTimeout(()=>{C.value||y()},3e3)})}const L={inCombat:Z.inCombat(),countdown:Z.countdown(),wipe:Te.wipe},R=["Raids","UltimateRaids","Dungeons","Trials","VCDungeonFinder","DeepDungeons","Guildhests","DisciplesOfTheLand","Eureka","GrandCompany","QuestBattles","TreasureHunt","Pvp"];function J(){const d=["Raids","UltimateRaids"];if(b.value)b.value=!1,m.value=[...d.map(n=>({type:n,enter:!1,countdown:!0,combatStart:!1,combatEnd:!0,wipe:!0})),...R.filter(n=>!d.includes(n)).map(n=>({type:n,enter:!1,countdown:!1,combatStart:!1,combatEnd:!1,wipe:!1}))];else{m.value=m.value.filter(i=>R.includes(i.type));const n=R.filter(i=>!m.value.some(p=>p.type===i)).map(i=>d.includes(i)?{type:i,enter:!1,countdown:!0,combatStart:!1,combatEnd:!0,wipe:!0}:{type:i,enter:!1,countdown:!1,combatStart:!1,combatEnd:!1,wipe:!1});m.value.push(...n)}m.value.sort((n,i)=>R.indexOf(n.type)-R.indexOf(i.type))}class K{constructor(){this.handleConnectionError=()=>{this.status.connecting=!1,this.status.connected=!1,this.status.recording=!1,this.status.outputActive=!1,this.status.outputPath="",E.modal.close(),E.modal.message({title:t("OBS Connection"),content:t("OBS Connection Error"),status:"warning",duration:2e3})},this.handleConnectionClosed=()=>{this.status.connecting=!1,this.status.connected=!1,this.status.recording=!1,this.status.outputActive=!1,this.status.outputPath="",E.modal.close(),E.modal.message({title:t("OBS Connection"),content:t("OBS Connection Closed"),status:"warning",duration:2e3})},this.ws=new ue,this.status=pe({connecting:!1,connected:!1,recording:!1,outputActive:!1,outputPath:""}),this.ws.on("ConnectionClosed",this.handleConnectionClosed),this.ws.on("ConnectionError",this.handleConnectionError),this.ws.on("RecordStateChanged",n=>{this.status.connected=!0,this.status.recording=n.outputState==="OBS_WEBSOCKET_OUTPUT_STARTED",this.status.outputActive=n.outputActive,this.status.outputPath=n.outputPath})}connect(){u.value.host&&u.value.password&&(this.status.connecting=!0,this.ws.connect(`ws://127.0.0.1:${u.value.host}`,u.value.password).then(()=>{this.ws.call("GetRecordStatus").then(n=>{this.status.recording=n.outputActive,this.status.outputActive=n.outputActive}),this.status.connected=!0,E.modal.close(),E.modal.message({title:t("OBS Connection"),content:t("OBS Connection Opened"),status:"success",duration:2e3})}).finally(()=>{this.status.connecting=!1}))}disconnect(){this.ws.disconnect()}startRecord(){this.ws.call("StartRecord")}stopRecord(){this.ws.call("StopRecord")}splitRecord(){this.ws.call("StopRecord").finally(()=>{setTimeout(()=>{this.ws.call("StartRecord")},1e3)})}}const l=new K,F=d=>{var p;const n=d.zoneID,i=(p=ke[n])==null?void 0:p.contentType;for(const _ in G)if(Object.prototype.hasOwnProperty.call(G,_)&&G[_]===i){B.value=_,T("enter");return}},Q=d=>{var i,p;const n=d.rawLine;for(const _ in L){const w=L[_].exec(n);if(w){const D=n.split("|");switch(_){case"partyList":{z.value=((p=(i=w.groups)==null?void 0:i.list)==null?void 0:p.split("|"))??[];break}case"inCombat":{const I=D[H.InCombat.fields.inACTCombat]==="1",S=D[H.InCombat.fields.inGameCombat]==="1";if(I&&S){T("combatStart");return}if(!I&&!S){T("combatEnd");return}break}case"countdown":{T("countdown");break}case"wipe":{T("wipe");break}}}}};function T(d){const n=l.status.recording;if(m.value.find(i=>i.type===B.value&&i[d]))switch(d){case"enter":case"countdown":case"combatStart":n?l.splitRecord():l.startRecord();return;case"combatEnd":case"wipe":n&&l.stopRecord()}}return q(async()=>{await y(),l.connect(),j("ChangeZone",F),j("LogLine",Q),J()}),de(()=>{l.disconnect(),Ve("ChangeZone",F)}),(d,n)=>{const i=De,p=me,_=_e,k=fe,w=he,D=be,I=we,S=ge,W=ve,X=Ce,g=ye,x=Se,ee=Ee;return h(),O("div",Ie,[c("header",null,[c("h1",null,r(e(t)("OBS Auto Record V2")),1),o(i)]),e(C)?$("",!0):(h(),N(p,{key:0,class:"act-not-ready-card"},{header:a(()=>[c("div",Pe,[c("span",null,r(e(t)("ACT Not Ready")),1)])]),default:a(()=>[c("div",Ae,[c("p",null,r(e(t)("overlayTutorial")),1)])]),_:1})),e(C)?(h(),O("main",Ne,[e(l).status.connected?(h(),O("div",$e,[e(U)?(h(),N(p,{key:0,class:"status-card"},{header:a(()=>[c("div",Ge,[c("span",null,r(e(t)("Connection Status")),1),o(w,{type:"danger",size:"small",class:"disconnect-button",onClick:n[3]||(n[3]=s=>e(l).disconnect())},{default:a(()=>[v(r(e(t)("Disconnect")),1)]),_:1})])]),default:a(()=>[c("div",Fe,[o(X,{direction:"vertical",column:1,border:""},{default:a(()=>[o(W,{label:e(t)("Recording")},{default:a(()=>[v(r(e(l).status.recording?e(t)("Yes"):e(t)("No")),1)]),_:1},8,["label"]),o(W,{label:e(t)("Output Path")},{default:a(()=>[v(r(e(l).status.outputPath||e(t)("None")),1)]),_:1},8,["label"])]),_:1})]),c("div",We,[o(w,{disabled:!e(l).status.connected||e(l).status.recording,type:"primary",onClick:n[4]||(n[4]=s=>e(l).startRecord())},{default:a(()=>[v(r(e(t)("Start Record")),1)]),_:1},8,["disabled"]),o(w,{disabled:!e(l).status.connected||!e(l).status.recording,type:"danger",onClick:n[5]||(n[5]=s=>e(l).stopRecord())},{default:a(()=>[v(r(e(t)("Stop Record")),1)]),_:1},8,["disabled"]),o(w,{disabled:!e(l).status.connected||!e(l).status.recording,type:"warning",onClick:n[6]||(n[6]=s=>e(l).splitRecord())},{default:a(()=>[v(r(e(t)("Split Record")),1)]),_:1},8,["disabled"])])]),_:1})):$("",!0),o(p,{class:"table-card"},{header:a(()=>[c("div",je,[c("span",null,r(e(t)("User Content Settings")),1)])]),default:a(()=>[o(ee,{data:e(m),style:{width:"100%"},border:!0,stripe:""},{default:a(()=>[o(g,{prop:"type",label:e(t)("Type"),"min-width":"120"},{default:a(s=>[c("span",null,r(e(t)(s.row.type)),1)]),_:1},8,["label"]),o(g,{label:e(t)("Start When"),align:"center"},{default:a(()=>[o(g,{prop:"enter",label:e(t)("Enter Zone"),align:"center",width:"100"},{default:a(s=>[o(x,{modelValue:s.row.enter,"onUpdate:modelValue":f=>s.row.enter=f},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),o(g,{prop:"countdown",label:e(t)("CountDown"),align:"center",width:"100"},{default:a(s=>[o(x,{modelValue:s.row.countdown,"onUpdate:modelValue":f=>s.row.countdown=f},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),o(g,{prop:"combatStart",label:e(t)("CombatStart"),align:"center",width:"100"},{default:a(s=>[o(x,{modelValue:s.row.combat,"onUpdate:modelValue":f=>s.row.combat=f},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"])]),_:1},8,["label"]),o(g,{label:e(t)("End When"),align:"center"},{default:a(()=>[o(g,{prop:"combatEnd",label:e(t)("CombatEnd"),align:"center",width:"100"},{default:a(s=>[o(x,{modelValue:s.row.leave,"onUpdate:modelValue":f=>s.row.leave=f},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),o(g,{prop:"wipe",label:e(t)("Wipe"),align:"center",width:"100"},{default:a(s=>[o(x,{modelValue:s.row.wipe,"onUpdate:modelValue":f=>s.row.wipe=f},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"])]),_:1},8,["label"])]),_:1},8,["data"])]),_:1}),o(S,{class:"instruction-alert",type:"info",description:e(t)("hideTutorial"),closable:!1,"show-icon":""},null,8,["description"])])):(h(),N(p,{key:0,class:"connection-card"},{header:a(()=>[c("div",ze,[c("span",null,r(e(t)("Connect to OBS")),1)])]),default:a(()=>[o(D,{"label-position":"top",class:"connection-form"},{default:a(()=>[o(k,{label:e(t)("Port")},{default:a(()=>[o(_,{modelValue:e(u).host,"onUpdate:modelValue":n[0]||(n[0]=s=>e(u).host=s),placeholder:e(t)("portPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(k,{label:e(t)("Password")},{default:a(()=>[o(_,{modelValue:e(u).password,"onUpdate:modelValue":n[1]||(n[1]=s=>e(u).password=s),placeholder:e(t)("passwordPlaceholder"),type:"password"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(k,null,{default:a(()=>[o(w,{type:"primary",class:"connect-button",loading:e(l).status.connecting,disabled:e(l).status.connecting||!e(u).host||!e(u).password,onClick:n[2]||(n[2]=s=>e(l).connect())},{default:a(()=>[v(r(e(l).status.connecting?e(t)("Connecting"):e(t)("Connect")),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1}),o(I,null,{default:a(()=>[v(r(e(t)("Instructions")),1)]),_:1}),o(S,{class:"instruction-alert",type:"info",description:e(t)("obsTutorial"),closable:!1,"show-icon":""},null,8,["description"]),o(S,{class:"instruction-alert",type:"info",description:e(t)("inputTutorial"),closable:!1,"show-icon":""},null,8,["description"])]),_:1}))])):$("",!0)])}}});const Qe=M(Ze,[["__scopeId","data-v-263fb1bb"]]);export{Qe as default};
