import{c as h}from"./overlay_plugin_api-409cb9ea.js";import{A as m}from"./actWS-e2500b62.js";import{n as c,b as f,X as w,T as u}from"./vendor-11da2b7e.js";function P(o){return new Promise((a,s)=>{const e=document.createElement("textarea");e.value=o,document.body.appendChild(e),e.select();try{document.execCommand("copy"),a()}catch(n){s(n)}finally{document.body.removeChild(e)}})}function C(){const o=window.location.href,[a,s=""]=o.split("#"),[e,n=""]=s.split("?"),r=new URLSearchParams(n);let t="";r.forEach((d,i)=>{i!=="OVERLAY_WS"&&(t+=`${i}=${encodeURIComponent(d)}&`)}),t+="OVERLAY_WS=ws://127.0.0.1:10501/ws";let l=a;e&&(l+=`#${e}`,t&&(l+=`?${t}`)),window.location.href=l,location.reload()}function b(o={allowClose:!1,addWsParam:!0}){const a=c(void 0),s=c(!1),e=c(void 0);function n(){Promise.race([h({call:"cactbotRequestState"}),new Promise((t,l)=>{setTimeout(()=>{l(new Error("Timeout"))},1e3)})]).then(()=>{a.value=!0}).catch(()=>{a.value=!1})}function r(){s.value||u.alert(`请按照下图设置<img src='${m}' style='width:100%'>`,o.allowClose?"未连接到 ACT":"未连接到 ACT，无法使用",{dangerouslyUseHTMLString:!0,closeOnClickModal:!1,showClose:!1,closeOnPressEscape:!1,closeOnHashChange:!1,showCancelButton:o.allowClose,showConfirmButton:!1,cancelButtonText:"我偏要看看",buttonSize:"small"}).catch(()=>{s.value=!0})}return f(()=>{w(a,t=>{t?u.close():r()}),!window.location.href.includes("OVERLAY_WS")&&o.addWsParam?(e.value="websocket",C()):e.value="overlay",n(),setInterval(()=>{n()},3e3)}),{wsConnected:a,useType:e}}export{P as c,b as u};
