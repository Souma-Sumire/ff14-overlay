import{ax as Q,q as L,Y as ne,b as Y,o as h,e as k,t as r,a,w as o,F as ae,L as oe,u as e,c as P,a1 as se,ad as le,a2 as ce,G as re,H as ie,d as de,n as N,ay as ue,y as d,a0 as $,x as v,az as V,aA as pe,J as me,ah as _e,B as fe,ak as he,N as be,al as we,aB as ge,aC as ve,as as Ce,ap as ye,af as Se,C as Ee,ag as Ve}from"./vendor-9c3ca848.js";import{_ as q}from"./_plugin-vue_export-helper-c27b6911.js";import{C as p}from"./content_type-52b79aff.js";import{a as Z,r as H,c as Te}from"./overlay_plugin_api-409cb9ea.js";import{N as W,c as Re,l as j}from"./netregexes-60f54b26.js";import{z as ke}from"./zoneInfo-a419d684.js";const xe=T=>(re("data-v-66d37cfa"),T=T(),ie(),T),Oe={class:"language-switcher"},De={class:"select-wrapper"},Ue=xe(()=>r("svg",{class:"globe-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[r("circle",{cx:"12",cy:"12",r:"10"}),r("line",{x1:"2",y1:"12",x2:"22",y2:"12"}),r("path",{d:"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"})],-1)),Be={__name:"LanguageSwitcher",setup(T){const{locale:t,availableLocales:u}=Q(),m={zhCn:"简体中文",en:"English",ja:"日本語"},b=L("user-locale",t.value);return ne(b,C=>{t.value=C}),Y(()=>{t.value=b.value}),(C,x)=>{const O=le,D=ce;return h(),k("div",Oe,[r("div",De,[Ue,a(D,{modelValue:e(b),"onUpdate:modelValue":x[0]||(x[0]=y=>se(b)?b.value=y:null),size:"small",class:"language-select"},{default:o(()=>[(h(!0),k(ae,null,oe(e(u),(y,S)=>(h(),P(O,{key:S,value:y,label:m[y]},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])])])}}},Le=q(Be,[["__scopeId","data-v-66d37cfa"]]),Pe={class:"obs-container"},Ae={class:"card-header"},Ie={class:"act-not-ready-content"},Ne={key:1},$e={class:"card-header"},ze={key:1},Ge={class:"card-header"},Fe={class:"status-info"},Ze={class:"button-container"},He={class:"card-header"},We=de({__name:"obs2",setup(T){const{t}=Q(),u=L("obs-user-config",{host:4455,password:""}),m=L("obs-user-content-setting",[]),b=L("obs-is-first-time",!0),C=N(!1),x=N(!1),O=N({});function D(){return new Promise(i=>{Te({call:"cactbotRequestState"}).then(()=>{C.value=!0,i()}),setTimeout(()=>{C.value||D()},3e3)})}const y={inCombat:W.inCombat(),countdown:W.countdown(),wipe:Re.wipe},S=["Savage","Extreme","Ultimate","Dungeons","Raids","Trials","VCDungeonFinder","DeepDungeons","Guildhests","DisciplesOfTheLand","Eureka","GrandCompany","QuestBattles","TreasureHunt","Pvp"];function M(){const i=["Savage","Extreme","Ultimate"];if(b.value)b.value=!1,m.value=[...i.map(n=>({type:n,enter:!1,countdown:!0,combatStart:!1,combatEnd:!0,wipe:!0})),...S.filter(n=>!i.includes(n)).map(n=>({type:n,enter:!1,countdown:!1,combatStart:!1,combatEnd:!1,wipe:!1}))];else{m.value=m.value.filter(c=>S.includes(c.type));const n=S.filter(c=>!m.value.some(_=>_.type===c)).map(c=>i.includes(c)?{type:c,enter:!1,countdown:!0,combatStart:!1,combatEnd:!0,wipe:!0}:{type:c,enter:!1,countdown:!1,combatStart:!1,combatEnd:!1,wipe:!1});m.value.push(...n)}m.value.sort((n,c)=>S.indexOf(n.type)-S.indexOf(c.type))}class J{constructor(){this.handleConnectionError=()=>{this.status.connecting=!1,this.status.connected=!1,this.status.recording=!1,this.status.outputActive=!1,this.status.outputPath="",V.modal.close(),V.modal.message({title:t("OBS Connection"),content:t("OBS Connection Error"),status:"warning",duration:2e3})},this.handleConnectionClosed=()=>{this.status.connecting=!1,this.status.connected=!1,this.status.recording=!1,this.status.outputActive=!1,this.status.outputPath="",V.modal.close(),V.modal.message({title:t("OBS Connection"),content:t("OBS Connection Closed"),status:"warning",duration:2e3})},this.ws=new pe,this.status=me({connecting:!1,connected:!1,recording:!1,outputActive:!1,outputPath:""}),this.ws.on("ConnectionClosed",this.handleConnectionClosed),this.ws.on("ConnectionError",this.handleConnectionError),this.ws.on("RecordStateChanged",n=>{this.status.connected=!0,this.status.recording=n.outputState==="OBS_WEBSOCKET_OUTPUT_STARTED",this.status.outputActive=n.outputActive,this.status.outputPath=n.outputPath})}connect(){u.value.host&&u.value.password&&(this.status.connecting=!0,this.ws.connect(`ws://127.0.0.1:${u.value.host}`,u.value.password).then(()=>{this.ws.call("GetRecordStatus").then(n=>{this.status.recording=n.outputActive,this.status.outputActive=n.outputActive}),this.status.connected=!0,V.modal.close(),V.modal.message({title:t("OBS Connection"),content:t("OBS Connection Opened"),status:"success",duration:2e3})}).finally(()=>{this.status.connecting=!1}))}disconnect(){this.ws.disconnect()}startRecord(){this.ws.call("StartRecord")}stopRecord(){this.ws.call("StopRecord")}splitRecord(){this.ws.call("StopRecord").finally(()=>{setTimeout(()=>{this.ws.call("StartRecord")},1e3)})}}const l=new J,z=i=>{const n=i.zoneID,c=ke[n];O.value=c},G=i=>{const n=i.rawLine;for(const c in y)if(y[c].exec(n)){const E=n.split("|");switch(c){case"inCombat":{const w=E[j.InCombat.fields.inACTCombat]==="1",B=E[j.InCombat.fields.inGameCombat]==="1";if(w&&B){U("combatStart");return}if(!w&&!B){U("combatEnd");return}break}case"countdown":{U("countdown");break}case"wipe":{U("wipe");break}}}};function K(i){var n,c;switch(i.contentType){case p.UltimateRaids:return"Ultimate";case p.Pvp:return"Pvp";case p.DeepDungeons:return"DeepDungeons";case p.VCDungeonFinder:return"VCDungeonFinder";case p.Trials:return(n=i.name.fr)!=null&&n.includes("(extrême)")?"Extreme":"Trials";case p.Raids:return(c=i.name.en)!=null&&c.includes("(Savage)")?"Savage":"Raids";case p.DisciplesOfTheLand:return"DisciplesOfTheLand";case p.Eureka:return"Eureka";case p.GrandCompany:return"GrandCompany";case p.QuestBattles:return"QuestBattles";case p.TreasureHunt:return"TreasureHunt";default:throw new Error(`Unknown content type: ${i.contentType}`)}}function U(i){const n=l.status.recording,c=K(O.value);if(m.value.find(_=>_.type===c&&_[i]))switch(i){case"enter":case"countdown":case"combatStart":n?l.splitRecord():l.startRecord();return;case"combatEnd":case"wipe":n&&l.stopRecord()}}return Y(async()=>{await D(),l.connect(),Z("ChangeZone",z),Z("LogLine",G),M()}),ue(()=>{l.disconnect(),H("ChangeZone",z),H("LogLine",G)}),(i,n)=>{const c=Le,_=_e,A=fe,E=he,w=be,B=we,X=ge,I=ve,F=Ce,ee=ye,g=Se,R=Ee,te=Ve;return h(),k("div",Pe,[r("header",null,[r("h1",null,d(e(t)("OBS Auto Record V2")),1),a(c)]),e(C)?$("",!0):(h(),P(_,{key:0,class:"act-not-ready-card"},{header:o(()=>[r("div",Ae,[r("span",null,d(e(t)("ACT Not Ready")),1)])]),default:o(()=>[r("div",Ie,[r("p",null,d(e(t)("overlayTutorial")),1)])]),_:1})),e(C)?(h(),k("main",Ne,[e(l).status.connected?(h(),k("div",ze,[a(I,{class:"instruction-alert",type:"info",description:e(t)("hideTutorial"),closable:!1,"show-icon":""},null,8,["description"]),e(x)?(h(),P(_,{key:0,class:"status-card"},{header:o(()=>[r("div",Ge,[r("span",null,d(e(t)("Connection Status")),1),a(w,{type:"danger",size:"small",class:"disconnect-button",onClick:n[3]||(n[3]=s=>e(l).disconnect())},{default:o(()=>[v(d(e(t)("Disconnect")),1)]),_:1})])]),default:o(()=>[r("div",Fe,[a(ee,{direction:"vertical",column:1,border:""},{default:o(()=>[a(F,{label:e(t)("Recording")},{default:o(()=>[v(d(e(l).status.recording?e(t)("Yes"):e(t)("No")),1)]),_:1},8,["label"]),a(F,{label:e(t)("Output Path")},{default:o(()=>[v(d(e(l).status.outputPath||e(t)("None")),1)]),_:1},8,["label"])]),_:1})]),r("div",Ze,[a(w,{disabled:!e(l).status.connected||e(l).status.recording,type:"primary",onClick:n[4]||(n[4]=s=>e(l).startRecord())},{default:o(()=>[v(d(e(t)("Start Record")),1)]),_:1},8,["disabled"]),a(w,{disabled:!e(l).status.connected||!e(l).status.recording,type:"danger",onClick:n[5]||(n[5]=s=>e(l).stopRecord())},{default:o(()=>[v(d(e(t)("Stop Record")),1)]),_:1},8,["disabled"]),a(w,{disabled:!e(l).status.connected||!e(l).status.recording,type:"warning",onClick:n[6]||(n[6]=s=>e(l).splitRecord())},{default:o(()=>[v(d(e(t)("Split Record")),1)]),_:1},8,["disabled"])])]),_:1})):$("",!0),a(_,{class:"table-card"},{header:o(()=>[r("div",He,[r("span",null,d(e(t)("User Content Settings")),1)])]),default:o(()=>[a(te,{data:e(m),style:{width:"100%"},border:!0,stripe:""},{default:o(()=>[a(g,{prop:"type",label:e(t)("Type"),"min-width":"130"},{default:o(s=>[r("span",null,d(e(t)(s.row.type)),1)]),_:1},8,["label"]),a(g,{label:e(t)("Start When"),align:"center"},{default:o(()=>[a(g,{prop:"enter",label:e(t)("Enter Zone"),align:"center","min-width":"100"},{default:o(s=>[a(R,{modelValue:s.row.enter,"onUpdate:modelValue":f=>s.row.enter=f},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),a(g,{prop:"countdown",label:e(t)("CountDown"),align:"center","min-width":"100"},{default:o(s=>[a(R,{modelValue:s.row.countdown,"onUpdate:modelValue":f=>s.row.countdown=f},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),a(g,{prop:"combatStart",label:e(t)("CombatStart"),align:"center","min-width":"100"},{default:o(s=>[a(R,{modelValue:s.row.combatStart,"onUpdate:modelValue":f=>s.row.combatStart=f},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"])]),_:1},8,["label"]),a(g,{label:e(t)("End When"),align:"center"},{default:o(()=>[a(g,{prop:"combatEnd",label:e(t)("CombatEnd"),align:"center","min-width":"100"},{default:o(s=>[a(R,{modelValue:s.row.combatEnd,"onUpdate:modelValue":f=>s.row.combatEnd=f},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),a(g,{prop:"wipe",label:e(t)("Wipe"),align:"center","min-width":"100"},{default:o(s=>[a(R,{modelValue:s.row.wipe,"onUpdate:modelValue":f=>s.row.wipe=f},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"])]),_:1},8,["label"])]),_:1},8,["data"])]),_:1})])):(h(),P(_,{key:0,class:"connection-card"},{header:o(()=>[r("div",$e,[r("span",null,d(e(t)("Connect to OBS")),1)])]),default:o(()=>[a(B,{"label-position":"top",class:"connection-form"},{default:o(()=>[a(E,{label:e(t)("Port")},{default:o(()=>[a(A,{modelValue:e(u).host,"onUpdate:modelValue":n[0]||(n[0]=s=>e(u).host=s),placeholder:e(t)("portPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(E,{label:e(t)("Password")},{default:o(()=>[a(A,{modelValue:e(u).password,"onUpdate:modelValue":n[1]||(n[1]=s=>e(u).password=s),placeholder:e(t)("passwordPlaceholder"),type:"password"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(E,null,{default:o(()=>[a(w,{type:"primary",class:"connect-button",loading:e(l).status.connecting,disabled:e(l).status.connecting||!e(u).host||!e(u).password,onClick:n[2]||(n[2]=s=>e(l).connect())},{default:o(()=>[v(d(e(l).status.connecting?e(t)("Connecting"):e(t)("Connect")),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1}),a(X,null,{default:o(()=>[v(d(e(t)("Instructions")),1)]),_:1}),a(I,{class:"instruction-alert",type:"info",description:e(t)("obsTutorial"),closable:!1,"show-icon":""},null,8,["description"]),a(I,{class:"instruction-alert",type:"info",description:e(t)("inputTutorial"),closable:!1,"show-icon":""},null,8,["description"])]),_:1}))])):$("",!0)])}}});const Ke=q(We,[["__scopeId","data-v-065ef075"]]);export{Ke as default};
