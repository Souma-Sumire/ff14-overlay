import{d as Q,m as x,p as R,r as D,o as m,e as y,a as w,w as S,t as ae,F as I,K as E,u as n,q as N,O as oe,x as G,v as U,aO as ne,aE as re,b as le,s as p,a0 as se,aP as ie,P as K,$ as ue,D as ce,G as de,c as pe}from"./vendor-4de35385.js";import{U as s,j as fe}from"./util-6ab7166a.js";import{_ as W}from"./_plugin-vue_export-helper-c27b6911.js";import{a as B,c as me}from"./overlay_plugin_api-409cb9ea.js";const _e={flex:"~ col",style:{position:"relative"}},ye=Q({__name:"dragJob",props:{party:{}},emits:["updateSortArr"],setup(j,{emit:b}){const _=j,V=b,L=x(),H=x(!0),a=x(!1),h=[{role:"tank",color:"blue"},{role:"healer",color:"green"},{role:"dps",color:"red"},{role:"crafter",color:"yellow"},{role:"gatherer",color:"purple"},{role:"none",color:"gray"}];function k(o){return _.party.find(i=>i.job===o)}const f=s.getBattleJobs3(),P=(()=>{const o={},i={tank:s.isTankJob,healer:s.isHealerJob,dps:s.isDpsJob,crafter:s.isCraftingJob,gatherer:s.isGatheringJob};for(const u of h.map(r=>r.role))o[u]=(u==="none"?[]:f.filter(r=>i[u](r))).map(r=>s.jobToJobEnum(r)).sort((r,v)=>s.enumSortMethod(r,v));return o})(),J=Object.values(P).flat().map(o=>({name:s.nameToFullName(s.jobEnumToJob(o)).simple1,id:o})),l=R("cactbotRuntime-jobList",(()=>{const o={};for(const i of h.map(u=>u.role))o[i]=J.filter(u=>P[i].includes(u.id)).sort((u,r)=>P[i].indexOf(u.id)-P[i].indexOf(r.id));return o})());l.value.dps.findIndex(o=>o.id===41)===-1&&l.value.dps.push({name:"蛇",id:41}),l.value.dps.findIndex(o=>o.id===42)===-1&&l.value.dps.push({name:"绘",id:42});function O(){V("updateSortArr",Object.values(l.value).flat().map(o=>o.id))}return(o,i)=>{const u=D("vxe-checkbox");return m(),y("div",_e,[w(u,{modelValue:a.value,"onUpdate:modelValue":i[0]||(i[0]=r=>a.value=r),size:"mini",style:{"--vxe-primary-color":"none",position:"absolute",top:"0.25rem",right:"0.25rem",background:"rgba(30, 30, 30, 0.33)",color:"white","border-radius":"0.25rem",padding:"0.08rem 0.16rem","font-size":"0.75rem","line-height":"1","box-shadow":"0 0 2px black"}},{default:S(()=>[ae(" 解除限制 ")]),_:1},8,["modelValue"]),(m(),y(I,null,E(h,(r,v)=>w(n(ne),{key:v,ref_for:!0,ref_key:"el",ref:L,modelValue:n(l)[r.role],"onUpdate:modelValue":g=>n(l)[r.role]=g,disabled:!H.value,animation:"150","ghost-class":"ghost",class:"m-b-0.25 m-t-0.25 flex flex-row gap-0.25 rounded p-0",filter:".no-draggable","force-fallback":!0,onUpdate:O},{default:S(()=>[(m(!0),y(I,null,E(n(l)[r.role],g=>N((m(),y("div",{key:g.id,class:oe(`${a.value||k(g.id)?`draggable bg-${r.color} cursor-move`:"no-draggable bg-gray-700/50 opacity-75"} rounded p-l-0.6 p-r-0.6 p-t-0 p-b-0.3 m-0 color-white`)},G(g.name),3)),[[U,_.party.find(M=>M.job===36)?!0:g.id!==36]])),128))]),_:2},1032,["modelValue","onUpdate:modelValue","disabled"])),64))])}}});const be=W(ye,[["__scopeId","data-v-153e95e1"]]),F=j=>(ce("data-v-7e19fe0d"),j=j(),de(),j),ve={class:"text-white text-shadow-sm text-shadow-color-black"},ge=F(()=>p("span",null,"用法",-1)),he=F(()=>p("p",null,"使悬浮窗的位置分配对应游戏内的实际位置（D1D2等）",-1)),xe=F(()=>p("ul",null,[p("li",null,"临时：下拉选择框修改。"),p("li",null,"长期：用鼠标拖动职能顺序。")],-1)),je={class:"players"},ke={class:"name"},Pe={key:0,style:{position:"fixed",bottom:"0"}},Je=Q({__name:"cactbotRuntime",setup(j){re.setTheme("dark");function b(e,t,c=0){return Array(t).fill(e).map((C,$)=>C+(+$+1+c))}const _=x(!1),V=R("cactbotRuntime-sortArr",fe),L=[{id:"10000001",name:"虚构战士",job:21,inParty:!0},{id:"10000002",name:"虚构骑士",job:19,inParty:!0},{id:"10000003",name:"虚构占星",job:33,inParty:!0},{id:"10000004",name:"虚构学者",job:28,inParty:!0},{id:"10000005",name:"虚构忍者",job:30,inParty:!0},{id:"10000006",name:"虚构武士",job:34,inParty:!0},{id:"10000008",name:"虚构诗人",job:23,inParty:!0},{id:"10000007",name:"虚构召唤",job:27,inParty:!0}],a=R("cactbotRuntime-data",{party:[]}),h=R("cactbotRuntime-showTips",x(!0)),k=R("cactbotRuntime-roleSelectLength",{tank:0,healer:0,dps:0,crafter:0,gatherer:0,none:0}),f={tank:["MT","ST",...b("T",6,2)],healer:[...b("H",8)],dps:[...b("D",8)],crafter:[...b("C",8)],gatherer:[...b("G",8)],none:[...b("N",8)]};function P(){for(const e in k.value)Object.prototype.hasOwnProperty.call(k.value,e)&&(k.value[e]=a.value.party.reduce((t,c)=>o(c.job)===e?t+1:t,0))}function q(e){const t=o(e);return f[t].filter((c,C)=>C<k.value[t])}const J=location.href.includes("localhost"),l=x(!1),O=x(J?L[2].name:"");function o(e){return[1,3,19,21,32,37].includes(e)?"tank":[6,24,28,33,40].includes(e)?"healer":[2,4,5,7,20,22,23,25,26,27,29,30,31,34,35,36,38,39,41,42].includes(e)?"dps":s.isCraftingJob(s.jobEnumToJob(e))?"crafter":s.isGatheringJob(s.jobEnumToJob(e))?"gatherer":"none"}function i(){a.value.party.sort((e,t)=>V.value.indexOf(e.job)-V.value.indexOf(t.job));for(const e of a.value.party)e.rp=void 0,e.rp=r(e)}function u(e){a.value.party[e].specify=!0;const t=a.value.party.find(c=>c.rp===a.value.party[e].rp&&c.id!==a.value.party[e].id);t&&(t.rp=r(t),t.specify=!0),v()}function r(e){return f[o(e.job)].find(t=>!a.value.party.find(c=>c.rp===t))??"unknown"}function v(){const e=[...f.tank,...f.healer,...f.dps,...f.crafter,...f.gatherer,...f.none];a.value.party.sort((t,c)=>e.indexOf(t.rp??"")-e.indexOf(c.rp??"")),me({call:"broadcast",source:"soumaRuntimeJS",msg:{party:a.value.party}})}function g(){l.value=!0}function M(){l.value=!1}function X(e){V.value=e,A()}function Y(e){return s.nameToFullName(s.jobEnumToJob(e)).simple1}function we(e){return e}function A(){i(),P(),v()}le(()=>{v(),B("PartyChanged",e=>{h.value&&(_.value=!0),!(J&&e.party.length===0)&&(a.value.party=e.party.filter(t=>t.inParty).map(t=>({...t,rp:"",specify:!1})),A())}),B("ChangePrimaryPlayer",e=>{J||(O.value=e.charName)}),B("BroadcastMessage",e=>{e.source==="soumaUserJS"&&typeof e.msg=="object"&&e.msg!==null&&Reflect.get(e.msg,"text")==="requestData"&&v()})});function Z(){const e={party:L};h.value&&(_.value=!0),a.value.party=e.party.filter(t=>t.inParty).map(t=>({...t,rp:"",specify:!1})),A()}return(e,t)=>{const c=D("vxe-modal"),C=D("vxe-option"),$=D("vxe-select"),ee=be;return m(),y("div",{onMouseenter:g,onMouseleave:M},[N(p("span",ve,"...",512),[[U,n(a).party.length<=1]]),w(c,{modelValue:n(_),"onUpdate:modelValue":t[0]||(t[0]=d=>se(_)?_.value=d:null),size:"small",position:{left:10,top:10},width:"90vw",onClose:t[1]||(t[1]=d=>{_.value=!1,h.value=!1})},{title:S(()=>[ge]),default:S(()=>[he,xe]),_:1},8,["modelValue"]),p("main",{style:K({width:n(l)?`${18+ +(n(a).party.find(d=>d.job===36)?1:0)}em`:"4em"})},[p("div",je,[w(ie,{name:"animate__animated animate__bounce","enter-active-class":"animate__fadeInLeft","leave-active-class":"animate__fadeOutLeft"},{default:S(()=>[(m(!0),y(I,null,E(n(a).party,(d,z)=>N((m(),y("section",{key:d.id,flex:"~ nowrap",style:K({opacity:n(l)?1:.5}),class:"player"},[w($,{modelValue:d.rp,"onUpdate:modelValue":T=>d.rp=T,size:"mini","class-name":"select",onChange:T=>u(z)},{default:S(()=>[(m(!0),y(I,null,E(q(d.job),(T,te)=>(m(),pe(C,{key:te,value:T,label:T},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),p("span",ke,G(Y(d.job))+" "+G(n(l)?d.name:""),1)],4)),[[U,n(a).party.length>1&&(n(l)||d.name===n(O))]])),128))]),_:1})]),N(w(ee,{party:n(a).party,"m-b-1":"","p-1":"",onUpdateSortArr:X},null,8,["party"]),[[U,n(l)]])],4),n(J)?(m(),y("div",Pe,[p("button",{onClick:t[2]||(t[2]=d=>{n(a).party=n(a).party.filter(z=>z.name===n(O)),A()})}," 测试单人 "),p("button",{onClick:Z}," 测试组队 ")])):ue("",!0)],32)}}});const Te=W(Je,[["__scopeId","data-v-7e19fe0d"]]);export{Te as default};
