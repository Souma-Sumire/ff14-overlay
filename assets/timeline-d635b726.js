import{d as R,J as U,n as C,q as K,p as E,b as Q,ai as b,o as c,e as r,u as n,s as W,v as X,a0 as f,F as Y,L as e2,a as t2,y as I,G as n2,H as i2,t as o2}from"./vendor-9c3ca848.js";import{u as l2,p as a2,_ as s2}from"./TimelineShow-ca532673.js";import{a as S,c as c2}from"./overlay_plugin_api-409cb9ea.js";import{_ as r2}from"./_plugin-vue_export-helper-c27b6911.js";import"./util-831b56e7.js";import"./xivapi-a5c0f7f0.js";const u2=k=>(n2("data-v-47efc762"),k=k(),i2(),k),d2={id:"wrapper"},m2=u2(()=>o2("path",{d:"M943.321212 577.163636c12.412121 18.618182 31.030303 31.030303 55.854546 37.236364 6.206061 0 12.412121 6.206061 12.412121 6.206061 6.206061 6.206061 18.618182 18.618182 18.618182 31.030303v24.824242c-6.206061 24.824242-12.412121 43.442424-24.824243 62.060606l-6.20606 12.412121c-6.206061 12.412121-12.412121 18.618182-24.824243 24.824243-6.206061 6.206061-18.618182 6.206061-24.824242 6.20606-6.206061 0-12.412121 0-18.618182-6.20606-18.618182-6.206061-37.236364-6.206061-55.854546-6.206061h6.206061-12.412121c-18.618182 0-31.030303 6.206061-43.442424 12.412121 0 0-12.412121 6.206061-24.824243 18.618182-12.412121 12.412121-24.824242 37.236364-24.824242 62.060606 0 18.618182 0 37.236364 12.412121 62.060606 6.206061 12.412121 6.206061 31.030303-6.206061 43.442425-12.412121 12.412121-24.824242 18.618182-37.236363 24.824242-6.206061 6.206061-37.236364 18.618182-68.266667 24.824242 37.236364-6.206061 12.412121 0-12.412121 0h-6.206061c-6.206061 0-12.412121 0-18.618182-6.20606-6.206061-6.206061-12.412121-12.412121-12.412121-24.824243v6.206061c-12.412121-31.030303-31.030303-55.854545-55.854545-68.266667 0-6.206061-24.824242-12.412121-49.648485-12.412121s-49.648485 6.206061-68.266667 24.824243c-24.824242 18.618182-43.442424 43.442424-49.648485 74.472727 0-6.206061-6.206061 0-12.412121 0 0 0-12.412121 6.206061-18.618182 6.20606-12.412121 0-18.618182 0-37.236363-6.20606-12.412121-6.206061-24.824242-6.206061-37.236364-12.412121l-37.236364-18.618182c-12.412121-6.206061-18.618182-12.412121-24.824242-24.824243-6.206061-6.206061-6.206061-12.412121-6.206061-18.618181 0-6.206061 0-18.618182 6.206061-31.030304 6.206061-6.206061 12.412121-24.824242 12.412121-49.648484s-12.412121-43.442424-31.030303-62.060606c-12.412121-12.412121-24.824242-18.618182-43.442424-24.824243h-24.824242-6.206061c-12.412121 0-31.030303 6.206061-49.648485 6.206061h-12.412121c-6.206061 0-12.412121 0-18.618182-6.206061-6.206061 0-12.412121-12.412121-24.824242-18.618182-18.618182-31.030303-31.030303-68.266667-37.236364-105.50303v-6.206061c0-18.618182 12.412121-24.824242 24.824242-31.030303 24.824242-6.206061 43.442424-24.824242 62.060606-43.442424 18.618182-6.206061 24.824242-31.030303 24.824243-55.854545s-6.206061-49.648485-24.824243-68.266667C62.060606 415.806061 31.030303 397.187879 0 390.981818c18.618182 6.206061 12.412121 0 12.412121-6.20606-6.206061-6.206061-6.206061-18.618182-6.20606-24.824243 0-6.206061 0-18.618182 6.20606-31.030303 6.206061-24.824242 18.618182-49.648485 31.030303-68.266667-12.412121 24.824242-6.206061 12.412121 0 6.206061 0-12.412121 6.206061-18.618182 12.412121-24.824242 6.206061 0 6.206061-6.206061 12.412122-6.206061s12.412121 0 18.618181 6.206061c24.824242 6.206061 49.648485 12.412121 74.472728 6.20606 24.824242 0 43.442424-12.412121 62.060606-31.030303 12.412121-12.412121 18.618182-24.824242 18.618182-43.442424 6.206061 0 6.206061-12.412121 6.20606-24.824242v-18.618182-18.618182c0-18.618182-6.206061-43.442424-12.412121-62.060606 6.206061 31.030303 0 18.618182 0 6.20606v0c12.412121-6.206061 18.618182-12.412121 31.030303-18.618181l37.236364-18.618182c12.412121-6.206061 24.824242-6.206061 37.236363-12.412121 12.412121-6.206061 24.824242-6.206061 31.030303-6.206061 12.412121 0 18.618182 0 24.824243 12.412121 6.206061 6.206061 12.412121 18.618182 12.412121 31.030303 6.206061 12.412121 18.618182 24.824242 37.236364 43.442424s37.236364 24.824242 62.060606 24.824243 49.648485-6.206061 68.266666-18.618182c24.824242-24.824242 37.236364-43.442424 43.442425-68.266667 0-6.206061 6.206061-12.412121 12.412121-18.618181 6.206061 0 12.412121-6.206061 18.618182-6.206061 12.412121 0 18.618182 0 31.030303 6.206061 12.412121 0 24.824242 6.206061 37.236363 12.412121 12.412121 6.206061 24.824242 12.412121 31.030303 18.618182 12.412121 6.206061 18.618182 18.618182 24.824243 24.824242 0 6.206061 6.206061 6.206061 6.20606 12.412121v6.206061c0 6.206061-6.206061 18.618182-6.20606 24.824242 0 6.206061-6.206061 24.824242-6.206061 37.236364v18.618182c6.206061 24.824242 12.412121 43.442424 31.030303 62.060606 18.618182 18.618182 37.236364 24.824242 62.060606 31.030303 24.824242 0 49.648485 0 68.266667-12.412121 6.206061 0 12.412121-6.206061 18.618182-6.206061h6.20606c6.206061 0 18.618182 6.206061 24.824243 12.412121 12.412121 12.412121 18.618182 24.824242 31.030303 43.442424 6.206061 18.618182 12.412121 43.442424 18.618182 62.060607 0 12.412121 0 24.824242-6.206061 31.030303-6.206061 6.206061-12.412121 12.412121-24.824242 18.618181-24.824242 6.206061-49.648485 31.030303-62.060606 55.854546-6.206061 6.206061-12.412121 24.824242-12.412122 49.648485-6.206061 24.824242 0 49.648485 18.618182 68.266666zM682.666667 341.333333c-43.442424-43.442424-105.50303-68.266667-167.563637-68.266666-31.030303 0-62.060606 6.206061-93.090909 18.618181-43.442424 18.618182-80.678788 49.648485-105.50303 86.884849-6.206061-6.206061-24.824242 37.236364-37.236364 80.678788 0-18.618182-6.206061 12.412121-6.20606 49.648485 0 31.030303 6.206061 62.060606 18.618181 93.090909 12.412121 31.030303 31.030303 55.854545 49.648485 74.472727 18.618182 24.824242 49.648485 37.236364 74.472728 49.648485 31.030303 12.412121 62.060606 18.618182 93.090909 18.618182s62.060606-6.206061 93.090909-18.618182c43.442424-18.618182 80.678788-49.648485 105.50303-86.884849-6.206061 12.412121 12.412121-12.412121 24.824243-43.442424 12.412121-31.030303 18.618182-62.060606 18.618181-93.090909s-6.206061-62.060606-18.618181-93.090909C713.69697 372.363636 682.666667 335.127273 645.430303 310.30303l37.236364 31.030303z","p-id":"2216"},null,-1)),f2=[m2],v2={key:1,class:"optionalTimelines"},g2=["onClick"],p2={key:7,style:{color:"white","background-color":"black"}},h2=R({__name:"timeline",setup(k){const i=l2(),s=U({loadedTimeline:[],optionalTimeline:[]}),v=C(0),u=C(0-i.configValues.preBattle),B=C(0);let h=!1;const d=K("timeline-condition",{zoneId:"0",job:"NONE"}),x=new URLSearchParams(location.hash.split("?")[1]),p=C(window.location.href.match(/localhost/)||x.get("dev")==="1"),M=C(x.get("showSettings")!=="false"),D=E(()=>s.loadedTimeline.filter(e=>e.sync)),A=E(()=>s.loadedTimeline.filter(e=>e.tts));Q(()=>{J()});function N(){const e=window.open(`/ff14-overlay-vue/#/timelineSettings?timestamp=${new Date().getTime()}`,"_blank","width=1200,height=800"),t=setInterval(()=>{e!=null&&e.closed&&(clearInterval(t),i.loadTimelineSettings(),y(d.value))},500)}function y(e){T(),s.loadedTimeline.length=0,s.optionalTimeline.length=0;const t=i.getTimeline(e);t.length===1?$(t[0]):t.length>1&&(s.optionalTimeline=t)}function z(e){$(e)}async function $(e,t=!0){t&&T(),h=!1,e!=null&&e.timeline&&(s.loadedTimeline=await a2(e.timeline),s.loadedTimeline.sort((l,o)=>l.time-o.time),b.fire({position:"top-end",icon:"success",text:`加载了${e.name}~`,showConfirmButton:!1,timer:1e3,backdrop:!1})),setTimeout(()=>{h=!0},1e3)}function T(){v.value=0,u.value=0-i.configValues.preBattle,B.value=0;for(const e of s.loadedTimeline)e.alertAlready=!1;for(const e of D.value)e.syncAlready=!1}function _(e,t=!0){t&&(h=!1,setTimeout(()=>{h=!0},1e3)),u.value=0,B.value=0,v.value=new Date().getTime()+e*1e3,A.value.forEach(l=>{l.alertAlready=!1}),L()}function L(){if(v.value===0)return;u.value=(new Date().getTime()-v.value+B.value)/1e3;const e=A.value.find(t=>!t.alertAlready&&t.time-i.configValues.ttsAdvance<=u.value);e&&(e.alertAlready=!0,e.tts&&j(e.tts)),requestAnimationFrame(L)}function F(e){var t,l,o;for(const m of e.detail.logs){const w=m.match(/^.{14} \w+ 00:(?:00b9|0[12]39)::?(?:距离战斗开始还有|Battle commencing in |戦闘開始まで)(?<cd>\d+)[^（(\d]+[（(]/i);if(w)_(Number.parseInt(((t=w==null?void 0:w.groups)==null?void 0:t.cd)||"0"));else if(/^.{14} Director 21:.{8}:4000000F/.test(m)||/^.{14} ChatLog 00:0038::end$/.test(m)||/^.{14} SystemLogMessage 29:.{8}:B1C:/.test(m))T();else{const g=D.value.find(a=>a.sync&&(a.syncOnce&&!a.syncAlready||!a.syncOnce)&&u.value>=a.time-a.windowBefore&&u.value<=a.time+Number(a.windowAfter)&&a.sync.test(m));g&&(g.syncAlready=!0,V(g.jump||g.time))}if(/^.{14} ChatLog 00:0038::/.test(m)){const g=(o=(l=m.match(/^.{14} ChatLog 00:0038::(?<name>.+)$/))==null?void 0:l.groups)==null?void 0:o.name;if(g){const a=i.getTimeline(d.value).find(Z=>Z.name===g);a&&$(a,!1)}}}}function O(e){V(e)}function V(e){v.value===0&&_(0,!1),B.value+=(e-u.value)*1e3,A.value.forEach(t=>{t.time<e&&(t.alertAlready=!0)})}const P=e=>{e.detail.job!==d.value.job?(d.value.job=e.detail.job,y(d.value)):d.value.job=e.detail.job},G=e=>{d.value.zoneId=String(e.zoneID),y(d.value)};function j(e,t=!1){e&&(h||t)&&c2({call:"cactbotSay",text:e})}const q=e=>{if(e.source==="soumuaTimelineSetting"){const t=e.msg.store;b.fire({text:`接受到${t.allTimelines.length}个时间轴`,showDenyButton:!0,denyButtonText:"覆盖",showConfirmButton:!0,confirmButtonText:"追加",showCancelButton:!0,cancelButtonText:"放弃",backdrop:!1}).then(l=>{(l.isConfirmed||l.isDenied)&&(l.isDenied&&(i.allTimelines.length=0),i.allTimelines=t.allTimelines,i.configValues=t.configValues,i.showStyle=t.showStyle,i.saveTimelineSettings(),b.fire("接受成功"),y(d.value))})}};function H(e){e.detail.inGameCombat&&e.detail.inACTCombat&&v.value===0?_(0):!e.detail.inGameCombat&&!e.detail.inACTCombat&&T()}function J(){S("onLogEvent",F),S("onPlayerChangedEvent",P),S("ChangeZone",G),S("BroadcastMessage",q),S("onInCombatChangedEvent",H),i.loadTimelineSettings(),b.isVisible()||b.fire({text:`${i.allTimelines.length}条时间轴已就绪`,showConfirmButton:!1,timer:1500,backdrop:!1}),y(d.value)}return(e,t)=>{const l=s2;return c(),r("div",d2,[n(M)?W((c(),r("svg",{key:0,t:"1652767124032",class:"icon",viewBox:"0 0 1030 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"2215",width:"16",height:"16",onClick:t[0]||(t[0]=o=>N())},f2,512)),[[X,n(v)===0]]):f("",!0),n(s).optionalTimeline.length&&n(u)<=-n(i).configValues.preBattle?(c(),r("ul",v2,[(c(!0),r(Y,null,e2(n(s).optionalTimeline,(o,m)=>(c(),r("li",{key:m,onClick:w=>z(o)},I(o.condition.job)+" - "+I(o.name),9,g2))),128))])):f("",!0),t2(l,{config:n(i).configValues,lines:n(s).loadedTimeline,runtime:n(u),"show-style":n(i).showStyle},null,8,["config","lines","runtime","show-style"]),n(p)?(c(),r("button",{key:2,onClick:t[1]||(t[1]=o=>_(30))}," 开始从-30 ")):f("",!0),n(p)?(c(),r("button",{key:3,onClick:t[2]||(t[2]=o=>_(0))}," 开始从0 ")):f("",!0),n(p)?(c(),r("button",{key:4,onClick:t[3]||(t[3]=o=>T())}," 团灭 ")):f("",!0),n(p)?(c(),r("button",{key:5,onClick:t[4]||(t[4]=o=>O(1e3))}," 跳转1000测试 ")):f("",!0),n(p)?(c(),r("button",{key:6,onClick:t[5]||(t[5]=o=>j("今天天气真不错",!0))}," TTS测试 ")):f("",!0),n(p)?(c(),r("span",p2,I(n(u)),1)):f("",!0)])}}});const S2=r2(h2,[["__scopeId","data-v-47efc762"]]);export{S2 as default};
