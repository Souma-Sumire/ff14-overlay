import{d as ze,v as T,B as Me,ay as je,o as ie,b as de,f as j,p as ft,j as yt,az as gt,A as ue,y as U,x as ht,Z as bt,r as ee,D as De,F as Se,u as b,a as c,w as te,H as fe,I as vt,a1 as kt,Q as Ft,g as xt,aA as Ct,au as It,G as E,ax as He,c as _t}from"./vendor-03596f85.js";import{_ as wt}from"./index-7fa9ac84.js";import{N as M,l as s}from"./netregexes-7057d210.js";import{U as G}from"./util-f6d3a594.js";import{c as Re,s as Et,a as Nt}from"./status-2cacdfd9.js";import{g as $t}from"./actionChinese-71b7e526.js";const Tt=i=>(ft("data-v-d140243c"),i=i(),yt(),i),At={class:"upload select"},Dt=Tt(()=>j("div",{class:"upload text"},[j("span",null,"+"),j("p",null,"上传或拖入ACT日志")],-1)),St=ze({__name:"testLog",emits:["handleLine","beforeHandle","afterHandle"],setup(i,{emit:r}){const o=r,l=T(null),a=T(null),_=async h=>{var N,V;(N=a.value)==null||N.classList.remove("drag");const g=h.target.files;if(!(!g||g.length==0)){o("beforeHandle");for(let H=0;H<g.length;H++)(await g[H].text()).split(`
`).forEach(X=>{o("handleLine",X)});o("afterHandle"),(V=a.value)==null||V.classList.remove("drag")}},C=h=>{var g;h.preventDefault(),(g=a.value)==null||g.classList.add("drag")},ne=h=>{var g;h.preventDefault(),(g=a.value)==null||g.classList.remove("drag")};return Me(()=>{var h,g,N;(h=l.value)==null||h.addEventListener("change",_),(g=a.value)==null||g.addEventListener("dragover",C),(N=a.value)==null||N.addEventListener("dragleave",ne)}),je(()=>{var h,g,N;(h=l.value)==null||h.removeEventListener("change",_),(g=a.value)==null||g.removeEventListener("dragover",C),(N=a.value)==null||N.removeEventListener("dragleave",ne)}),(h,g)=>(ie(),de("div",At,[j("div",{class:"upload-select",ref_key:"select",ref:a},[Dt,j("input",{type:"file",ref_key:"input",ref:l},null,512)],512)]))}});const Ht=wt(St,[["__scopeId","data-v-d140243c"]]);function ye(i){switch(i){case"dodge":return"闪避";case"damage done":return"击中";case"blocked damage":return"格挡";case"parried damage":return"招架";case"instant death":return"即死";case"heal":return"治疗";case"crit heal":return"暴击治疗";case"damage":return"普通";case"crit damage":return"暴击";case"direct hit damage":return"直击";case"crit direct hit damage":return"直暴";case"physics":return"物理";case"magic":return"魔法";case"darkness":return"暗黑";default:throw new Error("Unknown type")}}function Lt(i){const r=Pt(i),o=Ot(i),l=zt(i);return{effect:r,properties:o,type:l}}function Pt(i){switch(!0){case/1$/.test(i):return"dodge";case/3$/.test(i):return"damage done";case/5$/.test(i):return"blocked damage";case/6$/.test(i):return"parried damage";case/33$/.test(i):return"instant death";case/4$/.test(i):return"heal";case/2\w{4}4$/.test(i):return"crit heal";default:throw new Error("Unknown effect flag "+i)}}function Ot(i){switch(!0){case/2\w{3}$/.test(i):return"crit damage";case/4\w{3}$/.test(i):return"direct hit damage";case/6\w{3}$/.test(i):return"crit direct hit damage";default:return"damage"}}function zt(i){switch(!0){case/7?[1234]\w{3}[35]$|[16]$/.test(i):return"physics";case/^E$/.test(i):case/5\w{4}$/.test(i):return"magic";case/^(?:\d0)?3$/.test(i):case/6\w{4}$/.test(i):return"darkness";default:return console.error("Unknown type flag "+i),"physics"}}const Mt=["3E","113","213","313"],jt=["A10","E"],Rt=["04"],Ut="36",Gt=["01","03","05","06",Ut],Vt=i=>{let o=0,l=i[8]??"",a=i[8+1]??"";Mt.includes(l)&&(o+=2,l=i[8+o]??l,a=i[8+o+1]??a),jt.includes(l)&&(o+=2,l=i[8+o]??l,a=i[8+o+1]??a);const _=Bt(a),C=`00${l}`.slice(-2);return{amount:_,lowByte:C,flags:l,isHeal:Rt.includes(C),isAttack:Gt.includes(C)}},Bt=i=>{if(i===void 0)return 0;const r=i.length;if(r<=4)return 0;let o=parseInt(i.slice(0,r-4),16);if(i[r-4]==="4"){const l=parseInt(i.slice(r-2,r),16);o=o-l+(l<<16)}return o},Le=[{name:"铁壁",description:"减轻所受到的伤害",id:1191,icon:13911,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"盾阵",description:"受到攻击时必定发动格挡",id:1856,icon:12510,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"干预",description:"减轻所受到的伤害",id:1174,icon:12511,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"预警",description:"减轻所受到的伤害",id:74,icon:10151,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"武装",description:"减轻所受到的伤害",id:1176,icon:12513,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"神圣领域",description:"除特定攻击之外其他所有攻击均无效化",id:82,icon:12504,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"圣光幕帘",description:"抵消一定伤害",id:1362,icon:12509,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"圣盾阵",description:"受到攻击时必定发动格挡",id:2674,icon:12515,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"骑士的坚守",description:"减轻所受到的伤害",id:2675,icon:12516,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"壁垒",description:"受到攻击时必定发动格挡",id:77,icon:10156,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的直觉",description:"自身发动战技命中时可以恢复体力，同时减轻所受到的伤害",id:735,icon:12555,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的勇猛",description:"自身发动战技命中时可以恢复体力",id:1857,icon:12558,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的武猛",description:`附加此效果的战士受到原初的勇猛的恢复体力的效果时，会获得相当于其100%的恢复效果
另外受到攻击的伤害减少`,id:1858,icon:12559,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"战栗",description:`体力最大值提高
习得战栗效果提高后追加效果：自身所受的治疗效果提高`,id:87,icon:10254,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"复仇",description:"受到攻击的伤害减少并且受到物理攻击时会发动反击",id:89,icon:10256,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"摆脱",description:"抵消一定伤害",id:1457,icon:12557,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"死斗",description:"除特定攻击之外其他所有对自身发动的攻击均无法令体力减少到1以下",id:409,icon:10266,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的血气",description:"自身发动战技命中时可以恢复体力，同时减轻所受到的伤害",id:2678,icon:12562,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的血潮",description:"减轻所受到的伤害",id:2679,icon:12563,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的血烟",description:"抵消一定伤害",id:2680,icon:12564,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"至黑之夜",description:"抵消一定伤害",id:1178,icon:13118,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"弃明投暗",description:"减轻所受到的魔法伤害",id:746,icon:13114,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!0},{name:"暗影墙",description:"减轻所受到的伤害",id:747,icon:13113,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"暗黑布道",description:"减轻所受到的魔法伤害",id:1894,icon:13122,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!0},{name:"行尸走肉",description:`受到致命伤害时体力减为1，并附加死而不僵状态
但是对部分攻击无效`,id:810,icon:13115,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"死而不僵",description:"除特定攻击之外其他所有对自身发动的攻击均无法令体力减少到1以下",id:811,icon:13116,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"出死入生",description:"除特定攻击之外其他所有对自身发动的攻击均无法令体力减少到1以下",id:3255,icon:13124,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"献奉",description:"减轻所受到的伤害",id:2682,icon:13123,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"石之心",description:"减轻所受到的伤害",id:1840,icon:13610,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"残暴弹",description:"抵消一定伤害",id:1898,icon:13614,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"伪装",description:"招架发动率提高，减轻所受到的伤害",id:1832,icon:13602,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"星云",description:"减轻所受到的伤害",id:1834,icon:13604,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"光之心",description:"减轻所受到的魔法伤害",id:1839,icon:13609,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!0},{name:"超火流星",description:"除特定攻击之外其他所有攻击均无效化",id:1836,icon:13606,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"刚玉之心",description:"减轻所受到的伤害",id:2683,icon:13615,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"刚玉之清",description:"减轻所受到的伤害",id:2684,icon:13616,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"神祝祷",description:"抵消一定伤害",id:1218,icon:12632,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"节制",description:"减轻所受到的伤害",id:1873,icon:12633,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"水流幕",description:"减轻所受到的伤害",id:2708,icon:12638,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"鼓舞",description:"抵消一定伤害",id:297,icon:12801,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"激励",description:"抵消一定伤害",id:1918,icon:12814,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"炽天的幕帘",description:"抵消一定伤害",id:1917,icon:12848,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"野战治疗阵",description:"减轻所受到的伤害",id:299,icon:12803,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"异想的幻光",description:"发动治疗魔法的治疗量提高，且受到魔法攻击的伤害减少",id:317,icon:12828,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!0},{name:"炽天的幻光",description:"发动治疗魔法的治疗量提高，且受到魔法攻击的伤害减少",id:1875,icon:12847,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!0},{name:"生命回生法",description:"体力最大值提高，同时自身所受体力恢复效果提高",id:2710,icon:12815,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"怒涛之计",description:"减轻所受到的伤害",id:2711,icon:12816,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"命运之轮",description:"减轻所受到的伤害",id:849,icon:13226,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"天星交错",description:"抵消一定伤害",id:1889,icon:13250,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"擢升",description:"减轻所受到的伤害",id:2717,icon:13262,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"中间学派",description:"抵消一定伤害",id:1921,icon:13255,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"均衡诊断",description:"抵消一定伤害",id:2607,icon:12954,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"齐衡诊断",description:"抵消一定伤害",id:2608,icon:12955,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"均衡预后",description:"抵消一定伤害",id:2609,icon:12954,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"坚角清汁",description:"减轻所受到的伤害",id:2618,icon:12964,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"白牛清汁",description:"减轻所受到的伤害",id:2619,icon:12965,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"整体论",description:"减轻所受到的伤害",id:3003,icon:12971,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"整体盾",description:"抵消一定伤害",id:3365,icon:12972,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"输血",description:"抵消一定伤害",id:2612,icon:12958,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"泛输血",description:"抵消一定伤害",id:2613,icon:12959,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"心眼",description:"下次受到攻击时所受到的伤害减轻",id:1232,icon:13307,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"金刚极意",description:"减轻所受到的一部分伤害",id:1179,icon:12527,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"行吟",description:"减轻所受到的伤害",id:1934,icon:12615,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"策动",description:"减轻所受到的伤害",id:1951,icon:13021,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"防守之桑巴",description:"减轻所受到的伤害",id:1826,icon:13715,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"即兴表演结束",description:"抵消一定伤害",id:2697,icon:13721,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"残影",description:"抵消一定伤害",id:488,icon:10605,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"魔罩",description:"抵消一定伤害",id:168,icon:10456,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"守护之光",description:"抵消一定伤害",id:2702,icon:12691,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"守护纹",description:"抵消一定伤害",id:2597,icon:12934,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"抗死",description:"减轻所受到的魔法伤害，同时自身所受体力恢复效果提高",id:2707,icon:13408,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!0},{name:"雪仇",description:"攻击所造成的伤害降低",id:1193,icon:13901,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!1},{name:"牵制",description:"物理攻击和魔法攻击所造成的伤害降低",id:1195,icon:13904,type:"multiplier",performance:{physics:1,magic:.5,darkness:0},isFriendly:!1},{name:"昏乱",description:"物理攻击和魔法攻击所造成的伤害降低",id:1203,icon:13917,type:"multiplier",performance:{physics:.5,magic:1,darkness:0},isFriendly:!1},{name:"武装解除",description:"攻击所造成的伤害降低",id:860,icon:13009,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!1},{name:"减速",description:"战技与魔法的咏唱及复唱时间延长",id:9,icon:15009,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!1},{name:"体力增加",description:"体力最大值提高",id:2120,icon:13523,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"腐臭",description:"造成的伤害降低",id:1715,icon:13502,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!1},{name:"智力精神降低",description:"智力与精神有所降低",id:2115,icon:13518,type:"multiplier",performance:{physics:0,magic:1,darkness:0},isFriendly:!1},{name:"龙之力",description:"受到的伤害降低",id:2500,icon:13539,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"超硬化",description:"无法自由活动，但受到攻击的伤害减少",id:1722,icon:13509,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"玄结界",description:"减轻所受到的伤害，受到一定伤害后将附加玄天武水壁状态",id:2496,icon:13535,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"仙人盾",description:"受到的伤害降低",id:2119,icon:13522,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"强力守护",description:"令自身所受到的伤害减少，同时会以攻击力降低为代价提高自身仇恨",id:1719,icon:13506,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"哥布防御",description:"抵消一定伤害",id:2114,icon:13517,type:"absorbed",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"铜墙铁盾",description:"减轻所受到的伤害",id:194,icon:16306,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"坚守要塞",description:"减轻所受到的伤害",id:195,icon:16306,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"终极堡垒",description:"减轻所受到的伤害",id:196,icon:16306,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初大地",description:"减轻所受到的伤害",id:863,icon:16306,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"暗黑之力",description:"减轻所受到的伤害",id:864,icon:16306,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"灵魂之青",description:"减轻所受到的伤害",id:1931,icon:16306,type:"multiplier",performance:{physics:1,magic:1,darkness:1},isFriendly:!0}],ge=new Map;let Pe;function he(i){if(Pe!==i){const r=i==="Chinese"?Le:Object.assign(Le,{});ge.clear();for(const o of r)o.fullIcon=Re(o.icon),ge.set(o.id.toString(16).toUpperCase(),o);Pe=i}}he("Chinese");function Zt(i){return ge.get(i)}const Jt=i=>i===1?"useful":i===0?"unuseful":"half-useful",Yt=/(?:耐性|防御力)(?:大幅)?(?:降低|提升|低下|下降)|受伤(?:加重|减轻)|体力(?:增加|衰减|减少)|伤害屏障/,Wt=/(?:精神|力量|灵巧|智力){1,2}(?:大幅)?降低/,Ue=(i,r)=>Object.entries(Et).reduce((o,[l,[a,_]])=>(i.test(a)&&o.set(l,{name:a,icon:_,isFriendly:r}),o),new Map),Kt=Ue(Yt,!0),Qt=Ue(Wt,!1),be=(()=>typeof structuredClone=="function"?structuredClone:i=>{if(i===null||typeof i!="object")return i;if(i instanceof Date)return new Date(i.getTime());if(i instanceof RegExp)return new RegExp(i.source,i.flags);if(i instanceof Array)return i.map(o=>be(o));const r=new i.constructor;for(const o in i)i.hasOwnProperty(o)&&(r[o]=be(i[o]));return r})(),Xt={key:0,class:"testLog"},Oe="souma-keigenn-record-2",si=ze({__name:"keigennRecord2",setup(i){const r=gt("hash"),o=T(r.dev==="1"||r.dev===void 0&&!window.OverlayPluginApi&&!r.OVERLAY_WS&&!r.HOST_PORT);o.value&&setTimeout(()=>{o.value=r.dev==="1"||r.dev===void 0&&!window.OverlayPluginApi&&!r.OVERLAY_WS&&!r.HOST_PORT},1e3);function l(e,t){return typeof t=="boolean"?e==="0"?!1:e==="1"?!0:t:typeof t=="number"?isNaN(+e)?t:+e:t}const a={scale:l(r.scale,1),showHeader:l(r.showHeader,!0),showIcon:l(r.showIcon,!0),showName:l(r.showName,!1),abbrId:l(r.abbrId,!0),anonymous:l(r.anonymous,!0),replaceWithYou:l(r.replaceWithYou,!1),parseAA:l(r.parseAA,!0),parseDoT:l(r.parseDoT,!1),minimize:l(r.minimize,!1),actionCN:l(r.actionCN,!0),statusCN:l(r.statusCN,!0)},_=ue(()=>a.actionCN?"actionCN":"action"),C=T(a.minimize),ne=a.scale>=2||window.devicePixelRatio>=2?"_hr1":"",h={line_height:28*a.scale,time:40*a.scale,action:65*a.scale,target:((a.showIcon?24:0)+(a.showName?a.anonymous||!a.anonymous&&a.abbrId?24:36:0)+7)*a.scale,amount:44*a.scale},g={"--vxe-font-size-mini":12*a.scale+"px","--vxe-table-row-line-height":30*a.scale+"px","--vxe-table-row-height-mini":30*a.scale+"px","--vxe-input-height-mini":20*a.scale+"px","--vxe-select-option-height-mini":24*a.scale+"px"},N={runtime:99,localStorage:3},V=T(!1),H=T(),Q=U("keigenn-record-2-pov-name",""),L=U("keigenn-record-2-pov-id",""),X=U("keigenn-record-2-party-list",[]),B=U("keigenn-record-2-job-map",{}),ae=U("keigenn-record-2-party-event-party",[]),P=T(0),u=T([{zoneName:"",duration:"00:00",table:[],key:"init"}]),ve={rsv:/^262\|(?<timestamp>[^|]*)\|[^|]*\|[^|]*\|_rsv_(?<id>\d*)[^|]*\|(?<real>[^|]*)\|/i,ability:M.ability(),statusEffectExplicit:M.statusEffectExplicit(),gainsEffect:M.gainsEffect(),losesEffect:M.losesEffect(),inCombat:/^260\|(?<timestamp>[^|]*)\|(?<inACTCombat>[^|]*)\|(?<inGameCombat>[^|]*)\|/i,changeZone:M.changeZone(),partyList:/^11\|(?<timestamp>[^|]*)\|(?<partyCount>\d*)\|(?<list>(?:\w{8}\|){0,})\w{16}/i,primaryPlayer:/^02\|(?<timestamp>[^|]*)\|(?<id>[^|]*)\|(?<name>[^|]*)/,addCombatant:M.addedCombatant(),removingCombatant:M.removingCombatant(),networkDoT:M.networkDoT()},w=T(0),ke=U("souma-keigenn-record-2-zone-name",""),Fe=U("souma-keigenn-record-2-rsv-data",{}),me={},A={friendly:{},enemy:{}},Ge=e=>{e.table.length=0,e.zoneName="",e.duration="00:00",e.key="init"},Ve=()=>{V.value=!0,w.value=0,P.value=0,u.value.length=1,Ge(u.value[0])},Be=()=>{Ee(),V.value=!1},xe=e=>{Ce(e.rawLine)},Ce=e=>{var t,p,m;for(const x in ve){const F=ve[x].exec(e);if(F){const n=e.split("|");switch(x){case"statusEffectExplicit":F.groups.targetId[0]==="1"&&(me[F.groups.targetId]=F.groups.currentShield);break;case"gainsEffect":{const d=n[s.GainsEffect.fields.effectId],f=n[s.GainsEffect.fields.effect],y=n[s.GainsEffect.fields.target],v=n[s.GainsEffect.fields.targetId],S=Number(n[s.GainsEffect.fields.count]);let I=Zt(d);if(!I){const $=v.startsWith("1")&&Kt.get(parseInt(d,16).toString())||v.startsWith("4")&&Qt.get(parseInt(d,16).toString());if(!$)return;const K=Re($.icon),q=S>1?Nt(K,S):K;I={type:"multiplier",performance:{physics:1,magic:1,darkness:1},id:parseInt(d,16),icon:$.icon,fullIcon:q,name:$.name,isFriendly:$.isFriendly}}const J=n[s.GainsEffect.fields.duration],D=n[s.GainsEffect.fields.source],z=n[s.GainsEffect.fields.sourceId],Y=new Date(n[s.GainsEffect.fields.timestamp]).getTime()+parseFloat(J)*1e3,W={name:I.name,count:S,effect:f,effectId:d,source:D,sourceId:z,target:y,targetId:v,expirationTimestamp:Y,performance:I.performance,fullIcon:I.fullIcon,isPov:L.value===z};v[0]==="1"&&I.isFriendly?((t=A.friendly)[v]??(t[v]={}))[d]=W:v[0]==="4"&&!I.isFriendly&&(((p=A.enemy)[y]??(p[y]={}))[d]=W)}break;case"losesEffect":{const d=n[s.LosesEffect.fields.target],f=n[s.LosesEffect.fields.targetId],y=n[s.LosesEffect.fields.effectId];f[0]==="1"?A.friendly[f]&&Reflect.deleteProperty(A.friendly[f],y):A.enemy[d]&&Reflect.deleteProperty(A.enemy[d],y)}break;case"addCombatant":if(n[s.AddedCombatant.fields.job]!=="00"){const d=n[s.AddedCombatant.fields.job],f=new Date(n[s.AddedCombatant.fields.timestamp]).getTime();B.value[n[s.AddedCombatant.fields.id]]={job:parseInt(d,16),timestamp:f}}break;case"removingCombatant":Reflect.deleteProperty(B.value,n[s.RemovedCombatant.fields.id]);break;case"primaryPlayer":L.value=n[s.ChangedPlayer.fields.id];const ce=n[s.ChangedPlayer.fields.name];if(Q.value===ce)return;Q.value=ce,Ne(n[s.ChangedPlayer.fields.name]);break;case"partyList":X.value=((m=F.groups.list)==null?void 0:m.split("|"))??[];break;case"changeZone":ke.value=n[s.ChangeZone.fields.name],we(new Date(n[s.ChangeZone.fields.timestamp]).getTime());break;case"inCombat":{const d=n[s.InCombat.fields.inACTCombat]==="1",f=n[s.InCombat.fields.inGameCombat]==="1",y=new Date(n[s.InCombat.fields.timestamp]).getTime();if(d||f){if(w.value>0)return;u.value[0].table.length!==0&&(u.value[0]=Ct(u.value[0]),u.value.unshift({zoneName:"",duration:"00:00",table:[],key:n[s.InCombat.fields.timestamp]}),u.value.length>=N.runtime&&u.value.splice(u.value.length-1,1)),w.value=y,u.value[0].zoneName=ke.value,P.value=0;return}if(!d&&!f){we(y);return}}break;case"rsv":{const d=Number(F.groups.id),f=n[s.RSVData.fields.value];Fe.value[Number(d)]=f}break;case"networkDoT":if(!a.parseDoT)return;{const d=n[s.NetworkDoT.fields.which],f=n[s.NetworkDoT.fields.id];if(d!=="DoT"||f[0]==="4"||!(f===L.value||X.value.includes(f)||ae.value.find(q=>q.id===f)))return;const y=n[s.NetworkDoT.fields.name],v=n[s.NetworkDoT.fields.damage],S=parseInt(v,16),I=new Date(n[s.Ability.fields.timestamp]??"???").getTime(),J=Number(n[s.NetworkDoT.fields.currentHp]),D=Number(n[s.NetworkDoT.fields.maxHp]),z=w.value===0?0:I-w.value,oe=se(z),Y=Ie(f),W=G.nameToFullName(G.jobEnumToJob(Y)).simple2,$=Y,K=G.jobEnumToIcon($).toLocaleLowerCase();_e({timestamp:I,time:oe,id:void 0,action:d,actionCN:d,source:"",target:y,targetId:f,job:W,jobIcon:K,jobEnum:$,amount:S,keigenns:[],currentHp:J,maxHp:D,effect:"damage done",type:"dot",shield:me[f],povId:L.value})}break;case"ability":if(w.value===0)return;{const d=Vt(n);if(d.isAttack&&d.amount>=0){const f=n[s.Ability.fields.sourceId]??"???",y=n[s.Ability.fields.targetId]??"???";if(!(f[0]==="4"&&y[0]==="1")||!(y===L.value||X.value.includes(y)||ae.value.find(R=>R.id===y)))return;const v=new Date(n[s.Ability.fields.timestamp]??"???").getTime(),S=n[s.Ability.fields.ability],I=S.match(/^_rsv_(?<id>\d+)_/),J=n[s.Ability.fields.id]??"???";let D=S;if(I){const R=Number(I.groups.id);D=Fe.value[R]??S.match(/^_(?<id>rsv_\d+)_/).groups.id}else if(D=D.replace(/unknown_.*/,"攻击"),a.parseAA===!1&&/^攻击|攻撃|[Aa]ttack$/.test(D))return;const z=$t(parseInt(J,16)),oe=z&&z!==""?z:D,Y=Number(n[s.Ability.fields.targetCurrentHp])??"???",W=Number(n[s.Ability.fields.targetMaxHp])??"???",$=n[s.Ability.fields.source]??"???",K=n[s.Ability.fields.target]??"???",{effect:q,type:ot}=Lt(d.flags),lt=w.value===0?0:v-w.value,dt=se(lt),Te=Ie(y),mt=G.nameToFullName(G.jobEnumToJob(Te)).cn.substring(0,2),Ae=Te,pt=G.jobEnumToIcon(Ae).toLocaleLowerCase(),ut=be(Object.values(A.friendly[y]??[]).concat(Object.values(A.enemy[$]??[])).filter(R=>{const le=Math.max(0,(R.expirationTimestamp-v)/1e3);return R.remainingDuration=le>=999?"":le.toFixed(le>.05&&le<.95?1:0),Number(R.remainingDuration)>-3}));_e({timestamp:v,time:dt,id:J,action:D,actionCN:oe,source:$,target:K,targetId:y,job:mt,jobIcon:pt,jobEnum:Ae,amount:d.amount,keigenns:ut,currentHp:Y,maxHp:W,effect:q,type:ot,shield:me[F.groups.targetId],povId:L.value}),u.value[0].duration=se(new Date(n[s.Ability.fields.timestamp]).getTime()-w.value)}break}}}}},Ie=e=>{const t=B.value[e],p=ae.value.find(m=>m.id===e)??{job:0,timestamp:0};return[t,p].sort((m,x)=>x.timestamp-m.timestamp)[0].job},_e=e=>{u.value[0].table.unshift(e)},we=e=>{w.value!==0&&(u.value[0].duration=se(e-w.value),w.value=0,A.friendly={},A.enemy={},Ee())},Ee=()=>{localStorage.setItem(Oe,JSON.stringify(u.value.slice(0,N.localStorage)))},Ze=()=>{const e=localStorage.getItem(Oe);if(e)try{const t=JSON.parse(e);u.value.length=0,u.value.push(...t)}catch(t){console.error(t)}},se=e=>{const t=Math.max(Math.floor(e/6e4),0),p=Math.max(Math.floor((e-t*6e4)/1e3),0);return`${t<10?"0":""}${t}:${p<10?"0":""}${p}`},Je=ue(()=>{const e=new Set(u.value[P.value].table.map(t=>a.actionCN?t.actionCN:t.action));return Array.from(e).map(t=>({label:t,value:t}))}),Ye=ue(()=>{const e={},t=new Set(u.value[P.value].table.slice().sort((p,m)=>G.enumSortMethod(p.jobEnum,m.jobEnum)).map(p=>(e[p.target]=p.job,p.target)));return Array.from(t).map(p=>({label:`${e[p]}（${p}）`,value:p}))});let pe=e=>e;const Ne=e=>{/^([A-Z])\S+ ([A-Z])\S+$/.test(e)?(a.abbrId&&(pe=t=>t.replace(/^([A-Z])\S+ ([A-Z])\S+$/,"$1.$2.")),he("Global")):(a.abbrId&&(pe=t=>t.substring(0,2)),he("Chinese"))};Ne(Q.value);const $e=e=>{const t=e.target;t.src.includes("cafemaker.wakingsands.com")?t.src=t.src.replace("cafemaker.wakingsands.com","xivapi.com"):t.src.includes("xivapi.com")&&(t.src="")},We=e=>{Q.value=e.charName,L.value=e.charID.toString(16).toUpperCase()},Ke=e=>{ae.value=e.party.map(t=>({...t,timestamp:Date.now()}))};Me(()=>{for(const e in B.value){const t=B.value[e];Date.now()-t.timestamp>1e3*60*60*24*1&&Reflect.deleteProperty(B.value,e)}Ze(),addOverlayListener("LogLine",xe),addOverlayListener("PartyChanged",Ke),addOverlayListener("ChangePrimaryPlayer",We),startOverlayEvents()}),je(()=>{removeOverlayListener("LogLine",xe)});const Qe=({row:e})=>c("div",null,[c("span",{class:"target"},[a.showIcon&&c("img",{class:"jobIcon",src:`//cafemaker.wakingsands.com/cj/companion/${e.jobIcon}.png`,alt:"","data-job":a.showName?"":e.job,onError:$e,loading:"lazy"},null),a.showName&&c("span",{class:`job ${e.jobIcon} ${e.targetId===e.povId?"YOU":""}`,style:!a.abbrId&&a.showName?{overflow:"hidden",textOverflow:"ellipsis"}:{}},[e.targetId===e.povId&&a.replaceWithYou?"YOU":a.anonymous?e.job:pe(e.target)])])]),Xe=({row:e})=>c(It,{"append-to":".wrapper",effect:"dark",placement:"right-start",title:"",trigger:"hover",enterable:!1,"hide-after":0,"popper-class":"my-el-popover"},{default:()=>[c(qe,{row:e},null)],...{reference:()=>c("span",{class:"amount"},[c("span",{class:`${e.type}`},[c("span",{class:`${tt(e)?"lethal":""}`},[e.amount.toLocaleString().padStart(3,"　")])])])}}),qe=({row:e})=>c("div",null,[c("span",null,[E("盾:"),Math.round(e.maxHp*+e.shield/100),E(" ("),e.shield,E("%)")]),c("br",null,null),c("span",null,[E("HP:"),e.currentHp,E("/"),e.maxHp,E(" ("),Math.round(e.currentHp/e.maxHp*100),E("%)")]),c("br",null,null),c("span",null,[E("来源:"),e.source]),c("br",null,null),c("span",null,[E("受到伤害:"),e.amount]),c("br",null,null),c("span",null,[E("剩余HP:"),e.currentHp-e.amount,E(" ("),Math.round((e.currentHp-e.amount)/e.maxHp*100),E("%)")])]),et=[409 .toString(16).toUpperCase(),810 .toString(16).toUpperCase(),811 .toString(16).toUpperCase(),1836 .toString(16).toUpperCase()],tt=e=>e.currentHp-e.amount<0&&!e.keigenns.find(t=>et.includes(t.effectId)),it=({row:e})=>c(fe,null,[e.type==="dot"?"（不支持）":e.keigenns.map(t=>c("span",{class:"status",title:`${t.name}(${t.source})`,"data-duration":t.remainingDuration,"data-sourcePov":t.isPov},[c("img",{class:`statusIcon ${Jt(t.performance[e.type])}`,src:`//cafemaker.wakingsands.com/i/${t.fullIcon}${ne}.png`,alt:t.effect,onError:$e,loading:"lazy"},null)])),c("span",null,[e.effect==="damage done"?"":ye(e.effect)])]),nt=e=>{const{action:t,actionCN:p,amount:m,job:x,keigenns:k,source:F,target:n,time:ce,type:d}=e,f=e.effect==="damage done"?"":","+ye(e.effect),y=`${ce} [${x}]${n} HP:${e.currentHp}/${e.maxHp}(${Math.round(e.currentHp/e.maxHp*100)}%) + 护盾:${Math.round(e.maxHp*+e.shield/100)}(${e.shield}%) 受到${F}“${t}${p!==t?"("+p+")":""}”的${m.toLocaleString()}点${ye(d)}伤害。剩余HP:${e.currentHp-e.amount}(${Math.round((e.currentHp-e.amount)/e.maxHp*100)}%)。减伤：${k.length===0&&f===""?"无":k.map(v=>a.statusCN?v.name:v.effect).join(",")+f}。`;at(y)},at=e=>{navigator.clipboard.writeText(e).catch(()=>{const t=document.createElement("input");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}),He.modal.message({content:"已复制到剪贴板",status:"success"})},O=T({target:!1,action:!1}),Z=T(),re=ht({className:"my-menus",body:{options:[]}});bt(()=>{var e,t,p;re.body&&re.body.options&&H.value&&(re.body.options[0]=[{code:"copy",name:"复制详情",prefixIcon:"vxe-icon-copy",className:"my-copy-item"},{code:"clearFilterAction",name:"取消技能筛选",prefixIcon:"vxe-icon-funnel-clear",className:"my-clear-filter",visible:O.value.action,disabled:!1},{code:"filterSelectAction",name:(e=Z.value)!=null&&e[_.value]?`只看 ${(t=Z.value)==null?void 0:t[_.value]}`:"只看该技能",prefixIcon:"vxe-icon-info-circle",visible:!O.value.action,disabled:!1},{code:"clearFilterTarget",name:"取消玩家筛选",prefixIcon:"vxe-icon-funnel-clear",visible:O.value.target,disabled:!1},{code:"filterSelectTarget",name:(p=Z.value)!=null&&p.target?`只看[${Z.value.job}] ${Z.value.target}`:"只看该玩家",prefixIcon:"vxe-icon-user-fill",visible:!O.value.target,disabled:!1}])});const st=()=>{C.value=!C.value},rt=({row:e})=>{const t=H.value;t&&(t.setCurrentRow(e),Z.value=e)},ct=({menu:e,row:t,column:p})=>{const m=H.value;switch(e.code){case"copy":if(!t){He.modal.message({content:"未选中有效数据行",status:"error"});return}nt(t);break;case"clearFilterTarget":m&&(m.clearFilter(m.getColumnByField("target")),O.value.target=!1);break;case"clearFilterAction":m&&(m.clearFilter(m.getColumnByField(_.value)),O.value.action=!1);break;case"filterSelectTarget":if(m){const x=m.getColumnByField("target");if(x){const k=x.filters.find(F=>F.value===t.target);if(!k)return;k.checked=!0,m.updateData().then(()=>{m.scrollToRow(t),O.value.target=!0})}}break;case"filterSelectAction":if(m){const x=m.getColumnByField(_.value);if(x){const k=x.filters.find(F=>F.value===t[_.value]);if(!k)return;k.checked=!0,m.updateData().then(()=>{m.scrollToRow(t),O.value.action=!0})}}break}};return(e,t)=>{const p=ee("vxe-option"),m=ee("vxe-select"),x=ee("vxe-button"),k=ee("vxe-column"),F=ee("vxe-table");return ie(),de(fe,null,[j("div",{class:"wrapper",style:g},[j("header",null,[De(c(m,{modelValue:b(P),"onUpdate:modelValue":t[0]||(t[0]=n=>kt(P)?P.value=n:null),size:"mini",class:"select"},{default:te(()=>[(ie(!0),de(fe,null,vt(b(u).length,n=>(ie(),_t(p,{key:`${b(u)[n-1].key}-${b(u)[n-1].duration}-${b(u)[n-1].zoneName}`,value:n-1,label:`${b(u)[n-1].duration} ${b(u)[n-1].zoneName}`},null,8,["value","label"]))),128))]),_:1},8,["modelValue"]),[[Se,!b(C)]]),c(x,{class:"minimize",icon:b(C)?"vxe-icon-fullscreen":"vxe-icon-minimize",onClick:st,style:Ft({opacity:b(C)?.5:1})},null,8,["icon","style"])]),De(j("main",null,[c(F,{ref_key:"xTable",ref:H,size:"mini",class:"vxe-table","show-overflow":"",round:"",height:"100%","scroll-y":{enabled:!0},loading:b(V),"show-header":a.showHeader,data:b(u)[b(P)].table,"row-config":{isHover:!0,height:h.line_height},"header-cell-style":{padding:"0px"},onCellMenu:rt,"menu-config":b(re),onMenuClick:ct},{default:te(()=>[c(k,{width:h.time,field:"time",title:"时间",align:"center"},null,8,["width"]),c(k,{width:h.action,field:a.actionCN?"actionCN":"action",title:"技能",filters:b(Je),"filter-multiple":!1,resizable:!1,align:"center"},null,8,["width","field","filters"]),c(k,{width:h.target,field:"target",title:a.showName?"目标":"目",filters:b(Ye),"filter-multiple":!1,resizable:!a.anonymous&&!a.abbrId,align:"left","header-align":"center"},{default:te(({row:n})=>[c(Qe,{row:n},null,8,["row"])]),_:1},8,["width","title","filters","resizable"]),c(k,{width:h.amount,title:"伤害","header-align":"center"},{default:te(({row:n})=>[c(Xe,{row:n},null,8,["row"])]),_:1},8,["width"]),c(k,{title:"减伤",align:"left"},{default:te(({row:n})=>[c(it,{row:n},null,8,["row"])]),_:1})]),_:1},8,["loading","show-header","data","row-config","menu-config"])],512),[[Se,!b(C)]])]),b(o)?(ie(),de("div",Xt,[c(Ht,{onBeforeHandle:Ve,onAfterHandle:Be,onHandleLine:Ce})])):xt("",!0)],64)}}});export{si as default};
