import{d as F,v as k,y as C,o as d,b as f,G as O,H as L,a as _,w as m,u as o,Q as ae,I as N,aD as te,B as ne,C as oe,a8 as re,g as b,f as le,a3 as se,aE as ie,D as A,F as D,R as ue,i as de,aF as ce,l as pe,e as fe,O as _e,P as me,c as ye,af as ve,a4 as be}from"./vendor-8d19117d.js";import{U as V}from"./util-213940cd.js";import{_ as $}from"./_plugin-vue_export-helper-c27b6911.js";const he={flex:"~ col"},ge=F({__name:"dragJob",props:{party:{}},emits:["updateSortArr"],setup(h,{emit:j}){const y=h,v=k(),x=k(!0),R=()=>{j("updateSortArr",Object.values(c.value).flat().map(t=>t.id))},T=[{name:"tank",color:"blue"},{name:"healer",color:"green"},{name:"dps",color:"red"}];function n(t){return y.party.find(l=>l.job===t)}const r={tank:[21,32,37,19],healer:[33,24,40,28],dps:[34,30,39,22,20,38,23,31,25,27,35,36],unknown:[]},g=Object.values(r).flat().map(t=>({name:V.nameToFullName(V.jobEnumToJob(t)).simple1,id:t})),c=C("cactbotRuntime-jobList",{tank:g.filter(t=>r.tank.includes(t.id)).sort((t,l)=>r.tank.indexOf(t.id)-r.tank.indexOf(l.id)),healer:g.filter(t=>r.healer.includes(t.id)).sort((t,l)=>r.healer.indexOf(t.id)-r.healer.indexOf(l.id)),dps:g.filter(t=>r.dps.includes(t.id)).sort((t,l)=>r.dps.indexOf(t.id)-r.dps.indexOf(l.id)),unknown:[]});return(t,l)=>(d(),f("div",he,[(d(),f(O,null,L(T,s=>_(o(te),{ref_for:!0,ref_key:"el",ref:v,disabled:!x.value,modelValue:o(c)[s.name],"onUpdate:modelValue":p=>o(c)[s.name]=p,animation:"150",ghostClass:"ghost",class:"flex flex-row gap-0.25 p-0 m-t-0.25 m-b-0.25 rounded",onUpdate:R,filter:".no-draggable",forceFallback:!0},{default:m(()=>[(d(!0),f(O,null,L(o(c)[s.name],p=>(d(),f("div",{key:p.id,class:ae(`${n(p.id)?`draggable bg-${s.color}`:"no-draggable bg-gray-700/50"} rounded p-l-0.6 p-r-0.6 p-t-0 p-b-0.3 m-0 color-white cursor-move`)},N(p.name),3))),128))]),_:2},1032,["disabled","modelValue","onUpdate:modelValue"])),64))]))}});const ke=$(ge,[["__scopeId","data-v-e5ffedcd"]]),z=h=>(_e("data-v-df3f4c97"),h=h(),me(),h),je={key:0,style:{color:"white","text-shadow":"1px 1px 2px black"}},xe=z(()=>b("p",null,"使悬浮窗的位置分配对应游戏内的实际位置（D1D2等）",-1)),Pe=z(()=>b("ul",null,[b("li",null,"长期：用鼠标拖动职能顺序。"),b("li",null,"临时：下拉选择框修改。")],-1)),we={class:"dialog-footer"},Oe={style:{"white-space":"nowrap"}},Se=F({__name:"cactbotRuntime",setup(h){const j=(e,a)=>Array(a).fill(e).map((u,E)=>u+ ++E),y={tank:["MT","ST",...j("T",70)],healer:[...j("H",72)],dps:[...j("D",72)],unknown:["unknown"]},v=k(!1),x=C("cactbotRuntime-sortArr",[21,32,37,19,33,24,40,28,34,30,39,22,20,38,23,31,25,27,35,36]),R=[{id:"10000001",name:"虚构战士",job:21,inParty:!0},{id:"10000002",name:"虚构骑士",job:19,inParty:!0},{id:"10000003",name:"虚构占星",job:33,inParty:!0},{id:"10000004",name:"虚构学者",job:28,inParty:!0},{id:"10000005",name:"虚构忍者",job:30,inParty:!0},{id:"10000006",name:"虚构武士",job:34,inParty:!0},{id:"10000007",name:"虚构黑魔",job:25,inParty:!0},{id:"10000008",name:"虚构舞者",job:38,inParty:!0}],n=C("cactbotRuntime-data",{party:[]}),r=C("cactbotRuntime-showTips",k(!0)),P={tank:0,healer:0,dps:0,unknown:1};function g(){P.tank=n.value.party.reduce((e,a)=>s(a.job)==="tank"?e+1:e,0),P.healer=n.value.party.reduce((e,a)=>s(a.job)==="healer"?e+1:e,0),P.dps=n.value.party.reduce((e,a)=>s(a.job)==="dps"?e+1:e,0)}const c=location.href.includes("localhost"),t=k(!1),l=k(c?"虚构占星":"");c&&p({party:R});function s(e){const a=Number(e);return[1,3,19,21,32,37].includes(a)?"tank":[6,24,28,33,40].includes(a)?"healer":[2,4,5,7,20,22,23,25,26,27,29,30,31,34,35,36,38,39].includes(a)?"dps":"unknown"}function p(e){r.value&&(v.value=!0),!(c&&e.party.length===0)&&(n.value.party=e.party.filter(a=>a.inParty).map(a=>({...a,rp:"",specify:!1})),U(),g(),w())}function U(){n.value.party.sort((e,a)=>x.value.indexOf(e.job)-x.value.indexOf(a.job)),n.value.party.forEach(e=>e.rp=void 0),n.value.party.forEach(e=>e.rp=B(e))}function H(e){n.value.party[e].specify=!0;const a=n.value.party.find(u=>u.rp===n.value.party[e].rp&&u.id!==n.value.party[e].id);a&&(a.rp=B(a))&&(a.specify=!0),w()}function B(e){return y[s(e.job)].find(a=>!n.value.party.find(u=>u.rp===a))??"unknown"}function w(){const e=[...y.tank,...y.healer,...y.dps];n.value.party.sort((a,u)=>e.indexOf(a.rp)-e.indexOf(u.rp)),callOverlayHandler({call:"broadcast",source:"soumaRuntimeJS",msg:{party:n.value.party}})}function J(e){c||(l.value=e.charName)}function M(e){if(e.source==="soumaUserJS")switch(e.msg.text){case"updateNewPartyRP Success":break;case"requestData":w();break}}function G(){t.value=!0}function Q(){t.value=!1}function q(e){x.value=e,U(),g(),w()}return ne(()=>{w(),addOverlayListener("PartyChanged",p),addOverlayListener("ChangePrimaryPlayer",J),addOverlayListener("BroadcastMessage",M),startOverlayEvents()}),oe(()=>{removeOverlayListener("PartyChanged",p),removeOverlayListener("ChangePrimaryPlayer",J),removeOverlayListener("BroadcastMessage",M)}),(e,a)=>{const u=de,E=ce,K=ve,W=be,X=ke,Y=pe,Z=fe;return d(),f(O,null,[o(n).party.length===0?(d(),f("span",je,"等待小队...")):re("",!0),b("div",{onMouseenter:G,onMouseleave:Q},[_(E,{modelValue:o(v),"onUpdate:modelValue":a[1]||(a[1]=i=>se(v)?v.value=i:null),title:"初见提示",width:"90%","destroy-on-close":!0,"close-on-click-modal":!1},{footer:m(()=>[b("span",we,[_(u,{type:"primary",onClick:a[0]||(a[0]=i=>{v.value=!1,r.value=!1})},{default:m(()=>[le("明白了")]),_:1})])]),default:m(()=>[xe,Pe]),_:1},8,["modelValue"]),_(Z,{style:ue({width:o(t)?"16.75rem":"5rem"})},{default:m(()=>[_(Y,null,{default:m(()=>[_(ie,{name:"animate__animated animate__bounce","enter-active-class":"animate__fadeInLeft","leave-active-class":"animate__fadeOutLeft"},{default:m(()=>[(d(!0),f(O,null,L(o(n).party,(i,ee)=>A((d(),f("div",{key:i.id,flex:"~ nowrap"},[_(W,{modelValue:i.rp,"onUpdate:modelValue":S=>i.rp=S,size:"small","m-0":"","p-0":"",onChange:S=>H(ee),teleported:!1},{default:m(()=>[(d(!0),f(O,null,L(y[s(i.job)],(S,I)=>A((d(),ye(K,{key:I,value:S,"fit-input-width":!0},null,8,["value"])),[[D,I<P[s(i.job)]]])),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),b("span",Oe,N(o(V).nameToFullName(o(V).jobEnumToJob(i.job)).simple2)+" "+N(o(t)?i.name:""),1)])),[[D,o(t)||i.name===o(l)]])),128))]),_:1}),A(_(X,{class:"dragJob",onUpdateSortArr:q,party:o(n).party,"m-b-1":"","p-1":""},null,8,["party"]),[[D,o(t)]])]),_:1})]),_:1},8,["style"])],32)],64)}}});const Re=$(Se,[["__scopeId","data-v-df3f4c97"]]);export{Re as default};
