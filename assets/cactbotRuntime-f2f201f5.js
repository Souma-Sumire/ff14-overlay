import{d as G,A as k,C as T,o as _,b as v,J as V,K as A,a as O,w as R,u as l,R as H,t as E,aG as ee,F as te,r as D,a3 as ae,g,aH as oe,h as $,H as F,p as ne,l as re,c as se}from"./vendor-bfd3a191.js";import{U as r,j as le}from"./util-ef9ccf87.js";import{_ as z}from"./index-c8f627a4.js";import{c as ue,a as U}from"./overlay_plugin_api-409cb9ea.js";const ie={flex:"~ col"},ce=G({__name:"dragJob",props:{party:{}},emits:["updateSortArr"],setup(j,{emit:b}){const d=k(),y=k(!0),P=b,L=j,I=()=>{P("updateSortArr",Object.values(u.value).flat().map(o=>o.id))},a=[{name:"tank",color:"blue"},{name:"healer",color:"green"},{name:"dps",color:"red"},{name:"crafter",color:"yellow"},{name:"gatherer",color:"purple"},{name:"none",color:"gray"}];function S(o){return L.party.find(i=>i.job===o)}const x=r.getBattleJobs3(),J=["tank","healer","dps","crafter","gatherer","none"],f=(()=>{const o={},i={tank:r.isTankJob,healer:r.isHealerJob,dps:r.isDpsJob,crafter:r.isCraftingJob,gatherer:r.isGatheringJob};for(const s of J)o[s]=(s==="none"?[]:x.filter(n=>i[s](n))).map(n=>r.jobToJobEnum(n)).sort((n,m)=>r.enumSortMethod(n,m));return o})(),w=Object.values(f).flat().map(o=>({name:r.nameToFullName(r.jobEnumToJob(o)).simple1,id:o})),u=T("cactbotRuntime-jobList",(()=>{const o={};for(const i of J)o[i]=w.filter(s=>f[i].includes(s.id)).sort((s,n)=>f[i].indexOf(s.id)-f[i].indexOf(n.id));return o})());return(o,i)=>(_(),v("div",ie,[(_(),v(V,null,A(a,(s,n)=>O(l(ee),{key:n,ref_for:!0,ref_key:"el",ref:d,disabled:!y.value,modelValue:l(u)[s.name],"onUpdate:modelValue":m=>l(u)[s.name]=m,animation:"150",ghostClass:"ghost",class:"flex flex-row gap-0.25 p-0 m-t-0.25 m-b-0.25 rounded",onUpdate:I,filter:".no-draggable",forceFallback:!0},{default:R(()=>[(_(!0),v(V,null,A(l(u)[s.name],m=>(_(),v("div",{key:m.id,class:H(`${S(m.id)?`draggable bg-${s.color} cursor-move`:"no-draggable bg-gray-700/50"} rounded p-l-0.6 p-r-0.6 p-t-0 p-b-0.3 m-0 color-white`)},E(m.name),3))),128))]),_:2},1032,["disabled","modelValue","onUpdate:modelValue"])),64))]))}});const de=z(ce,[["__scopeId","data-v-9039b8ac"]]),M=j=>(ne("data-v-39207914"),j=j(),re(),j),pe=M(()=>g("span",null,"用法",-1)),fe=M(()=>g("p",null,"使悬浮窗的位置分配对应游戏内的实际位置（D1D2等）",-1)),me=M(()=>g("ul",null,[g("li",null,"临时：下拉选择框修改。"),g("li",null,"长期：用鼠标拖动职能顺序。")],-1)),_e={class:"players"},be={class:"name"},ye=G({__name:"cactbotRuntime",setup(j){const b=(e,t)=>Array(t).fill(e).map((p,N)=>p+(+N+1)),d={tank:["MT","ST",...b("T",70)],healer:[...b("H",72)],dps:[...b("D",72)],crafter:[...b("C",72)],gatherer:[...b("G",72)],none:[...b("N",72)]},y=k(!1),P=T("cactbotRuntime-sortArr",le),L=[{id:"10000001",name:"虚构战士",job:21,inParty:!0},{id:"10000002",name:"虚构骑士",job:19,inParty:!0},{id:"10000003",name:"虚构占星",job:33,inParty:!0},{id:"10000004",name:"虚构学者",job:28,inParty:!0},{id:"10000005",name:"虚构忍者",job:30,inParty:!0},{id:"10000006",name:"虚构武士",job:34,inParty:!0},{id:"10000007",name:"虚构黑魔",job:25,inParty:!0},{id:"10000008",name:"虚构舞者",job:38,inParty:!0}],a=T("cactbotRuntime-data",{party:[]}),S=T("cactbotRuntime-showTips",k(!0)),x={tank:0,healer:0,dps:0,crafter:0,gatherer:0,none:0};function J(){x.tank=a.value.party.reduce((e,t)=>u(t.job)==="tank"?e+1:e,0),x.healer=a.value.party.reduce((e,t)=>u(t.job)==="healer"?e+1:e,0),x.dps=a.value.party.reduce((e,t)=>u(t.job)==="dps"?e+1:e,0)}const f=location.href.includes("localhost"),h=k(!1),w=k(f?"虚构占星":"");if(f){const e={party:L};S.value&&(y.value=!0),a.value.party=e.party.map(t=>({...t,rp:"",specify:!1})),o(),J(),n()}function u(e){const t=Number(e);return[1,3,19,21,32,37].includes(t)?"tank":[6,24,28,33,40].includes(t)?"healer":[2,4,5,7,20,22,23,25,26,27,29,30,31,34,35,36,38,39].includes(t)?"dps":r.isCraftingJob(r.jobEnumToJob(e))?"crafter":r.isGatheringJob(r.jobEnumToJob(e))?"gatherer":"none"}function o(){a.value.party.sort((e,t)=>P.value.indexOf(e.job)-P.value.indexOf(t.job));for(const e of a.value.party)e.rp=void 0,e.rp=s(e)}function i(e){a.value.party[e].specify=!0;const t=a.value.party.find(p=>p.rp===a.value.party[e].rp&&p.id!==a.value.party[e].id);t&&(t.rp=s(t),t.specify=!0),n()}function s(e){return d[u(e.job)].find(t=>!a.value.party.find(p=>p.rp===t))??"unknown"}function n(){const e=[...d.tank,...d.healer,...d.dps,...d.crafter,...d.gatherer,...d.none];a.value.party.sort((t,p)=>e.indexOf(t.rp??"")-e.indexOf(p.rp??"")),ue({call:"broadcast",source:"soumaRuntimeJS",msg:{party:a.value.party}})}function m(){h.value=!0}function K(){h.value=!1}function q(e){P.value=e,o(),J(),n()}const Q=e=>r.nameToFullName(r.jobEnumToJob(e)).simple1,W=e=>e;return te(()=>{n(),U("PartyChanged",e=>{S.value&&(y.value=!0),!(f&&e.party.length===0)&&(a.value.party=e.party.filter(t=>t.inParty).map(t=>({...t,rp:"",specify:!1})),o(),J(),n())}),U("ChangePrimaryPlayer",e=>{f||(w.value=e.charName)}),U("BroadcastMessage",e=>{e.source==="soumaUserJS"&&typeof e.msg=="object"&&e.msg!==null&&Reflect.get(e.msg,"text")==="requestData"&&n()}),startOverlayEvents()}),(e,t)=>{const p=D("vxe-modal"),N=D("vxe-option"),X=D("vxe-select"),Y=de;return _(),v("div",{onMouseenter:m,onMouseleave:K},[O(p,{modelValue:l(y),"onUpdate:modelValue":t[0]||(t[0]=c=>ae(y)?y.value=c:null),size:"small",position:{left:10,top:10},width:"90vw",onClose:t[1]||(t[1]=c=>{y.value=!1,S.value=!1})},{title:R(()=>[pe]),default:R(()=>[fe,me]),_:1},8,["modelValue"]),g("main",{class:H(l(h)?"mouseIn":"")},[g("div",_e,[O(oe,{name:"animate__animated animate__bounce","enter-active-class":"animate__fadeInLeft","leave-active-class":"animate__fadeOutLeft"},{default:R(()=>[(_(!0),v(V,null,A(l(a).party,(c,Z)=>$((_(),v("section",{key:c.id,flex:"~ nowrap",class:"player"},[O(X,{modelValue:c.rp,"onUpdate:modelValue":C=>c.rp=C,size:"mini",onChange:C=>i(Z),"class-name":"select"},{default:R(()=>[(_(!0),v(V,null,A(d[u(c.job)],(C,B)=>(_(),se(N,{visible:B<x[u(c.job)],key:B,value:C,label:C},null,8,["visible","value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),g("span",be,E(Q(c.job))+" "+E(l(h)?W(c.name):""),1)])),[[F,l(a).party.length>1&&(l(h)||c.name===l(w))]])),128))]),_:1})]),$(O(Y,{class:"dragJob",onUpdateSortArr:q,party:l(a).party,"m-b-1":"","p-1":""},null,8,["party"]),[[F,l(h)]])],2)],32)}}});const xe=z(ye,[["__scopeId","data-v-39207914"]]);export{xe as default};
