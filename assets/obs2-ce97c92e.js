import{az as J,q as L,Y as se,b as K,o as b,e as U,t as c,a as o,w as a,F as le,L as ce,u as e,c as D,a1 as ie,ad as re,a2 as de,G as ue,H as pe,d as me,n as N,aA as _e,y as r,a0 as z,x as f,aB as S,aC as he,J as fe,ah as be,B as ge,ak as we,N as ve,al as Ce,aD as ye,aE as Ee,as as Se,ap as Ve,af as Re,C as Te,ag as xe,au as ke}from"./vendor-8bdaa26a.js";import{_ as Q}from"./_plugin-vue_export-helper-c27b6911.js";import{C as $}from"./content_type-52b79aff.js";import{a as G,r as F,c as Oe}from"./overlay_plugin_api-409cb9ea.js";import{N as q,c as Le,l as M}from"./netregexes-60f54b26.js";import{z as Ue}from"./zoneInfo-a419d684.js";const Be=V=>(ue("data-v-179b86b4"),V=V(),pe(),V),Pe={class:"language-switcher"},De={class:"select-wrapper"},Ie=Be(()=>c("svg",{class:"globe-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[c("circle",{cx:"12",cy:"12",r:"10"}),c("line",{x1:"2",y1:"12",x2:"22",y2:"12"}),c("path",{d:"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"})],-1)),Ae={__name:"LanguageSwitcher",setup(V){const{locale:t,availableLocales:u}=J(),m={zhCn:"简体中文",en:"English",ja:"日本語"},_=L("user-locale",t.value);return se(_,R=>{t.value=R}),K(()=>{t.value=_.value}),(R,y)=>{const I=re,B=de;return b(),U("div",Pe,[c("div",De,[Ie,o(B,{modelValue:e(_),"onUpdate:modelValue":y[0]||(y[0]=g=>ie(_)?_.value=g:null),size:"small",class:"language-select"},{default:a(()=>[(b(!0),U(le,null,ce(e(u),(g,P)=>(b(),D(I,{key:P,value:g,label:m[g]},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])])])}}},Ne=Q(Ae,[["__scopeId","data-v-179b86b4"]]),ze={class:"obs-container"},$e={class:"card-header"},Ge={class:"act-not-ready-content"},Fe={key:1},We={class:"card-header"},je={key:1},Ze={class:"card-header"},He={class:"status-info"},Ye={class:"button-container"},qe={class:"card-header"},Me={class:"card-header"},Je=me({__name:"obs2",setup(V){const{t}=J(),u=L("obs-user-config",{host:4455,password:""}),m=L("obs-user-content-setting",[]),_=L("obs-user-content-setting-extra",{limitToEightOrLess:!0}),R=L("obs-is-first-time",!0),y=N(!1),I=N(!1);let B=0;const g=N("");function P(){return new Promise(d=>{Oe({call:"cactbotRequestState"}).then(()=>{y.value=!0,d()}),setTimeout(()=>{y.value||P()},3e3)})}const W={inCombat:q.inCombat(),countdown:q.countdown(),wipe:Le.wipe},T=["Raids","UltimateRaids","Dungeons","Trials","VCDungeonFinder","DeepDungeons","Guildhests","DisciplesOfTheLand","Eureka","GrandCompany","QuestBattles","TreasureHunt","Pvp"];function X(){const d=["Raids","UltimateRaids"];if(R.value)R.value=!1,m.value=[...d.map(n=>({type:n,enter:!1,countdown:!0,combatStart:!1,combatEnd:!0,wipe:!0})),...T.filter(n=>!d.includes(n)).map(n=>({type:n,enter:!1,countdown:!1,combatStart:!1,combatEnd:!1,wipe:!1}))];else{m.value=m.value.filter(i=>T.includes(i.type));const n=T.filter(i=>!m.value.some(p=>p.type===i)).map(i=>d.includes(i)?{type:i,enter:!1,countdown:!0,combatStart:!1,combatEnd:!0,wipe:!0}:{type:i,enter:!1,countdown:!1,combatStart:!1,combatEnd:!1,wipe:!1});m.value.push(...n)}m.value.sort((n,i)=>T.indexOf(n.type)-T.indexOf(i.type))}class ee{constructor(){this.handleConnectionError=()=>{this.status.connecting=!1,this.status.connected=!1,this.status.recording=!1,this.status.outputActive=!1,this.status.outputPath="",S.modal.close(),S.modal.message({title:t("OBS Connection"),content:t("OBS Connection Error"),status:"warning",duration:2e3})},this.handleConnectionClosed=()=>{this.status.connecting=!1,this.status.connected=!1,this.status.recording=!1,this.status.outputActive=!1,this.status.outputPath="",S.modal.close(),S.modal.message({title:t("OBS Connection"),content:t("OBS Connection Closed"),status:"warning",duration:2e3})},this.ws=new he,this.status=fe({connecting:!1,connected:!1,recording:!1,outputActive:!1,outputPath:""}),this.ws.on("ConnectionClosed",this.handleConnectionClosed),this.ws.on("ConnectionError",this.handleConnectionError),this.ws.on("RecordStateChanged",n=>{this.status.connected=!0,this.status.recording=n.outputState==="OBS_WEBSOCKET_OUTPUT_STARTED",this.status.outputActive=n.outputActive,this.status.outputPath=n.outputPath})}connect(){u.value.host&&u.value.password&&(this.status.connecting=!0,this.ws.connect(`ws://127.0.0.1:${u.value.host}`,u.value.password).then(()=>{this.ws.call("GetRecordStatus").then(n=>{this.status.recording=n.outputActive,this.status.outputActive=n.outputActive}),this.status.connected=!0,S.modal.close(),S.modal.message({title:t("OBS Connection"),content:t("OBS Connection Opened"),status:"success",duration:2e3})}).finally(()=>{this.status.connecting=!1}))}disconnect(){this.ws.disconnect()}startRecord(){this.ws.call("StartRecord")}stopRecord(){this.ws.call("StopRecord")}splitRecord(){this.ws.call("StopRecord").finally(()=>{setTimeout(()=>{this.ws.call("StartRecord")},1e3)})}}const l=new ee,j=d=>{var p;const n=d.zoneID,i=(p=Ue[n])==null?void 0:p.contentType;for(const E in $)if(Object.prototype.hasOwnProperty.call($,E)&&$[E]===i){g.value=E,x("enter");return}},Z=d=>{const n=d.rawLine;for(const i in W)if(W[i].exec(n)){const w=n.split("|");switch(i){case"inCombat":{const v=w[M.InCombat.fields.inACTCombat]==="1",k=w[M.InCombat.fields.inGameCombat]==="1";if(v&&k){x("combatStart");return}if(!v&&!k){x("combatEnd");return}break}case"countdown":{x("countdown");break}case"wipe":{x("wipe");break}}}},H=d=>{B=d.party.length};function x(d){const n=l.status.recording;if(m.value.find(i=>i.type===g.value&&i[d])&&!(g.value==="Raids"&&_.value.limitToEightOrLess&&B>8))switch(d){case"enter":case"countdown":case"combatStart":n?l.splitRecord():l.startRecord();return;case"combatEnd":case"wipe":n&&l.stopRecord()}}return K(async()=>{await P(),l.connect(),G("ChangeZone",j),G("LogLine",Z),G("PartyChanged",H),X()}),_e(()=>{l.disconnect(),F("ChangeZone",j),F("LogLine",Z),F("PartyChanged",H)}),(d,n)=>{const i=Ne,p=be,E=ge,w=we,v=ve,k=Ce,te=ye,A=Ee,Y=Se,ne=Ve,C=Re,O=Te,oe=xe,ae=ke;return b(),U("div",ze,[c("header",null,[c("h1",null,r(e(t)("OBS Auto Record V2")),1),o(i)]),e(y)?z("",!0):(b(),D(p,{key:0,class:"act-not-ready-card"},{header:a(()=>[c("div",$e,[c("span",null,r(e(t)("ACT Not Ready")),1)])]),default:a(()=>[c("div",Ge,[c("p",null,r(e(t)("overlayTutorial")),1)])]),_:1})),e(y)?(b(),U("main",Fe,[e(l).status.connected?(b(),U("div",je,[e(I)?(b(),D(p,{key:0,class:"status-card"},{header:a(()=>[c("div",Ze,[c("span",null,r(e(t)("Connection Status")),1),o(v,{type:"danger",size:"small",class:"disconnect-button",onClick:n[3]||(n[3]=s=>e(l).disconnect())},{default:a(()=>[f(r(e(t)("Disconnect")),1)]),_:1})])]),default:a(()=>[c("div",He,[o(ne,{direction:"vertical",column:1,border:""},{default:a(()=>[o(Y,{label:e(t)("Recording")},{default:a(()=>[f(r(e(l).status.recording?e(t)("Yes"):e(t)("No")),1)]),_:1},8,["label"]),o(Y,{label:e(t)("Output Path")},{default:a(()=>[f(r(e(l).status.outputPath||e(t)("None")),1)]),_:1},8,["label"])]),_:1})]),c("div",Ye,[o(v,{disabled:!e(l).status.connected||e(l).status.recording,type:"primary",onClick:n[4]||(n[4]=s=>e(l).startRecord())},{default:a(()=>[f(r(e(t)("Start Record")),1)]),_:1},8,["disabled"]),o(v,{disabled:!e(l).status.connected||!e(l).status.recording,type:"danger",onClick:n[5]||(n[5]=s=>e(l).stopRecord())},{default:a(()=>[f(r(e(t)("Stop Record")),1)]),_:1},8,["disabled"]),o(v,{disabled:!e(l).status.connected||!e(l).status.recording,type:"warning",onClick:n[6]||(n[6]=s=>e(l).splitRecord())},{default:a(()=>[f(r(e(t)("Split Record")),1)]),_:1},8,["disabled"])])]),_:1})):z("",!0),o(p,{class:"table-card"},{header:a(()=>[c("div",qe,[c("span",null,r(e(t)("User Content Settings")),1)])]),default:a(()=>[o(oe,{data:e(m),style:{width:"100%"},border:!0,stripe:""},{default:a(()=>[o(C,{prop:"type",label:e(t)("Type"),"min-width":"120"},{default:a(s=>[c("span",null,r(e(t)(s.row.type)),1)]),_:1},8,["label"]),o(C,{label:e(t)("Start When"),align:"center"},{default:a(()=>[o(C,{prop:"enter",label:e(t)("Enter Zone"),align:"center",width:"100"},{default:a(s=>[o(O,{modelValue:s.row.enter,"onUpdate:modelValue":h=>s.row.enter=h},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),o(C,{prop:"countdown",label:e(t)("CountDown"),align:"center",width:"100"},{default:a(s=>[o(O,{modelValue:s.row.countdown,"onUpdate:modelValue":h=>s.row.countdown=h},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),o(C,{prop:"combatStart",label:e(t)("CombatStart"),align:"center",width:"100"},{default:a(s=>[o(O,{modelValue:s.row.combat,"onUpdate:modelValue":h=>s.row.combat=h},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"])]),_:1},8,["label"]),o(C,{label:e(t)("End When"),align:"center"},{default:a(()=>[o(C,{prop:"combatEnd",label:e(t)("CombatEnd"),align:"center",width:"100"},{default:a(s=>[o(O,{modelValue:s.row.leave,"onUpdate:modelValue":h=>s.row.leave=h},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),o(C,{prop:"wipe",label:e(t)("Wipe"),align:"center",width:"100"},{default:a(s=>[o(O,{modelValue:s.row.wipe,"onUpdate:modelValue":h=>s.row.wipe=h},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"])]),_:1},8,["label"])]),_:1},8,["data"])]),_:1}),o(p,{class:"table-card"},{header:a(()=>[c("div",Me,[c("span",null,r(e(t)("Extra Rule")),1)])]),default:a(()=>[o(k,{"label-position":"top",class:"extra-rule-form"},{default:a(()=>[o(w,{label:e(t)("Raids")},{default:a(()=>[o(ae,{modelValue:e(_).limitToEightOrLess,"onUpdate:modelValue":n[7]||(n[7]=s=>e(_).limitToEightOrLess=s)},{default:a(()=>[f(r(e(t)("limitToEightOrLess")),1)]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1}),o(A,{class:"instruction-alert",type:"info",description:e(t)("hideTutorial"),closable:!1,"show-icon":""},null,8,["description"])])):(b(),D(p,{key:0,class:"connection-card"},{header:a(()=>[c("div",We,[c("span",null,r(e(t)("Connect to OBS")),1)])]),default:a(()=>[o(k,{"label-position":"top",class:"connection-form"},{default:a(()=>[o(w,{label:e(t)("Port")},{default:a(()=>[o(E,{modelValue:e(u).host,"onUpdate:modelValue":n[0]||(n[0]=s=>e(u).host=s),placeholder:e(t)("portPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(w,{label:e(t)("Password")},{default:a(()=>[o(E,{modelValue:e(u).password,"onUpdate:modelValue":n[1]||(n[1]=s=>e(u).password=s),placeholder:e(t)("passwordPlaceholder"),type:"password"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(w,null,{default:a(()=>[o(v,{type:"primary",class:"connect-button",loading:e(l).status.connecting,disabled:e(l).status.connecting||!e(u).host||!e(u).password,onClick:n[2]||(n[2]=s=>e(l).connect())},{default:a(()=>[f(r(e(l).status.connecting?e(t)("Connecting"):e(t)("Connect")),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1}),o(te,null,{default:a(()=>[f(r(e(t)("Instructions")),1)]),_:1}),o(A,{class:"instruction-alert",type:"info",description:e(t)("obsTutorial"),closable:!1,"show-icon":""},null,8,["description"]),o(A,{class:"instruction-alert",type:"info",description:e(t)("inputTutorial"),closable:!1,"show-icon":""},null,8,["description"])]),_:1}))])):z("",!0)])}}});const ot=Q(Je,[["__scopeId","data-v-2b50f655"]]);export{ot as default};
