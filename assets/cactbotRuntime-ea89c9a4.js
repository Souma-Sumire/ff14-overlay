import{d as H,v as x,y as V,o as m,b as f,H as C,I as R,a as w,w as D,u as l,P as M,t as U,aE as te,B as ae,r as L,g as oe,f as _,a1 as ne,aF as re,D as $,F as G,p as se,j as le,c as ue}from"./vendor-d54c40a3.js";import{U as n,j as ce}from"./util-ef9ccf87.js";import{_ as z}from"./index-cf486db8.js";import{c as ie,a as E}from"./overlay_plugin_api-409cb9ea.js";const de={flex:"~ col"},pe=H({__name:"dragJob",props:{party:{}},emits:["updateSortArr"],setup(k,{emit:T}){const b=x(),i=x(!0),g=T,J=k,N=()=>{g("updateSortArr",Object.values(j.value).flat().map(a=>a.id))},F=[{name:"tank",color:"blue"},{name:"healer",color:"green"},{name:"dps",color:"red"},{name:"crafter",color:"yellow"},{name:"gatherer",color:"purple"},{name:"none",color:"gray"}];function o(a){return J.party.find(u=>u.job===a)}const O=n.getBattleJobs3(),h=["tank","healer","dps","crafter","gatherer","none"],y=(()=>{const a={},u={tank:n.isTankJob,healer:n.isHealerJob,dps:n.isDpsJob,crafter:n.isCraftingJob,gatherer:n.isGatheringJob};for(const r of h)a[r]=(r==="none"?[]:O.filter(c=>u[r](c))).map(c=>n.jobToJobEnum(c)).sort((c,s)=>n.enumSortMethod(c,s));return a})(),v=Object.values(y).flat().map(a=>({name:n.nameToFullName(n.jobEnumToJob(a)).simple1,id:a})),j=V("cactbotRuntime-jobList",(()=>{const a={};for(const u of h)a[u]=v.filter(r=>y[u].includes(r.id)).sort((r,c)=>y[u].indexOf(r.id)-y[u].indexOf(c.id));return a})());return(a,u)=>(m(),f("div",de,[(m(),f(C,null,R(F,(r,c)=>w(l(te),{key:c,ref_for:!0,ref_key:"el",ref:b,disabled:!i.value,modelValue:l(j)[r.name],"onUpdate:modelValue":s=>l(j)[r.name]=s,animation:"150",ghostClass:"ghost",class:"flex flex-row gap-0.25 p-0 m-t-0.25 m-b-0.25 rounded",onUpdate:N,filter:".no-draggable",forceFallback:!0},{default:D(()=>[(m(!0),f(C,null,R(l(j)[r.name],s=>(m(),f("div",{key:s.id,class:M(`${o(s.id)?`draggable bg-${r.color} cursor-move`:"no-draggable bg-gray-700/50"} rounded p-l-0.6 p-r-0.6 p-t-0 p-b-0.3 m-0 color-white`)},U(s.name),3))),128))]),_:2},1032,["disabled","modelValue","onUpdate:modelValue"])),64))]))}});const me=z(pe,[["__scopeId","data-v-9039b8ac"]]),I=k=>(se("data-v-341c9039"),k=k(),le(),k),fe={key:0,style:{color:"white","text-shadow":"1px 1px 2px black"}},_e=I(()=>_("span",null,"用法",-1)),be=I(()=>_("p",null,"使悬浮窗的位置分配对应游戏内的实际位置（D1D2等）",-1)),ye=I(()=>_("ul",null,[_("li",null,"临时：下拉选择框修改。"),_("li",null,"长期：用鼠标拖动职能顺序。")],-1)),ve={class:"players"},ge=H({__name:"cactbotRuntime",setup(k){const T=x(new Date().getMonth()===3&&new Date().getDate()===1),b=(e,t)=>Array(t).fill(e).map((d,A)=>d+(+A+1)),i={tank:["MT","ST",...b("T",70)],healer:[...b("H",72)],dps:[...b("D",72)],crafter:[...b("C",72)],gatherer:[...b("G",72)],none:[...b("N",72)]},g=x(!1),J=V("cactbotRuntime-sortArr",ce),N=[{id:"10000001",name:"虚构战士",job:21,inParty:!0},{id:"10000002",name:"虚构骑士",job:19,inParty:!0},{id:"10000003",name:"虚构占星",job:33,inParty:!0},{id:"10000004",name:"虚构学者",job:28,inParty:!0},{id:"10000005",name:"虚构忍者",job:30,inParty:!0},{id:"10000006",name:"虚构武士",job:34,inParty:!0},{id:"10000007",name:"虚构黑魔",job:25,inParty:!0},{id:"10000008",name:"虚构舞者",job:38,inParty:!0}],o=V("cactbotRuntime-data",{party:[]}),O=V("cactbotRuntime-showTips",x(!0)),h={tank:0,healer:0,dps:0,crafter:0,gatherer:0,none:0};function y(){h.tank=o.value.party.reduce((e,t)=>a(t.job)==="tank"?e+1:e,0),h.healer=o.value.party.reduce((e,t)=>a(t.job)==="healer"?e+1:e,0),h.dps=o.value.party.reduce((e,t)=>a(t.job)==="dps"?e+1:e,0)}const S=location.href.includes("localhost"),v=x(!1),j=x(S?"虚构占星":"");if(S){const e={party:N};O.value&&(g.value=!0),o.value.party=e.party.map(t=>({...t,rp:"",specify:!1})),u(),y(),s()}function a(e){const t=Number(e);return[1,3,19,21,32,37].includes(t)?"tank":[6,24,28,33,40].includes(t)?"healer":[2,4,5,7,20,22,23,25,26,27,29,30,31,34,35,36,38,39].includes(t)?"dps":n.isCraftingJob(n.jobEnumToJob(e))?"crafter":n.isGatheringJob(n.jobEnumToJob(e))?"gatherer":"none"}function u(){o.value.party.sort((e,t)=>J.value.indexOf(e.job)-J.value.indexOf(t.job));for(const e of o.value.party)e.rp=void 0,e.rp=c(e)}function r(e){o.value.party[e].specify=!0;const t=o.value.party.find(d=>d.rp===o.value.party[e].rp&&d.id!==o.value.party[e].id);t&&(t.rp=c(t),t.specify=!0),s()}function c(e){return i[a(e.job)].find(t=>!o.value.party.find(d=>d.rp===t))??"unknown"}function s(){const e=[...i.tank,...i.healer,...i.dps,...i.crafter,...i.gatherer,...i.none];o.value.party.sort((t,d)=>e.indexOf(t.rp??"")-e.indexOf(d.rp??"")),ie({call:"broadcast",source:"soumaRuntimeJS",msg:{party:o.value.party}})}function q(){v.value=!0}function K(){v.value=!1}function Q(e){J.value=e,u(),y(),s()}const W=e=>n.nameToFullName(n.jobEnumToJob(e)).simple1,X=e=>e;return ae(()=>{s(),E("PartyChanged",e=>{O.value&&(g.value=!0),!(S&&e.party.length===0)&&(o.value.party=e.party.filter(t=>t.inParty).map(t=>({...t,rp:"",specify:!1})),u(),y(),s())}),E("ChangePrimaryPlayer",e=>{S||(j.value=e.charName)}),E("BroadcastMessage",e=>{e.source==="soumaUserJS"&&typeof e.msg=="object"&&e.msg!==null&&Reflect.get(e.msg,"text")==="requestData"&&s()}),startOverlayEvents()}),(e,t)=>{const d=L("vxe-modal"),A=L("vxe-option"),Y=L("vxe-select"),Z=me;return m(),f(C,null,[l(o).party.length===0?(m(),f("span",fe,"等待小队...")):oe("",!0),_("div",{onMouseenter:q,onMouseleave:K},[w(d,{modelValue:l(g),"onUpdate:modelValue":t[0]||(t[0]=p=>ne(g)?g.value=p:null),size:"small",position:{left:10,top:10},width:"90vw"},{title:D(()=>[_e]),default:D(()=>[be,ye]),_:1},8,["modelValue"]),_("main",{class:M(l(v)?"mouseIn":"")},[_("div",ve,[w(re,{name:"animate__animated animate__bounce","enter-active-class":"animate__fadeInLeft","leave-active-class":"animate__fadeOutLeft"},{default:D(()=>[(m(!0),f(C,null,R(l(o).party,(p,ee)=>$((m(),f("section",{key:p.id,flex:"~ nowrap",class:"player"},[w(Y,{modelValue:p.rp,"onUpdate:modelValue":P=>p.rp=P,size:"mini",onChange:P=>r(ee),"class-name":"select"},{default:D(()=>[(m(!0),f(C,null,R(i[a(p.job)],(P,B)=>(m(),ue(A,{visible:B<h[a(p.job)],key:B,value:P,label:P},null,8,["visible","value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),_("span",{class:M(["name",l(T)?"aprilFoolSDay":""])},U(W(p.job))+" "+U(l(v)?X(p.name):""),3)])),[[G,l(v)||p.name===l(j)]])),128))]),_:1})]),$(w(Z,{class:"dragJob",onUpdateSortArr:Q,party:l(o).party,"m-b-1":"","p-1":""},null,8,["party"]),[[G,l(v)]])],2)],32)],64)}}});const Je=z(ge,[["__scopeId","data-v-341c9039"]]);export{Je as default};
